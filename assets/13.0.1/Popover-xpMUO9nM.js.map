{"version":3,"file":"Popover-xpMUO9nM.js","sources":["../../../packages/lake/src/components/FlatList.tsx","../../../packages/lake/src/components/Popover.tsx"],"sourcesContent":["import { Fragment, ReactNode, Ref, useEffect, useRef } from \"react\";\nimport { StyleProp, StyleSheet, View, ViewStyle, WebRole } from \"react-native\";\nimport { ScrollView, ScrollViewProps, ScrollViewRef } from \"./ScrollView\";\n\nconst styles = StyleSheet.create({\n  scrollTracker: {\n    position: \"absolute\",\n    pointerEvents: \"none\",\n    right: 0,\n    bottom: 0,\n  },\n});\n\nexport type FlatListRef = ScrollViewRef;\n\nexport type ListRenderItemInfo<T> = {\n  item: T;\n  index: number;\n};\n\ntype Props<T> = {\n  ref?: Ref<FlatListRef>;\n  ItemSeparatorComponent?: ReactNode;\n  ListEmptyComponent?: ReactNode;\n  ListFooterComponent?: ReactNode;\n  ListHeaderComponent?: ReactNode;\n  contentContainerStyle?: StyleProp<ViewStyle>;\n  data: T[];\n  horizontal?: boolean;\n  keyExtractor: (item: T, index: number) => string;\n  onEndReached?: () => void;\n  onEndReachedThresholdPx?: number;\n  onKeyDown?: ScrollViewProps[\"onKeyDown\"];\n  onScroll?: ScrollViewProps[\"onScroll\"];\n  renderItem: (info: ListRenderItemInfo<T>) => ReactNode;\n  role?: WebRole;\n  scrollEventThrottle?: number;\n  showsScrollIndicators?: boolean;\n  style?: StyleProp<ViewStyle>;\n};\n\nexport const FlatList = <T,>({\n  ref,\n  ItemSeparatorComponent,\n  ListEmptyComponent,\n  ListFooterComponent,\n  ListHeaderComponent,\n  contentContainerStyle,\n  data,\n  horizontal = false,\n  keyExtractor,\n  onEndReached,\n  onEndReachedThresholdPx = 200,\n  onKeyDown,\n  onScroll,\n  renderItem,\n  role,\n  scrollEventThrottle = 16,\n  showsScrollIndicators = true,\n  style,\n}: Props<T>) => {\n  const scrollTrackerRef = useRef<View>(null);\n\n  const scrollTrackerStyle = horizontal\n    ? { top: 0, width: onEndReachedThresholdPx }\n    : { left: 0, height: onEndReachedThresholdPx };\n\n  // biome-ignore lint/correctness/useExhaustiveDependencies(onEndReached):\n  // biome-ignore lint/correctness/useExhaustiveDependencies(data.length):\n  useEffect(() => {\n    const element = scrollTrackerRef.current as unknown as HTMLElement;\n\n    if (element != null) {\n      const observer = new IntersectionObserver(entries => {\n        entries.forEach(entry => {\n          if (entry.isIntersecting) {\n            onEndReached?.();\n          }\n        });\n      });\n\n      observer.observe(element);\n\n      return () => {\n        observer.unobserve(element);\n      };\n    }\n    // re-create an observer only on list length change\n  }, [data.length]);\n\n  return (\n    <ScrollView\n      contentContainerStyle={contentContainerStyle}\n      horizontal={horizontal}\n      onKeyDown={onKeyDown}\n      onScroll={onScroll}\n      ref={ref}\n      role={role}\n      scrollEventThrottle={scrollEventThrottle}\n      showsScrollIndicators={showsScrollIndicators}\n      style={style}\n    >\n      {ListHeaderComponent}\n\n      {data.length <= 0\n        ? ListEmptyComponent\n        : data.map((item, index) => (\n            <Fragment key={keyExtractor(item, index)}>\n              {index !== 0 && ItemSeparatorComponent}\n              {renderItem({ item, index })}\n            </Fragment>\n          ))}\n\n      {ListFooterComponent}\n\n      <View role=\"none\" ref={scrollTrackerRef} style={[styles.scrollTracker, scrollTrackerStyle]} />\n    </ScrollView>\n  );\n};\n","import { memo, ReactNode, RefObject, useCallback, useEffect, useRef, useState } from \"react\";\nimport {\n  AnimationStyles,\n  GestureResponderEvent,\n  Pressable,\n  StyleSheet,\n  Text,\n  View,\n} from \"react-native\";\nimport { match, P } from \"ts-pattern\";\nimport {\n  Animation,\n  animations,\n  backgroundColor,\n  radii,\n  shadows,\n  spacings,\n} from \"../constants/design\";\nimport { useContextualLayer } from \"../hooks/useContextualLayer\";\nimport { useResponsive } from \"../hooks/useResponsive\";\nimport { noop } from \"../utils/function\";\nimport { BottomPanel } from \"./BottomPanel\";\nimport { FocusTrap } from \"./FocusTrap\";\nimport { Portal } from \"./Portal\";\nimport { ScrollView } from \"./ScrollView\";\nimport { TransitionView } from \"./TransitionView\";\n\ntype Props = {\n  children: ReactNode | ((state: { mode: \"dropdown\" | \"panel\" }) => ReactNode);\n  id?: string;\n  label?: string;\n  placement?: \"left\" | \"right\" | \"center\";\n  role?: \"listbox\" | \"combobox\" | \"dialog\";\n  describedBy?: string;\n  matchReferenceWidth?: boolean;\n  matchReferenceMinWidth?: boolean;\n  onDismiss?: () => void;\n  onEscapeKey?: () => void;\n  referenceRef: RefObject<View | Text | null>;\n  returnFocus?: boolean;\n  autoFocus?: boolean;\n  visible: boolean;\n  underlay?: boolean;\n  safetyMargin?: number;\n  forcedMode?: \"Dropdown\" | \"BottomPanel\";\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    ...StyleSheet.absoluteFillObject,\n    pointerEvents: \"none\",\n  },\n  defaultCursor: {\n    cursor: \"default\",\n  },\n  underlay: {\n    pointerEvents: \"auto\",\n    cursor: \"default\",\n    position: \"fixed\",\n    left: 0,\n    top: 0,\n    bottom: 0,\n    right: 0,\n  },\n  popoverContainer: {\n    position: \"absolute\",\n    display: \"flex\",\n  },\n  popover: {\n    pointerEvents: \"auto\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    backgroundColor: backgroundColor.accented,\n    borderRadius: radii[8],\n    marginVertical: spacings[8],\n    overflow: \"hidden\",\n    boxShadow: shadows.modal,\n    flexGrow: 1,\n    alignSelf: \"stretch\",\n  },\n  popoverContents: {\n    alignItems: \"stretch\",\n  },\n});\n\nconst animation: Animation = {\n  ...animations.fadeAndSlideInFromBottom,\n  leave: [\n    animations.fadeAndSlideInFromBottom.leave,\n    { animationDuration: \"100ms\" },\n  ] as unknown as AnimationStyles,\n};\n\nexport const VIEWPORT_WIDTH_THRESHOLD = 600;\n\nexport const Popover = memo<Props>(\n  ({\n    children,\n    id,\n    label,\n    placement,\n    role = \"dialog\",\n    describedBy,\n    matchReferenceWidth = false,\n    matchReferenceMinWidth = false,\n    onDismiss = noop,\n    onEscapeKey = onDismiss,\n    referenceRef,\n    returnFocus = true,\n    autoFocus = true,\n    visible,\n    underlay = true,\n    forcedMode,\n  }) => {\n    const [rootElement, setRootElement] = useState<Element | null>(null);\n    const underlayRef = useRef<View>(null);\n    const { desktop } = useResponsive(VIEWPORT_WIDTH_THRESHOLD);\n\n    const { position } = useContextualLayer({\n      placement,\n      referenceRef,\n      visible,\n      matchReferenceWidth,\n      matchReferenceMinWidth,\n    });\n\n    useEffect(() => {\n      const element = underlayRef.current as unknown as HTMLElement | null;\n      if (!visible && element != null) {\n        element.style.pointerEvents = \"none\";\n      }\n    }, [visible]);\n\n    useEffect(() => {\n      const element = document.createElement(\"div\");\n      document.body.append(element);\n      setRootElement(element);\n      return () => {\n        setRootElement(null);\n        element.remove();\n      };\n    }, []);\n\n    const onPressUnderlay = useCallback(\n      (event: GestureResponderEvent) => {\n        event.preventDefault();\n        onDismiss();\n      },\n      [onDismiss],\n    );\n\n    const onClickOutside = useCallback(\n      ({ target }: MouseEvent | TouchEvent) => {\n        const ref = referenceRef.current;\n        if (\n          !(ref instanceof Element) ||\n          !(target instanceof Element) ||\n          (ref !== target && !ref.contains(target))\n        ) {\n          onDismiss();\n        }\n      },\n      [referenceRef, onDismiss],\n    );\n\n    const onPress = useCallback((event: GestureResponderEvent) => {\n      event.preventDefault();\n    }, []);\n\n    if (rootElement == null) {\n      return null;\n    }\n\n    const mode = match(forcedMode)\n      .with(P.nullish, () => (desktop ? \"Dropdown\" : \"BottomPanel\"))\n      .with(\"BottomPanel\", () => \"BottomPanel\" as const)\n      .with(\"Dropdown\", () => \"Dropdown\" as const)\n      .exhaustive();\n\n    if (mode === \"BottomPanel\") {\n      return (\n        <BottomPanel visible={visible} onPressClose={onDismiss} returnFocus={false}>\n          {typeof children === \"function\" ? children({ mode: \"panel\" }) : children}\n        </BottomPanel>\n      );\n    }\n\n    return (\n      <Portal container={rootElement}>\n        {visible && underlay ? (\n          <Pressable\n            ref={underlayRef}\n            style={styles.underlay}\n            onPress={onPressUnderlay}\n            aria-label=\"Close\"\n          />\n        ) : null}\n\n        <TransitionView style={styles.container} {...animation}>\n          {position.isSome() ? (\n            <View style={position.get().rootStyle}>\n              <View\n                style={[\n                  styles.popoverContainer,\n                  position.get().style,\n                  {\n                    alignItems: match(position.get().horizontalPosition)\n                      .with(\"left\", () => \"flex-start\" as const)\n                      .with(\"center\", () => \"center\" as const)\n                      .with(\"right\", () => \"flex-end\" as const)\n                      .exhaustive(),\n                  },\n                ]}\n              >\n                <ScrollView\n                  style={styles.popover}\n                  contentContainerStyle={styles.popoverContents}\n                  id={id}\n                  role={role}\n                  aria-describedby={describedBy}\n                  aria-label={label}\n                >\n                  <FocusTrap\n                    focusLock={true}\n                    returnFocus={returnFocus}\n                    autoFocus={autoFocus}\n                    onEscapeKey={onEscapeKey}\n                    onClickOutside={underlay ? undefined : onClickOutside}\n                  >\n                    <Pressable tabIndex={-1} onPress={onPress} style={styles.defaultCursor}>\n                      {typeof children === \"function\" ? children({ mode: \"dropdown\" }) : children}\n                    </Pressable>\n                  </FocusTrap>\n                </ScrollView>\n              </View>\n            </View>\n          ) : null}\n        </TransitionView>\n      </Portal>\n    );\n  },\n);\n"],"names":["styles","StyleSheet","FlatList","ref","ItemSeparatorComponent","ListEmptyComponent","ListFooterComponent","ListHeaderComponent","contentContainerStyle","data","horizontal","keyExtractor","onEndReached","onEndReachedThresholdPx","onKeyDown","onScroll","renderItem","role","scrollEventThrottle","showsScrollIndicators","style","scrollTrackerRef","useRef","scrollTrackerStyle","useEffect","element","observer","entries","entry","jsxs","ScrollView","item","index","Fragment","jsx","View","backgroundColor","radii","spacings","shadows","animation","animations","VIEWPORT_WIDTH_THRESHOLD","Popover","memo","children","id","label","placement","describedBy","matchReferenceWidth","matchReferenceMinWidth","onDismiss","noop","onEscapeKey","referenceRef","returnFocus","autoFocus","visible","underlay","forcedMode","rootElement","setRootElement","useState","underlayRef","desktop","useResponsive","position","useContextualLayer","onPressUnderlay","useCallback","event","onClickOutside","target","onPress","match","P","BottomPanel","Portal","Pressable","TransitionView","FocusTrap"],"mappings":"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"}