import{i as I,v as A,P as G}from"./Boxed-xcydBHmC.js";import{r as s}from"./index-CBqU2yxZ.js";const H=z=>z,M=()=>{},T=z=>{const[,p]=s.useReducer(()=>[],[]),w=s.useRef(!1),b=s.useRef("untouched"),F=s.useRef(z);F.current=z,s.useEffect(()=>(w.current=!0,()=>{w.current=!1}),[]);const u=s.useRef(),x=s.useRef(),N=s.useRef(),o=s.useMemo(()=>{const d=e=>F.current[e].initialValue,S=e=>{var t;return(t=F.current[e].sanitize)!=null?t:H},f=(e,t)=>{u.current[e].state=typeof t=="function"?t(u.current[e].state):t},i=e=>{const{talkative:t,value:n,validity:r}=u.current[e].state;if(!t||r.tag==="unknown")return{value:n,valid:!1,error:void 0};const l=S(e),k=(O=>{var V;return(V=F.current[O].isEqual)!=null?V:Object.is})(e);return{value:n,valid:r.tag==="valid"&&!k(l(d(e)),l(n)),error:r.tag==="invalid"?r.error:void 0}},y=e=>{u.current[e].callbacks.forEach(t=>t())},v=(e,t)=>{const n=(r=>{var l;return(l=F.current[r].strategy)!=null?l:"onSuccessOrBlur"})(e);t&&!t.some(r=>n===r)||f(e,r=>({...r,talkative:!0}))},h=e=>e===void 0?{tag:"valid"}:{tag:"invalid",error:e},a=function(e,t){t===void 0&&(t={});const{sanitize:n=!1}=t,r=u.current[e]==null?d(e):u.current[e].state.value;return n?S(e)(r):r},m=e=>{const{ref:t}=u.current[e];t.current&&typeof t.current.focus=="function"&&t.current.focus()},E=e=>{const t=(r=>{var l;return(l=F.current[r].validate)!=null?l:M})(e),n=t(a(e,{sanitize:!0}),{getFieldValue:a,focusField:m});return n===void 0&&v(e,["onSuccess","onSuccessOrBlur"]),f(e,r=>({...r,validity:h(n)})),y(e),n},J=e=>{f(e,{value:d(e),talkative:!1,validity:{tag:"unknown"}}),y(e)},L=()=>{b.current="submitted",w.current&&p()};return{getFieldValue:a,setFieldValue:function(e,t,n){n===void 0&&(n={});const{validate:r=!1}=n;f(e,l=>({...l,value:t})),r&&v(e),E(e)},setFieldError:(e,t)=>{f(e,n=>({...n,validity:h(t)})),v(e),y(e)},focusField:m,resetField:J,sanitizeField:e=>{const t=S(e);f(e,n=>{let{talkative:r,value:l,validity:k}=n;return{value:t(l),talkative:r,validity:k}}),y(e)},validateField:e=>{if((t=>u.current[t].mounted)(e))return v(e),E(e)},listenFields:(e,t)=>{const n=()=>{t(e.reduce((r,l)=>(r[l]=i(l),r),{}))};return e.forEach(r=>u.current[r].callbacks.add(n)),()=>{e.forEach(r=>u.current[r].callbacks.delete(n))}},resetForm:()=>{I.keys(F.current).forEach(e=>J(e)),b.current="untouched",p()},submitForm:function(e){let{onSuccess:t=M,onFailure:n=M,focusOnFirstError:r=!0}=e===void 0?{}:e;if(b.current==="submitting")return;b.current="submitting";const l=I.keys(u.current),k=l.filter(c=>u.current[c].mounted),O={},V={},B=[];if(l.forEach(c=>{O[c]=A.None()}),k.forEach((c,g)=>{v(c),O[c]=A.Some(a(c,{sanitize:!0})),B[g]=E(c)}),(c=>c.every(g=>g===void 0))(B)){const c=t(O),g=G.isFuture(c)?c.toPromise():c;!(R=g)||typeof R!="object"&&typeof R!="function"||typeof R.then!="function"?L():(p(),g.finally(L))}else r&&((c,g)=>{const q=c[g.findIndex(D=>D!==void 0)];q!==void 0&&m(q)})(k,B),k.forEach((c,g)=>{V[c]=B[g]}),n(V),b.current="submitted",p();var R},getOnChange:e=>t=>{f(e,n=>({...n,value:t})),v(e,["onChange"]),b.current!=="untouched"&&b.current!=="submitted"||(b.current="editing",p()),E(e)},getOnBlur:e=>()=>{const{validity:t}=u.current[e].state;t.tag==="unknown"||(n=>u.current[n].state.talkative)(e)||(v(e,["onBlur","onSuccessOrBlur"]),E(e))},getFieldState:i}},[]),C={};for(const d in F.current){var j,P;Object.prototype.hasOwnProperty.call(F.current,d)&&(C[d]=(j=(P=u.current)==null?void 0:P[d])!=null?j:{callbacks:new Set,ref:{current:null},mounted:!1,state:{value:F.current[d].initialValue,talkative:!1,validity:{tag:"unknown"}}})}if(u.current=C,!x.current){const d=f=>{let{name:i,children:y}=f;const{subscribe:v,getSnapshot:h}=s.useMemo(()=>({getSnapshot:()=>u.current[i].state,subscribe:a=>(u.current[i].callbacks.add(a),()=>{u.current[i].callbacks.delete(a)})}),[i]);return s.useSyncExternalStore(v,h,h),s.useEffect(()=>{const a=!u.current[i].mounted;return a&&(u.current[i].mounted=!0),()=>{a&&(u.current[i].mounted=!1)}},[i]),y({...o.getFieldState(i),ref:u.current[i].ref,onBlur:s.useMemo(()=>o.getOnBlur(i),[i]),onChange:s.useMemo(()=>o.getOnChange(i),[i])})};d.displayName="Field",x.current=d;const S=f=>{let{names:i,children:y}=f;const{subscribe:v,getSnapshot:h}=s.useMemo(()=>({getSnapshot:()=>JSON.stringify(i.map(a=>u.current[a].state)),subscribe:a=>(i.forEach(m=>u.current[m].callbacks.add(a)),()=>{i.forEach(m=>u.current[m].callbacks.delete(a))})}),[JSON.stringify(i)]);return s.useSyncExternalStore(v,h,h),y(i.reduce((a,m)=>(a[m]=o.getFieldState(m),a),{}))};S.displayName="FieldsListener",N.current=S}return{formStatus:b.current,Field:x.current,FieldsListener:N.current,getFieldValue:o.getFieldValue,setFieldValue:o.setFieldValue,setFieldError:o.setFieldError,focusField:o.focusField,resetField:o.resetField,sanitizeField:o.sanitizeField,validateField:o.validateField,listenFields:o.listenFields,resetForm:o.resetForm,submitForm:o.submitForm}};export{T as f};
//# sourceMappingURL=index-DMKL_UYy.js.map
