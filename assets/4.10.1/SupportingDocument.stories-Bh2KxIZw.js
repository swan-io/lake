import{o as ee,s as z,j as D,a as t,N as T,m as te,S as b,F as re,L as U,p as ae,k as ne}from"./Space-D-8LYWdG.js";import{i as oe}from"./Boxed-xcydBHmC.js";import{r as d}from"./index-CBqU2yxZ.js";import{c as ie}from"./commonStyles-eL7lPPQ9.js";import{a as K,L as q}from"./LakeButton-DxjKuUZ1.js";import{L as le}from"./LakeLabel-CnFONVZn.js";import{f as se}from"./index-DMKL_UYy.js";import{i as H,t as o,l as ue}from"./i18n-OElK1gMB.js";import{L as N}from"./LakeModal-DCqdmv5L.js";import{U as pe}from"./UploadArea-C9ny6kLJ.js";import{S as de,a as me}from"./_StoriesComponents-B4nu2aGF.js";import"./extends-CCbyfPlC.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-BtM5VmRH.js";import"./Pressable-T6P0vImJ.js";import"./index-DMz-6n7T.js";import"./v4-D8aEg3BZ.js";import"./rifm-B7rfNgIs.js";import"./utc-DJvBpWoA.js";import"./array-rjEBP2Ry.js";import"./FocusTrap-DOrUCCZC.js";import"./a11y-DXvpDVrG.js";import"./LakeHeading-sCHYwGgv.js";import"./LoadingView-C1kjaShj.js";import"./ResponsiveContainer-B_dxXhmU.js";import"./TransitionView-CVpgs8rS.js";import"./useBodyClassName-FAgY5CgW.js";import"./useBoolean-B5BCxMq_.js";import"./LakeAlert-BFQ6f8Gl.js";import"./Tag-D3OQLLeX.js";import"./index-Hxs8W7Od.js";import"./index-D3ylJrlI.js";const V=d.memo(d.forwardRef(({style:r,onReset:i,onSubmit:l,...c},S)=>ee("form",{...c,ref:S,onReset:f=>{f.preventDefault(),i==null||i(f)},onSubmit:f=>{f.preventDefault(),l==null||l(f)},style:[ie.view,r]})));V.displayName="Form";try{V.displayName="Form",V.__docgenInfo={description:"",displayName:"Form",props:{onKeyDown:{defaultValue:null,description:"",name:"onKeyDown",required:!1,type:{name:"((event: NativeSyntheticEvent<KeyboardEvent<Element>>) => void)"}},onKeyDownCapture:{defaultValue:null,description:"",name:"onKeyDownCapture",required:!1,type:{name:"((event: NativeSyntheticEvent<KeyboardEvent<Element>>) => void)"}},onKeyUp:{defaultValue:null,description:"",name:"onKeyUp",required:!1,type:{name:"((event: NativeSyntheticEvent<KeyboardEvent<Element>>) => void)"}},onKeyUpCapture:{defaultValue:null,description:"",name:"onKeyUpCapture",required:!1,type:{name:"((event: NativeSyntheticEvent<KeyboardEvent<Element>>) => void)"}},tabIndex:{defaultValue:null,description:"Additional accessibility props",name:"tabIndex",required:!1,type:{name:"enum",value:[{value:"0"},{value:"-1"}]}},"aria-activedescendant":{defaultValue:null,description:`Aria props (additional, minus existants)
@see https://necolas.github.io/react-native-web/docs/accessibility
@see https://reactnative.dev/docs/accessibility#aria-valuemax`,name:"aria-activedescendant",required:!1,type:{name:"string"}},"aria-atomic":{defaultValue:null,description:"",name:"aria-atomic",required:!1,type:{name:"boolean"}},"aria-autocomplete":{defaultValue:null,description:"",name:"aria-autocomplete",required:!1,type:{name:"string"}},"aria-colcount":{defaultValue:null,description:"",name:"aria-colcount",required:!1,type:{name:"number"}},"aria-colindex":{defaultValue:null,description:"",name:"aria-colindex",required:!1,type:{name:"number"}},"aria-colspan":{defaultValue:null,description:"",name:"aria-colspan",required:!1,type:{name:"number"}},"aria-controls":{defaultValue:null,description:"",name:"aria-controls",required:!1,type:{name:"string"}},"aria-current":{defaultValue:null,description:"",name:"aria-current",required:!1,type:{name:'boolean | "page" | "step" | "location" | "date" | "time"'}},"aria-describedby":{defaultValue:null,description:"",name:"aria-describedby",required:!1,type:{name:"string"}},"aria-details":{defaultValue:null,description:"",name:"aria-details",required:!1,type:{name:"string"}},"aria-errormessage":{defaultValue:null,description:"",name:"aria-errormessage",required:!1,type:{name:"string"}},"aria-flowto":{defaultValue:null,description:"",name:"aria-flowto",required:!1,type:{name:"string"}},"aria-haspopup":{defaultValue:null,description:"",name:"aria-haspopup",required:!1,type:{name:"string"}},"aria-invalid":{defaultValue:null,description:"",name:"aria-invalid",required:!1,type:{name:"boolean"}},"aria-keyshortcuts":{defaultValue:null,description:"",name:"aria-keyshortcuts",required:!1,type:{name:"string"}},"aria-level":{defaultValue:null,description:"",name:"aria-level",required:!1,type:{name:"number"}},"aria-multiline":{defaultValue:null,description:"",name:"aria-multiline",required:!1,type:{name:"boolean"}},"aria-multiselectable":{defaultValue:null,description:"",name:"aria-multiselectable",required:!1,type:{name:"boolean"}},"aria-orientation":{defaultValue:null,description:"",name:"aria-orientation",required:!1,type:{name:"enum",value:[{value:'"horizontal"'},{value:'"vertical"'}]}},"aria-owns":{defaultValue:null,description:"",name:"aria-owns",required:!1,type:{name:"string"}},"aria-placeholder":{defaultValue:null,description:"",name:"aria-placeholder",required:!1,type:{name:"string"}},"aria-posinset":{defaultValue:null,description:"",name:"aria-posinset",required:!1,type:{name:"number"}},"aria-pressed":{defaultValue:null,description:"",name:"aria-pressed",required:!1,type:{name:"boolean"}},"aria-readonly":{defaultValue:null,description:"",name:"aria-readonly",required:!1,type:{name:"boolean"}},"aria-required":{defaultValue:null,description:"",name:"aria-required",required:!1,type:{name:"boolean"}},"aria-roledescription":{defaultValue:null,description:"",name:"aria-roledescription",required:!1,type:{name:"string"}},"aria-rowcount":{defaultValue:null,description:"",name:"aria-rowcount",required:!1,type:{name:"number"}},"aria-rowindex":{defaultValue:null,description:"",name:"aria-rowindex",required:!1,type:{name:"number"}},"aria-rowspan":{defaultValue:null,description:"",name:"aria-rowspan",required:!1,type:{name:"number"}},"aria-setsize":{defaultValue:null,description:"",name:"aria-setsize",required:!1,type:{name:"number"}},"aria-sort":{defaultValue:null,description:"",name:"aria-sort",required:!1,type:{name:"enum",value:[{value:'"none"'},{value:'"ascending"'},{value:'"descending"'},{value:'"other"'}]}},onReset:{defaultValue:null,description:"",name:"onReset",required:!1,type:{name:"((event: FormEvent<HTMLElement>) => void)"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!1,type:{name:"((event: FormEvent<HTMLElement>) => void)"}}}}}catch{}const j=20,ce=j*1e3*1e3,fe=["application/pdf","image/png","image/jpeg"],L="NO_ID_YET",ye=r=>{if(r.length===0)return o("error.requiredField")},I=z.create({button:{opacity:1},buttonWithDefaultCursor:{opacity:1,cursor:"default"}}),O=r=>T(r).with({type:"tooltip"},({text:i,width:l})=>t(ae,{content:i,width:l,togglableOnFocus:!0,placement:"top",children:t(q,{mode:"tertiary",size:"small",color:"gray",icon:"question-circle-regular",disabled:!0,style:[I.button,I.buttonWithDefaultCursor],ariaLabel:o("supportingDocuments.help.whatIsThis")})})).with({type:"button"},({label:i,onPress:l})=>t(q,{mode:"tertiary",size:"small",color:"gray",icon:"question-circle-regular",onPress:l,style:I.button,ariaLabel:o("supportingDocuments.help.whatIsThis"),children:i})).exhaustive(),A=r=>{const i=`supportingDocuments.purpose.${r}`;return H(i)?o(i):r},F=r=>{const i=`supportingDocuments.purpose.${r}.description`;return H(i)?o(i):""},ge=({documents:r,getAwsUrl:i,onChange:l,requiredDocumentPurposes:c,onboardingLanguage:S=ue.language},f)=>{const W=d.useMemo(()=>r.reduce((n,e)=>({...n,[e.purpose]:[...n[e.purpose]??[],{status:"finished",id:e.id,name:e.name,fileUrl:e.downloadUrl}]}),{}),[r]),[$,x]=d.useState(!1),[G,k]=d.useState(!1),{Field:X,setFieldValue:h,getFieldValue:w,listenFields:M,submitForm:Y}=se(c.reduce((n,e)=>({...n,[e]:{initialValue:W[e]??[],validate:ye}}),{}));d.useImperativeHandle(f,()=>({submit:n=>{Y({onSuccess:()=>n(!0),onFailure:()=>n(!1)})}})),d.useEffect(()=>{const n=M(c,e=>{let p=[];oe.entries(e).forEach(([y,{value:u=[]}])=>{p=[...p,...u.map(m=>({id:m.id,name:m.name,downloadUrl:m.fileUrl,purpose:y}))]}),l==null||l(p)});return()=>n()},[M,l,c]);const Z=(n,e)=>{const p=n[0];ne(p)||i(p,e).then(({upload:{url:y,fields:u},id:m})=>{const g=new XMLHttpRequest;g.open("POST",y,!0);const J=w(e);h(e,J.map(s=>s.id===L?{status:"uploading",progress:0,name:p.name,id:m}:s)),g.upload.onprogress=s=>{const a=s.loaded/s.total*100,Q=w(e);h(e,Q.map(E=>E.id===m?{...E,progress:a}:E))},g.onerror=()=>{const s=w(e);h(e,s.map(a=>a.id===m?{status:"failed",id:a.id,name:a.name,fileUrl:a.fileUrl,error:o("supportingDocuments.errorUpload")}:a))},g.onload=()=>{const s=w(e);if(g.status!==200&&g.status!==204){h(e,s.map(a=>a.id===m?{status:"failed",id:a.id,name:a.name,fileUrl:a.fileUrl,error:o("supportingDocuments.errorUpload")}:a));return}h(e,s.map(a=>a.id===m?{...a,status:"finished"}:a))};const P=new FormData;u.forEach(({key:s,value:a})=>{P.append(s,a)}),P.append("file",p),g.send(P)}).catch(()=>{const y=w(e);h(e,y.map(u=>u.id===L?{status:"failed",id:u.id,name:u.name,fileUrl:u.fileUrl,error:o("supportingDocuments.errorUpload")}:u))})};return D(V,{children:[c.map(n=>D(d.Fragment,{children:[t(le,{label:A(n),help:T(n).with("PowerOfAttorney",()=>t(O,{type:"button",label:o("supportingDocuments.help.whatIsThis"),onPress:()=>x(!0)})).with("SwornStatement",()=>t(O,{type:"button",label:o("supportingDocuments.help.whatIsThis"),onPress:()=>k(!0)})).otherwise(()=>{const e=F(n);return te(e)?t(O,{type:"tooltip",text:e}):null}),render:()=>t(X,{name:n,children:({value:e,onChange:p,error:y})=>t(pe,{layout:"horizontal",error:y,onDropAccepted:u=>{p([...e,{id:L,status:"uploading",progress:0}]),Z(u,n)},documents:e,accept:fe,icon:"document-regular",description:o("supportingDocuments.documentTypes",{maxSizeMB:j}),maxSize:ce})})}),t(b,{height:24})]},n)),c.length===0?D(re,{children:[t(b,{height:24}),t(U,{children:o("supportingDocuments.noRequiredDocuments")}),t(b,{height:24})]}):null,D(N,{visible:$,title:o("supportingDocuments.powerOfAttorneyModal.title"),icon:"document-regular",onPressClose:()=>x(!1),children:[t(U,{children:o("supportingDocuments.powerOfAttorneyModal.description")}),t(b,{height:16}),t(K,{paddingBottom:0,children:t(q,{grow:!0,color:"current",onPress:()=>window.open(`/power-of-attorney-template/${T(S).with("fr",()=>"fr").with("de",()=>"de").with("es",()=>"es").otherwise(()=>"en")}.pdf`),children:o("supportingDocuments.downloadTemplate")})})]}),D(N,{visible:G,title:o("supportingDocuments.purpose.SwornStatement"),icon:"document-regular",onPressClose:()=>k(!1),children:[t(U,{children:o("supportingDocuments.purpose.SwornStatement.description")}),t(b,{height:16}),t(K,{paddingBottom:0,children:t(q,{grow:!0,color:"current",onPress:()=>window.open("/sworn-statement-template/es.pdf"),children:o("supportingDocuments.downloadTemplate")})})]})]})},_=d.forwardRef(ge);try{A.displayName="getSupportingDocumentPurposeLabel",A.__docgenInfo={description:"",displayName:"getSupportingDocumentPurposeLabel",props:{}}}catch{}try{F.displayName="getSupportingDocumentPurposeDescriptionLabel",F.__docgenInfo={description:"",displayName:"getSupportingDocumentPurposeDescriptionLabel",props:{}}}catch{}try{_.displayName="SupportingDocument",_.__docgenInfo={description:"",displayName:"SupportingDocument",props:{getAwsUrl:{defaultValue:null,description:"",name:"getAwsUrl",required:!0,type:{name:"(file: File, purpose: I) => Promise<{ upload: { url: string; fields: { key: string; value: string; }[]; }; id: string; }>"}},documents:{defaultValue:null,description:"",name:"documents",required:!0,type:{name:"Document<I>[]"}},requiredDocumentPurposes:{defaultValue:null,description:"",name:"requiredDocumentPurposes",required:!0,type:{name:"I[]"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((documents: Document<I>[]) => void)"}},onboardingLanguage:{defaultValue:{value:"locale.language"},description:"",name:"onboardingLanguage",required:!1,type:{name:"string"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"ForwardedRef<SupportingDocumentRef>"}}}}}catch{}const he=z.create({storyPart:{maxWidth:600}}),Ye={title:"Onboarding/SupportingDocument",component:_},v=()=>{const[r,i]=d.useState([]);return t(de,{title:"SupportingDocument",description:"Supporting document collection",children:t(me,{title:"Default",style:he.storyPart,children:t(_,{getAwsUrl:()=>Promise.resolve({id:"",upload:{url:"https://localhost",fields:[{key:"",value:""}]}}),documents:r,onChange:i,requiredDocumentPurposes:["ProofOfIdentity","SwornStatement","PowerOfAttorney","UnknownDocumentType"]})})})};var C,B,R;v.parameters={...v.parameters,docs:{...(C=v.parameters)==null?void 0:C.docs,source:{originalSource:`() => {
  const [documents, setDocuments] = useState<Document<string>[]>([]);
  return <StoryBlock title="SupportingDocument" description="Supporting document collection">
      <StoryPart title="Default" style={styles.storyPart}>
        <SupportingDocument getAwsUrl={() => Promise.resolve({
        id: "",
        upload: {
          url: "https://localhost",
          fields: [{
            key: "",
            value: ""
          }]
        }
      })} documents={documents} onChange={setDocuments} requiredDocumentPurposes={["ProofOfIdentity", "SwornStatement", "PowerOfAttorney", "UnknownDocumentType"]} />
      </StoryPart>
    </StoryBlock>;
}`,...(R=(B=v.parameters)==null?void 0:B.docs)==null?void 0:R.source}}};const Ze=["Variations"];export{v as Variations,Ze as __namedExportsOrder,Ye as default};
//# sourceMappingURL=SupportingDocument.stories-Bh2KxIZw.js.map
