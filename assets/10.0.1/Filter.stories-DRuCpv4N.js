import{j as e}from"./jsx-runtime-BlAj40OV.js";import{r as g}from"./index-Cs7sjTYM.js";import{s as Q,c as C,B as J,V as w,h as U,L as H,S as D,I as G,g as X,T as M,z as q,N as I,i as B,f as Z,W as ee}from"./ScrollView-CdeN2c90.js";import{u as T}from"./useDisclosure-DLkMFUa4.js";import{P as L,F as E}from"./Popover-BGCmf6kz.js";import{L as te}from"./LakeButton-D9tT7gut.js";import{M as V}from"./index-B-e40BQY.js";import{D as re}from"./DatePicker-C65DQYQh.js";import{d as O}from"./utc-Bb9NEY8r.js";import{u as ne}from"./Pressable-Cm7BIrql.js";import{u as se}from"./TransitionView-CDS0x0T_.js";import{L as oe}from"./LakeCheckbox-B9ubUk3h.js";import{L as ie}from"./LakeLabel-BHdxvK9H.js";import{L as ae}from"./LakeRadio-CHXUD9zQ.js";import{L as le}from"./LakeTextInput-DcfmN3Ux.js";import{S as de}from"./Stack-Cab3gO6A.js";import{T as ce}from"./Tag-Cz2aSnPn.js";import{S as ue}from"./_StoriesComponents-DlaK0P1a.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-DJFdew98.js";import"./useResponsive-CzIqCC5v.js";import"./function-DqanX5uB.js";import"./BottomPanel-DFGNGfH6.js";import"./commonStyles-t4XfA7cz.js";import"./useBodyClassName-DMoYUPTW.js";import"./FocusTrap-CkiMevqq.js";import"./array-BfAlyugE.js";import"./Suspendable-RLtE4NdL.js";import"./index-BaFjtvWz.js";import"./extends-CF3RwP-h.js";import"./Fill-C1Xrh8KL.js";import"./LakeSelect-Y_I7aE6k.js";import"./rifm-CS9mxFk2.js";import"./rifm.esm-FZJd-_Wa.js";import"./i18n-Fuk8P8l9.js";import"./LakeModal-D0C5VJO3.js";import"./LakeHeading-BaQ07yeI.js";import"./ResponsiveContainer-DUt7I6CP.js";import"./v4-DvF23Exx.js";import"./index-9wgo8SO9.js";const S=Q.create({selected:{color:C.gray[500]},list:{paddingVertical:20,marginVertical:4,minWidth:250,overflow:"hidden"},item:{display:"flex",paddingHorizontal:24,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:8},itemHovered:{backgroundColor:C.gray[50]},availableFiltersTitle:{paddingHorizontal:24}});function _({filters:s,openFilters:t,label:m,title:i,availableFilters:l,large:o=!0,onAddFilter:f}){const r=g.useRef(null),[h,{close:c,toggle:x}]=T(!1);return e.jsxs(e.Fragment,{children:[e.jsx(J,{direction:"row",justifyContent:"start",alignItems:"center",children:e.jsx(te,{size:"small",mode:"secondary",color:"gray",onPress:x,ref:r,icon:o?"chevron-down-filled":"filter-filled",iconPosition:"end",ariaLabel:m,children:o?m:null})}),e.jsx(L,{role:"listbox",matchReferenceMinWidth:!0,onDismiss:c,referenceRef:r,returnFocus:!1,visible:h,children:e.jsxs(w,{style:S.list,children:[U(i)?e.jsxs(e.Fragment,{children:[e.jsx(H,{style:S.availableFiltersTitle,children:i}),e.jsx(D,{height:8})]}):null,e.jsx(E,{role:"list",data:l,keyExtractor:(a,n)=>`filter-item-${n}`,renderItem:({item:a})=>{const n=!!s[a.name]||t.includes(a.name);return e.jsxs(V,{style:({hovered:d})=>[S.item,d&&S.itemHovered],role:"button",disabled:n,onPress:()=>{f(a.name),c()},children:[e.jsx(H,{variant:"smallRegular",style:n&&S.selected,children:a.label}),n&&e.jsx(G,{color:C.positive[500],name:"checkmark-filled",size:14})]})}})]})})]})}_.__docgenInfo={description:"",methods:[],displayName:"FilterChooser",props:{filters:{required:!0,tsType:{name:"Partial",elements:[{name:"Record",elements:[{name:"FilterName"},{name:"unknown"}],raw:"Record<FilterName, unknown>"}],raw:"Partial<Record<FilterName, unknown>>"},description:""},openFilters:{required:!0,tsType:{name:"Array",elements:[{name:"FilterName"}],raw:"FilterName[]"},description:""},label:{required:!0,tsType:{name:"string"},description:""},title:{required:!1,tsType:{name:"string"},description:""},availableFilters:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ label: string; name: FilterName }",signature:{properties:[{key:"label",value:{name:"string",required:!0}},{key:"name",value:{name:"FilterName",required:!0}}]}}],raw:"{ label: string; name: FilterName }[]"},description:""},large:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},onAddFilter:{required:!0,tsType:{name:"signature",type:"function",raw:"(filterName: FilterName) => void",signature:{arguments:[{type:{name:"FilterName"},name:"filterName"}],return:{name:"void"}}},description:""}}};const u=Q.create({container:{paddingRight:12,paddingBottom:8},shadowed:{position:"absolute",opacity:0,width:"100%",height:"100%",borderRadius:4,boxShadow:X.tile,transitionDuration:"150ms",transitionProperty:"opacity"},hovered:{opacity:1},dropdown:{maxHeight:400,minWidth:200},itemHovered:{backgroundColor:C.gray[50]},content:{paddingVertical:12},inputContent:{paddingHorizontal:24,paddingTop:24,paddingBottom:16},radio:{display:"flex",flexDirection:"row",alignItems:"center",height:32,paddingHorizontal:24},itemLabel:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},input:{width:250},value:{maxWidth:130,whiteSpace:"nowrap"}}),A=g.forwardRef(({onPress:s,onPressRemove:t,label:m,value:i="",isActive:l},o)=>{const f=g.useRef(null),r=ne(f,o);return e.jsx(V,{ref:r,onPress:s,children:({hovered:h})=>e.jsxs(e.Fragment,{children:[e.jsx(w,{style:[u.shadowed,h&&u.hovered]}),e.jsx(ce,{label:m,color:"current",onPressRemove:t,children:e.jsxs(J,{direction:"row",alignItems:"center",children:[e.jsx(M,{numberOfLines:1,style:u.value,children:i}),e.jsx(D,{width:4}),e.jsx(G,{color:C.current.primary,name:l?"chevron-up-filled":"chevron-down-filled",size:16})]})})]})})});function me({label:s,items:t,width:m,value:i,onValueChange:l,onPressRemove:o,autoOpen:f=!1}){const r=g.useRef(null),[h,{close:c,toggle:x}]=T(f),a=g.useMemo(()=>t.find(n=>n.value===i),[t,i]);return e.jsxs(w,{style:u.container,children:[e.jsx(A,{label:s,onPress:x,ref:r,onPressRemove:o,isActive:h,value:a==null?void 0:a.label}),e.jsx(L,{role:"listbox",matchReferenceWidth:!1,onDismiss:c,referenceRef:r,returnFocus:!1,visible:h,children:e.jsx(E,{role:"list",data:t,style:[u.dropdown,{width:m}],contentContainerStyle:u.content,keyExtractor:(n,d)=>`filter-item-${d}`,renderItem:({item:n})=>{const d=i===n.value;return e.jsxs(V,{role:"radio","aria-checked":d,style:({hovered:v})=>[u.radio,v&&u.itemHovered],onPress:()=>{l(n.value),c()},children:[e.jsx(ae,{value:d}),e.jsx(D,{width:12}),e.jsx(M,{style:u.itemLabel,children:n.label})]})}})})]})}function pe({label:s,items:t,width:m,checkAllLabel:i,value:l,onValueChange:o,onPressRemove:f,autoOpen:r=!1}){const h=g.useRef(null),[c,{close:x,toggle:a}]=T(r),n=g.useMemo(()=>new Set(l),[l]),d=g.useMemo(()=>t.filter(y=>n.has(y.value)),[t,n]),v=i!=null&&n.size===t.length,F=g.useMemo(()=>{if(i==null)return t;const y=n.size===0?!1:n.size===t.length?!0:"mixed";return[{label:i,checked:y},...t]},[t,i,n]);return e.jsxs(w,{style:u.container,children:[e.jsx(A,{label:s,onPress:a,ref:h,onPressRemove:f,isActive:c,value:v?i:d.map(y=>y.label).join(", ")}),e.jsx(L,{role:"listbox",matchReferenceWidth:!1,onDismiss:x,referenceRef:h,returnFocus:!1,visible:c,children:e.jsx(E,{role:"list",data:F,style:[u.dropdown,{width:m}],contentContainerStyle:u.content,keyExtractor:(y,p)=>`filter-item-${p}`,renderItem:({item:y})=>{const p=q(y).with({checked:I.any},({checked:j})=>j).with({value:I.any},({value:j})=>n.has(j)).exhaustive(),k=q(y).with({checked:I.any},({checked:j})=>()=>{o(j===!0?void 0:t.map(b=>b.value))}).with({value:I.any},({value:j})=>()=>{const b=new Set([...n]);p===!0?b.delete(j):b.add(j),b.size===0?o(void 0):o([...b])}).exhaustive();return e.jsxs(V,{role:"radio","aria-checked":p,style:({hovered:j})=>[u.radio,j&&u.itemHovered],onPress:k,children:[e.jsx(oe,{value:p}),e.jsx(D,{width:12}),e.jsx(M,{style:u.itemLabel,children:y.label})]})}})})]})}function fe({label:s,initialValue:t,noValueText:m,cancelText:i,submitText:l,dateFormat:o,isSelectable:f,validate:r,onValueChange:h,onPressRemove:c,autoOpen:x=!1}){const a=g.useRef(null),[n,{close:d,toggle:v}]=T(x),F=g.useMemo(()=>B(t)?O(t).format(o):"",[t,o]);return e.jsxs(w,{style:u.container,children:[e.jsx(A,{label:s,onPress:v,ref:a,onPressRemove:c,isActive:n,value:B(t)?O(t).format(o):m}),e.jsx(re,{visible:n,format:o,firstWeekDay:"monday",label:s,cancelLabel:i,confirmLabel:l,value:F,isSelectable:f,validate:r,onChange:y=>{const p=O(y,o,!0).toJSON();h(p)},onDismiss:d})]})}function he({label:s,initialValue:t="",noValueText:m,autoOpen:i=!1,placeholder:l,validate:o,onValueChange:f,onPressRemove:r}){const[h,{close:c,toggle:x}]=T(i),a=g.useRef(null),n=g.useCallback((k,j)=>{const b=k.trim(),z=(o==null?void 0:o(b))??void 0,W=Z(z)?b:void 0;return j||f(W),{inputValue:k,validValue:W,error:j?void 0:z}},[o,f]),[{inputValue:d,validValue:v,error:F},y]=g.useState(()=>n(t,!0)),p=g.useCallback(k=>y(n(k,!1)),[n]);return e.jsxs(w,{style:u.container,children:[e.jsx(A,{label:s,onPress:x,ref:a,onPressRemove:r,isActive:h,value:v??m}),e.jsx(L,{role:"listbox",matchReferenceWidth:!1,onDismiss:c,referenceRef:a,returnFocus:!1,visible:h,children:e.jsx(w,{style:[u.dropdown,u.inputContent],children:e.jsx(ie,{label:s,render:k=>e.jsx(le,{id:k,value:d,error:F,style:u.input,placeholder:l,onChangeText:p})})})})]})}const P=(s,t,m)=>t[m],K=({filters:s,openedFilters:t,definition:m,onChangeOpened:i,onChangeFilters:l})=>{const o=se(t),f=t.length>o.length?t[t.length-1]:void 0;return t.length===0?null:e.jsx(de,{direction:"row",wrap:"wrap",children:t.map(r=>{const h=m[r];return typeof r!="string"||h==null?null:e.jsx(w,{children:q(h).with({type:"radio"},({type:c,label:x,items:a,width:n})=>e.jsx(me,{label:x,items:a,width:n,autoOpen:f===r,onPressRemove:()=>{l({...s,[r]:void 0}),i(t.filter(d=>d!==r))},value:P(c,s,r),onValueChange:d=>l({...s,[r]:d})})).with({type:"checkbox"},({type:c,label:x,items:a,width:n,checkAllLabel:d})=>e.jsx(pe,{label:x,items:a,width:n,checkAllLabel:d,autoOpen:f===r,value:P(c,s,r),onValueChange:v=>l({...s,[r]:v}),onPressRemove:()=>{l({...s,[r]:void 0}),i(t.filter(v=>v!==r))}})).with({type:"date"},({type:c,label:x,noValueText:a,cancelText:n,submitText:d,dateFormat:v,isSelectable:F,validate:y})=>e.jsx(fe,{label:x,noValueText:a,cancelText:n,submitText:d,dateFormat:v,autoOpen:f===r,isSelectable:F?p=>F(p,s):void 0,validate:y?p=>y(p,s):void 0,initialValue:P(c,s,r),onValueChange:p=>l({...s,[r]:p}),onPressRemove:()=>{l({...s,[r]:void 0}),i(t.filter(p=>p!==r))}})).with({type:"input"},({type:c,label:x,placeholder:a,noValueText:n,validate:d})=>e.jsx(he,{label:x,placeholder:a,noValueText:n,autoOpen:f===r,validate:d,initialValue:P(c,s,r),onValueChange:v=>l({...s,[r]:v}),onPressRemove:()=>{l({...s,[r]:void 0}),i(t.filter(v=>v!==r))}})).exhaustive()},r)})})};K.__docgenInfo={description:"",methods:[],displayName:"FiltersStack",props:{definition:{required:!0,tsType:{name:"Definition"},description:""},filters:{required:!0,tsType:{name:"State"},description:""},openedFilters:{required:!0,tsType:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},description:""},onChangeOpened:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: (keyof Definition)[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},name:"value"}],return:{name:"void"}}},description:""},onChangeFilters:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: State) => void",signature:{arguments:[{type:{name:"State"},name:"value"}],return:{name:"void"}}},description:""}}};const xe={type:"radio",label:"Mode",items:[{label:"QES",value:"QES"},{label:"Expert",value:"Expert"}]},ve={type:"checkbox",label:"Status",checkAllLabel:"All",items:[{label:"Accepted",value:"Accepted"},{label:"Canceled",value:"Canceled"},{label:"Failed",value:"Failed"},{label:"Expired",value:"Expired"},{label:"CustomerRefused",value:"CustomerRefused"}]},ye={type:"date",label:"Start Date",cancelText:"Cancel",submitText:"Save",noValueText:"None",dateFormat:"DD/MM/YYYY"},ge={type:"input",label:"Resource ID",noValueText:"None",placeholder:"Placeholder...",validate:s=>{if(s.length<3)return"Not long enough"}},je={mode:xe,status:ve,startDate:ye,resourceId:ge},be=[{name:"mode",label:"Mode"},{name:"status",label:"Status"},{name:"startDate",label:"Start date"},{name:"resourceId",label:"Ressource ID"}],lt={title:"Forms/Filter",component:_},R=()=>{const[s,t]=g.useState([]),[m,i]=g.useState({mode:void 0,status:void 0,resourceId:void 0,startDate:void 0});return e.jsx(ue,{title:"Filter",children:e.jsx(ee,{variant:"live",children:e.jsxs(w,{children:[e.jsx(_,{filters:m,label:"Choose filters",title:"Filters",onAddFilter:l=>t(o=>[...o,l]),availableFilters:be,openFilters:s}),e.jsx(D,{height:8}),e.jsx(K,{definition:je,filters:m,openedFilters:s,onChangeFilters:i,onChangeOpened:t})]})})})};R.__docgenInfo={description:"",methods:[],displayName:"All"};var Y,$,N;R.parameters={...R.parameters,docs:{...(Y=R.parameters)==null?void 0:Y.docs,source:{originalSource:`() => {
  const [openFilters, setOpenFilters] = useState<(keyof State)[]>([]);
  const [filters, setFilters] = useState<State>({
    mode: undefined,
    status: undefined,
    resourceId: undefined,
    startDate: undefined
  });
  return <StoryBlock title="Filter">
      <WithCurrentColor variant="live">
        <View>
          <FilterChooser filters={filters} label="Choose filters" title="Filters" onAddFilter={filter => setOpenFilters(filters => [...filters, filter])} availableFilters={availableFilters} openFilters={openFilters} />

          <Space height={8} />

          <FiltersStack definition={definition} filters={filters} openedFilters={openFilters} onChangeFilters={setFilters} onChangeOpened={setOpenFilters} />
        </View>
      </WithCurrentColor>
    </StoryBlock>;
}`,...(N=($=R.parameters)==null?void 0:$.docs)==null?void 0:N.source}}};const dt=["All"];export{R as All,dt as __namedExportsOrder,lt as default};
//# sourceMappingURL=Filter.stories-DRuCpv4N.js.map
