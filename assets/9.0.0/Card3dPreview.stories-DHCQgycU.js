import{j as pe,$ as Lr,v as zt,l as nr,i as Or,h as _i,g as Di,s as Ri,V as An,B as xi,S as Oo,N as Gi}from"./ScrollView-DWjQ00nM.js";import{F as Ui}from"./FileInput-CbJ2q9s6.js";import{r as oe}from"./index-Cs7sjTYM.js";import{e as _a,d as Li,f as Oi,g as ki,i as Pi,E as Hi,B as Ni,h as Ji,T as ji,j as Ki,k as Xi,l as Vn,m as Da,R as Ra,M as hr,I as Wi,n as uo,D as Cn,o as Qi,P as Yi,p as zi,V as at,Q as mn,q as kr,O as Cr,r as ko,s as vt,t as Ar,v as mr,L as fo,w as Nr,F as ar,C as jt,x as Zi,y as Vi,z as qi,A as cr,G as Kt,H as Wr,J as $i,K as xa,N as Ga,U as bn,W as es,X as Jr,Y as ts,Z as Tt,_ as Ua,$ as qn,a0 as rs,a1 as Gn,a2 as ns,a3 as La,a4 as os,a5 as ho,a6 as as,a7 as is,a8 as ss,a9 as ls,aa as cs,ab as Un,ac as us,ad as fs,ae as hs,af as ds,ag as Oa,ah as ps,ai as As,aj as ms,ak as gs,al as Yt,am as vs,an as Bs,ao as ka,ap as Cs,aq as Dt,ar as Po,as as Ho,at as No,au as Pa,av as Ha,aw as bs,ax as Na,ay as Ut,az as Zt,aA as br,aB as Qr,aC as Es,aD as ys,aE as Ms,aF as Ts,aG as Fs,aH as ws,aI as Is,aJ as Ss,aK as Jo,aL as _s,aM as Yr,aN as Ds,u as Ct,aO as Rs,aP as ir,b as po,S as Ja,aQ as ja,aR as gn,aS as xs,aT as Gs,aU as $n,aV as Us,aW as Ls,aX as Os,aY as ks,aZ as eo,a_ as Ps,a$ as jo,b0 as Ka,b1 as Hs,b2 as Ns,b3 as Js,b4 as js,b5 as Ks,a as Xs,b6 as Ko}from"./index-99983b2d.esm-CcB714HC.js";import{g as Ws}from"./_commonjsHelpers-BosuxZz1.js";import{_ as Ao}from"./extends-CF3RwP-h.js";import{L as rn}from"./LakeLabel-BlQ3b0Ot.js";import{L as Qs}from"./LakeSlider-Dw7rOlFz.js";import{L as Ys}from"./LakeTextInput-RVwTHeH7.js";import{R as zs}from"./RadioGroup-B48Q9FcQ.js";import{d as Zs}from"./string-CooJ28LA.js";import{S as Xa,a as Wa}from"./_StoriesComponents-_jmnnGUR.js";import"./index-BU4L-DQy.js";import"./LakeButton-B6sbG4pD.js";import"./commonStyles-t4XfA7cz.js";import"./Pressable-CMe_F2_9.js";import"./index-BJ6ZNIxC.js";import"./LakeHeading-Devxa2jE.js";import"./useBoolean-DHW5baxv.js";import"./index-D3ylJrlI.js";import"./i18n-CV4-0aDM.js";import"./rifm-CFTOlIhk.js";import"./utc-DJvBpWoA.js";import"./array-BfAlyugE.js";import"./v4-DvF23Exx.js";import"./Fill-CJ2tm9Hu.js";import"./LakeSelect-BCceW-go.js";import"./useDisclosure-DLkMFUa4.js";import"./FocusTrap-BmeT9-In.js";import"./Popover-CdPSbsOC.js";import"./useResponsive-CzIqCC5v.js";import"./function-c-Au7wom.js";import"./BottomPanel-DIUwAyP4.js";import"./useBodyClassName-DMoYUPTW.js";import"./Suspendable-Di1_g3U1.js";import"./TransitionView-cETjUupd.js";import"./index-CCMTQrND.js";import"./LakeRadio-DzCqQjHn.js";const Vs="/lake/assets/9.0.0/nx-Boiyas7x.png",qs="/lake/assets/9.0.0/ny-DWXVp2ab.png",$s="/lake/assets/9.0.0/nz-BHTJfDf0.png",el="/lake/assets/9.0.0/px-FPBPSFp1.png",tl="/lake/assets/9.0.0/py-BNAjJhDJ.png",rl="/lake/assets/9.0.0/pz-CAvJgW1j.png",nl="/lake/assets/9.0.0/MaisonNeue-Book-DlxDS1Iq.woff",ol="/lake/assets/9.0.0/MarkPro-Regular-Cu1_Q-Pt.ttf",al="/lake/assets/9.0.0/band_roughness-BuY2-ul7.jpg",il="/lake/assets/9.0.0/card-BGOB-vBw.gltf",sl="/lake/assets/9.0.0/chip-CVPxzD9X.jpg",ll="/lake/assets/9.0.0/color_black-C-I-WyQV.jpg",cl="/lake/assets/9.0.0/color_silver-CSsV1GwH.jpg";function to(u,t,s){var a,r,e,n,i;t==null&&(t=100);function o(){var c=Date.now()-n;c<t&&c>=0?a=setTimeout(o,t-c):(a=null,s||(i=u.apply(e,r),e=r=null))}var l=function(){e=this,r=arguments,n=Date.now();var c=s&&!a;return a||(a=setTimeout(o,t)),c&&(i=u.apply(e,r),e=r=null),i};return l.clear=function(){a&&(clearTimeout(a),a=null)},l.flush=function(){a&&(i=u.apply(e,r),e=r=null,clearTimeout(a),a=null)},l}to.debounce=to;var ul=to;const Xo=Ws(ul);function fl(u){let{debounce:t,scroll:s,polyfill:a,offsetSize:r}=u===void 0?{debounce:0,scroll:!1,offsetSize:!1}:u;const e=a||(typeof window>"u"?class{}:window.ResizeObserver);if(!e)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[n,i]=oe.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=oe.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:n}),l=t?typeof t=="number"?t:t.scroll:null,c=t?typeof t=="number"?t:t.resize:null,f=oe.useRef(!1);oe.useEffect(()=>(f.current=!0,()=>void(f.current=!1)));const[h,p,A]=oe.useMemo(()=>{const b=()=>{if(!o.current.element)return;const{left:S,top:E,width:T,height:w,bottom:R,right:B,x:_,y:D}=o.current.element.getBoundingClientRect(),z={left:S,top:E,width:T,height:w,bottom:R,right:B,x:_,y:D};o.current.element instanceof HTMLElement&&r&&(z.height=o.current.element.offsetHeight,z.width=o.current.element.offsetWidth),Object.freeze(z),f.current&&!Al(o.current.lastBounds,z)&&i(o.current.lastBounds=z)};return[b,c?Xo(b,c):b,l?Xo(b,l):b]},[i,r,l,c]);function v(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(b=>b.removeEventListener("scroll",A,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null)}function g(){o.current.element&&(o.current.resizeObserver=new e(A),o.current.resizeObserver.observe(o.current.element),s&&o.current.scrollContainers&&o.current.scrollContainers.forEach(b=>b.addEventListener("scroll",A,{capture:!0,passive:!0})))}const F=b=>{!b||b===o.current.element||(v(),o.current.element=b,o.current.scrollContainers=Qa(b),g())};return dl(A,!!s),hl(p),oe.useEffect(()=>{v(),g()},[s,A,p]),oe.useEffect(()=>v,[]),[F,n,h]}function hl(u){oe.useEffect(()=>{const t=u;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[u])}function dl(u,t){oe.useEffect(()=>{if(t){const s=u;return window.addEventListener("scroll",s,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",s,!0)}},[u,t])}function Qa(u){const t=[];if(!u||u===document.body)return t;const{overflow:s,overflowX:a,overflowY:r}=window.getComputedStyle(u);return[s,a,r].some(e=>e==="auto"||e==="scroll")&&t.push(u),[...t,...Qa(u.parentElement)]}const pl=["x","y","top","bottom","left","right","width","height"],Al=(u,t)=>pl.every(s=>u[s]===t[s]);var ml=Object.defineProperty,gl=Object.defineProperties,vl=Object.getOwnPropertyDescriptors,Wo=Object.getOwnPropertySymbols,Bl=Object.prototype.hasOwnProperty,Cl=Object.prototype.propertyIsEnumerable,Qo=(u,t,s)=>t in u?ml(u,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[t]=s,Yo=(u,t)=>{for(var s in t||(t={}))Bl.call(t,s)&&Qo(u,s,t[s]);if(Wo)for(var s of Wo(t))Cl.call(t,s)&&Qo(u,s,t[s]);return u},bl=(u,t)=>gl(u,vl(t)),zo,Zo;typeof window<"u"&&((zo=window.document)!=null&&zo.createElement||((Zo=window.navigator)==null?void 0:Zo.product)==="ReactNative")?oe.useLayoutEffect:oe.useEffect;function Ya(u,t,s){if(!u)return;if(s(u)===!0)return u;let a=u.child;for(;a;){const r=Ya(a,t,s);if(r)return r;a=a.sibling}}function za(u){try{return Object.defineProperties(u,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return u}}const Vo=console.error;console.error=function(){const u=[...arguments].join("");if(u!=null&&u.startsWith("Warning:")&&u.includes("useContext")){console.error=Vo;return}return Vo.apply(this,arguments)};const mo=za(oe.createContext(null));class Za extends oe.Component{render(){return oe.createElement(mo.Provider,{value:this._reactInternals},this.props.children)}}function El(){const u=oe.useContext(mo);if(u===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=oe.useId();return oe.useMemo(()=>{for(const a of[u,u==null?void 0:u.alternate]){if(!a)continue;const r=Ya(a,!1,e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}});if(r)return r}},[u,t])}function yl(){const u=El(),[t]=oe.useState(()=>new Map);t.clear();let s=u;for(;s;){if(s.type&&typeof s.type=="object"){const r=s.type._context===void 0&&s.type.Provider===s.type?s.type:s.type._context;r&&r!==mo&&!t.has(r)&&t.set(r,oe.useContext(za(r)))}s=s.return}return t}function Ml(){const u=yl();return oe.useMemo(()=>Array.from(u.keys()).reduce((t,s)=>a=>oe.createElement(t,null,oe.createElement(s.Provider,bl(Yo({},a),{value:u.get(s)}))),t=>oe.createElement(Za,Yo({},t))),[u])}const Ln={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Tl(u){const{handlePointer:t}=Ki(u);return{priority:1,enabled:!0,compute(s,a,r){a.pointer.set(s.offsetX/a.size.width*2-1,-(s.offsetY/a.size.height)*2+1),a.raycaster.setFromCamera(a.pointer,a.camera)},connected:void 0,handlers:Object.keys(Ln).reduce((s,a)=>({...s,[a]:t(a)}),{}),update:()=>{var s;const{events:a,internal:r}=u.getState();(s=r.lastEvent)!=null&&s.current&&a.handlers&&a.handlers.onPointerMove(r.lastEvent.current)},connect:s=>{var a;const{set:r,events:e}=u.getState();e.disconnect==null||e.disconnect(),r(n=>({events:{...n.events,connected:s}})),Object.entries((a=e.handlers)!=null?a:[]).forEach(([n,i])=>{const[o,l]=Ln[n];s.addEventListener(o,i,{passive:l})})},disconnect:()=>{const{set:s,events:a}=u.getState();if(a.connected){var r;Object.entries((r=a.handlers)!=null?r:[]).forEach(([e,n])=>{if(a&&a.connected instanceof HTMLElement){const[i]=Ln[e];a.connected.removeEventListener(i,n)}}),s(e=>({events:{...e.events,connected:void 0}}))}}}}const Fl=oe.forwardRef(function({children:t,fallback:s,resize:a,style:r,gl:e,events:n=Tl,eventSource:i,eventPrefix:o,shadows:l,linear:c,flat:f,legacy:h,orthographic:p,frameloop:A,dpr:v,performance:g,raycaster:F,camera:b,scene:S,onPointerMissed:E,onCreated:T,...w},R){oe.useMemo(()=>_a(ji),[]);const B=Ml(),[_,D]=fl({scroll:!0,debounce:{scroll:50,resize:0},...a}),z=oe.useRef(null),I=oe.useRef(null);oe.useImperativeHandle(R,()=>z.current);const L=Li(E),[x,V]=oe.useState(!1),[j,ue]=oe.useState(!1);if(x)throw x;if(j)throw j;const fe=oe.useRef(null);Oi(()=>{const k=z.current;D.width>0&&D.height>0&&k&&(fe.current||(fe.current=ki(k)),fe.current.configure({gl:e,events:n,shadows:l,linear:c,flat:f,legacy:h,orthographic:p,frameloop:A,dpr:v,performance:g,raycaster:F,camera:b,scene:S,size:D,onPointerMissed:(...M)=>L.current==null?void 0:L.current(...M),onCreated:M=>{M.events.connect==null||M.events.connect(i?Pi(i)?i.current:i:I.current),o&&M.setEvents({compute:(G,U)=>{const H=G[o+"X"],P=G[o+"Y"];U.pointer.set(H/U.size.width*2-1,-(P/U.size.height)*2+1),U.raycaster.setFromCamera(U.pointer,U.camera)}}),T==null||T(M)}}),fe.current.render(pe.jsx(B,{children:pe.jsx(Hi,{set:ue,children:pe.jsx(oe.Suspense,{fallback:pe.jsx(Ni,{set:V}),children:t})})})))}),oe.useEffect(()=>{const k=z.current;if(k)return()=>Ji(k)},[]);const Y=i?"none":"auto";return pe.jsx("div",{ref:I,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Y,...r},...w,children:pe.jsx("div",{ref:_,style:{width:"100%",height:"100%"},children:pe.jsx("canvas",{ref:z,style:{display:"block"},children:s})})})}),wl=oe.forwardRef(function(t,s){return pe.jsx(Za,{children:pe.jsx(Fl,{...t,ref:s})})});function qo(u,t){if(t===Xi)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),u;if(t===Vn||t===Da){let s=u.getIndex();if(s===null){const n=[],i=u.getAttribute("position");if(i!==void 0){for(let o=0;o<i.count;o++)n.push(o);u.setIndex(n),s=u.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),u}const a=s.count-2,r=[];if(s)if(t===Vn)for(let n=1;n<=a;n++)r.push(s.getX(0)),r.push(s.getX(n)),r.push(s.getX(n+1));else for(let n=0;n<a;n++)n%2===0?(r.push(s.getX(n)),r.push(s.getX(n+1)),r.push(s.getX(n+2))):(r.push(s.getX(n+2)),r.push(s.getX(n+1)),r.push(s.getX(n)));r.length/3!==a&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const e=u.clone();return e.setIndex(r),e.clearGroups(),e}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),u}const Il=parseInt(Ra.replace(/\D+/g,""));var Gt=Uint8Array,or=Uint16Array,ro=Uint32Array,Va=new Gt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),qa=new Gt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Sl=new Gt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$a=function(u,t){for(var s=new or(31),a=0;a<31;++a)s[a]=t+=1<<u[a-1];for(var r=new ro(s[30]),a=1;a<30;++a)for(var e=s[a];e<s[a+1];++e)r[e]=e-s[a]<<5|a;return[s,r]},ei=$a(Va,2),ti=ei[0],_l=ei[1];ti[28]=258,_l[258]=28;var Dl=$a(qa,0),Rl=Dl[0],no=new or(32768);for(var it=0;it<32768;++it){var er=(it&43690)>>>1|(it&21845)<<1;er=(er&52428)>>>2|(er&13107)<<2,er=(er&61680)>>>4|(er&3855)<<4,no[it]=((er&65280)>>>8|(er&255)<<8)>>>1}var jr=function(u,t,s){for(var a=u.length,r=0,e=new or(t);r<a;++r)++e[u[r]-1];var n=new or(t);for(r=0;r<t;++r)n[r]=n[r-1]+e[r-1]<<1;var i;if(s){i=new or(1<<t);var o=15-t;for(r=0;r<a;++r)if(u[r])for(var l=r<<4|u[r],c=t-u[r],f=n[u[r]-1]++<<c,h=f|(1<<c)-1;f<=h;++f)i[no[f]>>>o]=l}else for(i=new or(a),r=0;r<a;++r)u[r]&&(i[r]=no[n[u[r]-1]++]>>>15-u[r]);return i},zr=new Gt(288);for(var it=0;it<144;++it)zr[it]=8;for(var it=144;it<256;++it)zr[it]=9;for(var it=256;it<280;++it)zr[it]=7;for(var it=280;it<288;++it)zr[it]=8;var ri=new Gt(32);for(var it=0;it<32;++it)ri[it]=5;var xl=jr(zr,9,1),Gl=jr(ri,5,1),On=function(u){for(var t=u[0],s=1;s<u.length;++s)u[s]>t&&(t=u[s]);return t},Nt=function(u,t,s){var a=t/8|0;return(u[a]|u[a+1]<<8)>>(t&7)&s},kn=function(u,t){var s=t/8|0;return(u[s]|u[s+1]<<8|u[s+2]<<16)>>(t&7)},Ul=function(u){return(u/8|0)+(u&7&&1)},Ll=function(u,t,s){(s==null||s>u.length)&&(s=u.length);var a=new(u instanceof or?or:u instanceof ro?ro:Gt)(s-t);return a.set(u.subarray(t,s)),a},Ol=function(u,t,s){var a=u.length;if(!a||s&&!s.l&&a<5)return t||new Gt(0);var r=!t||s,e=!s||s.i;s||(s={}),t||(t=new Gt(a*3));var n=function(X){var W=t.length;if(X>W){var Z=new Gt(Math.max(W*2,X));Z.set(t),t=Z}},i=s.f||0,o=s.p||0,l=s.b||0,c=s.l,f=s.d,h=s.m,p=s.n,A=a*8;do{if(!c){s.f=i=Nt(u,o,1);var v=Nt(u,o+1,3);if(o+=3,v)if(v==1)c=xl,f=Gl,h=9,p=5;else if(v==2){var S=Nt(u,o,31)+257,E=Nt(u,o+10,15)+4,T=S+Nt(u,o+5,31)+1;o+=14;for(var w=new Gt(T),R=new Gt(19),B=0;B<E;++B)R[Sl[B]]=Nt(u,o+B*3,7);o+=E*3;for(var _=On(R),D=(1<<_)-1,z=jr(R,_,1),B=0;B<T;){var I=z[Nt(u,o,D)];o+=I&15;var g=I>>>4;if(g<16)w[B++]=g;else{var L=0,x=0;for(g==16?(x=3+Nt(u,o,3),o+=2,L=w[B-1]):g==17?(x=3+Nt(u,o,7),o+=3):g==18&&(x=11+Nt(u,o,127),o+=7);x--;)w[B++]=L}}var V=w.subarray(0,S),j=w.subarray(S);h=On(V),p=On(j),c=jr(V,h,1),f=jr(j,p,1)}else throw"invalid block type";else{var g=Ul(o)+4,F=u[g-4]|u[g-3]<<8,b=g+F;if(b>a){if(e)throw"unexpected EOF";break}r&&n(l+F),t.set(u.subarray(g,b),l),s.b=l+=F,s.p=o=b*8;continue}if(o>A){if(e)throw"unexpected EOF";break}}r&&n(l+131072);for(var ue=(1<<h)-1,fe=(1<<p)-1,Y=o;;Y=o){var L=c[kn(u,o)&ue],k=L>>>4;if(o+=L&15,o>A){if(e)throw"unexpected EOF";break}if(!L)throw"invalid length/literal";if(k<256)t[l++]=k;else if(k==256){Y=o,c=null;break}else{var M=k-254;if(k>264){var B=k-257,G=Va[B];M=Nt(u,o,(1<<G)-1)+ti[B],o+=G}var U=f[kn(u,o)&fe],H=U>>>4;if(!U)throw"invalid distance";o+=U&15;var j=Rl[H];if(H>3){var G=qa[H];j+=kn(u,o)&(1<<G)-1,o+=G}if(o>A){if(e)throw"unexpected EOF";break}r&&n(l+131072);for(var P=l+M;l<P;l+=4)t[l]=t[l-j],t[l+1]=t[l+1-j],t[l+2]=t[l+2-j],t[l+3]=t[l+3-j];l=P}}s.l=c,s.p=Y,s.b=l,c&&(i=1,s.m=h,s.d=f,s.n=p)}while(!i);return l==t.length?t:Ll(t,0,l)},kl=new Gt(0),Pl=function(u){if((u[0]&15)!=8||u[0]>>>4>7||(u[0]<<8|u[1])%31)throw"invalid zlib data";if(u[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function nn(u,t){return Ol((Pl(u),u.subarray(2,-4)),t)}var Hl=typeof TextDecoder<"u"&&new TextDecoder,Nl=0;try{Hl.decode(kl,{stream:!0}),Nl=1}catch{}const Jl=u=>u&&u.isCubeTexture;class jl extends hr{constructor(t,s){var a,r;const e=Jl(t),i=((r=e?(a=t.image[0])==null?void 0:a.width:t.image.width)!=null?r:1024)/4,o=Math.floor(Math.log2(i)),l=Math.pow(2,o),c=3*Math.max(l,16*7),f=4*l,h=[e?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/c}`,`#define CUBEUV_TEXEL_HEIGHT ${1/f}`,`#define CUBEUV_MAX_MIP ${o}.0`],p=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,A=h.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(Ra.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,v={map:{value:t},height:{value:(s==null?void 0:s.height)||15},radius:{value:(s==null?void 0:s.radius)||100}},g=new Wi(1,16),F=new uo({uniforms:v,fragmentShader:A,vertexShader:p,side:Cn});super(g,F)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}var Kl=Object.defineProperty,Xl=(u,t,s)=>t in u?Kl(u,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[t]=s,Le=(u,t,s)=>(Xl(u,typeof t!="symbol"?t+"":t,s),s);const on=new Qi,$o=new Yi,Wl=Math.cos(70*(Math.PI/180)),ea=(u,t)=>(u%t+t)%t;let Ql=class extends zi{constructor(t,s){super(),Le(this,"object"),Le(this,"domElement"),Le(this,"enabled",!0),Le(this,"target",new at),Le(this,"minDistance",0),Le(this,"maxDistance",1/0),Le(this,"minZoom",0),Le(this,"maxZoom",1/0),Le(this,"minPolarAngle",0),Le(this,"maxPolarAngle",Math.PI),Le(this,"minAzimuthAngle",-1/0),Le(this,"maxAzimuthAngle",1/0),Le(this,"enableDamping",!1),Le(this,"dampingFactor",.05),Le(this,"enableZoom",!0),Le(this,"zoomSpeed",1),Le(this,"enableRotate",!0),Le(this,"rotateSpeed",1),Le(this,"enablePan",!0),Le(this,"panSpeed",1),Le(this,"screenSpacePanning",!0),Le(this,"keyPanSpeed",7),Le(this,"zoomToCursor",!1),Le(this,"autoRotate",!1),Le(this,"autoRotateSpeed",2),Le(this,"reverseOrbit",!1),Le(this,"reverseHorizontalOrbit",!1),Le(this,"reverseVerticalOrbit",!1),Le(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Le(this,"mouseButtons",{LEFT:Ar.ROTATE,MIDDLE:Ar.DOLLY,RIGHT:Ar.PAN}),Le(this,"touches",{ONE:mr.ROTATE,TWO:mr.DOLLY_PAN}),Le(this,"target0"),Le(this,"position0"),Le(this,"zoom0"),Le(this,"_domElementKeyEvents",null),Le(this,"getPolarAngle"),Le(this,"getAzimuthalAngle"),Le(this,"setPolarAngle"),Le(this,"setAzimuthalAngle"),Le(this,"getDistance"),Le(this,"listenToKeyEvents"),Le(this,"stopListenToKeyEvents"),Le(this,"saveState"),Le(this,"reset"),Le(this,"update"),Le(this,"connect"),Le(this,"dispose"),this.object=t,this.domElement=s,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=C=>{let q=ea(C,2*Math.PI),le=c.phi;le<0&&(le+=2*Math.PI),q<0&&(q+=2*Math.PI);let ve=Math.abs(q-le);2*Math.PI-ve<ve&&(q<le?q+=2*Math.PI:le+=2*Math.PI),f.phi=q-le,a.update()},this.setAzimuthalAngle=C=>{let q=ea(C,2*Math.PI),le=c.theta;le<0&&(le+=2*Math.PI),q<0&&(q+=2*Math.PI);let ve=Math.abs(q-le);2*Math.PI-ve<ve&&(q<le?q+=2*Math.PI:le+=2*Math.PI),f.theta=q-le,a.update()},this.getDistance=()=>a.object.position.distanceTo(a.target),this.listenToKeyEvents=C=>{C.addEventListener("keydown",be),this._domElementKeyEvents=C},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",be),this._domElementKeyEvents=null},this.saveState=()=>{a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=()=>{a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(r),a.update(),o=i.NONE},this.update=(()=>{const C=new at,q=new at(0,1,0),le=new mn().setFromUnitVectors(t.up,q),ve=le.clone().invert(),Ge=new at,Q=new mn,Ne=2*Math.PI;return function(){const We=a.object.position;le.setFromUnitVectors(t.up,q),ve.copy(le).invert(),C.copy(We).sub(a.target),C.applyQuaternion(le),c.setFromVector3(C),a.autoRotate&&o===i.NONE&&x(I()),a.enableDamping?(c.theta+=f.theta*a.dampingFactor,c.phi+=f.phi*a.dampingFactor):(c.theta+=f.theta,c.phi+=f.phi);let xe=a.minAzimuthAngle,Qe=a.maxAzimuthAngle;isFinite(xe)&&isFinite(Qe)&&(xe<-Math.PI?xe+=Ne:xe>Math.PI&&(xe-=Ne),Qe<-Math.PI?Qe+=Ne:Qe>Math.PI&&(Qe-=Ne),xe<=Qe?c.theta=Math.max(xe,Math.min(Qe,c.theta)):c.theta=c.theta>(xe+Qe)/2?Math.max(xe,c.theta):Math.min(Qe,c.theta)),c.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,c.phi)),c.makeSafe(),a.enableDamping===!0?a.target.addScaledVector(p,a.dampingFactor):a.target.add(p),a.zoomToCursor&&_||a.object.isOrthographicCamera?c.radius=G(c.radius):c.radius=G(c.radius*h),C.setFromSpherical(c),C.applyQuaternion(ve),We.copy(a.target).add(C),a.object.matrixAutoUpdate||a.object.updateMatrix(),a.object.lookAt(a.target),a.enableDamping===!0?(f.theta*=1-a.dampingFactor,f.phi*=1-a.dampingFactor,p.multiplyScalar(1-a.dampingFactor)):(f.set(0,0,0),p.set(0,0,0));let Ye=!1;if(a.zoomToCursor&&_){let De=null;if(a.object instanceof kr&&a.object.isPerspectiveCamera){const ze=C.length();De=G(ze*h);const lt=ze-De;a.object.position.addScaledVector(R,lt),a.object.updateMatrixWorld()}else if(a.object.isOrthographicCamera){const ze=new at(B.x,B.y,0);ze.unproject(a.object),a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/h)),a.object.updateProjectionMatrix(),Ye=!0;const lt=new at(B.x,B.y,0);lt.unproject(a.object),a.object.position.sub(lt).add(ze),a.object.updateMatrixWorld(),De=C.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),a.zoomToCursor=!1;De!==null&&(a.screenSpacePanning?a.target.set(0,0,-1).transformDirection(a.object.matrix).multiplyScalar(De).add(a.object.position):(on.origin.copy(a.object.position),on.direction.set(0,0,-1).transformDirection(a.object.matrix),Math.abs(a.object.up.dot(on.direction))<Wl?t.lookAt(a.target):($o.setFromNormalAndCoplanarPoint(a.object.up,a.target),on.intersectPlane($o,a.target))))}else a.object instanceof Cr&&a.object.isOrthographicCamera&&(Ye=h!==1,Ye&&(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/h)),a.object.updateProjectionMatrix()));return h=1,_=!1,Ye||Ge.distanceToSquared(a.object.position)>l||8*(1-Q.dot(a.object.quaternion))>l?(a.dispatchEvent(r),Ge.copy(a.object.position),Q.copy(a.object.quaternion),Ye=!1,!0):!1}})(),this.connect=C=>{C===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),a.domElement=C,a.domElement.style.touchAction="none",a.domElement.addEventListener("contextmenu",ke),a.domElement.addEventListener("pointerdown",$),a.domElement.addEventListener("pointercancel",de),a.domElement.addEventListener("wheel",Xe)},this.dispose=()=>{var C,q,le,ve,Ge,Q;a.domElement&&(a.domElement.style.touchAction="auto"),(C=a.domElement)==null||C.removeEventListener("contextmenu",ke),(q=a.domElement)==null||q.removeEventListener("pointerdown",$),(le=a.domElement)==null||le.removeEventListener("pointercancel",de),(ve=a.domElement)==null||ve.removeEventListener("wheel",Xe),(Ge=a.domElement)==null||Ge.ownerDocument.removeEventListener("pointermove",Re),(Q=a.domElement)==null||Q.ownerDocument.removeEventListener("pointerup",de),a._domElementKeyEvents!==null&&a._domElementKeyEvents.removeEventListener("keydown",be)};const a=this,r={type:"change"},e={type:"start"},n={type:"end"},i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const l=1e-6,c=new ko,f=new ko;let h=1;const p=new at,A=new vt,v=new vt,g=new vt,F=new vt,b=new vt,S=new vt,E=new vt,T=new vt,w=new vt,R=new at,B=new vt;let _=!1;const D=[],z={};function I(){return 2*Math.PI/60/60*a.autoRotateSpeed}function L(){return Math.pow(.95,a.zoomSpeed)}function x(C){a.reverseOrbit||a.reverseHorizontalOrbit?f.theta+=C:f.theta-=C}function V(C){a.reverseOrbit||a.reverseVerticalOrbit?f.phi+=C:f.phi-=C}const j=(()=>{const C=new at;return function(le,ve){C.setFromMatrixColumn(ve,0),C.multiplyScalar(-le),p.add(C)}})(),ue=(()=>{const C=new at;return function(le,ve){a.screenSpacePanning===!0?C.setFromMatrixColumn(ve,1):(C.setFromMatrixColumn(ve,0),C.crossVectors(a.object.up,C)),C.multiplyScalar(le),p.add(C)}})(),fe=(()=>{const C=new at;return function(le,ve){const Ge=a.domElement;if(Ge&&a.object instanceof kr&&a.object.isPerspectiveCamera){const Q=a.object.position;C.copy(Q).sub(a.target);let Ne=C.length();Ne*=Math.tan(a.object.fov/2*Math.PI/180),j(2*le*Ne/Ge.clientHeight,a.object.matrix),ue(2*ve*Ne/Ge.clientHeight,a.object.matrix)}else Ge&&a.object instanceof Cr&&a.object.isOrthographicCamera?(j(le*(a.object.right-a.object.left)/a.object.zoom/Ge.clientWidth,a.object.matrix),ue(ve*(a.object.top-a.object.bottom)/a.object.zoom/Ge.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}})();function Y(C){a.object instanceof kr&&a.object.isPerspectiveCamera||a.object instanceof Cr&&a.object.isOrthographicCamera?h/=C:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function k(C){a.object instanceof kr&&a.object.isPerspectiveCamera||a.object instanceof Cr&&a.object.isOrthographicCamera?h*=C:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function M(C){if(!a.zoomToCursor||!a.domElement)return;_=!0;const q=a.domElement.getBoundingClientRect(),le=C.clientX-q.left,ve=C.clientY-q.top,Ge=q.width,Q=q.height;B.x=le/Ge*2-1,B.y=-(ve/Q)*2+1,R.set(B.x,B.y,1).unproject(a.object).sub(a.object.position).normalize()}function G(C){return Math.max(a.minDistance,Math.min(a.maxDistance,C))}function U(C){A.set(C.clientX,C.clientY)}function H(C){M(C),E.set(C.clientX,C.clientY)}function P(C){F.set(C.clientX,C.clientY)}function X(C){v.set(C.clientX,C.clientY),g.subVectors(v,A).multiplyScalar(a.rotateSpeed);const q=a.domElement;q&&(x(2*Math.PI*g.x/q.clientHeight),V(2*Math.PI*g.y/q.clientHeight)),A.copy(v),a.update()}function W(C){T.set(C.clientX,C.clientY),w.subVectors(T,E),w.y>0?Y(L()):w.y<0&&k(L()),E.copy(T),a.update()}function Z(C){b.set(C.clientX,C.clientY),S.subVectors(b,F).multiplyScalar(a.panSpeed),fe(S.x,S.y),F.copy(b),a.update()}function Ae(C){M(C),C.deltaY<0?k(L()):C.deltaY>0&&Y(L()),a.update()}function Be(C){let q=!1;switch(C.code){case a.keys.UP:fe(0,a.keyPanSpeed),q=!0;break;case a.keys.BOTTOM:fe(0,-a.keyPanSpeed),q=!0;break;case a.keys.LEFT:fe(a.keyPanSpeed,0),q=!0;break;case a.keys.RIGHT:fe(-a.keyPanSpeed,0),q=!0;break}q&&(C.preventDefault(),a.update())}function ae(){if(D.length==1)A.set(D[0].pageX,D[0].pageY);else{const C=.5*(D[0].pageX+D[1].pageX),q=.5*(D[0].pageY+D[1].pageY);A.set(C,q)}}function ee(){if(D.length==1)F.set(D[0].pageX,D[0].pageY);else{const C=.5*(D[0].pageX+D[1].pageX),q=.5*(D[0].pageY+D[1].pageY);F.set(C,q)}}function Oe(){const C=D[0].pageX-D[1].pageX,q=D[0].pageY-D[1].pageY,le=Math.sqrt(C*C+q*q);E.set(0,le)}function _e(){a.enableZoom&&Oe(),a.enablePan&&ee()}function me(){a.enableZoom&&Oe(),a.enableRotate&&ae()}function Ce(C){if(D.length==1)v.set(C.pageX,C.pageY);else{const le=Se(C),ve=.5*(C.pageX+le.x),Ge=.5*(C.pageY+le.y);v.set(ve,Ge)}g.subVectors(v,A).multiplyScalar(a.rotateSpeed);const q=a.domElement;q&&(x(2*Math.PI*g.x/q.clientHeight),V(2*Math.PI*g.y/q.clientHeight)),A.copy(v)}function we(C){if(D.length==1)b.set(C.pageX,C.pageY);else{const q=Se(C),le=.5*(C.pageX+q.x),ve=.5*(C.pageY+q.y);b.set(le,ve)}S.subVectors(b,F).multiplyScalar(a.panSpeed),fe(S.x,S.y),F.copy(b)}function ne(C){const q=Se(C),le=C.pageX-q.x,ve=C.pageY-q.y,Ge=Math.sqrt(le*le+ve*ve);T.set(0,Ge),w.set(0,Math.pow(T.y/E.y,a.zoomSpeed)),Y(w.y),E.copy(T)}function Ee(C){a.enableZoom&&ne(C),a.enablePan&&we(C)}function ge(C){a.enableZoom&&ne(C),a.enableRotate&&Ce(C)}function $(C){var q,le;a.enabled!==!1&&(D.length===0&&((q=a.domElement)==null||q.ownerDocument.addEventListener("pointermove",Re),(le=a.domElement)==null||le.ownerDocument.addEventListener("pointerup",de)),et(C),C.pointerType==="touch"?ye(C):Te(C))}function Re(C){a.enabled!==!1&&(C.pointerType==="touch"?Ie(C):he(C))}function de(C){var q,le,ve;ot(C),D.length===0&&((q=a.domElement)==null||q.releasePointerCapture(C.pointerId),(le=a.domElement)==null||le.ownerDocument.removeEventListener("pointermove",Re),(ve=a.domElement)==null||ve.ownerDocument.removeEventListener("pointerup",de)),a.dispatchEvent(n),o=i.NONE}function Te(C){let q;switch(C.button){case 0:q=a.mouseButtons.LEFT;break;case 1:q=a.mouseButtons.MIDDLE;break;case 2:q=a.mouseButtons.RIGHT;break;default:q=-1}switch(q){case Ar.DOLLY:if(a.enableZoom===!1)return;H(C),o=i.DOLLY;break;case Ar.ROTATE:if(C.ctrlKey||C.metaKey||C.shiftKey){if(a.enablePan===!1)return;P(C),o=i.PAN}else{if(a.enableRotate===!1)return;U(C),o=i.ROTATE}break;case Ar.PAN:if(C.ctrlKey||C.metaKey||C.shiftKey){if(a.enableRotate===!1)return;U(C),o=i.ROTATE}else{if(a.enablePan===!1)return;P(C),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&a.dispatchEvent(e)}function he(C){if(a.enabled!==!1)switch(o){case i.ROTATE:if(a.enableRotate===!1)return;X(C);break;case i.DOLLY:if(a.enableZoom===!1)return;W(C);break;case i.PAN:if(a.enablePan===!1)return;Z(C);break}}function Xe(C){a.enabled===!1||a.enableZoom===!1||o!==i.NONE&&o!==i.ROTATE||(C.preventDefault(),a.dispatchEvent(e),Ae(C),a.dispatchEvent(n))}function be(C){a.enabled===!1||a.enablePan===!1||Be(C)}function ye(C){switch(Pe(C),D.length){case 1:switch(a.touches.ONE){case mr.ROTATE:if(a.enableRotate===!1)return;ae(),o=i.TOUCH_ROTATE;break;case mr.PAN:if(a.enablePan===!1)return;ee(),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(a.touches.TWO){case mr.DOLLY_PAN:if(a.enableZoom===!1&&a.enablePan===!1)return;_e(),o=i.TOUCH_DOLLY_PAN;break;case mr.DOLLY_ROTATE:if(a.enableZoom===!1&&a.enableRotate===!1)return;me(),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&a.dispatchEvent(e)}function Ie(C){switch(Pe(C),o){case i.TOUCH_ROTATE:if(a.enableRotate===!1)return;Ce(C),a.update();break;case i.TOUCH_PAN:if(a.enablePan===!1)return;we(C),a.update();break;case i.TOUCH_DOLLY_PAN:if(a.enableZoom===!1&&a.enablePan===!1)return;Ee(C),a.update();break;case i.TOUCH_DOLLY_ROTATE:if(a.enableZoom===!1&&a.enableRotate===!1)return;ge(C),a.update();break;default:o=i.NONE}}function ke(C){a.enabled!==!1&&C.preventDefault()}function et(C){D.push(C)}function ot(C){delete z[C.pointerId];for(let q=0;q<D.length;q++)if(D[q].pointerId==C.pointerId){D.splice(q,1);return}}function Pe(C){let q=z[C.pointerId];q===void 0&&(q=new vt,z[C.pointerId]=q),q.set(C.pageX,C.pageY)}function Se(C){const q=C.pointerId===D[0].pointerId?D[1]:D[0];return z[q.pointerId]}s!==void 0&&this.connect(s),this.update()}};function vn(u){if(typeof TextDecoder<"u")return new TextDecoder().decode(u);let t="";for(let s=0,a=u.length;s<a;s++)t+=String.fromCharCode(u[s]);try{return decodeURIComponent(escape(t))}catch{return t}}const ur="srgb",Vt="srgb-linear",ta=3001,Yl=3e3;class go extends fo{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new $l(s)}),this.register(function(s){return new ec(s)}),this.register(function(s){return new cc(s)}),this.register(function(s){return new uc(s)}),this.register(function(s){return new fc(s)}),this.register(function(s){return new rc(s)}),this.register(function(s){return new nc(s)}),this.register(function(s){return new oc(s)}),this.register(function(s){return new ac(s)}),this.register(function(s){return new ql(s)}),this.register(function(s){return new ic(s)}),this.register(function(s){return new tc(s)}),this.register(function(s){return new lc(s)}),this.register(function(s){return new sc(s)}),this.register(function(s){return new Zl(s)}),this.register(function(s){return new hc(s)}),this.register(function(s){return new dc(s)})}load(t,s,a,r){const e=this;let n;if(this.resourcePath!=="")n=this.resourcePath;else if(this.path!==""){const l=Nr.extractUrlBase(t);n=Nr.resolveURL(l,this.path)}else n=Nr.extractUrlBase(t);this.manager.itemStart(t);const i=function(l){r?r(l):console.error(l),e.manager.itemError(t),e.manager.itemEnd(t)},o=new ar(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){try{e.parse(l,n,function(c){s(c),e.manager.itemEnd(t)},i)}catch(c){i(c)}},a,i)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,s,a,r){let e;const n={},i={};if(typeof t=="string")e=JSON.parse(t);else if(t instanceof ArrayBuffer)if(vn(new Uint8Array(t.slice(0,4)))===ni){try{n[Ke.KHR_BINARY_GLTF]=new pc(t)}catch(c){r&&r(c);return}e=JSON.parse(n[Ke.KHR_BINARY_GLTF].content)}else e=JSON.parse(vn(new Uint8Array(t)));else e=t;if(e.asset===void 0||e.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const o=new wc(e,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const c=this.pluginCallbacks[l](o);c.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),i[c.name]=c,n[c.name]=!0}if(e.extensionsUsed)for(let l=0;l<e.extensionsUsed.length;++l){const c=e.extensionsUsed[l],f=e.extensionsRequired||[];switch(c){case Ke.KHR_MATERIALS_UNLIT:n[c]=new Vl;break;case Ke.KHR_DRACO_MESH_COMPRESSION:n[c]=new Ac(e,this.dracoLoader);break;case Ke.KHR_TEXTURE_TRANSFORM:n[c]=new mc;break;case Ke.KHR_MESH_QUANTIZATION:n[c]=new gc;break;default:f.indexOf(c)>=0&&i[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}o.setExtensions(n),o.setPlugins(i),o.parse(a,r)}parseAsync(t,s){const a=this;return new Promise(function(r,e){a.parse(t,s,r,e)})}}function zl(){let u={};return{get:function(t){return u[t]},add:function(t,s){u[t]=s},remove:function(t){delete u[t]},removeAll:function(){u={}}}}const Ke={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Zl{constructor(t){this.parser=t,this.name=Ke.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,s=this.parser.json.nodes||[];for(let a=0,r=s.length;a<r;a++){const e=s[a];e.extensions&&e.extensions[this.name]&&e.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,e.extensions[this.name].light)}}_loadLight(t){const s=this.parser,a="light:"+t;let r=s.cache.get(a);if(r)return r;const e=s.json,o=((e.extensions&&e.extensions[this.name]||{}).lights||[])[t];let l;const c=new jt(16777215);o.color!==void 0&&c.setRGB(o.color[0],o.color[1],o.color[2],Vt);const f=o.range!==void 0?o.range:0;switch(o.type){case"directional":l=new qi(c),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Vi(c),l.distance=f;break;case"spot":l=new Zi(c),l.distance=f,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,l.angle=o.spot.outerConeAngle,l.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return l.position.set(0,0,0),l.decay=2,Qt(l,o),o.intensity!==void 0&&(l.intensity=o.intensity),l.name=s.createUniqueName(o.name||"light_"+t),r=Promise.resolve(l),s.cache.add(a,r),r}getDependency(t,s){if(t==="light")return this._loadLight(s)}createNodeAttachment(t){const s=this,a=this.parser,e=a.json.nodes[t],i=(e.extensions&&e.extensions[this.name]||{}).light;return i===void 0?null:this._loadLight(i).then(function(o){return a._getNodeRef(s.cache,i,o)})}}class Vl{constructor(){this.name=Ke.KHR_MATERIALS_UNLIT}getMaterialType(){return cr}extendParams(t,s,a){const r=[];t.color=new jt(1,1,1),t.opacity=1;const e=s.pbrMetallicRoughness;if(e){if(Array.isArray(e.baseColorFactor)){const n=e.baseColorFactor;t.color.setRGB(n[0],n[1],n[2],Vt),t.opacity=n[3]}e.baseColorTexture!==void 0&&r.push(a.assignTexture(t,"map",e.baseColorTexture,ur))}return Promise.all(r)}}class ql{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,s){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=r.extensions[this.name].emissiveStrength;return e!==void 0&&(s.emissiveIntensity=e),Promise.resolve()}}class $l{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const a=this.parser,r=a.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],n=r.extensions[this.name];if(n.clearcoatFactor!==void 0&&(s.clearcoat=n.clearcoatFactor),n.clearcoatTexture!==void 0&&e.push(a.assignTexture(s,"clearcoatMap",n.clearcoatTexture)),n.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=n.clearcoatRoughnessFactor),n.clearcoatRoughnessTexture!==void 0&&e.push(a.assignTexture(s,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),n.clearcoatNormalTexture!==void 0&&(e.push(a.assignTexture(s,"clearcoatNormalMap",n.clearcoatNormalTexture)),n.clearcoatNormalTexture.scale!==void 0)){const i=n.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new vt(i,i)}return Promise.all(e)}}class ec{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_DISPERSION}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=r.extensions[this.name];return s.dispersion=e.dispersion!==void 0?e.dispersion:0,Promise.resolve()}}class tc{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const a=this.parser,r=a.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],n=r.extensions[this.name];return n.iridescenceFactor!==void 0&&(s.iridescence=n.iridescenceFactor),n.iridescenceTexture!==void 0&&e.push(a.assignTexture(s,"iridescenceMap",n.iridescenceTexture)),n.iridescenceIor!==void 0&&(s.iridescenceIOR=n.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),n.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=n.iridescenceThicknessMinimum),n.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=n.iridescenceThicknessMaximum),n.iridescenceThicknessTexture!==void 0&&e.push(a.assignTexture(s,"iridescenceThicknessMap",n.iridescenceThicknessTexture)),Promise.all(e)}}class rc{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_SHEEN}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const a=this.parser,r=a.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[];s.sheenColor=new jt(0,0,0),s.sheenRoughness=0,s.sheen=1;const n=r.extensions[this.name];if(n.sheenColorFactor!==void 0){const i=n.sheenColorFactor;s.sheenColor.setRGB(i[0],i[1],i[2],Vt)}return n.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=n.sheenRoughnessFactor),n.sheenColorTexture!==void 0&&e.push(a.assignTexture(s,"sheenColorMap",n.sheenColorTexture,ur)),n.sheenRoughnessTexture!==void 0&&e.push(a.assignTexture(s,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(e)}}class nc{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const a=this.parser,r=a.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],n=r.extensions[this.name];return n.transmissionFactor!==void 0&&(s.transmission=n.transmissionFactor),n.transmissionTexture!==void 0&&e.push(a.assignTexture(s,"transmissionMap",n.transmissionTexture)),Promise.all(e)}}class oc{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_VOLUME}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const a=this.parser,r=a.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],n=r.extensions[this.name];s.thickness=n.thicknessFactor!==void 0?n.thicknessFactor:0,n.thicknessTexture!==void 0&&e.push(a.assignTexture(s,"thicknessMap",n.thicknessTexture)),s.attenuationDistance=n.attenuationDistance||1/0;const i=n.attenuationColor||[1,1,1];return s.attenuationColor=new jt().setRGB(i[0],i[1],i[2],Vt),Promise.all(e)}}class ac{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_IOR}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=r.extensions[this.name];return s.ior=e.ior!==void 0?e.ior:1.5,Promise.resolve()}}class ic{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_SPECULAR}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const a=this.parser,r=a.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],n=r.extensions[this.name];s.specularIntensity=n.specularFactor!==void 0?n.specularFactor:1,n.specularTexture!==void 0&&e.push(a.assignTexture(s,"specularIntensityMap",n.specularTexture));const i=n.specularColorFactor||[1,1,1];return s.specularColor=new jt().setRGB(i[0],i[1],i[2],Vt),n.specularColorTexture!==void 0&&e.push(a.assignTexture(s,"specularColorMap",n.specularColorTexture,ur)),Promise.all(e)}}class sc{constructor(t){this.parser=t,this.name=Ke.EXT_MATERIALS_BUMP}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const a=this.parser,r=a.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],n=r.extensions[this.name];return s.bumpScale=n.bumpFactor!==void 0?n.bumpFactor:1,n.bumpTexture!==void 0&&e.push(a.assignTexture(s,"bumpMap",n.bumpTexture)),Promise.all(e)}}class lc{constructor(t){this.parser=t,this.name=Ke.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const a=this.parser.json.materials[t];return!a.extensions||!a.extensions[this.name]?null:Kt}extendMaterialParams(t,s){const a=this.parser,r=a.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const e=[],n=r.extensions[this.name];return n.anisotropyStrength!==void 0&&(s.anisotropy=n.anisotropyStrength),n.anisotropyRotation!==void 0&&(s.anisotropyRotation=n.anisotropyRotation),n.anisotropyTexture!==void 0&&e.push(a.assignTexture(s,"anisotropyMap",n.anisotropyTexture)),Promise.all(e)}}class cc{constructor(t){this.parser=t,this.name=Ke.KHR_TEXTURE_BASISU}loadTexture(t){const s=this.parser,a=s.json,r=a.textures[t];if(!r.extensions||!r.extensions[this.name])return null;const e=r.extensions[this.name],n=s.options.ktx2Loader;if(!n){if(a.extensionsRequired&&a.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(t,e.source,n)}}class uc{constructor(t){this.parser=t,this.name=Ke.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const s=this.name,a=this.parser,r=a.json,e=r.textures[t];if(!e.extensions||!e.extensions[s])return null;const n=e.extensions[s],i=r.images[n.source];let o=a.textureLoader;if(i.uri){const l=a.options.manager.getHandler(i.uri);l!==null&&(o=l)}return this.detectSupport().then(function(l){if(l)return a.loadTextureImage(t,n.source,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(s)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return a.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const s=new Image;s.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",s.onload=s.onerror=function(){t(s.height===1)}})),this.isSupported}}class fc{constructor(t){this.parser=t,this.name=Ke.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const s=this.name,a=this.parser,r=a.json,e=r.textures[t];if(!e.extensions||!e.extensions[s])return null;const n=e.extensions[s],i=r.images[n.source];let o=a.textureLoader;if(i.uri){const l=a.options.manager.getHandler(i.uri);l!==null&&(o=l)}return this.detectSupport().then(function(l){if(l)return a.loadTextureImage(t,n.source,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(s)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return a.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const s=new Image;s.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",s.onload=s.onerror=function(){t(s.height===1)}})),this.isSupported}}class hc{constructor(t){this.name=Ke.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const s=this.parser.json,a=s.bufferViews[t];if(a.extensions&&a.extensions[this.name]){const r=a.extensions[this.name],e=this.parser.getDependency("buffer",r.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return e.then(function(i){const o=r.byteOffset||0,l=r.byteLength||0,c=r.count,f=r.byteStride,h=new Uint8Array(i,o,l);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(c,f,h,r.mode,r.filter).then(function(p){return p.buffer}):n.ready.then(function(){const p=new ArrayBuffer(c*f);return n.decodeGltfBuffer(new Uint8Array(p),c,f,h,r.mode,r.filter),p})})}else return null}}class dc{constructor(t){this.name=Ke.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const s=this.parser.json,a=s.nodes[t];if(!a.extensions||!a.extensions[this.name]||a.mesh===void 0)return null;const r=s.meshes[a.mesh];for(const l of r.primitives)if(l.mode!==xt.TRIANGLES&&l.mode!==xt.TRIANGLE_STRIP&&l.mode!==xt.TRIANGLE_FAN&&l.mode!==void 0)return null;const n=a.extensions[this.name].attributes,i=[],o={};for(const l in n)i.push(this.parser.getDependency("accessor",n[l]).then(c=>(o[l]=c,o[l])));return i.length<1?null:(i.push(this.parser.createNodeMesh(t)),Promise.all(i).then(l=>{const c=l.pop(),f=c.isGroup?c.children:[c],h=l[0].count,p=[];for(const A of f){const v=new Wr,g=new at,F=new mn,b=new at(1,1,1),S=new $i(A.geometry,A.material,h);for(let E=0;E<h;E++)o.TRANSLATION&&g.fromBufferAttribute(o.TRANSLATION,E),o.ROTATION&&F.fromBufferAttribute(o.ROTATION,E),o.SCALE&&b.fromBufferAttribute(o.SCALE,E),S.setMatrixAt(E,v.compose(g,F,b));for(const E in o)if(E==="_COLOR_0"){const T=o[E];S.instanceColor=new xa(T.array,T.itemSize,T.normalized)}else E!=="TRANSLATION"&&E!=="ROTATION"&&E!=="SCALE"&&A.geometry.setAttribute(E,o[E]);Ga.prototype.copy.call(S,A),this.parser.assignFinalMaterial(S),p.push(S)}return c.isGroup?(c.clear(),c.add(...p),c):p[0]}))}}const ni="glTF",Rr=12,ra={JSON:1313821514,BIN:5130562};class pc{constructor(t){this.name=Ke.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(t,0,Rr);if(this.header={magic:vn(new Uint8Array(t.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==ni)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const a=this.header.length-Rr,r=new DataView(t,Rr);let e=0;for(;e<a;){const n=r.getUint32(e,!0);e+=4;const i=r.getUint32(e,!0);if(e+=4,i===ra.JSON){const o=new Uint8Array(t,Rr+e,n);this.content=vn(o)}else if(i===ra.BIN){const o=Rr+e;this.body=t.slice(o,o+n)}e+=n}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ac{constructor(t,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ke.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(t,s){const a=this.json,r=this.dracoLoader,e=t.extensions[this.name].bufferView,n=t.extensions[this.name].attributes,i={},o={},l={};for(const c in n){const f=oo[c]||c.toLowerCase();i[f]=n[c]}for(const c in t.attributes){const f=oo[c]||c.toLowerCase();if(n[c]!==void 0){const h=a.accessors[t.attributes[c]],p=yr[h.componentType];l[f]=p.name,o[f]=h.normalized===!0}}return s.getDependency("bufferView",e).then(function(c){return new Promise(function(f,h){r.decodeDracoFile(c,function(p){for(const A in p.attributes){const v=p.attributes[A],g=o[A];g!==void 0&&(v.normalized=g)}f(p)},i,l,Vt,h)})})}}class mc{constructor(){this.name=Ke.KHR_TEXTURE_TRANSFORM}extendTexture(t,s){return(s.texCoord===void 0||s.texCoord===t.channel)&&s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(t=t.clone(),s.texCoord!==void 0&&(t.channel=s.texCoord),s.offset!==void 0&&t.offset.fromArray(s.offset),s.rotation!==void 0&&(t.rotation=s.rotation),s.scale!==void 0&&t.repeat.fromArray(s.scale),t.needsUpdate=!0),t}}class gc{constructor(){this.name=Ke.KHR_MESH_QUANTIZATION}}class oi extends bs{constructor(t,s,a,r){super(t,s,a,r)}copySampleValue_(t){const s=this.resultBuffer,a=this.sampleValues,r=this.valueSize,e=t*r*3+r;for(let n=0;n!==r;n++)s[n]=a[e+n];return s}interpolate_(t,s,a,r){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=i*2,l=i*3,c=r-s,f=(a-s)/c,h=f*f,p=h*f,A=t*l,v=A-l,g=-2*p+3*h,F=p-h,b=1-g,S=F-h+f;for(let E=0;E!==i;E++){const T=n[v+E+i],w=n[v+E+o]*c,R=n[A+E+i],B=n[A+E]*c;e[E]=b*T+S*w+g*R+F*B}return e}}const vc=new mn;class Bc extends oi{interpolate_(t,s,a,r){const e=super.interpolate_(t,s,a,r);return vc.fromArray(e).normalize().toArray(e),e}}const xt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},yr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},na={9728:ps,9729:Tt,9984:As,9985:ms,9986:gs,9987:Ua},oa={33071:Yt,33648:vs,10497:qn},Pn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},oo={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Il>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},tr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Cc={CUBICSPLINE:void 0,LINEAR:Oa,STEP:Bs},Hn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function bc(u){return u.DefaultMaterial===void 0&&(u.DefaultMaterial=new La({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ka})),u.DefaultMaterial}function sr(u,t,s){for(const a in s.extensions)u[a]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[a]=s.extensions[a])}function Qt(u,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(u.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Ec(u,t,s){let a=!1,r=!1,e=!1;for(let l=0,c=t.length;l<c;l++){const f=t[l];if(f.POSITION!==void 0&&(a=!0),f.NORMAL!==void 0&&(r=!0),f.COLOR_0!==void 0&&(e=!0),a&&r&&e)break}if(!a&&!r&&!e)return Promise.resolve(u);const n=[],i=[],o=[];for(let l=0,c=t.length;l<c;l++){const f=t[l];if(a){const h=f.POSITION!==void 0?s.getDependency("accessor",f.POSITION):u.attributes.position;n.push(h)}if(r){const h=f.NORMAL!==void 0?s.getDependency("accessor",f.NORMAL):u.attributes.normal;i.push(h)}if(e){const h=f.COLOR_0!==void 0?s.getDependency("accessor",f.COLOR_0):u.attributes.color;o.push(h)}}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(o)]).then(function(l){const c=l[0],f=l[1],h=l[2];return a&&(u.morphAttributes.position=c),r&&(u.morphAttributes.normal=f),e&&(u.morphAttributes.color=h),u.morphTargetsRelative=!0,u})}function yc(u,t){if(u.updateMorphTargets(),t.weights!==void 0)for(let s=0,a=t.weights.length;s<a;s++)u.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(u.morphTargetInfluences.length===s.length){u.morphTargetDictionary={};for(let a=0,r=s.length;a<r;a++)u.morphTargetDictionary[s[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Mc(u){let t;const s=u.extensions&&u.extensions[Ke.KHR_DRACO_MESH_COMPRESSION];if(s?t="draco:"+s.bufferView+":"+s.indices+":"+Nn(s.attributes):t=u.indices+":"+Nn(u.attributes)+":"+u.mode,u.targets!==void 0)for(let a=0,r=u.targets.length;a<r;a++)t+=":"+Nn(u.targets[a]);return t}function Nn(u){let t="";const s=Object.keys(u).sort();for(let a=0,r=s.length;a<r;a++)t+=s[a]+":"+u[s[a]]+";";return t}function ao(u){switch(u){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Tc(u){return u.search(/\.jpe?g($|\?)/i)>0||u.search(/^data\:image\/jpeg/)===0?"image/jpeg":u.search(/\.webp($|\?)/i)>0||u.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Fc=new Wr;class wc{constructor(t={},s={}){this.json=t,this.extensions={},this.plugins={},this.options=s,this.cache=new zl,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let a=!1,r=!1,e=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,e=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||a||r&&e<98?this.textureLoader=new bn(this.options.manager):this.textureLoader=new es(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ar(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,s){const a=this,r=this.json,e=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(n){return n._markDefs&&n._markDefs()}),Promise.all(this._invokeAll(function(n){return n.beforeRoot&&n.beforeRoot()})).then(function(){return Promise.all([a.getDependencies("scene"),a.getDependencies("animation"),a.getDependencies("camera")])}).then(function(n){const i={scene:n[0][r.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:r.asset,parser:a,userData:{}};return sr(e,i,r),Qt(i,r),Promise.all(a._invokeAll(function(o){return o.afterRoot&&o.afterRoot(i)})).then(function(){for(const o of i.scenes)o.updateMatrixWorld();t(i)})}).catch(s)}_markDefs(){const t=this.json.nodes||[],s=this.json.skins||[],a=this.json.meshes||[];for(let r=0,e=s.length;r<e;r++){const n=s[r].joints;for(let i=0,o=n.length;i<o;i++)t[n[i]].isBone=!0}for(let r=0,e=t.length;r<e;r++){const n=t[r];n.mesh!==void 0&&(this._addNodeRef(this.meshCache,n.mesh),n.skin!==void 0&&(a[n.mesh].isSkinnedMesh=!0)),n.camera!==void 0&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,s){s!==void 0&&(t.refs[s]===void 0&&(t.refs[s]=t.uses[s]=0),t.refs[s]++)}_getNodeRef(t,s,a){if(t.refs[s]<=1)return a;const r=a.clone(),e=(n,i)=>{const o=this.associations.get(n);o!=null&&this.associations.set(i,o);for(const[l,c]of n.children.entries())e(c,i.children[l])};return e(a,r),r.name+="_instance_"+t.uses[s]++,r}_invokeOne(t){const s=Object.values(this.plugins);s.push(this);for(let a=0;a<s.length;a++){const r=t(s[a]);if(r)return r}return null}_invokeAll(t){const s=Object.values(this.plugins);s.unshift(this);const a=[];for(let r=0;r<s.length;r++){const e=t(s[r]);e&&a.push(e)}return a}getDependency(t,s){const a=t+":"+s;let r=this.cache.get(a);if(!r){switch(t){case"scene":r=this.loadScene(s);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(s)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(s)});break;case"accessor":r=this.loadAccessor(s);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(s)});break;case"buffer":r=this.loadBuffer(s);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(s)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(s)});break;case"skin":r=this.loadSkin(s);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(s)});break;case"camera":r=this.loadCamera(s);break;default:if(r=this._invokeOne(function(e){return e!=this&&e.getDependency&&e.getDependency(t,s)}),!r)throw new Error("Unknown type: "+t);break}this.cache.add(a,r)}return r}getDependencies(t){let s=this.cache.get(t);if(!s){const a=this,r=this.json[t+(t==="mesh"?"es":"s")]||[];s=Promise.all(r.map(function(e,n){return a.getDependency(t,n)})),this.cache.add(t,s)}return s}loadBuffer(t){const s=this.json.buffers[t],a=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&t===0)return Promise.resolve(this.extensions[Ke.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(e,n){a.load(Nr.resolveURL(s.uri,r.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(t){const s=this.json.bufferViews[t];return this.getDependency("buffer",s.buffer).then(function(a){const r=s.byteLength||0,e=s.byteOffset||0;return a.slice(e,e+r)})}loadAccessor(t){const s=this,a=this.json,r=this.json.accessors[t];if(r.bufferView===void 0&&r.sparse===void 0){const n=Pn[r.type],i=yr[r.componentType],o=r.normalized===!0,l=new i(r.count*n);return Promise.resolve(new Jr(l,n,o))}const e=[];return r.bufferView!==void 0?e.push(this.getDependency("bufferView",r.bufferView)):e.push(null),r.sparse!==void 0&&(e.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),e.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(e).then(function(n){const i=n[0],o=Pn[r.type],l=yr[r.componentType],c=l.BYTES_PER_ELEMENT,f=c*o,h=r.byteOffset||0,p=r.bufferView!==void 0?a.bufferViews[r.bufferView].byteStride:void 0,A=r.normalized===!0;let v,g;if(p&&p!==f){const F=Math.floor(h/p),b="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+F+":"+r.count;let S=s.cache.get(b);S||(v=new l(i,F*p,r.count*p/c),S=new ts(v,p/c),s.cache.add(b,S)),g=new Cs(S,o,h%p/c,A)}else i===null?v=new l(r.count*o):v=new l(i,h,r.count*o),g=new Jr(v,o,A);if(r.sparse!==void 0){const F=Pn.SCALAR,b=yr[r.sparse.indices.componentType],S=r.sparse.indices.byteOffset||0,E=r.sparse.values.byteOffset||0,T=new b(n[1],S,r.sparse.count*F),w=new l(n[2],E,r.sparse.count*o);i!==null&&(g=new Jr(g.array.slice(),g.itemSize,g.normalized));for(let R=0,B=T.length;R<B;R++){const _=T[R];if(g.setX(_,w[R*o]),o>=2&&g.setY(_,w[R*o+1]),o>=3&&g.setZ(_,w[R*o+2]),o>=4&&g.setW(_,w[R*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(t){const s=this.json,a=this.options,e=s.textures[t].source,n=s.images[e];let i=this.textureLoader;if(n.uri){const o=a.manager.getHandler(n.uri);o!==null&&(i=o)}return this.loadTextureImage(t,e,i)}loadTextureImage(t,s,a){const r=this,e=this.json,n=e.textures[t],i=e.images[s],o=(i.uri||i.bufferView)+":"+n.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(s,a).then(function(c){c.flipY=!1,c.name=n.name||i.name||"",c.name===""&&typeof i.uri=="string"&&i.uri.startsWith("data:image/")===!1&&(c.name=i.uri);const h=(e.samplers||{})[n.sampler]||{};return c.magFilter=na[h.magFilter]||Tt,c.minFilter=na[h.minFilter]||Ua,c.wrapS=oa[h.wrapS]||qn,c.wrapT=oa[h.wrapT]||qn,r.associations.set(c,{textures:t}),c}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(t,s){const a=this,r=this.json,e=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(f=>f.clone());const n=r.images[t],i=self.URL||self.webkitURL;let o=n.uri||"",l=!1;if(n.bufferView!==void 0)o=a.getDependency("bufferView",n.bufferView).then(function(f){l=!0;const h=new Blob([f],{type:n.mimeType});return o=i.createObjectURL(h),o});else if(n.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const c=Promise.resolve(o).then(function(f){return new Promise(function(h,p){let A=h;s.isImageBitmapLoader===!0&&(A=function(v){const g=new Dt(v);g.needsUpdate=!0,h(g)}),s.load(Nr.resolveURL(f,e.path),A,void 0,p)})}).then(function(f){return l===!0&&i.revokeObjectURL(o),Qt(f,n),f.userData.mimeType=n.mimeType||Tc(n.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),f});return this.sourceCache[t]=c,c}assignTexture(t,s,a,r){const e=this;return this.getDependency("texture",a.index).then(function(n){if(!n)return null;if(a.texCoord!==void 0&&a.texCoord>0&&(n=n.clone(),n.channel=a.texCoord),e.extensions[Ke.KHR_TEXTURE_TRANSFORM]){const i=a.extensions!==void 0?a.extensions[Ke.KHR_TEXTURE_TRANSFORM]:void 0;if(i){const o=e.associations.get(n);n=e.extensions[Ke.KHR_TEXTURE_TRANSFORM].extendTexture(n,i),e.associations.set(n,o)}}return r!==void 0&&(typeof r=="number"&&(r=r===ta?ur:Vt),"colorSpace"in n?n.colorSpace=r:n.encoding=r===ur?ta:Yl),t[s]=n,n})}assignFinalMaterial(t){const s=t.geometry;let a=t.material;const r=s.attributes.tangent===void 0,e=s.attributes.color!==void 0,n=s.attributes.normal===void 0;if(t.isPoints){const i="PointsMaterial:"+a.uuid;let o=this.cache.get(i);o||(o=new rs,Gn.prototype.copy.call(o,a),o.color.copy(a.color),o.map=a.map,o.sizeAttenuation=!1,this.cache.add(i,o)),a=o}else if(t.isLine){const i="LineBasicMaterial:"+a.uuid;let o=this.cache.get(i);o||(o=new ns,Gn.prototype.copy.call(o,a),o.color.copy(a.color),o.map=a.map,this.cache.add(i,o)),a=o}if(r||e||n){let i="ClonedMaterial:"+a.uuid+":";r&&(i+="derivative-tangents:"),e&&(i+="vertex-colors:"),n&&(i+="flat-shading:");let o=this.cache.get(i);o||(o=a.clone(),e&&(o.vertexColors=!0),n&&(o.flatShading=!0),r&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(i,o),this.associations.set(o,this.associations.get(a))),a=o}t.material=a}getMaterialType(){return La}loadMaterial(t){const s=this,a=this.json,r=this.extensions,e=a.materials[t];let n;const i={},o=e.extensions||{},l=[];if(o[Ke.KHR_MATERIALS_UNLIT]){const f=r[Ke.KHR_MATERIALS_UNLIT];n=f.getMaterialType(),l.push(f.extendParams(i,e,s))}else{const f=e.pbrMetallicRoughness||{};if(i.color=new jt(1,1,1),i.opacity=1,Array.isArray(f.baseColorFactor)){const h=f.baseColorFactor;i.color.setRGB(h[0],h[1],h[2],Vt),i.opacity=h[3]}f.baseColorTexture!==void 0&&l.push(s.assignTexture(i,"map",f.baseColorTexture,ur)),i.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,i.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(l.push(s.assignTexture(i,"metalnessMap",f.metallicRoughnessTexture)),l.push(s.assignTexture(i,"roughnessMap",f.metallicRoughnessTexture))),n=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(t,i)})))}e.doubleSided===!0&&(i.side=Cn);const c=e.alphaMode||Hn.OPAQUE;if(c===Hn.BLEND?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,c===Hn.MASK&&(i.alphaTest=e.alphaCutoff!==void 0?e.alphaCutoff:.5)),e.normalTexture!==void 0&&n!==cr&&(l.push(s.assignTexture(i,"normalMap",e.normalTexture)),i.normalScale=new vt(1,1),e.normalTexture.scale!==void 0)){const f=e.normalTexture.scale;i.normalScale.set(f,f)}if(e.occlusionTexture!==void 0&&n!==cr&&(l.push(s.assignTexture(i,"aoMap",e.occlusionTexture)),e.occlusionTexture.strength!==void 0&&(i.aoMapIntensity=e.occlusionTexture.strength)),e.emissiveFactor!==void 0&&n!==cr){const f=e.emissiveFactor;i.emissive=new jt().setRGB(f[0],f[1],f[2],Vt)}return e.emissiveTexture!==void 0&&n!==cr&&l.push(s.assignTexture(i,"emissiveMap",e.emissiveTexture,ur)),Promise.all(l).then(function(){const f=new n(i);return e.name&&(f.name=e.name),Qt(f,e),s.associations.set(f,{materials:t}),e.extensions&&sr(r,f,e),f})}createUniqueName(t){const s=os.sanitizeNodeName(t||"");return s in this.nodeNamesUsed?s+"_"+ ++this.nodeNamesUsed[s]:(this.nodeNamesUsed[s]=0,s)}loadGeometries(t){const s=this,a=this.extensions,r=this.primitiveCache;function e(i){return a[Ke.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(i,s).then(function(o){return aa(o,i,s)})}const n=[];for(let i=0,o=t.length;i<o;i++){const l=t[i],c=Mc(l),f=r[c];if(f)n.push(f.promise);else{let h;l.extensions&&l.extensions[Ke.KHR_DRACO_MESH_COMPRESSION]?h=e(l):h=aa(new ho,l,s),r[c]={primitive:l,promise:h},n.push(h)}}return Promise.all(n)}loadMesh(t){const s=this,a=this.json,r=this.extensions,e=a.meshes[t],n=e.primitives,i=[];for(let o=0,l=n.length;o<l;o++){const c=n[o].material===void 0?bc(this.cache):this.getDependency("material",n[o].material);i.push(c)}return i.push(s.loadGeometries(n)),Promise.all(i).then(function(o){const l=o.slice(0,o.length-1),c=o[o.length-1],f=[];for(let p=0,A=c.length;p<A;p++){const v=c[p],g=n[p];let F;const b=l[p];if(g.mode===xt.TRIANGLES||g.mode===xt.TRIANGLE_STRIP||g.mode===xt.TRIANGLE_FAN||g.mode===void 0)F=e.isSkinnedMesh===!0?new as(v,b):new hr(v,b),F.isSkinnedMesh===!0&&F.normalizeSkinWeights(),g.mode===xt.TRIANGLE_STRIP?F.geometry=qo(F.geometry,Da):g.mode===xt.TRIANGLE_FAN&&(F.geometry=qo(F.geometry,Vn));else if(g.mode===xt.LINES)F=new is(v,b);else if(g.mode===xt.LINE_STRIP)F=new ss(v,b);else if(g.mode===xt.LINE_LOOP)F=new ls(v,b);else if(g.mode===xt.POINTS)F=new cs(v,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(F.geometry.morphAttributes).length>0&&yc(F,e),F.name=s.createUniqueName(e.name||"mesh_"+t),Qt(F,e),g.extensions&&sr(r,F,g),s.assignFinalMaterial(F),f.push(F)}for(let p=0,A=f.length;p<A;p++)s.associations.set(f[p],{meshes:t,primitives:p});if(f.length===1)return e.extensions&&sr(r,f[0],e),f[0];const h=new Un;e.extensions&&sr(r,h,e),s.associations.set(h,{meshes:t});for(let p=0,A=f.length;p<A;p++)h.add(f[p]);return h})}loadCamera(t){let s;const a=this.json.cameras[t],r=a[a.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return a.type==="perspective"?s=new kr(us.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):a.type==="orthographic"&&(s=new Cr(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),a.name&&(s.name=this.createUniqueName(a.name)),Qt(s,a),Promise.resolve(s)}loadSkin(t){const s=this.json.skins[t],a=[];for(let r=0,e=s.joints.length;r<e;r++)a.push(this._loadNodeShallow(s.joints[r]));return s.inverseBindMatrices!==void 0?a.push(this.getDependency("accessor",s.inverseBindMatrices)):a.push(null),Promise.all(a).then(function(r){const e=r.pop(),n=r,i=[],o=[];for(let l=0,c=n.length;l<c;l++){const f=n[l];if(f){i.push(f);const h=new Wr;e!==null&&h.fromArray(e.array,l*16),o.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[l])}return new fs(i,o)})}loadAnimation(t){const s=this.json,a=this,r=s.animations[t],e=r.name?r.name:"animation_"+t,n=[],i=[],o=[],l=[],c=[];for(let f=0,h=r.channels.length;f<h;f++){const p=r.channels[f],A=r.samplers[p.sampler],v=p.target,g=v.node,F=r.parameters!==void 0?r.parameters[A.input]:A.input,b=r.parameters!==void 0?r.parameters[A.output]:A.output;v.node!==void 0&&(n.push(this.getDependency("node",g)),i.push(this.getDependency("accessor",F)),o.push(this.getDependency("accessor",b)),l.push(A),c.push(v))}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(o),Promise.all(l),Promise.all(c)]).then(function(f){const h=f[0],p=f[1],A=f[2],v=f[3],g=f[4],F=[];for(let b=0,S=h.length;b<S;b++){const E=h[b],T=p[b],w=A[b],R=v[b],B=g[b];if(E===void 0)continue;E.updateMatrix&&E.updateMatrix();const _=a._createAnimationTracks(E,T,w,R,B);if(_)for(let D=0;D<_.length;D++)F.push(_[D])}return new hs(e,void 0,F)})}createNodeMesh(t){const s=this.json,a=this,r=s.nodes[t];return r.mesh===void 0?null:a.getDependency("mesh",r.mesh).then(function(e){const n=a._getNodeRef(a.meshCache,r.mesh,e);return r.weights!==void 0&&n.traverse(function(i){if(i.isMesh)for(let o=0,l=r.weights.length;o<l;o++)i.morphTargetInfluences[o]=r.weights[o]}),n})}loadNode(t){const s=this.json,a=this,r=s.nodes[t],e=a._loadNodeShallow(t),n=[],i=r.children||[];for(let l=0,c=i.length;l<c;l++)n.push(a.getDependency("node",i[l]));const o=r.skin===void 0?Promise.resolve(null):a.getDependency("skin",r.skin);return Promise.all([e,Promise.all(n),o]).then(function(l){const c=l[0],f=l[1],h=l[2];h!==null&&c.traverse(function(p){p.isSkinnedMesh&&p.bind(h,Fc)});for(let p=0,A=f.length;p<A;p++)c.add(f[p]);return c})}_loadNodeShallow(t){const s=this.json,a=this.extensions,r=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const e=s.nodes[t],n=e.name?r.createUniqueName(e.name):"",i=[],o=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return o&&i.push(o),e.camera!==void 0&&i.push(r.getDependency("camera",e.camera).then(function(l){return r._getNodeRef(r.cameraCache,e.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){i.push(l)}),this.nodeCache[t]=Promise.all(i).then(function(l){let c;if(e.isBone===!0?c=new ds:l.length>1?c=new Un:l.length===1?c=l[0]:c=new Ga,c!==l[0])for(let f=0,h=l.length;f<h;f++)c.add(l[f]);if(e.name&&(c.userData.name=e.name,c.name=n),Qt(c,e),e.extensions&&sr(a,c,e),e.matrix!==void 0){const f=new Wr;f.fromArray(e.matrix),c.applyMatrix4(f)}else e.translation!==void 0&&c.position.fromArray(e.translation),e.rotation!==void 0&&c.quaternion.fromArray(e.rotation),e.scale!==void 0&&c.scale.fromArray(e.scale);return r.associations.has(c)||r.associations.set(c,{}),r.associations.get(c).nodes=t,c}),this.nodeCache[t]}loadScene(t){const s=this.extensions,a=this.json.scenes[t],r=this,e=new Un;a.name&&(e.name=r.createUniqueName(a.name)),Qt(e,a),a.extensions&&sr(s,e,a);const n=a.nodes||[],i=[];for(let o=0,l=n.length;o<l;o++)i.push(r.getDependency("node",n[o]));return Promise.all(i).then(function(o){for(let c=0,f=o.length;c<f;c++)e.add(o[c]);const l=c=>{const f=new Map;for(const[h,p]of r.associations)(h instanceof Gn||h instanceof Dt)&&f.set(h,p);return c.traverse(h=>{const p=r.associations.get(h);p!=null&&f.set(h,p)}),f};return r.associations=l(e),e})}_createAnimationTracks(t,s,a,r,e){const n=[],i=t.name?t.name:t.uuid,o=[];tr[e.path]===tr.weights?t.traverse(function(h){h.morphTargetInfluences&&o.push(h.name?h.name:h.uuid)}):o.push(i);let l;switch(tr[e.path]){case tr.weights:l=Ho;break;case tr.rotation:l=No;break;case tr.position:case tr.scale:l=Po;break;default:switch(a.itemSize){case 1:l=Ho;break;case 2:case 3:default:l=Po;break}break}const c=r.interpolation!==void 0?Cc[r.interpolation]:Oa,f=this._getArrayFromAccessor(a);for(let h=0,p=o.length;h<p;h++){const A=new l(o[h]+"."+tr[e.path],s.array,f,c);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(A),n.push(A)}return n}_getArrayFromAccessor(t){let s=t.array;if(t.normalized){const a=ao(s.constructor),r=new Float32Array(s.length);for(let e=0,n=s.length;e<n;e++)r[e]=s[e]*a;s=r}return s}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(a){const r=this instanceof No?Bc:oi;return new r(this.times,this.values,this.getValueSize()/3,a)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ic(u,t,s){const a=t.attributes,r=new Pa;if(a.POSITION!==void 0){const i=s.json.accessors[a.POSITION],o=i.min,l=i.max;if(o!==void 0&&l!==void 0){if(r.set(new at(o[0],o[1],o[2]),new at(l[0],l[1],l[2])),i.normalized){const c=ao(yr[i.componentType]);r.min.multiplyScalar(c),r.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const e=t.targets;if(e!==void 0){const i=new at,o=new at;for(let l=0,c=e.length;l<c;l++){const f=e[l];if(f.POSITION!==void 0){const h=s.json.accessors[f.POSITION],p=h.min,A=h.max;if(p!==void 0&&A!==void 0){if(o.setX(Math.max(Math.abs(p[0]),Math.abs(A[0]))),o.setY(Math.max(Math.abs(p[1]),Math.abs(A[1]))),o.setZ(Math.max(Math.abs(p[2]),Math.abs(A[2]))),h.normalized){const v=ao(yr[h.componentType]);o.multiplyScalar(v)}i.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(i)}u.boundingBox=r;const n=new Ha;r.getCenter(n.center),n.radius=r.min.distanceTo(r.max)/2,u.boundingSphere=n}function aa(u,t,s){const a=t.attributes,r=[];function e(n,i){return s.getDependency("accessor",n).then(function(o){u.setAttribute(i,o)})}for(const n in a){const i=oo[n]||n.toLowerCase();i in u.attributes||r.push(e(a[n],i))}if(t.indices!==void 0&&!u.index){const n=s.getDependency("accessor",t.indices).then(function(i){u.setIndex(i)});r.push(n)}return Qt(u,t),Ic(u,t,s),Promise.all(r).then(function(){return t.targets!==void 0?Ec(u,t.targets,s):u})}class Sc extends Na{constructor(t){super(t),this.type=Ut}parse(t){const n=function(B,_){switch(B){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(_||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(_||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(_||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(_||""))}},c=`
`,f=function(B,_,D){_=_||1024;let I=B.pos,L=-1,x=0,V="",j=String.fromCharCode.apply(null,new Uint16Array(B.subarray(I,I+128)));for(;0>(L=j.indexOf(c))&&x<_&&I<B.byteLength;)V+=j,x+=j.length,I+=128,j+=String.fromCharCode.apply(null,new Uint16Array(B.subarray(I,I+128)));return-1<L?(B.pos+=x+L+1,V+j.slice(0,L)):!1},h=function(B){const _=/^#\?(\S+)/,D=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*FORMAT=(\S+)\s*$/,L=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,x={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let V,j;for((B.pos>=B.byteLength||!(V=f(B)))&&n(1,"no header found"),(j=V.match(_))||n(3,"bad initial token"),x.valid|=1,x.programtype=j[1],x.string+=V+`
`;V=f(B),V!==!1;){if(x.string+=V+`
`,V.charAt(0)==="#"){x.comments+=V+`
`;continue}if((j=V.match(D))&&(x.gamma=parseFloat(j[1])),(j=V.match(z))&&(x.exposure=parseFloat(j[1])),(j=V.match(I))&&(x.valid|=2,x.format=j[1]),(j=V.match(L))&&(x.valid|=4,x.height=parseInt(j[1],10),x.width=parseInt(j[2],10)),x.valid&2&&x.valid&4)break}return x.valid&2||n(3,"missing format specifier"),x.valid&4||n(3,"missing image size specifier"),x},p=function(B,_,D){const z=_;if(z<8||z>32767||B[0]!==2||B[1]!==2||B[2]&128)return new Uint8Array(B);z!==(B[2]<<8|B[3])&&n(3,"wrong scanline width");const I=new Uint8Array(4*_*D);I.length||n(4,"unable to allocate buffer space");let L=0,x=0;const V=4*z,j=new Uint8Array(4),ue=new Uint8Array(V);let fe=D;for(;fe>0&&x<B.byteLength;){x+4>B.byteLength&&n(1),j[0]=B[x++],j[1]=B[x++],j[2]=B[x++],j[3]=B[x++],(j[0]!=2||j[1]!=2||(j[2]<<8|j[3])!=z)&&n(3,"bad rgbe scanline format");let Y=0,k;for(;Y<V&&x<B.byteLength;){k=B[x++];const G=k>128;if(G&&(k-=128),(k===0||Y+k>V)&&n(3,"bad scanline data"),G){const U=B[x++];for(let H=0;H<k;H++)ue[Y++]=U}else ue.set(B.subarray(x,x+k),Y),Y+=k,x+=k}const M=z;for(let G=0;G<M;G++){let U=0;I[L]=ue[G+U],U+=z,I[L+1]=ue[G+U],U+=z,I[L+2]=ue[G+U],U+=z,I[L+3]=ue[G+U],L+=4}fe--}return I},A=function(B,_,D,z){const I=B[_+3],L=Math.pow(2,I-128)/255;D[z+0]=B[_+0]*L,D[z+1]=B[_+1]*L,D[z+2]=B[_+2]*L,D[z+3]=1},v=function(B,_,D,z){const I=B[_+3],L=Math.pow(2,I-128)/255;D[z+0]=br.toHalfFloat(Math.min(B[_+0]*L,65504)),D[z+1]=br.toHalfFloat(Math.min(B[_+1]*L,65504)),D[z+2]=br.toHalfFloat(Math.min(B[_+2]*L,65504)),D[z+3]=br.toHalfFloat(1)},g=new Uint8Array(t);g.pos=0;const F=h(g),b=F.width,S=F.height,E=p(g.subarray(g.pos),b,S);let T,w,R;switch(this.type){case Zt:R=E.length/4;const B=new Float32Array(R*4);for(let D=0;D<R;D++)A(E,D*4,B,D*4);T=B,w=Zt;break;case Ut:R=E.length/4;const _=new Uint16Array(R*4);for(let D=0;D<R;D++)v(E,D*4,_,D*4);T=_,w=Ut;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:b,height:S,data:T,header:F.string,gamma:F.gamma,exposure:F.exposure,type:w}}setDataType(t){return this.type=t,this}load(t,s,a,r){function e(n,i){switch(n.type){case Zt:case Ut:"colorSpace"in n?n.colorSpace="srgb-linear":n.encoding=3e3,n.minFilter=Tt,n.magFilter=Tt,n.generateMipmaps=!1,n.flipY=!0;break}s&&s(n,i)}return super.load(t,e,a,r)}}const xr="colorSpace"in new Dt;class _c extends Na{constructor(t){super(t),this.type=Ut}parse(t){const _=Math.pow(2.7182818,2.2);function D(d,m){for(var y=0,O=0;O<65536;++O)(O==0||d[O>>3]&1<<(O&7))&&(m[y++]=O);for(var J=y-1;y<65536;)m[y++]=0;return J}function z(d){for(var m=0;m<16384;m++)d[m]={},d[m].len=0,d[m].lit=0,d[m].p=null}const I={l:0,c:0,lc:0};function L(d,m,y,O,J){for(;y<d;)m=m<<8|C(O,J),y+=8;y-=d,I.l=m>>y&(1<<d)-1,I.c=m,I.lc=y}const x=new Array(59);function V(d){for(var m=0;m<=58;++m)x[m]=0;for(var m=0;m<65537;++m)x[d[m]]+=1;for(var y=0,m=58;m>0;--m){var O=y+x[m]>>1;x[m]=y,y=O}for(var m=0;m<65537;++m){var J=d[m];J>0&&(d[m]=J|x[J]++<<6)}}function j(d,m,y,O,J,K,re){for(var te=y,ie=0,se=0;J<=K;J++){if(te.value-y.value>O)return!1;L(6,ie,se,d,te);var ce=I.l;if(ie=I.c,se=I.lc,re[J]=ce,ce==63){if(te.value-y.value>O)throw"Something wrong with hufUnpackEncTable";L(8,ie,se,d,te);var N=I.l+6;if(ie=I.c,se=I.lc,J+N>K+1)throw"Something wrong with hufUnpackEncTable";for(;N--;)re[J++]=0;J--}else if(ce>=59){var N=ce-59+2;if(J+N>K+1)throw"Something wrong with hufUnpackEncTable";for(;N--;)re[J++]=0;J--}}V(re)}function ue(d){return d&63}function fe(d){return d>>6}function Y(d,m,y,O){for(;m<=y;m++){var J=fe(d[m]),K=ue(d[m]);if(J>>K)throw"Invalid table entry";if(K>14){var re=O[J>>K-14];if(re.len)throw"Invalid table entry";if(re.lit++,re.p){var te=re.p;re.p=new Array(re.lit);for(var ie=0;ie<re.lit-1;++ie)re.p[ie]=te[ie]}else re.p=new Array(1);re.p[re.lit-1]=m}else if(K)for(var se=0,ie=1<<14-K;ie>0;ie--){var re=O[(J<<14-K)+se];if(re.len||re.p)throw"Invalid table entry";re.len=K,re.lit=m,se++}}return!0}const k={c:0,lc:0};function M(d,m,y,O){d=d<<8|C(y,O),m+=8,k.c=d,k.lc=m}const G={c:0,lc:0};function U(d,m,y,O,J,K,re,te,ie,se){if(d==m){O<8&&(M(y,O,J,re),y=k.c,O=k.lc),O-=8;var ce=y>>O,ce=new Uint8Array([ce])[0];if(ie.value+ce>se)return!1;for(var N=te[ie.value-1];ce-- >0;)te[ie.value++]=N}else if(ie.value<se)te[ie.value++]=d;else return!1;G.c=y,G.lc=O}function H(d){return d&65535}function P(d){var m=H(d);return m>32767?m-65536:m}const X={a:0,b:0};function W(d,m){var y=P(d),O=P(m),J=O,K=y+(J&1)+(J>>1),re=K,te=K-J;X.a=re,X.b=te}function Z(d,m){var y=H(d),O=H(m),J=y-(O>>1)&65535,K=O+J-32768&65535;X.a=K,X.b=J}function Ae(d,m,y,O,J,K,re){for(var te=re<16384,ie=y>J?J:y,se=1,ce;se<=ie;)se<<=1;for(se>>=1,ce=se,se>>=1;se>=1;){for(var N=0,tt=N+K*(J-ce),Fe=K*se,Me=K*ce,Ue=O*se,Je=O*ce,Ze,Ve,st,mt;N<=tt;N+=Me){for(var qe=N,St=N+O*(y-ce);qe<=St;qe+=Je){var rt=qe+Ue,ut=qe+Fe,Bt=ut+Ue;te?(W(d[qe+m],d[ut+m]),Ze=X.a,st=X.b,W(d[rt+m],d[Bt+m]),Ve=X.a,mt=X.b,W(Ze,Ve),d[qe+m]=X.a,d[rt+m]=X.b,W(st,mt),d[ut+m]=X.a,d[Bt+m]=X.b):(Z(d[qe+m],d[ut+m]),Ze=X.a,st=X.b,Z(d[rt+m],d[Bt+m]),Ve=X.a,mt=X.b,Z(Ze,Ve),d[qe+m]=X.a,d[rt+m]=X.b,Z(st,mt),d[ut+m]=X.a,d[Bt+m]=X.b)}if(y&se){var ut=qe+Fe;te?W(d[qe+m],d[ut+m]):Z(d[qe+m],d[ut+m]),Ze=X.a,d[ut+m]=X.b,d[qe+m]=Ze}}if(J&se)for(var qe=N,St=N+O*(y-ce);qe<=St;qe+=Je){var rt=qe+Ue;te?W(d[qe+m],d[rt+m]):Z(d[qe+m],d[rt+m]),Ze=X.a,d[rt+m]=X.b,d[qe+m]=Ze}ce=se,se>>=1}return N}function Be(d,m,y,O,J,K,re,te,ie,se){for(var ce=0,N=0,tt=te,Fe=Math.trunc(J.value+(K+7)/8);J.value<Fe;)for(M(ce,N,y,J),ce=k.c,N=k.lc;N>=14;){var Me=ce>>N-14&16383,Ue=m[Me];if(Ue.len)N-=Ue.len,U(Ue.lit,re,ce,N,y,O,J,ie,se,tt),ce=G.c,N=G.lc;else{if(!Ue.p)throw"hufDecode issues";var Je;for(Je=0;Je<Ue.lit;Je++){for(var Ze=ue(d[Ue.p[Je]]);N<Ze&&J.value<Fe;)M(ce,N,y,J),ce=k.c,N=k.lc;if(N>=Ze&&fe(d[Ue.p[Je]])==(ce>>N-Ze&(1<<Ze)-1)){N-=Ze,U(Ue.p[Je],re,ce,N,y,O,J,ie,se,tt),ce=G.c,N=G.lc;break}}if(Je==Ue.lit)throw"hufDecode issues"}}var Ve=8-K&7;for(ce>>=Ve,N-=Ve;N>0;){var Ue=m[ce<<14-N&16383];if(Ue.len)N-=Ue.len,U(Ue.lit,re,ce,N,y,O,J,ie,se,tt),ce=G.c,N=G.lc;else throw"hufDecode issues"}return!0}function ae(d,m,y,O,J,K){var re={value:0},te=y.value,ie=Se(m,y),se=Se(m,y);y.value+=4;var ce=Se(m,y);if(y.value+=4,ie<0||ie>=65537||se<0||se>=65537)throw"Something wrong with HUF_ENCSIZE";var N=new Array(65537),tt=new Array(16384);z(tt);var Fe=O-(y.value-te);if(j(d,m,y,Fe,ie,se,N),ce>8*(O-(y.value-te)))throw"Something wrong with hufUncompress";Y(N,ie,se,tt),Be(N,tt,d,m,y,ce,se,K,J,re)}function ee(d,m,y){for(var O=0;O<y;++O)m[O]=d[m[O]]}function Oe(d){for(var m=1;m<d.length;m++){var y=d[m-1]+d[m]-128;d[m]=y}}function _e(d,m){for(var y=0,O=Math.floor((d.length+1)/2),J=0,K=d.length-1;!(J>K||(m[J++]=d[y++],J>K));)m[J++]=d[O++]}function me(d){for(var m=d.byteLength,y=new Array,O=0,J=new DataView(d);m>0;){var K=J.getInt8(O++);if(K<0){var re=-K;m-=re+1;for(var te=0;te<re;te++)y.push(J.getUint8(O++))}else{var re=K;m-=2;for(var ie=J.getUint8(O++),te=0;te<re+1;te++)y.push(ie)}}return y}function Ce(d,m,y,O,J,K){var rt=new DataView(K.buffer),re=y[d.idx[0]].width,te=y[d.idx[0]].height,ie=3,se=Math.floor(re/8),ce=Math.ceil(re/8),N=Math.ceil(te/8),tt=re-(ce-1)*8,Fe=te-(N-1)*8,Me={value:0},Ue=new Array(ie),Je=new Array(ie),Ze=new Array(ie),Ve=new Array(ie),st=new Array(ie);for(let $e=0;$e<ie;++$e)st[$e]=m[d.idx[$e]],Ue[$e]=$e<1?0:Ue[$e-1]+ce*N,Je[$e]=new Float32Array(64),Ze[$e]=new Uint16Array(64),Ve[$e]=new Uint16Array(ce*64);for(let $e=0;$e<N;++$e){var mt=8;$e==N-1&&(mt=Fe);var qe=8;for(let nt=0;nt<ce;++nt){nt==ce-1&&(qe=tt);for(let je=0;je<ie;++je)Ze[je].fill(0),Ze[je][0]=J[Ue[je]++],we(Me,O,Ze[je]),ne(Ze[je],Je[je]),Ee(Je[je]);ge(Je);for(let je=0;je<ie;++je)$(Je[je],Ve[je],nt*64)}let ft=0;for(let nt=0;nt<ie;++nt){const je=y[d.idx[nt]].type;for(let Et=8*$e;Et<8*$e+mt;++Et){ft=st[nt][Et];for(let Rt=0;Rt<se;++Rt){const dt=Rt*64+(Et&7)*8;rt.setUint16(ft+0*2*je,Ve[nt][dt+0],!0),rt.setUint16(ft+1*2*je,Ve[nt][dt+1],!0),rt.setUint16(ft+2*2*je,Ve[nt][dt+2],!0),rt.setUint16(ft+3*2*je,Ve[nt][dt+3],!0),rt.setUint16(ft+4*2*je,Ve[nt][dt+4],!0),rt.setUint16(ft+5*2*je,Ve[nt][dt+5],!0),rt.setUint16(ft+6*2*je,Ve[nt][dt+6],!0),rt.setUint16(ft+7*2*je,Ve[nt][dt+7],!0),ft+=8*2*je}}if(se!=ce)for(let Et=8*$e;Et<8*$e+mt;++Et){const Rt=st[nt][Et]+8*se*2*je,dt=se*64+(Et&7)*8;for(let kt=0;kt<qe;++kt)rt.setUint16(Rt+kt*2*je,Ve[nt][dt+kt],!0)}}}for(var St=new Uint16Array(re),rt=new DataView(K.buffer),ut=0;ut<ie;++ut){y[d.idx[ut]].decoded=!0;var Bt=y[d.idx[ut]].type;if(y[ut].type==2)for(var Wt=0;Wt<te;++Wt){const $e=st[ut][Wt];for(var ht=0;ht<re;++ht)St[ht]=rt.getUint16($e+ht*2*Bt,!0);for(var ht=0;ht<re;++ht)rt.setFloat32($e+ht*2*Bt,Q(St[ht]),!0)}}}function we(d,m,y){for(var O,J=1;J<64;)O=m[d.value],O==65280?J=64:O>>8==255?J+=O&255:(y[J]=O,J++),d.value++}function ne(d,m){m[0]=Q(d[0]),m[1]=Q(d[1]),m[2]=Q(d[5]),m[3]=Q(d[6]),m[4]=Q(d[14]),m[5]=Q(d[15]),m[6]=Q(d[27]),m[7]=Q(d[28]),m[8]=Q(d[2]),m[9]=Q(d[4]),m[10]=Q(d[7]),m[11]=Q(d[13]),m[12]=Q(d[16]),m[13]=Q(d[26]),m[14]=Q(d[29]),m[15]=Q(d[42]),m[16]=Q(d[3]),m[17]=Q(d[8]),m[18]=Q(d[12]),m[19]=Q(d[17]),m[20]=Q(d[25]),m[21]=Q(d[30]),m[22]=Q(d[41]),m[23]=Q(d[43]),m[24]=Q(d[9]),m[25]=Q(d[11]),m[26]=Q(d[18]),m[27]=Q(d[24]),m[28]=Q(d[31]),m[29]=Q(d[40]),m[30]=Q(d[44]),m[31]=Q(d[53]),m[32]=Q(d[10]),m[33]=Q(d[19]),m[34]=Q(d[23]),m[35]=Q(d[32]),m[36]=Q(d[39]),m[37]=Q(d[45]),m[38]=Q(d[52]),m[39]=Q(d[54]),m[40]=Q(d[20]),m[41]=Q(d[22]),m[42]=Q(d[33]),m[43]=Q(d[38]),m[44]=Q(d[46]),m[45]=Q(d[51]),m[46]=Q(d[55]),m[47]=Q(d[60]),m[48]=Q(d[21]),m[49]=Q(d[34]),m[50]=Q(d[37]),m[51]=Q(d[47]),m[52]=Q(d[50]),m[53]=Q(d[56]),m[54]=Q(d[59]),m[55]=Q(d[61]),m[56]=Q(d[35]),m[57]=Q(d[36]),m[58]=Q(d[48]),m[59]=Q(d[49]),m[60]=Q(d[57]),m[61]=Q(d[58]),m[62]=Q(d[62]),m[63]=Q(d[63])}function Ee(d){const m=.5*Math.cos(.7853975),y=.5*Math.cos(3.14159/16),O=.5*Math.cos(3.14159/8),J=.5*Math.cos(3*3.14159/16),K=.5*Math.cos(5*3.14159/16),re=.5*Math.cos(3*3.14159/8),te=.5*Math.cos(7*3.14159/16);for(var ie=new Array(4),se=new Array(4),ce=new Array(4),N=new Array(4),tt=0;tt<8;++tt){var Fe=tt*8;ie[0]=O*d[Fe+2],ie[1]=re*d[Fe+2],ie[2]=O*d[Fe+6],ie[3]=re*d[Fe+6],se[0]=y*d[Fe+1]+J*d[Fe+3]+K*d[Fe+5]+te*d[Fe+7],se[1]=J*d[Fe+1]-te*d[Fe+3]-y*d[Fe+5]-K*d[Fe+7],se[2]=K*d[Fe+1]-y*d[Fe+3]+te*d[Fe+5]+J*d[Fe+7],se[3]=te*d[Fe+1]-K*d[Fe+3]+J*d[Fe+5]-y*d[Fe+7],ce[0]=m*(d[Fe+0]+d[Fe+4]),ce[3]=m*(d[Fe+0]-d[Fe+4]),ce[1]=ie[0]+ie[3],ce[2]=ie[1]-ie[2],N[0]=ce[0]+ce[1],N[1]=ce[3]+ce[2],N[2]=ce[3]-ce[2],N[3]=ce[0]-ce[1],d[Fe+0]=N[0]+se[0],d[Fe+1]=N[1]+se[1],d[Fe+2]=N[2]+se[2],d[Fe+3]=N[3]+se[3],d[Fe+4]=N[3]-se[3],d[Fe+5]=N[2]-se[2],d[Fe+6]=N[1]-se[1],d[Fe+7]=N[0]-se[0]}for(var Me=0;Me<8;++Me)ie[0]=O*d[16+Me],ie[1]=re*d[16+Me],ie[2]=O*d[48+Me],ie[3]=re*d[48+Me],se[0]=y*d[8+Me]+J*d[24+Me]+K*d[40+Me]+te*d[56+Me],se[1]=J*d[8+Me]-te*d[24+Me]-y*d[40+Me]-K*d[56+Me],se[2]=K*d[8+Me]-y*d[24+Me]+te*d[40+Me]+J*d[56+Me],se[3]=te*d[8+Me]-K*d[24+Me]+J*d[40+Me]-y*d[56+Me],ce[0]=m*(d[Me]+d[32+Me]),ce[3]=m*(d[Me]-d[32+Me]),ce[1]=ie[0]+ie[3],ce[2]=ie[1]-ie[2],N[0]=ce[0]+ce[1],N[1]=ce[3]+ce[2],N[2]=ce[3]-ce[2],N[3]=ce[0]-ce[1],d[0+Me]=N[0]+se[0],d[8+Me]=N[1]+se[1],d[16+Me]=N[2]+se[2],d[24+Me]=N[3]+se[3],d[32+Me]=N[3]-se[3],d[40+Me]=N[2]-se[2],d[48+Me]=N[1]-se[1],d[56+Me]=N[0]-se[0]}function ge(d){for(var m=0;m<64;++m){var y=d[0][m],O=d[1][m],J=d[2][m];d[0][m]=y+1.5747*J,d[1][m]=y-.1873*O-.4682*J,d[2][m]=y+1.8556*O}}function $(d,m,y){for(var O=0;O<64;++O)m[y+O]=br.toHalfFloat(Re(d[O]))}function Re(d){return d<=1?Math.sign(d)*Math.pow(Math.abs(d),2.2):Math.sign(d)*Math.pow(_,Math.abs(d)-1)}function de(d){return new DataView(d.array.buffer,d.offset.value,d.size)}function Te(d){var m=d.viewer.buffer.slice(d.offset.value,d.offset.value+d.size),y=new Uint8Array(me(m)),O=new Uint8Array(y.length);return Oe(y),_e(y,O),new DataView(O.buffer)}function he(d){var m=d.array.slice(d.offset.value,d.offset.value+d.size),y=nn(m),O=new Uint8Array(y.length);return Oe(y),_e(y,O),new DataView(O.buffer)}function Xe(d){for(var m=d.viewer,y={value:d.offset.value},O=new Uint16Array(d.width*d.scanlineBlockSize*(d.channels*d.type)),J=new Uint8Array(8192),K=0,re=new Array(d.channels),te=0;te<d.channels;te++)re[te]={},re[te].start=K,re[te].end=re[te].start,re[te].nx=d.width,re[te].ny=d.lines,re[te].size=d.type,K+=re[te].nx*re[te].ny*re[te].size;var ie=Ne(m,y),se=Ne(m,y);if(se>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(ie<=se)for(var te=0;te<se-ie+1;te++)J[te+ie]=q(m,y);var ce=new Uint16Array(65536),N=D(J,ce),tt=Se(m,y);ae(d.array,m,y,tt,O,K);for(var te=0;te<d.channels;++te)for(var Fe=re[te],Me=0;Me<re[te].size;++Me)Ae(O,Fe.start+Me,Fe.nx,Fe.size,Fe.ny,Fe.nx*Fe.size,N);ee(ce,O,K);for(var Ue=0,Je=new Uint8Array(O.buffer.byteLength),Ze=0;Ze<d.lines;Ze++)for(var Ve=0;Ve<d.channels;Ve++){var Fe=re[Ve],st=Fe.nx*Fe.size,mt=new Uint8Array(O.buffer,Fe.end*2,st*2);Je.set(mt,Ue),Ue+=st*2,Fe.end+=st}return new DataView(Je.buffer)}function be(d){var m=d.array.slice(d.offset.value,d.offset.value+d.size),y=nn(m);const O=d.lines*d.channels*d.width,J=d.type==1?new Uint16Array(O):new Uint32Array(O);let K=0,re=0;const te=new Array(4);for(let ie=0;ie<d.lines;ie++)for(let se=0;se<d.channels;se++){let ce=0;switch(d.type){case 1:te[0]=K,te[1]=te[0]+d.width,K=te[1]+d.width;for(let N=0;N<d.width;++N){const tt=y[te[0]++]<<8|y[te[1]++];ce+=tt,J[re]=ce,re++}break;case 2:te[0]=K,te[1]=te[0]+d.width,te[2]=te[1]+d.width,K=te[2]+d.width;for(let N=0;N<d.width;++N){const tt=y[te[0]++]<<24|y[te[1]++]<<16|y[te[2]++]<<8;ce+=tt,J[re]=ce,re++}break}}return new DataView(J.buffer)}function ye(d){var m=d.viewer,y={value:d.offset.value},O=new Uint8Array(d.width*d.lines*(d.channels*d.type*2)),J={version:le(m,y),unknownUncompressedSize:le(m,y),unknownCompressedSize:le(m,y),acCompressedSize:le(m,y),dcCompressedSize:le(m,y),rleCompressedSize:le(m,y),rleUncompressedSize:le(m,y),rleRawSize:le(m,y),totalAcUncompressedCount:le(m,y),totalDcUncompressedCount:le(m,y),acCompression:le(m,y)};if(J.version<2)throw"EXRLoader.parse: "+It.compression+" version "+J.version+" is unsupported";for(var K=new Array,re=Ne(m,y)-2;re>0;){var te=Ie(m.buffer,y),ie=q(m,y),se=ie>>2&3,ce=(ie>>4)-1,N=new Int8Array([ce])[0],tt=q(m,y);K.push({name:te,index:N,type:tt,compression:se}),re-=te.length+3}for(var Fe=It.channels,Me=new Array(d.channels),Ue=0;Ue<d.channels;++Ue){var Je=Me[Ue]={},Ze=Fe[Ue];Je.name=Ze.name,Je.compression=0,Je.decoded=!1,Je.type=Ze.pixelType,Je.pLinear=Ze.pLinear,Je.width=d.width,Je.height=d.lines}for(var Ve={idx:new Array(3)},st=0;st<d.channels;++st)for(var Je=Me[st],Ue=0;Ue<K.length;++Ue){var mt=K[Ue];Je.name==mt.name&&(Je.compression=mt.compression,mt.index>=0&&(Ve.idx[mt.index]=st),Je.offset=st)}if(J.acCompressedSize>0)switch(J.acCompression){case 0:var rt=new Uint16Array(J.totalAcUncompressedCount);ae(d.array,m,y,J.acCompressedSize,rt,J.totalAcUncompressedCount);break;case 1:var qe=d.array.slice(y.value,y.value+J.totalAcUncompressedCount),St=nn(qe),rt=new Uint16Array(St.buffer);y.value+=J.totalAcUncompressedCount;break}if(J.dcCompressedSize>0){var ut={array:d.array,offset:y,size:J.dcCompressedSize},Bt=new Uint16Array(he(ut).buffer);y.value+=J.dcCompressedSize}if(J.rleRawSize>0){var qe=d.array.slice(y.value,y.value+J.rleCompressedSize),St=nn(qe),Wt=me(St.buffer);y.value+=J.rleCompressedSize}for(var ht=0,$e=new Array(Me.length),Ue=0;Ue<$e.length;++Ue)$e[Ue]=new Array;for(var ft=0;ft<d.lines;++ft)for(var nt=0;nt<Me.length;++nt)$e[nt].push(ht),ht+=Me[nt].width*d.type*2;Ce(Ve,$e,Me,rt,Bt,O);for(var Ue=0;Ue<Me.length;++Ue){var Je=Me[Ue];if(!Je.decoded)switch(Je.compression){case 2:for(var je=0,Et=0,ft=0;ft<d.lines;++ft){for(var Rt=$e[Ue][je],dt=0;dt<Je.width;++dt){for(var kt=0;kt<2*Je.type;++kt)O[Rt++]=Wt[Et+kt*Je.width*Je.height];Et++}je++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(O.buffer)}function Ie(d,m){for(var y=new Uint8Array(d),O=0;y[m.value+O]!=0;)O+=1;var J=new TextDecoder().decode(y.slice(m.value,m.value+O));return m.value=m.value+O+1,J}function ke(d,m,y){var O=new TextDecoder().decode(new Uint8Array(d).slice(m.value,m.value+y));return m.value=m.value+y,O}function et(d,m){var y=Pe(d,m),O=Se(d,m);return[y,O]}function ot(d,m){var y=Se(d,m),O=Se(d,m);return[y,O]}function Pe(d,m){var y=d.getInt32(m.value,!0);return m.value=m.value+4,y}function Se(d,m){var y=d.getUint32(m.value,!0);return m.value=m.value+4,y}function C(d,m){var y=d[m.value];return m.value=m.value+1,y}function q(d,m){var y=d.getUint8(m.value);return m.value=m.value+1,y}const le=function(d,m){let y;return"getBigInt64"in DataView.prototype?y=Number(d.getBigInt64(m.value,!0)):y=d.getUint32(m.value+4,!0)+Number(d.getUint32(m.value,!0)<<32),m.value+=8,y};function ve(d,m){var y=d.getFloat32(m.value,!0);return m.value+=4,y}function Ge(d,m){return br.toHalfFloat(ve(d,m))}function Q(d){var m=(d&31744)>>10,y=d&1023;return(d>>15?-1:1)*(m?m===31?y?NaN:1/0:Math.pow(2,m-15)*(1+y/1024):6103515625e-14*(y/1024))}function Ne(d,m){var y=d.getUint16(m.value,!0);return m.value+=2,y}function Lt(d,m){return Q(Ne(d,m))}function We(d,m,y,O){for(var J=y.value,K=[];y.value<J+O-1;){var re=Ie(m,y),te=Pe(d,y),ie=q(d,y);y.value+=3;var se=Pe(d,y),ce=Pe(d,y);K.push({name:re,pixelType:te,pLinear:ie,xSampling:se,ySampling:ce})}return y.value+=1,K}function xe(d,m){var y=ve(d,m),O=ve(d,m),J=ve(d,m),K=ve(d,m),re=ve(d,m),te=ve(d,m),ie=ve(d,m),se=ve(d,m);return{redX:y,redY:O,greenX:J,greenY:K,blueX:re,blueY:te,whiteX:ie,whiteY:se}}function Qe(d,m){var y=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],O=q(d,m);return y[O]}function Ye(d,m){var y=Se(d,m),O=Se(d,m),J=Se(d,m),K=Se(d,m);return{xMin:y,yMin:O,xMax:J,yMax:K}}function De(d,m){var y=["INCREASING_Y"],O=q(d,m);return y[O]}function ze(d,m){var y=ve(d,m),O=ve(d,m);return[y,O]}function lt(d,m){var y=ve(d,m),O=ve(d,m),J=ve(d,m);return[y,O,J]}function pt(d,m,y,O,J){if(O==="string"||O==="stringvector"||O==="iccProfile")return ke(m,y,J);if(O==="chlist")return We(d,m,y,J);if(O==="chromaticities")return xe(d,y);if(O==="compression")return Qe(d,y);if(O==="box2i")return Ye(d,y);if(O==="lineOrder")return De(d,y);if(O==="float")return ve(d,y);if(O==="v2f")return ze(d,y);if(O==="v3f")return lt(d,y);if(O==="int")return Pe(d,y);if(O==="rational")return et(d,y);if(O==="timecode")return ot(d,y);if(O==="preview")return y.value+=J,"skipped";y.value+=J}function ct(d,m,y){const O={};if(d.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";O.version=d.getUint8(4);const J=d.getUint8(5);O.spec={singleTile:!!(J&2),longName:!!(J&4),deepFormat:!!(J&8),multiPart:!!(J&16)},y.value=8;for(var K=!0;K;){var re=Ie(m,y);if(re==0)K=!1;else{var te=Ie(m,y),ie=Se(d,y),se=pt(d,m,y,te,ie);se===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${te}'.`):O[re]=se}}if(J&-5)throw console.error("EXRHeader:",O),"THREE.EXRLoader: provided file is currently unsupported.";return O}function Ft(d,m,y,O,J){const K={size:0,viewer:m,array:y,offset:O,width:d.dataWindow.xMax-d.dataWindow.xMin+1,height:d.dataWindow.yMax-d.dataWindow.yMin+1,channels:d.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:d.channels[0].pixelType,uncompress:null,getter:null,format:null,[xr?"colorSpace":"encoding"]:null};switch(d.compression){case"NO_COMPRESSION":K.lines=1,K.uncompress=de;break;case"RLE_COMPRESSION":K.lines=1,K.uncompress=Te;break;case"ZIPS_COMPRESSION":K.lines=1,K.uncompress=he;break;case"ZIP_COMPRESSION":K.lines=16,K.uncompress=he;break;case"PIZ_COMPRESSION":K.lines=32,K.uncompress=Xe;break;case"PXR24_COMPRESSION":K.lines=16,K.uncompress=be;break;case"DWAA_COMPRESSION":K.lines=32,K.uncompress=ye;break;case"DWAB_COMPRESSION":K.lines=256,K.uncompress=ye;break;default:throw"EXRLoader.parse: "+d.compression+" is unsupported"}if(K.scanlineBlockSize=K.lines,K.type==1)switch(J){case Zt:K.getter=Lt,K.inputSize=2;break;case Ut:K.getter=Ne,K.inputSize=2;break}else if(K.type==2)switch(J){case Zt:K.getter=ve,K.inputSize=4;break;case Ut:K.getter=Ge,K.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+K.type+" for "+d.compression+".";K.blockCount=(d.dataWindow.yMax+1)/K.scanlineBlockSize;for(var re=0;re<K.blockCount;re++)le(m,O);K.outputChannels=K.channels==3?4:K.channels;const te=K.width*K.height*K.outputChannels;switch(J){case Zt:K.byteArray=new Float32Array(te),K.channels<K.outputChannels&&K.byteArray.fill(1,0,te);break;case Ut:K.byteArray=new Uint16Array(te),K.channels<K.outputChannels&&K.byteArray.fill(15360,0,te);break;default:console.error("THREE.EXRLoader: unsupported type: ",J);break}return K.bytesPerLine=K.width*K.inputSize*K.channels,K.outputChannels==4?K.format=Qr:K.format=Es,xr?K.colorSpace="srgb-linear":K.encoding=3e3,K}const wt=new DataView(t),Ot=new Uint8Array(t),bt={value:0},It=ct(wt,t,bt),He=Ft(It,wt,Ot,bt,this.type),At={value:0},Xt={R:0,G:1,B:2,A:3,Y:0};for(let d=0;d<He.height/He.scanlineBlockSize;d++){const m=Se(wt,bt);He.size=Se(wt,bt),He.lines=m+He.scanlineBlockSize>He.height?He.height-m:He.scanlineBlockSize;const O=He.size<He.lines*He.bytesPerLine?He.uncompress(He):de(He);bt.value+=He.size;for(let J=0;J<He.scanlineBlockSize;J++){const K=J+d*He.scanlineBlockSize;if(K>=He.height)break;for(let re=0;re<He.channels;re++){const te=Xt[It.channels[re].name];for(let ie=0;ie<He.width;ie++){At.value=(J*(He.channels*He.width)+re*He.width+ie)*He.inputSize;const se=(He.height-1-K)*(He.width*He.outputChannels)+ie*He.outputChannels+te;He.byteArray[se]=He.getter(O,At)}}}}return{header:It,width:He.width,height:He.height,data:He.byteArray,format:He.format,[xr?"colorSpace":"encoding"]:He[xr?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,s,a,r){function e(n,i){xr?n.colorSpace=i.colorSpace:n.encoding=i.encoding,n.minFilter=Tt,n.magFilter=Tt,n.generateMipmaps=!1,n.flipY=!1,s&&s(n,i)}return super.load(t,e,a,r)}}const Jn=new WeakMap;class Dc extends fo{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,s,a,r){const e=new ar(this.manager);e.setPath(this.path),e.setResponseType("arraybuffer"),e.setRequestHeader(this.requestHeader),e.setWithCredentials(this.withCredentials),e.load(t,n=>{const i={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(n,i).then(s).catch(r)},a,r)}decodeDracoFile(t,s,a,r){const e={attributeIDs:a||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!a};this.decodeGeometry(t,e).then(s)}decodeGeometry(t,s){for(const o in s.attributeTypes){const l=s.attributeTypes[o];l.BYTES_PER_ELEMENT!==void 0&&(s.attributeTypes[o]=l.name)}const a=JSON.stringify(s);if(Jn.has(t)){const o=Jn.get(t);if(o.key===a)return o.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const e=this.workerNextTaskID++,n=t.byteLength,i=this._getWorker(e,n).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[e]={resolve:l,reject:c},r.postMessage({type:"decode",id:e,taskConfig:s,buffer:t},[t])}))).then(o=>this._createGeometry(o.geometry));return i.catch(()=>!0).then(()=>{r&&e&&this._releaseTask(r,e)}),Jn.set(t,{key:a,promise:i}),i}_createGeometry(t){const s=new ho;t.index&&s.setIndex(new Jr(t.index.array,1));for(let a=0;a<t.attributes.length;a++){const r=t.attributes[a],e=r.name,n=r.array,i=r.itemSize;s.setAttribute(e,new Jr(n,i))}return s}_loadLibrary(t,s){const a=new ar(this.manager);return a.setPath(this.decoderPath),a.setResponseType(s),a.setWithCredentials(this.withCredentials),new Promise((r,e)=>{a.load(t,r,void 0,e)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",s=[];return t?s.push(this._loadLibrary("draco_decoder.js","text")):(s.push(this._loadLibrary("draco_wasm_wrapper.js","text")),s.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(s).then(a=>{const r=a[0];t||(this.decoderConfig.wasmBinary=a[1]);const e=Rc.toString(),n=["/* draco decoder */",r,"","/* worker */",e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(t,s){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(e){const n=e.data;switch(n.type){case"decode":r._callbacks[n.id].resolve(n);break;case"error":r._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,e){return r._taskLoad>e._taskLoad?-1:1});const a=this.workerPool[this.workerPool.length-1];return a._taskCosts[t]=s,a._taskLoad+=s,a})}_releaseTask(t,s){t._taskLoad-=t._taskCosts[s],delete t._callbacks[s],delete t._taskCosts[s]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function Rc(){let u,t;onmessage=function(n){const i=n.data;switch(i.type){case"init":u=i.decoderConfig,t=new Promise(function(c){u.onModuleLoaded=function(f){c({draco:f})},DracoDecoderModule(u)});break;case"decode":const o=i.buffer,l=i.taskConfig;t.then(c=>{const f=c.draco,h=new f.Decoder,p=new f.DecoderBuffer;p.Init(new Int8Array(o),o.byteLength);try{const A=s(f,h,p,l),v=A.attributes.map(g=>g.array.buffer);A.index&&v.push(A.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:A},v)}catch(A){console.error(A),self.postMessage({type:"error",id:i.id,error:A.message})}finally{f.destroy(p),f.destroy(h)}});break}};function s(n,i,o,l){const c=l.attributeIDs,f=l.attributeTypes;let h,p;const A=i.GetEncodedGeometryType(o);if(A===n.TRIANGULAR_MESH)h=new n.Mesh,p=i.DecodeBufferToMesh(o,h);else if(A===n.POINT_CLOUD)h=new n.PointCloud,p=i.DecodeBufferToPointCloud(o,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||h.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const v={index:null,attributes:[]};for(const g in c){const F=self[f[g]];let b,S;if(l.useUniqueIDs)S=c[g],b=i.GetAttributeByUniqueId(h,S);else{if(S=i.GetAttributeId(h,n[c[g]]),S===-1)continue;b=i.GetAttribute(h,S)}v.attributes.push(r(n,i,h,g,F,b))}return A===n.TRIANGULAR_MESH&&(v.index=a(n,i,h)),n.destroy(h),v}function a(n,i,o){const c=o.num_faces()*3,f=c*4,h=n._malloc(f);i.GetTrianglesUInt32Array(o,f,h);const p=new Uint32Array(n.HEAPF32.buffer,h,c).slice();return n._free(h),{array:p,itemSize:1}}function r(n,i,o,l,c,f){const h=f.num_components(),A=o.num_points()*h,v=A*c.BYTES_PER_ELEMENT,g=e(n,c),F=n._malloc(v);i.GetAttributeDataArrayForAllPoints(o,f,g,v,F);const b=new c(n.HEAPF32.buffer,F,A).slice();return n._free(F),{name:l,array:b,itemSize:h}}function e(n,i){switch(i){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32}}}let an;const jn=()=>{if(an)return an;const u="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",t="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",s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),a=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=u;WebAssembly.validate(s)&&(r=t);let e;const n=WebAssembly.instantiate(i(r),{}).then(f=>{e=f.instance,e.exports.__wasm_call_ctors()});function i(f){const h=new Uint8Array(f.length);for(let A=0;A<f.length;++A){const v=f.charCodeAt(A);h[A]=v>96?v-71:v>64?v-65:v>47?v+4:v>46?63:62}let p=0;for(let A=0;A<f.length;++A)h[p++]=h[A]<60?a[h[A]]:(h[A]-60)*64+h[++A];return h.buffer.slice(0,p)}function o(f,h,p,A,v,g){const F=e.exports.sbrk,b=p+3&-4,S=F(b*A),E=F(v.length),T=new Uint8Array(e.exports.memory.buffer);T.set(v,E);const w=f(S,p,A,E,v.length);if(w===0&&g&&g(S,b,A),h.set(T.subarray(S,S+p*A)),F(S-F(0)),w!==0)throw new Error(`Malformed buffer data: ${w}`)}const l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},c={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return an={ready:n,supported:!0,decodeVertexBuffer(f,h,p,A,v){o(e.exports.meshopt_decodeVertexBuffer,f,h,p,A,e.exports[l[v]])},decodeIndexBuffer(f,h,p,A){o(e.exports.meshopt_decodeIndexBuffer,f,h,p,A)},decodeIndexSequence(f,h,p,A){o(e.exports.meshopt_decodeIndexSequence,f,h,p,A)},decodeGltfBuffer(f,h,p,A,v,g){o(e.exports[c[v]],f,h,p,A,e.exports[l[g]])}},an};function xc(){var u=Object.create(null);function t(r,e){var n=r.id,i=r.name,o=r.dependencies;o===void 0&&(o=[]);var l=r.init;l===void 0&&(l=function(){});var c=r.getTransferables;if(c===void 0&&(c=null),!u[n])try{o=o.map(function(h){return h&&h.isWorkerModule&&(t(h,function(p){if(p instanceof Error)throw p}),h=u[h.id].value),h}),l=a("<"+i+">.init",l),c&&(c=a("<"+i+">.getTransferables",c));var f=null;typeof l=="function"?f=l.apply(void 0,o):console.error("worker module init function failed to rehydrate"),u[n]={id:n,value:f,getTransferables:c},e(f)}catch(h){h&&h.noLog||console.error(h),e(h)}}function s(r,e){var n,i=r.id,o=r.args;(!u[i]||typeof u[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var l=(n=u[i]).value.apply(n,o);l&&typeof l.then=="function"?l.then(c,function(f){return e(f instanceof Error?f:new Error(""+f))}):c(l)}catch(f){e(f)}function c(f){try{var h=u[i].getTransferables&&u[i].getTransferables(f);(!h||!Array.isArray(h)||!h.length)&&(h=void 0),e(f,h)}catch(p){console.error(p),e(p)}}}function a(r,e){var n=void 0;self.troikaDefine=function(o){return n=o};var i=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(o){console.error(o)}return URL.revokeObjectURL(i),delete self.troikaDefine,n}self.addEventListener("message",function(r){var e=r.data,n=e.messageId,i=e.action,o=e.data;try{i==="registerModule"&&t(o,function(l){l instanceof Error?postMessage({messageId:n,success:!1,error:l.message}):postMessage({messageId:n,success:!0,result:{isCallable:typeof l=="function"}})}),i==="callModule"&&s(o,function(l,c){l instanceof Error?postMessage({messageId:n,success:!1,error:l.message}):postMessage({messageId:n,success:!0,result:l},c||void 0)})}catch(l){postMessage({messageId:n,success:!1,error:l.stack})}})}function Gc(u){var t=function(){for(var s=[],a=arguments.length;a--;)s[a]=arguments[a];return t._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,s);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var s=u.dependencies,a=u.init;s=Array.isArray(s)?s.map(function(e){return e&&e._getInitResult?e._getInitResult():e}):[];var r=Promise.all(s).then(function(e){return a.apply(null,e)});return t._getInitResult=function(){return r},r},t}var ai=function(){var u=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),u=!0}catch(s){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+s.message+"]")}return ai=function(){return u},u},Uc=0,Lc=0,Kn=!1,Kr=Object.create(null),Xr=Object.create(null),io=Object.create(null);function Mr(u){if((!u||typeof u.init!="function")&&!Kn)throw new Error("requires `options.init` function");var t=u.dependencies,s=u.init,a=u.getTransferables,r=u.workerId;if(!ai())return Gc(u);r==null&&(r="#default");var e="workerModule"+ ++Uc,n=u.name||e,i=null;t=t&&t.map(function(l){return typeof l=="function"&&!l.workerModuleData&&(Kn=!0,l=Mr({workerId:r,name:"<"+n+"> function dependency: "+l.name,init:`function(){return (
`+dn(l)+`
)}`}),Kn=!1),l&&l.workerModuleData&&(l=l.workerModuleData),l});function o(){for(var l=[],c=arguments.length;c--;)l[c]=arguments[c];if(!i){i=ia(r,"registerModule",o.workerModuleData);var f=function(){i=null,Xr[r].delete(f)};(Xr[r]||(Xr[r]=new Set)).add(f)}return i.then(function(h){var p=h.isCallable;if(p)return ia(r,"callModule",{id:e,args:l});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:e,name:n,dependencies:t,init:dn(s),getTransferables:a&&dn(a)},o}function Oc(u){Xr[u]&&Xr[u].forEach(function(t){t()}),Kr[u]&&(Kr[u].terminate(),delete Kr[u])}function dn(u){var t=u.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function kc(u){var t=Kr[u];if(!t){var s=dn(xc);t=Kr[u]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+u.replace(/\*/g,"")+` **/

;(`+s+")()"],{type:"application/javascript"}))),t.onmessage=function(a){var r=a.data,e=r.messageId,n=io[e];if(!n)throw new Error("WorkerModule response with empty or unknown messageId");delete io[e],n(r)}}return t}function ia(u,t,s){return new Promise(function(a,r){var e=++Lc;io[e]=function(n){n.success?a(n.result):r(new Error("Error in worker "+t+" call: "+n.error))},kc(u).postMessage({messageId:e,action:t,data:s})})}function ii(){var u=function(t){function s(Y,k,M,G,U,H,P,X){var W=1-P;X.x=W*W*Y+2*W*P*M+P*P*U,X.y=W*W*k+2*W*P*G+P*P*H}function a(Y,k,M,G,U,H,P,X,W,Z){var Ae=1-W;Z.x=Ae*Ae*Ae*Y+3*Ae*Ae*W*M+3*Ae*W*W*U+W*W*W*P,Z.y=Ae*Ae*Ae*k+3*Ae*Ae*W*G+3*Ae*W*W*H+W*W*W*X}function r(Y,k){for(var M=/([MLQCZ])([^MLQCZ]*)/g,G,U,H,P,X;G=M.exec(Y);){var W=G[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Z){return parseFloat(Z)});switch(G[1]){case"M":P=U=W[0],X=H=W[1];break;case"L":(W[0]!==P||W[1]!==X)&&k("L",P,X,P=W[0],X=W[1]);break;case"Q":{k("Q",P,X,P=W[2],X=W[3],W[0],W[1]);break}case"C":{k("C",P,X,P=W[4],X=W[5],W[0],W[1],W[2],W[3]);break}case"Z":(P!==U||X!==H)&&k("L",P,X,U,H);break}}}function e(Y,k,M){M===void 0&&(M=16);var G={x:0,y:0};r(Y,function(U,H,P,X,W,Z,Ae,Be,ae){switch(U){case"L":k(H,P,X,W);break;case"Q":{for(var ee=H,Oe=P,_e=1;_e<M;_e++)s(H,P,Z,Ae,X,W,_e/(M-1),G),k(ee,Oe,G.x,G.y),ee=G.x,Oe=G.y;break}case"C":{for(var me=H,Ce=P,we=1;we<M;we++)a(H,P,Z,Ae,Be,ae,X,W,we/(M-1),G),k(me,Ce,G.x,G.y),me=G.x,Ce=G.y;break}}})}var n="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",o=new WeakMap,l={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function c(Y,k){var M=Y.getContext?Y.getContext("webgl",l):Y,G=o.get(M);if(!G){let Ae=function(me){var Ce=H[me];if(!Ce&&(Ce=H[me]=M.getExtension(me),!Ce))throw new Error(me+" not supported");return Ce},Be=function(me,Ce){var we=M.createShader(Ce);return M.shaderSource(we,me),M.compileShader(we),we},ae=function(me,Ce,we,ne){if(!P[me]){var Ee={},ge={},$=M.createProgram();M.attachShader($,Be(Ce,M.VERTEX_SHADER)),M.attachShader($,Be(we,M.FRAGMENT_SHADER)),M.linkProgram($),P[me]={program:$,transaction:function(de){M.useProgram($),de({setUniform:function(he,Xe){for(var be=[],ye=arguments.length-2;ye-- >0;)be[ye]=arguments[ye+2];var Ie=ge[Xe]||(ge[Xe]=M.getUniformLocation($,Xe));M["uniform"+he].apply(M,[Ie].concat(be))},setAttribute:function(he,Xe,be,ye,Ie){var ke=Ee[he];ke||(ke=Ee[he]={buf:M.createBuffer(),loc:M.getAttribLocation($,he),data:null}),M.bindBuffer(M.ARRAY_BUFFER,ke.buf),M.vertexAttribPointer(ke.loc,Xe,M.FLOAT,!1,0,0),M.enableVertexAttribArray(ke.loc),U?M.vertexAttribDivisor(ke.loc,ye):Ae("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ke.loc,ye),Ie!==ke.data&&(M.bufferData(M.ARRAY_BUFFER,Ie,be),ke.data=Ie)}})}}}P[me].transaction(ne)},ee=function(me,Ce){W++;try{M.activeTexture(M.TEXTURE0+W);var we=X[me];we||(we=X[me]=M.createTexture(),M.bindTexture(M.TEXTURE_2D,we),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.NEAREST),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.NEAREST)),M.bindTexture(M.TEXTURE_2D,we),Ce(we,W)}finally{W--}},Oe=function(me,Ce,we){var ne=M.createFramebuffer();Z.push(ne),M.bindFramebuffer(M.FRAMEBUFFER,ne),M.activeTexture(M.TEXTURE0+Ce),M.bindTexture(M.TEXTURE_2D,me),M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_2D,me,0);try{we(ne)}finally{M.deleteFramebuffer(ne),M.bindFramebuffer(M.FRAMEBUFFER,Z[--Z.length-1]||null)}},_e=function(){H={},P={},X={},W=-1,Z.length=0};var U=typeof WebGL2RenderingContext<"u"&&M instanceof WebGL2RenderingContext,H={},P={},X={},W=-1,Z=[];M.canvas.addEventListener("webglcontextlost",function(me){_e(),me.preventDefault()},!1),o.set(M,G={gl:M,isWebGL2:U,getExtension:Ae,withProgram:ae,withTexture:ee,withTextureFramebuffer:Oe,handleContextLoss:_e})}k(G)}function f(Y,k,M,G,U,H,P,X){P===void 0&&(P=15),X===void 0&&(X=null),c(Y,function(W){var Z=W.gl,Ae=W.withProgram,Be=W.withTexture;Be("copy",function(ae,ee){Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,U,H,0,Z.RGBA,Z.UNSIGNED_BYTE,k),Ae("copy",n,i,function(Oe){var _e=Oe.setUniform,me=Oe.setAttribute;me("aUV",2,Z.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),_e("1i","image",ee),Z.bindFramebuffer(Z.FRAMEBUFFER,X||null),Z.disable(Z.BLEND),Z.colorMask(P&8,P&4,P&2,P&1),Z.viewport(M,G,U,H),Z.scissor(M,G,U,H),Z.drawArrays(Z.TRIANGLES,0,3)})})})}function h(Y,k,M){var G=Y.width,U=Y.height;c(Y,function(H){var P=H.gl,X=new Uint8Array(G*U*4);P.readPixels(0,0,G,U,P.RGBA,P.UNSIGNED_BYTE,X),Y.width=k,Y.height=M,f(P,X,0,0,G,U)})}var p=Object.freeze({__proto__:null,withWebGLContext:c,renderImageData:f,resizeWebGLCanvasWithoutClearing:h});function A(Y,k,M,G,U,H){H===void 0&&(H=1);var P=new Uint8Array(Y*k),X=G[2]-G[0],W=G[3]-G[1],Z=[];e(M,function(me,Ce,we,ne){Z.push({x1:me,y1:Ce,x2:we,y2:ne,minX:Math.min(me,we),minY:Math.min(Ce,ne),maxX:Math.max(me,we),maxY:Math.max(Ce,ne)})}),Z.sort(function(me,Ce){return me.maxX-Ce.maxX});for(var Ae=0;Ae<Y;Ae++)for(var Be=0;Be<k;Be++){var ae=Oe(G[0]+X*(Ae+.5)/Y,G[1]+W*(Be+.5)/k),ee=Math.pow(1-Math.abs(ae)/U,H)/2;ae<0&&(ee=1-ee),ee=Math.max(0,Math.min(255,Math.round(ee*255))),P[Be*Y+Ae]=ee}return P;function Oe(me,Ce){for(var we=1/0,ne=1/0,Ee=Z.length;Ee--;){var ge=Z[Ee];if(ge.maxX+ne<=me)break;if(me+ne>ge.minX&&Ce-ne<ge.maxY&&Ce+ne>ge.minY){var $=F(me,Ce,ge.x1,ge.y1,ge.x2,ge.y2);$<we&&(we=$,ne=Math.sqrt(we))}}return _e(me,Ce)&&(ne=-ne),ne}function _e(me,Ce){for(var we=0,ne=Z.length;ne--;){var Ee=Z[ne];if(Ee.maxX<=me)break;var ge=Ee.y1>Ce!=Ee.y2>Ce&&me<(Ee.x2-Ee.x1)*(Ce-Ee.y1)/(Ee.y2-Ee.y1)+Ee.x1;ge&&(we+=Ee.y1<Ee.y2?1:-1)}return we!==0}}function v(Y,k,M,G,U,H,P,X,W,Z){H===void 0&&(H=1),X===void 0&&(X=0),W===void 0&&(W=0),Z===void 0&&(Z=0),g(Y,k,M,G,U,H,P,null,X,W,Z)}function g(Y,k,M,G,U,H,P,X,W,Z,Ae){H===void 0&&(H=1),W===void 0&&(W=0),Z===void 0&&(Z=0),Ae===void 0&&(Ae=0);for(var Be=A(Y,k,M,G,U,H),ae=new Uint8Array(Be.length*4),ee=0;ee<Be.length;ee++)ae[ee*4+Ae]=Be[ee];f(P,ae,W,Z,Y,k,1<<3-Ae,X)}function F(Y,k,M,G,U,H){var P=U-M,X=H-G,W=P*P+X*X,Z=W?Math.max(0,Math.min(1,((Y-M)*P+(k-G)*X)/W)):0,Ae=Y-(M+Z*P),Be=k-(G+Z*X);return Ae*Ae+Be*Be}var b=Object.freeze({__proto__:null,generate:A,generateIntoCanvas:v,generateIntoFramebuffer:g}),S="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",E="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",T="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",w=new Float32Array([0,0,2,0,0,2]),R=null,B=!1,_={},D=new WeakMap;function z(Y){if(!B&&!V(Y))throw new Error("WebGL generation not supported")}function I(Y,k,M,G,U,H,P){if(H===void 0&&(H=1),P===void 0&&(P=null),!P&&(P=R,!P)){var X=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!X)throw new Error("OffscreenCanvas or DOM canvas not supported");P=R=X.getContext("webgl",{depth:!1})}z(P);var W=new Uint8Array(Y*k*4);c(P,function(ae){var ee=ae.gl,Oe=ae.withTexture,_e=ae.withTextureFramebuffer;Oe("readable",function(me,Ce){ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,Y,k,0,ee.RGBA,ee.UNSIGNED_BYTE,null),_e(me,Ce,function(we){x(Y,k,M,G,U,H,ee,we,0,0,0),ee.readPixels(0,0,Y,k,ee.RGBA,ee.UNSIGNED_BYTE,W)})})});for(var Z=new Uint8Array(Y*k),Ae=0,Be=0;Ae<W.length;Ae+=4)Z[Be++]=W[Ae];return Z}function L(Y,k,M,G,U,H,P,X,W,Z){H===void 0&&(H=1),X===void 0&&(X=0),W===void 0&&(W=0),Z===void 0&&(Z=0),x(Y,k,M,G,U,H,P,null,X,W,Z)}function x(Y,k,M,G,U,H,P,X,W,Z,Ae){H===void 0&&(H=1),W===void 0&&(W=0),Z===void 0&&(Z=0),Ae===void 0&&(Ae=0),z(P);var Be=[];e(M,function(ae,ee,Oe,_e){Be.push(ae,ee,Oe,_e)}),Be=new Float32Array(Be),c(P,function(ae){var ee=ae.gl,Oe=ae.isWebGL2,_e=ae.getExtension,me=ae.withProgram,Ce=ae.withTexture,we=ae.withTextureFramebuffer,ne=ae.handleContextLoss;if(Ce("rawDistances",function(Ee,ge){(Y!==Ee._lastWidth||k!==Ee._lastHeight)&&ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,Ee._lastWidth=Y,Ee._lastHeight=k,0,ee.RGBA,ee.UNSIGNED_BYTE,null),me("main",S,E,function($){var Re=$.setAttribute,de=$.setUniform,Te=!Oe&&_e("ANGLE_instanced_arrays"),he=!Oe&&_e("EXT_blend_minmax");Re("aUV",2,ee.STATIC_DRAW,0,w),Re("aLineSegment",4,ee.DYNAMIC_DRAW,1,Be),de.apply(void 0,["4f","uGlyphBounds"].concat(G)),de("1f","uMaxDistance",U),de("1f","uExponent",H),we(Ee,ge,function(Xe){ee.enable(ee.BLEND),ee.colorMask(!0,!0,!0,!0),ee.viewport(0,0,Y,k),ee.scissor(0,0,Y,k),ee.blendFunc(ee.ONE,ee.ONE),ee.blendEquationSeparate(ee.FUNC_ADD,Oe?ee.MAX:he.MAX_EXT),ee.clear(ee.COLOR_BUFFER_BIT),Oe?ee.drawArraysInstanced(ee.TRIANGLES,0,3,Be.length/4):Te.drawArraysInstancedANGLE(ee.TRIANGLES,0,3,Be.length/4)})}),me("post",n,T,function($){$.setAttribute("aUV",2,ee.STATIC_DRAW,0,w),$.setUniform("1i","tex",ge),ee.bindFramebuffer(ee.FRAMEBUFFER,X),ee.disable(ee.BLEND),ee.colorMask(Ae===0,Ae===1,Ae===2,Ae===3),ee.viewport(W,Z,Y,k),ee.scissor(W,Z,Y,k),ee.drawArrays(ee.TRIANGLES,0,3)})}),ee.isContextLost())throw ne(),new Error("webgl context lost")})}function V(Y){var k=!Y||Y===R?_:Y.canvas||Y,M=D.get(k);if(M===void 0){B=!0;var G=null;try{var U=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],H=I(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,Y);M=H&&U.length===H.length&&H.every(function(P,X){return P===U[X]}),M||(G="bad trial run results",console.info(U,H))}catch(P){M=!1,G=P.message}G&&console.warn("WebGL SDF generation not supported:",G),B=!1,D.set(k,M)}return M}var j=Object.freeze({__proto__:null,generate:I,generateIntoCanvas:L,generateIntoFramebuffer:x,isSupported:V});function ue(Y,k,M,G,U,H){U===void 0&&(U=Math.max(G[2]-G[0],G[3]-G[1])/2),H===void 0&&(H=1);try{return I.apply(j,arguments)}catch(P){return console.info("WebGL SDF generation failed, falling back to JS",P),A.apply(b,arguments)}}function fe(Y,k,M,G,U,H,P,X,W,Z){U===void 0&&(U=Math.max(G[2]-G[0],G[3]-G[1])/2),H===void 0&&(H=1),X===void 0&&(X=0),W===void 0&&(W=0),Z===void 0&&(Z=0);try{return L.apply(j,arguments)}catch(Ae){return console.info("WebGL SDF generation failed, falling back to JS",Ae),v.apply(b,arguments)}}return t.forEachPathCommand=r,t.generate=ue,t.generateIntoCanvas=fe,t.javascript=b,t.pathToLineSegments=e,t.webgl=j,t.webglUtils=p,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return u}function Pc(){var u=function(t){var s={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},a={},r={};a.L=1,r[1]="L",Object.keys(s).forEach(function(ne,Ee){a[ne]=1<<Ee+1,r[a[ne]]=ne}),Object.freeze(a);var e=a.LRI|a.RLI|a.FSI,n=a.L|a.R|a.AL,i=a.B|a.S|a.WS|a.ON|a.FSI|a.LRI|a.RLI|a.PDI,o=a.BN|a.RLE|a.LRE|a.RLO|a.LRO|a.PDF,l=a.S|a.WS|a.B|e|a.PDI|o,c=null;function f(){if(!c){c=new Map;var ne=function(ge){if(s.hasOwnProperty(ge)){var $=0;s[ge].split(",").forEach(function(Re){var de=Re.split("+"),Te=de[0],he=de[1];Te=parseInt(Te,36),he=he?parseInt(he,36):0,c.set($+=Te,a[ge]);for(var Xe=0;Xe<he;Xe++)c.set(++$,a[ge])})}};for(var Ee in s)ne(Ee)}}function h(ne){return f(),c.get(ne.codePointAt(0))||a.L}function p(ne){return r[h(ne)]}var A={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function v(ne,Ee){var ge=36,$=0,Re=new Map,de=Ee&&new Map,Te;return ne.split(",").forEach(function he(Xe){if(Xe.indexOf("+")!==-1)for(var be=+Xe;be--;)he(Te);else{Te=Xe;var ye=Xe.split(">"),Ie=ye[0],ke=ye[1];Ie=String.fromCodePoint($+=parseInt(Ie,ge)),ke=String.fromCodePoint($+=parseInt(ke,ge)),Re.set(Ie,ke),Ee&&de.set(ke,Ie)}}),{map:Re,reverseMap:de}}var g,F,b;function S(){if(!g){var ne=v(A.pairs,!0),Ee=ne.map,ge=ne.reverseMap;g=Ee,F=ge,b=v(A.canonical,!1).map}}function E(ne){return S(),g.get(ne)||null}function T(ne){return S(),F.get(ne)||null}function w(ne){return S(),b.get(ne)||null}var R=a.L,B=a.R,_=a.EN,D=a.ES,z=a.ET,I=a.AN,L=a.CS,x=a.B,V=a.S,j=a.ON,ue=a.BN,fe=a.NSM,Y=a.AL,k=a.LRO,M=a.RLO,G=a.LRE,U=a.RLE,H=a.PDF,P=a.LRI,X=a.RLI,W=a.FSI,Z=a.PDI;function Ae(ne,Ee){for(var ge=125,$=new Uint32Array(ne.length),Re=0;Re<ne.length;Re++)$[Re]=h(ne[Re]);var de=new Map;function Te(yt,Ht){var Mt=$[yt];$[yt]=Ht,de.set(Mt,de.get(Mt)-1),Mt&i&&de.set(i,de.get(i)-1),de.set(Ht,(de.get(Ht)||0)+1),Ht&i&&de.set(i,(de.get(i)||0)+1)}for(var he=new Uint8Array(ne.length),Xe=new Map,be=[],ye=null,Ie=0;Ie<ne.length;Ie++)ye||be.push(ye={start:Ie,end:ne.length-1,level:Ee==="rtl"?1:Ee==="ltr"?0:Uo(Ie,!1)}),$[Ie]&x&&(ye.end=Ie,ye=null);for(var ke=U|G|M|k|e|Z|H|x,et=function(yt){return yt+(yt&1?1:2)},ot=function(yt){return yt+(yt&1?2:1)},Pe=0;Pe<be.length;Pe++){ye=be[Pe];var Se=[{_level:ye.level,_override:0,_isolate:0}],C=void 0,q=0,le=0,ve=0;de.clear();for(var Ge=ye.start;Ge<=ye.end;Ge++){var Q=$[Ge];if(C=Se[Se.length-1],de.set(Q,(de.get(Q)||0)+1),Q&i&&de.set(i,(de.get(i)||0)+1),Q&ke)if(Q&(U|G)){he[Ge]=C._level;var Ne=(Q===U?ot:et)(C._level);Ne<=ge&&!q&&!le?Se.push({_level:Ne,_override:0,_isolate:0}):q||le++}else if(Q&(M|k)){he[Ge]=C._level;var Lt=(Q===M?ot:et)(C._level);Lt<=ge&&!q&&!le?Se.push({_level:Lt,_override:Q&M?B:R,_isolate:0}):q||le++}else if(Q&e){Q&W&&(Q=Uo(Ge+1,!0)===1?X:P),he[Ge]=C._level,C._override&&Te(Ge,C._override);var We=(Q===X?ot:et)(C._level);We<=ge&&q===0&&le===0?(ve++,Se.push({_level:We,_override:0,_isolate:1,_isolInitIndex:Ge})):q++}else if(Q&Z){if(q>0)q--;else if(ve>0){for(le=0;!Se[Se.length-1]._isolate;)Se.pop();var xe=Se[Se.length-1]._isolInitIndex;xe!=null&&(Xe.set(xe,Ge),Xe.set(Ge,xe)),Se.pop(),ve--}C=Se[Se.length-1],he[Ge]=C._level,C._override&&Te(Ge,C._override)}else Q&H?(q===0&&(le>0?le--:!C._isolate&&Se.length>1&&(Se.pop(),C=Se[Se.length-1])),he[Ge]=C._level):Q&x&&(he[Ge]=ye.level);else he[Ge]=C._level,C._override&&Q!==ue&&Te(Ge,C._override)}for(var Qe=[],Ye=null,De=ye.start;De<=ye.end;De++){var ze=$[De];if(!(ze&o)){var lt=he[De],pt=ze&e,ct=ze===Z;Ye&&lt===Ye._level?(Ye._end=De,Ye._endsWithIsolInit=pt):Qe.push(Ye={_start:De,_end:De,_level:lt,_startsWithPDI:ct,_endsWithIsolInit:pt})}}for(var Ft=[],wt=0;wt<Qe.length;wt++){var Ot=Qe[wt];if(!Ot._startsWithPDI||Ot._startsWithPDI&&!Xe.has(Ot._start)){for(var bt=[Ye=Ot],It=void 0;Ye&&Ye._endsWithIsolInit&&(It=Xe.get(Ye._end))!=null;)for(var He=wt+1;He<Qe.length;He++)if(Qe[He]._start===It){bt.push(Ye=Qe[He]);break}for(var At=[],Xt=0;Xt<bt.length;Xt++)for(var d=bt[Xt],m=d._start;m<=d._end;m++)At.push(m);for(var y=he[At[0]],O=ye.level,J=At[0]-1;J>=0;J--)if(!($[J]&o)){O=he[J];break}var K=At[At.length-1],re=he[K],te=ye.level;if(!($[K]&e)){for(var ie=K+1;ie<=ye.end;ie++)if(!($[ie]&o)){te=he[ie];break}}Ft.push({_seqIndices:At,_sosType:Math.max(O,y)%2?B:R,_eosType:Math.max(te,re)%2?B:R})}}for(var se=0;se<Ft.length;se++){var ce=Ft[se],N=ce._seqIndices,tt=ce._sosType,Fe=ce._eosType,Me=he[N[0]]&1?B:R;if(de.get(fe))for(var Ue=0;Ue<N.length;Ue++){var Je=N[Ue];if($[Je]&fe){for(var Ze=tt,Ve=Ue-1;Ve>=0;Ve--)if(!($[N[Ve]]&o)){Ze=$[N[Ve]];break}Te(Je,Ze&(e|Z)?j:Ze)}}if(de.get(_))for(var st=0;st<N.length;st++){var mt=N[st];if($[mt]&_)for(var qe=st-1;qe>=-1;qe--){var St=qe===-1?tt:$[N[qe]];if(St&n){St===Y&&Te(mt,I);break}}}if(de.get(Y))for(var rt=0;rt<N.length;rt++){var ut=N[rt];$[ut]&Y&&Te(ut,B)}if(de.get(D)||de.get(L))for(var Bt=1;Bt<N.length-1;Bt++){var Wt=N[Bt];if($[Wt]&(D|L)){for(var ht=0,$e=0,ft=Bt-1;ft>=0&&(ht=$[N[ft]],!!(ht&o));ft--);for(var nt=Bt+1;nt<N.length&&($e=$[N[nt]],!!($e&o));nt++);ht===$e&&($[Wt]===D?ht===_:ht&(_|I))&&Te(Wt,ht)}}if(de.get(_))for(var je=0;je<N.length;je++){var Et=N[je];if($[Et]&_){for(var Rt=je-1;Rt>=0&&$[N[Rt]]&(z|o);Rt--)Te(N[Rt],_);for(je++;je<N.length&&$[N[je]]&(z|o|_);je++)$[N[je]]!==_&&Te(N[je],_)}}if(de.get(z)||de.get(D)||de.get(L))for(var dt=0;dt<N.length;dt++){var kt=N[dt];if($[kt]&(z|D|L)){Te(kt,j);for(var Zr=dt-1;Zr>=0&&$[N[Zr]]&o;Zr--)Te(N[Zr],j);for(var Vr=dt+1;Vr<N.length&&$[N[Vr]]&o;Vr++)Te(N[Vr],j)}}if(de.get(_))for(var Mn=0,yo=tt;Mn<N.length;Mn++){var Mo=N[Mn],Tn=$[Mo];Tn&_?yo===R&&Te(Mo,R):Tn&n&&(yo=Tn)}if(de.get(i)){var Tr=B|_|I,To=Tr|R,qr=[];{for(var dr=[],pr=0;pr<N.length;pr++)if($[N[pr]]&i){var Fr=ne[N[pr]],Fo=void 0;if(E(Fr)!==null)if(dr.length<63)dr.push({char:Fr,seqIndex:pr});else break;else if((Fo=T(Fr))!==null)for(var wr=dr.length-1;wr>=0;wr--){var Fn=dr[wr].char;if(Fn===Fo||Fn===T(w(Fr))||E(w(Fn))===Fr){qr.push([dr[wr].seqIndex,pr]),dr.length=wr;break}}}qr.sort(function(yt,Ht){return yt[0]-Ht[0]})}for(var wn=0;wn<qr.length;wn++){for(var wo=qr[wn],$r=wo[0],In=wo[1],Io=!1,Pt=0,Sn=$r+1;Sn<In;Sn++){var So=N[Sn];if($[So]&To){Io=!0;var _o=$[So]&Tr?B:R;if(_o===Me){Pt=_o;break}}}if(Io&&!Pt){Pt=tt;for(var _n=$r-1;_n>=0;_n--){var Do=N[_n];if($[Do]&To){var Ro=$[Do]&Tr?B:R;Ro!==Me?Pt=Ro:Pt=Me;break}}}if(Pt){if($[N[$r]]=$[N[In]]=Pt,Pt!==Me){for(var Ir=$r+1;Ir<N.length;Ir++)if(!($[N[Ir]]&o)){h(ne[N[Ir]])&fe&&($[N[Ir]]=Pt);break}}if(Pt!==Me){for(var Sr=In+1;Sr<N.length;Sr++)if(!($[N[Sr]]&o)){h(ne[N[Sr]])&fe&&($[N[Sr]]=Pt);break}}}}for(var qt=0;qt<N.length;qt++)if($[N[qt]]&i){for(var xo=qt,Dn=qt,Rn=tt,_r=qt-1;_r>=0;_r--)if($[N[_r]]&o)xo=_r;else{Rn=$[N[_r]]&Tr?B:R;break}for(var Go=Fe,Dr=qt+1;Dr<N.length;Dr++)if($[N[Dr]]&(i|o))Dn=Dr;else{Go=$[N[Dr]]&Tr?B:R;break}for(var xn=xo;xn<=Dn;xn++)$[N[xn]]=Rn===Go?Rn:Me;qt=Dn}}}for(var _t=ye.start;_t<=ye.end;_t++){var Ii=he[_t],en=$[_t];if(Ii&1?en&(R|_|I)&&he[_t]++:en&B?he[_t]++:en&(I|_)&&(he[_t]+=2),en&o&&(he[_t]=_t===0?ye.level:he[_t-1]),_t===ye.end||h(ne[_t])&(V|x))for(var tn=_t;tn>=0&&h(ne[tn])&l;tn--)he[tn]=ye.level}}return{levels:he,paragraphs:be};function Uo(yt,Ht){for(var Mt=yt;Mt<ne.length;Mt++){var $t=$[Mt];if($t&(B|Y))return 1;if($t&(x|R)||Ht&&$t===Z)return 0;if($t&e){var Lo=Si(Mt);Mt=Lo===-1?ne.length:Lo}}return 0}function Si(yt){for(var Ht=1,Mt=yt+1;Mt<ne.length;Mt++){var $t=$[Mt];if($t&x)break;if($t&Z){if(--Ht===0)return Mt}else $t&e&&Ht++}return-1}}var Be="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",ae;function ee(){if(!ae){var ne=v(Be,!0),Ee=ne.map,ge=ne.reverseMap;ge.forEach(function($,Re){Ee.set(Re,$)}),ae=Ee}}function Oe(ne){return ee(),ae.get(ne)||null}function _e(ne,Ee,ge,$){var Re=ne.length;ge=Math.max(0,ge==null?0:+ge),$=Math.min(Re-1,$==null?Re-1:+$);for(var de=new Map,Te=ge;Te<=$;Te++)if(Ee[Te]&1){var he=Oe(ne[Te]);he!==null&&de.set(Te,he)}return de}function me(ne,Ee,ge,$){var Re=ne.length;ge=Math.max(0,ge==null?0:+ge),$=Math.min(Re-1,$==null?Re-1:+$);var de=[];return Ee.paragraphs.forEach(function(Te){var he=Math.max(ge,Te.start),Xe=Math.min($,Te.end);if(he<Xe){for(var be=Ee.levels.slice(he,Xe+1),ye=Xe;ye>=he&&h(ne[ye])&l;ye--)be[ye]=Te.level;for(var Ie=Te.level,ke=1/0,et=0;et<be.length;et++){var ot=be[et];ot>Ie&&(Ie=ot),ot<ke&&(ke=ot|1)}for(var Pe=Ie;Pe>=ke;Pe--)for(var Se=0;Se<be.length;Se++)if(be[Se]>=Pe){for(var C=Se;Se+1<be.length&&be[Se+1]>=Pe;)Se++;Se>C&&de.push([C+he,Se+he])}}}),de}function Ce(ne,Ee,ge,$){var Re=we(ne,Ee,ge,$),de=[].concat(ne);return Re.forEach(function(Te,he){de[he]=(Ee.levels[Te]&1?Oe(ne[Te]):null)||ne[Te]}),de.join("")}function we(ne,Ee,ge,$){for(var Re=me(ne,Ee,ge,$),de=[],Te=0;Te<ne.length;Te++)de[Te]=Te;return Re.forEach(function(he){for(var Xe=he[0],be=he[1],ye=de.slice(Xe,be+1),Ie=ye.length;Ie--;)de[be-Ie]=ye[Ie]}),de}return t.closingToOpeningBracket=T,t.getBidiCharType=h,t.getBidiCharTypeName=p,t.getCanonicalBracket=w,t.getEmbeddingLevels=Ae,t.getMirroredCharacter=Oe,t.getMirroredCharactersMap=_e,t.getReorderSegments=me,t.getReorderedIndices=we,t.getReorderedString=Ce,t.openingToClosingBracket=E,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return u}const si=/\bvoid\s+main\s*\(\s*\)\s*{/g;function so(u){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function s(a,r){let e=ws[r];return e?so(e):a}return u.replace(t,s)}const gt=[];for(let u=0;u<256;u++)gt[u]=(u<16?"0":"")+u.toString(16);function Hc(){const u=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,a=Math.random()*4294967295|0;return(gt[u&255]+gt[u>>8&255]+gt[u>>16&255]+gt[u>>24&255]+"-"+gt[t&255]+gt[t>>8&255]+"-"+gt[t>>16&15|64]+gt[t>>24&255]+"-"+gt[s&63|128]+gt[s>>8&255]+"-"+gt[s>>16&255]+gt[s>>24&255]+gt[a&255]+gt[a>>8&255]+gt[a>>16&255]+gt[a>>24&255]).toUpperCase()}const lr=Object.assign||function(){let u=arguments[0];for(let t=1,s=arguments.length;t<s;t++){let a=arguments[t];if(a)for(let r in a)Object.prototype.hasOwnProperty.call(a,r)&&(u[r]=a[r])}return u},Nc=Date.now(),sa=new WeakMap,la=new Map;let Jc=1e10;function lo(u,t){const s=Wc(t);let a=sa.get(u);if(a||sa.set(u,a=Object.create(null)),a[s])return new a[s];const r=`_onBeforeCompile${s}`,e=function(l,c){u.onBeforeCompile.call(this,l,c);const f=this.customProgramCacheKey()+"|"+l.vertexShader+"|"+l.fragmentShader;let h=la[f];if(!h){const p=jc(this,l,t,s);h=la[f]=p}l.vertexShader=h.vertexShader,l.fragmentShader=h.fragmentShader,lr(l.uniforms,this.uniforms),t.timeUniform&&(l.uniforms[t.timeUniform]={get value(){return Date.now()-Nc}}),this[r]&&this[r](l)},n=function(){return i(t.chained?u:u.clone())},i=function(l){const c=Object.create(l,o);return Object.defineProperty(c,"baseMaterial",{value:u}),Object.defineProperty(c,"id",{value:Jc++}),c.uuid=Hc(),c.uniforms=lr({},l.uniforms,t.uniforms),c.defines=lr({},l.defines,t.defines),c.defines[`TROIKA_DERIVED_MATERIAL_${s}`]="",c.extensions=lr({},l.extensions,t.extensions),c._listeners=void 0,c},o={constructor:{value:n},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return u.customProgramCacheKey()+"|"+s}},onBeforeCompile:{get(){return e},set(l){this[r]=l}},copy:{writable:!0,configurable:!0,value:function(l){return u.copy.call(this,l),!u.isShaderMaterial&&!u.isDerivedMaterial&&(lr(this.extensions,l.extensions),lr(this.defines,l.defines),lr(this.uniforms,ys.clone(l.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const l=new u.constructor;return i(l).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let l=this._depthMaterial;return l||(l=this._depthMaterial=lo(u.isDerivedMaterial?u.getDepthMaterial():new Ms({depthPacking:Ts}),t),l.defines.IS_DEPTH_MATERIAL="",l.uniforms=this.uniforms),l}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let l=this._distanceMaterial;return l||(l=this._distanceMaterial=lo(u.isDerivedMaterial?u.getDistanceMaterial():new Fs,t),l.defines.IS_DISTANCE_MATERIAL="",l.uniforms=this.uniforms),l}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:l,_distanceMaterial:c}=this;l&&l.dispose(),c&&c.dispose(),u.dispose.call(this)}}};return a[s]=n,new n}function jc(u,{vertexShader:t,fragmentShader:s},a,r){let{vertexDefs:e,vertexMainIntro:n,vertexMainOutro:i,vertexTransform:o,fragmentDefs:l,fragmentMainIntro:c,fragmentMainOutro:f,fragmentColorTransform:h,customRewriter:p,timeUniform:A}=a;if(e=e||"",n=n||"",i=i||"",l=l||"",c=c||"",f=f||"",(o||p)&&(t=so(t)),(h||p)&&(s=s.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),s=so(s)),p){let v=p({vertexShader:t,fragmentShader:s});t=v.vertexShader,s=v.fragmentShader}if(h){let v=[];s=s.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,g=>(v.push(g),"")),f=`${h}
${v.join(`
`)}
${f}`}if(A){const v=`
uniform float ${A};
`;e=v+e,l=v+l}return o&&(t=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${t}
`,e=`${e}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${o}
}
`,n=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${n}
`,t=t.replace(/\b(position|normal|uv)\b/g,(v,g,F,b)=>/\battribute\s+vec[23]\s+$/.test(b.substr(0,F))?g:`troika_${g}_${r}`),u.map&&u.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),t=ca(t,r,e,n,i),s=ca(s,r,l,c,f),{vertexShader:t,fragmentShader:s}}function ca(u,t,s,a,r){return(a||r||s)&&(u=u.replace(si,`
${s}
void troikaOrigMain${t}() {`),u+=`
void main() {
  ${a}
  troikaOrigMain${t}();
  ${r}
}`),u}function Kc(u,t){return u==="uniforms"?void 0:typeof t=="function"?t.toString():t}let Xc=0;const ua=new Map;function Wc(u){const t=JSON.stringify(u,Kc);let s=ua.get(t);return s==null&&ua.set(t,s=++Xc),s}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Qc(){return typeof window>"u"&&(self.window=self),function(u){var t={parse:function(r){var e=t._bin,n=new Uint8Array(r);if(e.readASCII(n,0,4)=="ttcf"){var i=4;e.readUshort(n,i),i+=2,e.readUshort(n,i),i+=2;var o=e.readUint(n,i);i+=4;for(var l=[],c=0;c<o;c++){var f=e.readUint(n,i);i+=4,l.push(t._readFont(n,f))}return l}return[t._readFont(n,0)]},_readFont:function(r,e){var n=t._bin,i=e;n.readFixed(r,e),e+=4;var o=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2,n.readUshort(r,e),e+=2,n.readUshort(r,e),e+=2;for(var l=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],c={_data:r,_offset:i},f={},h=0;h<o;h++){var p=n.readASCII(r,e,4);e+=4,n.readUint(r,e),e+=4;var A=n.readUint(r,e);e+=4;var v=n.readUint(r,e);e+=4,f[p]={offset:A,length:v}}for(h=0;h<l.length;h++){var g=l[h];f[g]&&(c[g.trim()]=t[g.trim()].parse(r,f[g].offset,f[g].length,c))}return c},_tabOffset:function(r,e,n){for(var i=t._bin,o=i.readUshort(r,n+4),l=n+12,c=0;c<o;c++){var f=i.readASCII(r,l,4);l+=4,i.readUint(r,l),l+=4;var h=i.readUint(r,l);if(l+=4,i.readUint(r,l),l+=4,f==e)return h}return 0}};t._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,e){return t._bin.readShort(r,e)/16384},readInt:function(r,e){return t._bin._view(r).getInt32(e)},readInt8:function(r,e){return t._bin._view(r).getInt8(e)},readShort:function(r,e){return t._bin._view(r).getInt16(e)},readUshort:function(r,e){return t._bin._view(r).getUint16(e)},readUshorts:function(r,e,n){for(var i=[],o=0;o<n;o++)i.push(t._bin.readUshort(r,e+2*o));return i},readUint:function(r,e){return t._bin._view(r).getUint32(e)},readUint64:function(r,e){return 4294967296*t._bin.readUint(r,e)+t._bin.readUint(r,e+4)},readASCII:function(r,e,n){for(var i="",o=0;o<n;o++)i+=String.fromCharCode(r[e+o]);return i},readUnicode:function(r,e,n){for(var i="",o=0;o<n;o++){var l=r[e++]<<8|r[e++];i+=String.fromCharCode(l)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,e,n){var i=t._bin._tdec;return i&&e==0&&n==r.length?i.decode(r):t._bin.readASCII(r,e,n)},readBytes:function(r,e,n){for(var i=[],o=0;o<n;o++)i.push(r[e+o]);return i},readASCIIArray:function(r,e,n){for(var i=[],o=0;o<n;o++)i.push(String.fromCharCode(r[e+o]));return i},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},t._lctf={},t._lctf.parse=function(r,e,n,i,o){var l=t._bin,c={},f=e;l.readFixed(r,e),e+=4;var h=l.readUshort(r,e);e+=2;var p=l.readUshort(r,e);e+=2;var A=l.readUshort(r,e);return e+=2,c.scriptList=t._lctf.readScriptList(r,f+h),c.featureList=t._lctf.readFeatureList(r,f+p),c.lookupList=t._lctf.readLookupList(r,f+A,o),c},t._lctf.readLookupList=function(r,e,n){var i=t._bin,o=e,l=[],c=i.readUshort(r,e);e+=2;for(var f=0;f<c;f++){var h=i.readUshort(r,e);e+=2;var p=t._lctf.readLookupTable(r,o+h,n);l.push(p)}return l},t._lctf.readLookupTable=function(r,e,n){var i=t._bin,o=e,l={tabs:[]};l.ltype=i.readUshort(r,e),e+=2,l.flag=i.readUshort(r,e),e+=2;var c=i.readUshort(r,e);e+=2;for(var f=l.ltype,h=0;h<c;h++){var p=i.readUshort(r,e);e+=2;var A=n(r,f,o+p,l);l.tabs.push(A)}return l},t._lctf.numOfOnes=function(r){for(var e=0,n=0;n<32;n++)r>>>n&1&&e++;return e},t._lctf.readClassDef=function(r,e){var n=t._bin,i=[],o=n.readUshort(r,e);if(e+=2,o==1){var l=n.readUshort(r,e);e+=2;var c=n.readUshort(r,e);e+=2;for(var f=0;f<c;f++)i.push(l+f),i.push(l+f),i.push(n.readUshort(r,e)),e+=2}if(o==2){var h=n.readUshort(r,e);for(e+=2,f=0;f<h;f++)i.push(n.readUshort(r,e)),e+=2,i.push(n.readUshort(r,e)),e+=2,i.push(n.readUshort(r,e)),e+=2}return i},t._lctf.getInterval=function(r,e){for(var n=0;n<r.length;n+=3){var i=r[n],o=r[n+1];if(r[n+2],i<=e&&e<=o)return n}return-1},t._lctf.readCoverage=function(r,e){var n=t._bin,i={};i.fmt=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);return e+=2,i.fmt==1&&(i.tab=n.readUshorts(r,e,o)),i.fmt==2&&(i.tab=n.readUshorts(r,e,3*o)),i},t._lctf.coverageIndex=function(r,e){var n=r.tab;if(r.fmt==1)return n.indexOf(e);if(r.fmt==2){var i=t._lctf.getInterval(n,e);if(i!=-1)return n[i+2]+(e-n[i])}return-1},t._lctf.readFeatureList=function(r,e){var n=t._bin,i=e,o=[],l=n.readUshort(r,e);e+=2;for(var c=0;c<l;c++){var f=n.readASCII(r,e,4);e+=4;var h=n.readUshort(r,e);e+=2;var p=t._lctf.readFeatureTable(r,i+h);p.tag=f.trim(),o.push(p)}return o},t._lctf.readFeatureTable=function(r,e){var n=t._bin,i=e,o={},l=n.readUshort(r,e);e+=2,l>0&&(o.featureParams=i+l);var c=n.readUshort(r,e);e+=2,o.tab=[];for(var f=0;f<c;f++)o.tab.push(n.readUshort(r,e+2*f));return o},t._lctf.readScriptList=function(r,e){var n=t._bin,i=e,o={},l=n.readUshort(r,e);e+=2;for(var c=0;c<l;c++){var f=n.readASCII(r,e,4);e+=4;var h=n.readUshort(r,e);e+=2,o[f.trim()]=t._lctf.readScriptTable(r,i+h)}return o},t._lctf.readScriptTable=function(r,e){var n=t._bin,i=e,o={},l=n.readUshort(r,e);e+=2,l>0&&(o.default=t._lctf.readLangSysTable(r,i+l));var c=n.readUshort(r,e);e+=2;for(var f=0;f<c;f++){var h=n.readASCII(r,e,4);e+=4;var p=n.readUshort(r,e);e+=2,o[h.trim()]=t._lctf.readLangSysTable(r,i+p)}return o},t._lctf.readLangSysTable=function(r,e){var n=t._bin,i={};n.readUshort(r,e),e+=2,i.reqFeature=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);return e+=2,i.features=n.readUshorts(r,e,o),i},t.CFF={},t.CFF.parse=function(r,e,n){var i=t._bin;(r=new Uint8Array(r.buffer,e,n))[e=0],r[++e],r[++e],r[++e],e++;var o=[];e=t.CFF.readIndex(r,e,o);for(var l=[],c=0;c<o.length-1;c++)l.push(i.readASCII(r,e+o[c],o[c+1]-o[c]));e+=o[o.length-1];var f=[];e=t.CFF.readIndex(r,e,f);var h=[];for(c=0;c<f.length-1;c++)h.push(t.CFF.readDict(r,e+f[c],e+f[c+1]));e+=f[f.length-1];var p=h[0],A=[];e=t.CFF.readIndex(r,e,A);var v=[];for(c=0;c<A.length-1;c++)v.push(i.readASCII(r,e+A[c],A[c+1]-A[c]));if(e+=A[A.length-1],t.CFF.readSubrs(r,e,p),p.CharStrings){e=p.CharStrings,A=[],e=t.CFF.readIndex(r,e,A);var g=[];for(c=0;c<A.length-1;c++)g.push(i.readBytes(r,e+A[c],A[c+1]-A[c]));p.CharStrings=g}if(p.ROS){e=p.FDArray;var F=[];for(e=t.CFF.readIndex(r,e,F),p.FDArray=[],c=0;c<F.length-1;c++){var b=t.CFF.readDict(r,e+F[c],e+F[c+1]);t.CFF._readFDict(r,b,v),p.FDArray.push(b)}e+=F[F.length-1],e=p.FDSelect,p.FDSelect=[];var S=r[e];if(e++,S!=3)throw S;var E=i.readUshort(r,e);for(e+=2,c=0;c<E+1;c++)p.FDSelect.push(i.readUshort(r,e),r[e+2]),e+=3}return p.Encoding&&(p.Encoding=t.CFF.readEncoding(r,p.Encoding,p.CharStrings.length)),p.charset&&(p.charset=t.CFF.readCharset(r,p.charset,p.CharStrings.length)),t.CFF._readFDict(r,p,v),p},t.CFF._readFDict=function(r,e,n){var i;for(var o in e.Private&&(i=e.Private[1],e.Private=t.CFF.readDict(r,i,i+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(r,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)!=-1&&(e[o]=n[e[o]-426+35])},t.CFF.readSubrs=function(r,e,n){var i=t._bin,o=[];e=t.CFF.readIndex(r,e,o);var l,c=o.length;l=c<1240?107:c<33900?1131:32768,n.Bias=l,n.Subrs=[];for(var f=0;f<o.length-1;f++)n.Subrs.push(i.readBytes(r,e+o[f],o[f+1]-o[f]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(r,e){for(var n=0;n<r.charset.length;n++)if(r.charset[n]==e)return n;return-1},t.CFF.glyphBySE=function(r,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(r,t.CFF.tableSE[e])},t.CFF.readEncoding=function(r,e,n){t._bin;var i=[".notdef"],o=r[e];if(e++,o!=0)throw"error: unknown encoding format: "+o;var l=r[e];e++;for(var c=0;c<l;c++)i.push(r[e+c]);return i},t.CFF.readCharset=function(r,e,n){var i=t._bin,o=[".notdef"],l=r[e];if(e++,l==0)for(var c=0;c<n;c++){var f=i.readUshort(r,e);e+=2,o.push(f)}else{if(l!=1&&l!=2)throw"error: format: "+l;for(;o.length<n;){f=i.readUshort(r,e),e+=2;var h=0;for(l==1?(h=r[e],e++):(h=i.readUshort(r,e),e+=2),c=0;c<=h;c++)o.push(f),f++}}return o},t.CFF.readIndex=function(r,e,n){var i=t._bin,o=i.readUshort(r,e)+1,l=r[e+=2];if(e++,l==1)for(var c=0;c<o;c++)n.push(r[e+c]);else if(l==2)for(c=0;c<o;c++)n.push(i.readUshort(r,e+2*c));else if(l==3)for(c=0;c<o;c++)n.push(16777215&i.readUint(r,e+3*c-1));else if(o!=1)throw"unsupported offset size: "+l+", count: "+o;return(e+=o*l)-1},t.CFF.getCharString=function(r,e,n){var i=t._bin,o=r[e],l=r[e+1];r[e+2],r[e+3],r[e+4];var c=1,f=null,h=null;o<=20&&(f=o,c=1),o==12&&(f=100*o+l,c=2),21<=o&&o<=27&&(f=o,c=1),o==28&&(h=i.readShort(r,e+1),c=3),29<=o&&o<=31&&(f=o,c=1),32<=o&&o<=246&&(h=o-139,c=1),247<=o&&o<=250&&(h=256*(o-247)+l+108,c=2),251<=o&&o<=254&&(h=256*-(o-251)-l-108,c=2),o==255&&(h=i.readInt(r,e+1)/65535,c=5),n.val=h??"o"+f,n.size=c},t.CFF.readCharString=function(r,e,n){for(var i=e+n,o=t._bin,l=[];e<i;){var c=r[e],f=r[e+1];r[e+2],r[e+3],r[e+4];var h=1,p=null,A=null;c<=20&&(p=c,h=1),c==12&&(p=100*c+f,h=2),c!=19&&c!=20||(p=c,h=2),21<=c&&c<=27&&(p=c,h=1),c==28&&(A=o.readShort(r,e+1),h=3),29<=c&&c<=31&&(p=c,h=1),32<=c&&c<=246&&(A=c-139,h=1),247<=c&&c<=250&&(A=256*(c-247)+f+108,h=2),251<=c&&c<=254&&(A=256*-(c-251)-f-108,h=2),c==255&&(A=o.readInt(r,e+1)/65535,h=5),l.push(A??"o"+p),e+=h}return l},t.CFF.readDict=function(r,e,n){for(var i=t._bin,o={},l=[];e<n;){var c=r[e],f=r[e+1];r[e+2],r[e+3],r[e+4];var h=1,p=null,A=null;if(c==28&&(A=i.readShort(r,e+1),h=3),c==29&&(A=i.readInt(r,e+1),h=5),32<=c&&c<=246&&(A=c-139,h=1),247<=c&&c<=250&&(A=256*(c-247)+f+108,h=2),251<=c&&c<=254&&(A=256*-(c-251)-f-108,h=2),c==255)throw A=i.readInt(r,e+1)/65535,h=5,"unknown number";if(c==30){var v=[];for(h=1;;){var g=r[e+h];h++;var F=g>>4,b=15&g;if(F!=15&&v.push(F),b!=15&&v.push(b),b==15)break}for(var S="",E=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],T=0;T<v.length;T++)S+=E[v[T]];A=parseFloat(S)}c<=21&&(p=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][c],h=1,c==12&&(p=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],h=2)),p!=null?(o[p]=l.length==1?l[0]:l,l=[]):l.push(A),e+=h}return o},t.cmap={},t.cmap.parse=function(r,e,n){r=new Uint8Array(r.buffer,e,n),e=0;var i=t._bin,o={};i.readUshort(r,e),e+=2;var l=i.readUshort(r,e);e+=2;var c=[];o.tables=[];for(var f=0;f<l;f++){var h=i.readUshort(r,e);e+=2;var p=i.readUshort(r,e);e+=2;var A=i.readUint(r,e);e+=4;var v="p"+h+"e"+p,g=c.indexOf(A);if(g==-1){var F;g=o.tables.length,c.push(A);var b=i.readUshort(r,A);b==0?F=t.cmap.parse0(r,A):b==4?F=t.cmap.parse4(r,A):b==6?F=t.cmap.parse6(r,A):b==12?F=t.cmap.parse12(r,A):console.debug("unknown format: "+b,h,p,A),o.tables.push(F)}if(o[v]!=null)throw"multiple tables for one platform+encoding";o[v]=g}return o},t.cmap.parse0=function(r,e){var n=t._bin,i={};i.format=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2,i.map=[];for(var l=0;l<o-6;l++)i.map.push(r[e+l]);return i},t.cmap.parse4=function(r,e){var n=t._bin,i=e,o={};o.format=n.readUshort(r,e),e+=2;var l=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2;var c=n.readUshort(r,e);e+=2;var f=c/2;o.searchRange=n.readUshort(r,e),e+=2,o.entrySelector=n.readUshort(r,e),e+=2,o.rangeShift=n.readUshort(r,e),e+=2,o.endCount=n.readUshorts(r,e,f),e+=2*f,e+=2,o.startCount=n.readUshorts(r,e,f),e+=2*f,o.idDelta=[];for(var h=0;h<f;h++)o.idDelta.push(n.readShort(r,e)),e+=2;for(o.idRangeOffset=n.readUshorts(r,e,f),e+=2*f,o.glyphIdArray=[];e<i+l;)o.glyphIdArray.push(n.readUshort(r,e)),e+=2;return o},t.cmap.parse6=function(r,e){var n=t._bin,i={};i.format=n.readUshort(r,e),e+=2,n.readUshort(r,e),e+=2,n.readUshort(r,e),e+=2,i.firstCode=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);e+=2,i.glyphIdArray=[];for(var l=0;l<o;l++)i.glyphIdArray.push(n.readUshort(r,e)),e+=2;return i},t.cmap.parse12=function(r,e){var n=t._bin,i={};i.format=n.readUshort(r,e),e+=2,e+=2,n.readUint(r,e),e+=4,n.readUint(r,e),e+=4;var o=n.readUint(r,e);e+=4,i.groups=[];for(var l=0;l<o;l++){var c=e+12*l,f=n.readUint(r,c+0),h=n.readUint(r,c+4),p=n.readUint(r,c+8);i.groups.push([f,h,p])}return i},t.glyf={},t.glyf.parse=function(r,e,n,i){for(var o=[],l=0;l<i.maxp.numGlyphs;l++)o.push(null);return o},t.glyf._parseGlyf=function(r,e){var n=t._bin,i=r._data,o=t._tabOffset(i,"glyf",r._offset)+r.loca[e];if(r.loca[e]==r.loca[e+1])return null;var l={};if(l.noc=n.readShort(i,o),o+=2,l.xMin=n.readShort(i,o),o+=2,l.yMin=n.readShort(i,o),o+=2,l.xMax=n.readShort(i,o),o+=2,l.yMax=n.readShort(i,o),o+=2,l.xMin>=l.xMax||l.yMin>=l.yMax)return null;if(l.noc>0){l.endPts=[];for(var c=0;c<l.noc;c++)l.endPts.push(n.readUshort(i,o)),o+=2;var f=n.readUshort(i,o);if(o+=2,i.length-o<f)return null;l.instructions=n.readBytes(i,o,f),o+=f;var h=l.endPts[l.noc-1]+1;for(l.flags=[],c=0;c<h;c++){var p=i[o];if(o++,l.flags.push(p),(8&p)!=0){var A=i[o];o++;for(var v=0;v<A;v++)l.flags.push(p),c++}}for(l.xs=[],c=0;c<h;c++){var g=(2&l.flags[c])!=0,F=(16&l.flags[c])!=0;g?(l.xs.push(F?i[o]:-i[o]),o++):F?l.xs.push(0):(l.xs.push(n.readShort(i,o)),o+=2)}for(l.ys=[],c=0;c<h;c++)g=(4&l.flags[c])!=0,F=(32&l.flags[c])!=0,g?(l.ys.push(F?i[o]:-i[o]),o++):F?l.ys.push(0):(l.ys.push(n.readShort(i,o)),o+=2);var b=0,S=0;for(c=0;c<h;c++)b+=l.xs[c],S+=l.ys[c],l.xs[c]=b,l.ys[c]=S}else{var E;l.parts=[];do{E=n.readUshort(i,o),o+=2;var T={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(l.parts.push(T),T.glyphIndex=n.readUshort(i,o),o+=2,1&E){var w=n.readShort(i,o);o+=2;var R=n.readShort(i,o);o+=2}else w=n.readInt8(i,o),o++,R=n.readInt8(i,o),o++;2&E?(T.m.tx=w,T.m.ty=R):(T.p1=w,T.p2=R),8&E?(T.m.a=T.m.d=n.readF2dot14(i,o),o+=2):64&E?(T.m.a=n.readF2dot14(i,o),o+=2,T.m.d=n.readF2dot14(i,o),o+=2):128&E&&(T.m.a=n.readF2dot14(i,o),o+=2,T.m.b=n.readF2dot14(i,o),o+=2,T.m.c=n.readF2dot14(i,o),o+=2,T.m.d=n.readF2dot14(i,o),o+=2)}while(32&E);if(256&E){var B=n.readUshort(i,o);for(o+=2,l.instr=[],c=0;c<B;c++)l.instr.push(i[o]),o++}}return l},t.GDEF={},t.GDEF.parse=function(r,e,n,i){var o=e;e+=4;var l=t._bin.readUshort(r,e);return{glyphClassDef:l===0?null:t._lctf.readClassDef(r,o+l)}},t.GPOS={},t.GPOS.parse=function(r,e,n,i){return t._lctf.parse(r,e,n,i,t.GPOS.subt)},t.GPOS.subt=function(r,e,n,i){var o=t._bin,l=n,c={};if(c.fmt=o.readUshort(r,n),n+=2,e==1||e==2||e==3||e==7||e==8&&c.fmt<=2){var f=o.readUshort(r,n);n+=2,c.coverage=t._lctf.readCoverage(r,f+l)}if(e==1&&c.fmt==1){var h=o.readUshort(r,n);n+=2,h!=0&&(c.pos=t.GPOS.readValueRecord(r,n,h))}else if(e==2&&c.fmt>=1&&c.fmt<=2){h=o.readUshort(r,n),n+=2;var p=o.readUshort(r,n);n+=2;var A=t._lctf.numOfOnes(h),v=t._lctf.numOfOnes(p);if(c.fmt==1){c.pairsets=[];var g=o.readUshort(r,n);n+=2;for(var F=0;F<g;F++){var b=l+o.readUshort(r,n);n+=2;var S=o.readUshort(r,b);b+=2;for(var E=[],T=0;T<S;T++){var w=o.readUshort(r,b);b+=2,h!=0&&(I=t.GPOS.readValueRecord(r,b,h),b+=2*A),p!=0&&(L=t.GPOS.readValueRecord(r,b,p),b+=2*v),E.push({gid2:w,val1:I,val2:L})}c.pairsets.push(E)}}if(c.fmt==2){var R=o.readUshort(r,n);n+=2;var B=o.readUshort(r,n);n+=2;var _=o.readUshort(r,n);n+=2;var D=o.readUshort(r,n);for(n+=2,c.classDef1=t._lctf.readClassDef(r,l+R),c.classDef2=t._lctf.readClassDef(r,l+B),c.matrix=[],F=0;F<_;F++){var z=[];for(T=0;T<D;T++){var I=null,L=null;h!=0&&(I=t.GPOS.readValueRecord(r,n,h),n+=2*A),p!=0&&(L=t.GPOS.readValueRecord(r,n,p),n+=2*v),z.push({val1:I,val2:L})}c.matrix.push(z)}}}else if(e==4&&c.fmt==1)c.markCoverage=t._lctf.readCoverage(r,o.readUshort(r,n)+l),c.baseCoverage=t._lctf.readCoverage(r,o.readUshort(r,n+2)+l),c.markClassCount=o.readUshort(r,n+4),c.markArray=t.GPOS.readMarkArray(r,o.readUshort(r,n+6)+l),c.baseArray=t.GPOS.readBaseArray(r,o.readUshort(r,n+8)+l,c.markClassCount);else if(e==6&&c.fmt==1)c.mark1Coverage=t._lctf.readCoverage(r,o.readUshort(r,n)+l),c.mark2Coverage=t._lctf.readCoverage(r,o.readUshort(r,n+2)+l),c.markClassCount=o.readUshort(r,n+4),c.mark1Array=t.GPOS.readMarkArray(r,o.readUshort(r,n+6)+l),c.mark2Array=t.GPOS.readBaseArray(r,o.readUshort(r,n+8)+l,c.markClassCount);else{if(e==9&&c.fmt==1){var x=o.readUshort(r,n);n+=2;var V=o.readUint(r,n);if(n+=4,i.ltype==9)i.ltype=x;else if(i.ltype!=x)throw"invalid extension substitution";return t.GPOS.subt(r,i.ltype,l+V)}console.debug("unsupported GPOS table LookupType",e,"format",c.fmt)}return c},t.GPOS.readValueRecord=function(r,e,n){var i=t._bin,o=[];return o.push(1&n?i.readShort(r,e):0),e+=1&n?2:0,o.push(2&n?i.readShort(r,e):0),e+=2&n?2:0,o.push(4&n?i.readShort(r,e):0),e+=4&n?2:0,o.push(8&n?i.readShort(r,e):0),e+=8&n?2:0,o},t.GPOS.readBaseArray=function(r,e,n){var i=t._bin,o=[],l=e,c=i.readUshort(r,e);e+=2;for(var f=0;f<c;f++){for(var h=[],p=0;p<n;p++)h.push(t.GPOS.readAnchorRecord(r,l+i.readUshort(r,e))),e+=2;o.push(h)}return o},t.GPOS.readMarkArray=function(r,e){var n=t._bin,i=[],o=e,l=n.readUshort(r,e);e+=2;for(var c=0;c<l;c++){var f=t.GPOS.readAnchorRecord(r,n.readUshort(r,e+2)+o);f.markClass=n.readUshort(r,e),i.push(f),e+=4}return i},t.GPOS.readAnchorRecord=function(r,e){var n=t._bin,i={};return i.fmt=n.readUshort(r,e),i.x=n.readShort(r,e+2),i.y=n.readShort(r,e+4),i},t.GSUB={},t.GSUB.parse=function(r,e,n,i){return t._lctf.parse(r,e,n,i,t.GSUB.subt)},t.GSUB.subt=function(r,e,n,i){var o=t._bin,l=n,c={};if(c.fmt=o.readUshort(r,n),n+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&c.fmt<=2||e==6&&c.fmt<=2){var f=o.readUshort(r,n);n+=2,c.coverage=t._lctf.readCoverage(r,l+f)}if(e==1&&c.fmt>=1&&c.fmt<=2){if(c.fmt==1)c.delta=o.readShort(r,n),n+=2;else if(c.fmt==2){var h=o.readUshort(r,n);n+=2,c.newg=o.readUshorts(r,n,h),n+=2*c.newg.length}}else if(e==2&&c.fmt==1){h=o.readUshort(r,n),n+=2,c.seqs=[];for(var p=0;p<h;p++){var A=o.readUshort(r,n)+l;n+=2;var v=o.readUshort(r,A);c.seqs.push(o.readUshorts(r,A+2,v))}}else if(e==4)for(c.vals=[],h=o.readUshort(r,n),n+=2,p=0;p<h;p++){var g=o.readUshort(r,n);n+=2,c.vals.push(t.GSUB.readLigatureSet(r,l+g))}else if(e==5&&c.fmt==2){if(c.fmt==2){var F=o.readUshort(r,n);n+=2,c.cDef=t._lctf.readClassDef(r,l+F),c.scset=[];var b=o.readUshort(r,n);for(n+=2,p=0;p<b;p++){var S=o.readUshort(r,n);n+=2,c.scset.push(S==0?null:t.GSUB.readSubClassSet(r,l+S))}}}else if(e==6&&c.fmt==3){if(c.fmt==3){for(p=0;p<3;p++){h=o.readUshort(r,n),n+=2;for(var E=[],T=0;T<h;T++)E.push(t._lctf.readCoverage(r,l+o.readUshort(r,n+2*T)));n+=2*h,p==0&&(c.backCvg=E),p==1&&(c.inptCvg=E),p==2&&(c.ahedCvg=E)}h=o.readUshort(r,n),n+=2,c.lookupRec=t.GSUB.readSubstLookupRecords(r,n,h)}}else{if(e==7&&c.fmt==1){var w=o.readUshort(r,n);n+=2;var R=o.readUint(r,n);if(n+=4,i.ltype==9)i.ltype=w;else if(i.ltype!=w)throw"invalid extension substitution";return t.GSUB.subt(r,i.ltype,l+R)}console.debug("unsupported GSUB table LookupType",e,"format",c.fmt)}return c},t.GSUB.readSubClassSet=function(r,e){var n=t._bin.readUshort,i=e,o=[],l=n(r,e);e+=2;for(var c=0;c<l;c++){var f=n(r,e);e+=2,o.push(t.GSUB.readSubClassRule(r,i+f))}return o},t.GSUB.readSubClassRule=function(r,e){var n=t._bin.readUshort,i={},o=n(r,e),l=n(r,e+=2);e+=2,i.input=[];for(var c=0;c<o-1;c++)i.input.push(n(r,e)),e+=2;return i.substLookupRecords=t.GSUB.readSubstLookupRecords(r,e,l),i},t.GSUB.readSubstLookupRecords=function(r,e,n){for(var i=t._bin.readUshort,o=[],l=0;l<n;l++)o.push(i(r,e),i(r,e+2)),e+=4;return o},t.GSUB.readChainSubClassSet=function(r,e){var n=t._bin,i=e,o=[],l=n.readUshort(r,e);e+=2;for(var c=0;c<l;c++){var f=n.readUshort(r,e);e+=2,o.push(t.GSUB.readChainSubClassRule(r,i+f))}return o},t.GSUB.readChainSubClassRule=function(r,e){for(var n=t._bin,i={},o=["backtrack","input","lookahead"],l=0;l<o.length;l++){var c=n.readUshort(r,e);e+=2,l==1&&c--,i[o[l]]=n.readUshorts(r,e,c),e+=2*i[o[l]].length}return c=n.readUshort(r,e),e+=2,i.subst=n.readUshorts(r,e,2*c),e+=2*i.subst.length,i},t.GSUB.readLigatureSet=function(r,e){var n=t._bin,i=e,o=[],l=n.readUshort(r,e);e+=2;for(var c=0;c<l;c++){var f=n.readUshort(r,e);e+=2,o.push(t.GSUB.readLigature(r,i+f))}return o},t.GSUB.readLigature=function(r,e){var n=t._bin,i={chain:[]};i.nglyph=n.readUshort(r,e),e+=2;var o=n.readUshort(r,e);e+=2;for(var l=0;l<o-1;l++)i.chain.push(n.readUshort(r,e)),e+=2;return i},t.head={},t.head.parse=function(r,e,n){var i=t._bin,o={};return i.readFixed(r,e),e+=4,o.fontRevision=i.readFixed(r,e),e+=4,i.readUint(r,e),e+=4,i.readUint(r,e),e+=4,o.flags=i.readUshort(r,e),e+=2,o.unitsPerEm=i.readUshort(r,e),e+=2,o.created=i.readUint64(r,e),e+=8,o.modified=i.readUint64(r,e),e+=8,o.xMin=i.readShort(r,e),e+=2,o.yMin=i.readShort(r,e),e+=2,o.xMax=i.readShort(r,e),e+=2,o.yMax=i.readShort(r,e),e+=2,o.macStyle=i.readUshort(r,e),e+=2,o.lowestRecPPEM=i.readUshort(r,e),e+=2,o.fontDirectionHint=i.readShort(r,e),e+=2,o.indexToLocFormat=i.readShort(r,e),e+=2,o.glyphDataFormat=i.readShort(r,e),e+=2,o},t.hhea={},t.hhea.parse=function(r,e,n){var i=t._bin,o={};return i.readFixed(r,e),e+=4,o.ascender=i.readShort(r,e),e+=2,o.descender=i.readShort(r,e),e+=2,o.lineGap=i.readShort(r,e),e+=2,o.advanceWidthMax=i.readUshort(r,e),e+=2,o.minLeftSideBearing=i.readShort(r,e),e+=2,o.minRightSideBearing=i.readShort(r,e),e+=2,o.xMaxExtent=i.readShort(r,e),e+=2,o.caretSlopeRise=i.readShort(r,e),e+=2,o.caretSlopeRun=i.readShort(r,e),e+=2,o.caretOffset=i.readShort(r,e),e+=2,e+=8,o.metricDataFormat=i.readShort(r,e),e+=2,o.numberOfHMetrics=i.readUshort(r,e),e+=2,o},t.hmtx={},t.hmtx.parse=function(r,e,n,i){for(var o=t._bin,l={aWidth:[],lsBearing:[]},c=0,f=0,h=0;h<i.maxp.numGlyphs;h++)h<i.hhea.numberOfHMetrics&&(c=o.readUshort(r,e),e+=2,f=o.readShort(r,e),e+=2),l.aWidth.push(c),l.lsBearing.push(f);return l},t.kern={},t.kern.parse=function(r,e,n,i){var o=t._bin,l=o.readUshort(r,e);if(e+=2,l==1)return t.kern.parseV1(r,e-2,n,i);var c=o.readUshort(r,e);e+=2;for(var f={glyph1:[],rval:[]},h=0;h<c;h++){e+=2,n=o.readUshort(r,e),e+=2;var p=o.readUshort(r,e);e+=2;var A=p>>>8;if((A&=15)!=0)throw"unknown kern table format: "+A;e=t.kern.readFormat0(r,e,f)}return f},t.kern.parseV1=function(r,e,n,i){var o=t._bin;o.readFixed(r,e),e+=4;var l=o.readUint(r,e);e+=4;for(var c={glyph1:[],rval:[]},f=0;f<l;f++){o.readUint(r,e),e+=4;var h=o.readUshort(r,e);e+=2,o.readUshort(r,e),e+=2;var p=h>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=t.kern.readFormat0(r,e,c)}return c},t.kern.readFormat0=function(r,e,n){var i=t._bin,o=-1,l=i.readUshort(r,e);e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2;for(var c=0;c<l;c++){var f=i.readUshort(r,e);e+=2;var h=i.readUshort(r,e);e+=2;var p=i.readShort(r,e);e+=2,f!=o&&(n.glyph1.push(f),n.rval.push({glyph2:[],vals:[]}));var A=n.rval[n.rval.length-1];A.glyph2.push(h),A.vals.push(p),o=f}return e},t.loca={},t.loca.parse=function(r,e,n,i){var o=t._bin,l=[],c=i.head.indexToLocFormat,f=i.maxp.numGlyphs+1;if(c==0)for(var h=0;h<f;h++)l.push(o.readUshort(r,e+(h<<1))<<1);if(c==1)for(h=0;h<f;h++)l.push(o.readUint(r,e+(h<<2)));return l},t.maxp={},t.maxp.parse=function(r,e,n){var i=t._bin,o={},l=i.readUint(r,e);return e+=4,o.numGlyphs=i.readUshort(r,e),e+=2,l==65536&&(o.maxPoints=i.readUshort(r,e),e+=2,o.maxContours=i.readUshort(r,e),e+=2,o.maxCompositePoints=i.readUshort(r,e),e+=2,o.maxCompositeContours=i.readUshort(r,e),e+=2,o.maxZones=i.readUshort(r,e),e+=2,o.maxTwilightPoints=i.readUshort(r,e),e+=2,o.maxStorage=i.readUshort(r,e),e+=2,o.maxFunctionDefs=i.readUshort(r,e),e+=2,o.maxInstructionDefs=i.readUshort(r,e),e+=2,o.maxStackElements=i.readUshort(r,e),e+=2,o.maxSizeOfInstructions=i.readUshort(r,e),e+=2,o.maxComponentElements=i.readUshort(r,e),e+=2,o.maxComponentDepth=i.readUshort(r,e),e+=2),o},t.name={},t.name.parse=function(r,e,n){var i=t._bin,o={};i.readUshort(r,e),e+=2;var l=i.readUshort(r,e);e+=2,i.readUshort(r,e);for(var c,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=e+=2,p=0;p<l;p++){var A=i.readUshort(r,e);e+=2;var v=i.readUshort(r,e);e+=2;var g=i.readUshort(r,e);e+=2;var F=i.readUshort(r,e);e+=2;var b=i.readUshort(r,e);e+=2;var S=i.readUshort(r,e);e+=2;var E,T=f[F],w=h+12*l+S;if(A==0)E=i.readUnicode(r,w,b/2);else if(A==3&&v==0)E=i.readUnicode(r,w,b/2);else if(v==0)E=i.readASCII(r,w,b);else if(v==1)E=i.readUnicode(r,w,b/2);else if(v==3)E=i.readUnicode(r,w,b/2);else{if(A!=1)throw"unknown encoding "+v+", platformID: "+A;E=i.readASCII(r,w,b),console.debug("reading unknown MAC encoding "+v+" as ASCII")}var R="p"+A+","+g.toString(16);o[R]==null&&(o[R]={}),o[R][T!==void 0?T:F]=E,o[R]._lang=g}for(var B in o)if(o[B].postScriptName!=null&&o[B]._lang==1033)return o[B];for(var B in o)if(o[B].postScriptName!=null&&o[B]._lang==0)return o[B];for(var B in o)if(o[B].postScriptName!=null&&o[B]._lang==3084)return o[B];for(var B in o)if(o[B].postScriptName!=null)return o[B];for(var B in o){c=B;break}return console.debug("returning name table with languageID "+o[c]._lang),o[c]},t["OS/2"]={},t["OS/2"].parse=function(r,e,n){var i=t._bin.readUshort(r,e);e+=2;var o={};if(i==0)t["OS/2"].version0(r,e,o);else if(i==1)t["OS/2"].version1(r,e,o);else if(i==2||i==3||i==4)t["OS/2"].version2(r,e,o);else{if(i!=5)throw"unknown OS/2 table version: "+i;t["OS/2"].version5(r,e,o)}return o},t["OS/2"].version0=function(r,e,n){var i=t._bin;return n.xAvgCharWidth=i.readShort(r,e),e+=2,n.usWeightClass=i.readUshort(r,e),e+=2,n.usWidthClass=i.readUshort(r,e),e+=2,n.fsType=i.readUshort(r,e),e+=2,n.ySubscriptXSize=i.readShort(r,e),e+=2,n.ySubscriptYSize=i.readShort(r,e),e+=2,n.ySubscriptXOffset=i.readShort(r,e),e+=2,n.ySubscriptYOffset=i.readShort(r,e),e+=2,n.ySuperscriptXSize=i.readShort(r,e),e+=2,n.ySuperscriptYSize=i.readShort(r,e),e+=2,n.ySuperscriptXOffset=i.readShort(r,e),e+=2,n.ySuperscriptYOffset=i.readShort(r,e),e+=2,n.yStrikeoutSize=i.readShort(r,e),e+=2,n.yStrikeoutPosition=i.readShort(r,e),e+=2,n.sFamilyClass=i.readShort(r,e),e+=2,n.panose=i.readBytes(r,e,10),e+=10,n.ulUnicodeRange1=i.readUint(r,e),e+=4,n.ulUnicodeRange2=i.readUint(r,e),e+=4,n.ulUnicodeRange3=i.readUint(r,e),e+=4,n.ulUnicodeRange4=i.readUint(r,e),e+=4,n.achVendID=[i.readInt8(r,e),i.readInt8(r,e+1),i.readInt8(r,e+2),i.readInt8(r,e+3)],e+=4,n.fsSelection=i.readUshort(r,e),e+=2,n.usFirstCharIndex=i.readUshort(r,e),e+=2,n.usLastCharIndex=i.readUshort(r,e),e+=2,n.sTypoAscender=i.readShort(r,e),e+=2,n.sTypoDescender=i.readShort(r,e),e+=2,n.sTypoLineGap=i.readShort(r,e),e+=2,n.usWinAscent=i.readUshort(r,e),e+=2,n.usWinDescent=i.readUshort(r,e),e+=2},t["OS/2"].version1=function(r,e,n){var i=t._bin;return e=t["OS/2"].version0(r,e,n),n.ulCodePageRange1=i.readUint(r,e),e+=4,n.ulCodePageRange2=i.readUint(r,e),e+=4},t["OS/2"].version2=function(r,e,n){var i=t._bin;return e=t["OS/2"].version1(r,e,n),n.sxHeight=i.readShort(r,e),e+=2,n.sCapHeight=i.readShort(r,e),e+=2,n.usDefault=i.readUshort(r,e),e+=2,n.usBreak=i.readUshort(r,e),e+=2,n.usMaxContext=i.readUshort(r,e),e+=2},t["OS/2"].version5=function(r,e,n){var i=t._bin;return e=t["OS/2"].version2(r,e,n),n.usLowerOpticalPointSize=i.readUshort(r,e),e+=2,n.usUpperOpticalPointSize=i.readUshort(r,e),e+=2},t.post={},t.post.parse=function(r,e,n){var i=t._bin,o={};return o.version=i.readFixed(r,e),e+=4,o.italicAngle=i.readFixed(r,e),e+=4,o.underlinePosition=i.readShort(r,e),e+=2,o.underlineThickness=i.readShort(r,e),e+=2,o},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(r,e){var n=r.cmap,i=-1;if(n.p0e4!=null?i=n.p0e4:n.p3e1!=null?i=n.p3e1:n.p1e0!=null?i=n.p1e0:n.p0e3!=null&&(i=n.p0e3),i==-1)throw"no familiar platform and encoding!";var o=n.tables[i];if(o.format==0)return e>=o.map.length?0:o.map[e];if(o.format==4){for(var l=-1,c=0;c<o.endCount.length;c++)if(e<=o.endCount[c]){l=c;break}return l==-1||o.startCount[l]>e?0:65535&(o.idRangeOffset[l]!=0?o.glyphIdArray[e-o.startCount[l]+(o.idRangeOffset[l]>>1)-(o.idRangeOffset.length-l)]:e+o.idDelta[l])}if(o.format==12){if(e>o.groups[o.groups.length-1][1])return 0;for(c=0;c<o.groups.length;c++){var f=o.groups[c];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+o.format},t.U.glyphToPath=function(r,e){var n={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[e]){var i=r.SVG.entries[e];return i==null?n:(typeof i=="string"&&(i=t.SVG.toPath(i),r.SVG.entries[e]=i),i)}if(r.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},l=r.CFF,c=r.CFF.Private;if(l.ROS){for(var f=0;l.FDSelect[f+2]<=e;)f+=2;c=l.FDArray[l.FDSelect[f+1]].Private}t.U._drawCFF(r.CFF.CharStrings[e],o,l,c,n)}else r.glyf&&t.U._drawGlyf(e,r,n);return n},t.U._drawGlyf=function(r,e,n){var i=e.glyf[r];i==null&&(i=e.glyf[r]=t.glyf._parseGlyf(e,r)),i!=null&&(i.noc>-1?t.U._simpleGlyph(i,n):t.U._compoGlyph(i,e,n))},t.U._simpleGlyph=function(r,e){for(var n=0;n<r.noc;n++){for(var i=n==0?0:r.endPts[n-1]+1,o=r.endPts[n],l=i;l<=o;l++){var c=l==i?o:l-1,f=l==o?i:l+1,h=1&r.flags[l],p=1&r.flags[c],A=1&r.flags[f],v=r.xs[l],g=r.ys[l];if(l==i)if(h){if(!p){t.U.P.moveTo(e,v,g);continue}t.U.P.moveTo(e,r.xs[c],r.ys[c])}else p?t.U.P.moveTo(e,r.xs[c],r.ys[c]):t.U.P.moveTo(e,(r.xs[c]+v)/2,(r.ys[c]+g)/2);h?p&&t.U.P.lineTo(e,v,g):A?t.U.P.qcurveTo(e,v,g,r.xs[f],r.ys[f]):t.U.P.qcurveTo(e,v,g,(v+r.xs[f])/2,(g+r.ys[f])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(r,e,n){for(var i=0;i<r.parts.length;i++){var o={cmds:[],crds:[]},l=r.parts[i];t.U._drawGlyf(l.glyphIndex,e,o);for(var c=l.m,f=0;f<o.crds.length;f+=2){var h=o.crds[f],p=o.crds[f+1];n.crds.push(h*c.a+p*c.b+c.tx),n.crds.push(h*c.c+p*c.d+c.ty)}for(f=0;f<o.cmds.length;f++)n.cmds.push(o.cmds[f])}},t.U._getGlyphClass=function(r,e){var n=t._lctf.getInterval(e,r);return n==-1?0:e[n+2]},t.U._applySubs=function(r,e,n,i){for(var o=r.length-e-1,l=0;l<n.tabs.length;l++)if(n.tabs[l]!=null){var c,f=n.tabs[l];if(!f.coverage||(c=t._lctf.coverageIndex(f.coverage,r[e]))!=-1){if(n.ltype==1)r[e],f.fmt==1?r[e]=r[e]+f.delta:r[e]=f.newg[c];else if(n.ltype==4)for(var h=f.vals[c],p=0;p<h.length;p++){var A=h[p],v=A.chain.length;if(!(v>o)){for(var g=!0,F=0,b=0;b<v;b++){for(;r[e+F+(1+b)]==-1;)F++;A.chain[b]!=r[e+F+(1+b)]&&(g=!1)}if(g){for(r[e]=A.nglyph,b=0;b<v+F;b++)r[e+b+1]=-1;break}}}else if(n.ltype==5&&f.fmt==2)for(var S=t._lctf.getInterval(f.cDef,r[e]),E=f.cDef[S+2],T=f.scset[E],w=0;w<T.length;w++){var R=T[w],B=R.input;if(!(B.length>o)){for(g=!0,b=0;b<B.length;b++){var _=t._lctf.getInterval(f.cDef,r[e+1+b]);if(S==-1&&f.cDef[_+2]!=B[b]){g=!1;break}}if(g){var D=R.substLookupRecords;for(p=0;p<D.length;p+=2)D[p],D[p+1]}}}else if(n.ltype==6&&f.fmt==3){if(!t.U._glsCovered(r,f.backCvg,e-f.backCvg.length)||!t.U._glsCovered(r,f.inptCvg,e)||!t.U._glsCovered(r,f.ahedCvg,e+f.inptCvg.length))continue;var z=f.lookupRec;for(w=0;w<z.length;w+=2){S=z[w];var I=i[z[w+1]];t.U._applySubs(r,e+S,I,i)}}}}},t.U._glsCovered=function(r,e,n){for(var i=0;i<e.length;i++)if(t._lctf.coverageIndex(e[i],r[n+i])==-1)return!1;return!0},t.U.glyphsToPath=function(r,e,n){for(var i={cmds:[],crds:[]},o=0,l=0;l<e.length;l++){var c=e[l];if(c!=-1){for(var f=l<e.length-1&&e[l+1]!=-1?e[l+1]:0,h=t.U.glyphToPath(r,c),p=0;p<h.crds.length;p+=2)i.crds.push(h.crds[p]+o),i.crds.push(h.crds[p+1]);for(n&&i.cmds.push(n),p=0;p<h.cmds.length;p++)i.cmds.push(h.cmds[p]);n&&i.cmds.push("X"),o+=r.hmtx.aWidth[c],l<e.length-1&&(o+=t.U.getPairAdjustment(r,c,f))}}return i},t.U.P={},t.U.P.moveTo=function(r,e,n){r.cmds.push("M"),r.crds.push(e,n)},t.U.P.lineTo=function(r,e,n){r.cmds.push("L"),r.crds.push(e,n)},t.U.P.curveTo=function(r,e,n,i,o,l,c){r.cmds.push("C"),r.crds.push(e,n,i,o,l,c)},t.U.P.qcurveTo=function(r,e,n,i,o){r.cmds.push("Q"),r.crds.push(e,n,i,o)},t.U.P.closePath=function(r){r.cmds.push("Z")},t.U._drawCFF=function(r,e,n,i,o){for(var l=e.stack,c=e.nStems,f=e.haveWidth,h=e.width,p=e.open,A=0,v=e.x,g=e.y,F=0,b=0,S=0,E=0,T=0,w=0,R=0,B=0,_=0,D=0,z={val:0,size:0};A<r.length;){t.CFF.getCharString(r,A,z);var I=z.val;if(A+=z.size,I=="o1"||I=="o18")l.length%2!=0&&!f&&(h=l.shift()+i.nominalWidthX),c+=l.length>>1,l.length=0,f=!0;else if(I=="o3"||I=="o23")l.length%2!=0&&!f&&(h=l.shift()+i.nominalWidthX),c+=l.length>>1,l.length=0,f=!0;else if(I=="o4")l.length>1&&!f&&(h=l.shift()+i.nominalWidthX,f=!0),p&&t.U.P.closePath(o),g+=l.pop(),t.U.P.moveTo(o,v,g),p=!0;else if(I=="o5")for(;l.length>0;)v+=l.shift(),g+=l.shift(),t.U.P.lineTo(o,v,g);else if(I=="o6"||I=="o7")for(var L=l.length,x=I=="o6",V=0;V<L;V++){var j=l.shift();x?v+=j:g+=j,x=!x,t.U.P.lineTo(o,v,g)}else if(I=="o8"||I=="o24"){L=l.length;for(var ue=0;ue+6<=L;)F=v+l.shift(),b=g+l.shift(),S=F+l.shift(),E=b+l.shift(),v=S+l.shift(),g=E+l.shift(),t.U.P.curveTo(o,F,b,S,E,v,g),ue+=6;I=="o24"&&(v+=l.shift(),g+=l.shift(),t.U.P.lineTo(o,v,g))}else{if(I=="o11")break;if(I=="o1234"||I=="o1235"||I=="o1236"||I=="o1237")I=="o1234"&&(b=g,S=(F=v+l.shift())+l.shift(),D=E=b+l.shift(),w=E,B=g,v=(R=(T=(_=S+l.shift())+l.shift())+l.shift())+l.shift(),t.U.P.curveTo(o,F,b,S,E,_,D),t.U.P.curveTo(o,T,w,R,B,v,g)),I=="o1235"&&(F=v+l.shift(),b=g+l.shift(),S=F+l.shift(),E=b+l.shift(),_=S+l.shift(),D=E+l.shift(),T=_+l.shift(),w=D+l.shift(),R=T+l.shift(),B=w+l.shift(),v=R+l.shift(),g=B+l.shift(),l.shift(),t.U.P.curveTo(o,F,b,S,E,_,D),t.U.P.curveTo(o,T,w,R,B,v,g)),I=="o1236"&&(F=v+l.shift(),b=g+l.shift(),S=F+l.shift(),D=E=b+l.shift(),w=E,R=(T=(_=S+l.shift())+l.shift())+l.shift(),B=w+l.shift(),v=R+l.shift(),t.U.P.curveTo(o,F,b,S,E,_,D),t.U.P.curveTo(o,T,w,R,B,v,g)),I=="o1237"&&(F=v+l.shift(),b=g+l.shift(),S=F+l.shift(),E=b+l.shift(),_=S+l.shift(),D=E+l.shift(),T=_+l.shift(),w=D+l.shift(),R=T+l.shift(),B=w+l.shift(),Math.abs(R-v)>Math.abs(B-g)?v=R+l.shift():g=B+l.shift(),t.U.P.curveTo(o,F,b,S,E,_,D),t.U.P.curveTo(o,T,w,R,B,v,g));else if(I=="o14"){if(l.length>0&&!f&&(h=l.shift()+n.nominalWidthX,f=!0),l.length==4){var fe=l.shift(),Y=l.shift(),k=l.shift(),M=l.shift(),G=t.CFF.glyphBySE(n,k),U=t.CFF.glyphBySE(n,M);t.U._drawCFF(n.CharStrings[G],e,n,i,o),e.x=fe,e.y=Y,t.U._drawCFF(n.CharStrings[U],e,n,i,o)}p&&(t.U.P.closePath(o),p=!1)}else if(I=="o19"||I=="o20")l.length%2!=0&&!f&&(h=l.shift()+i.nominalWidthX),c+=l.length>>1,l.length=0,f=!0,A+=c+7>>3;else if(I=="o21")l.length>2&&!f&&(h=l.shift()+i.nominalWidthX,f=!0),g+=l.pop(),v+=l.pop(),p&&t.U.P.closePath(o),t.U.P.moveTo(o,v,g),p=!0;else if(I=="o22")l.length>1&&!f&&(h=l.shift()+i.nominalWidthX,f=!0),v+=l.pop(),p&&t.U.P.closePath(o),t.U.P.moveTo(o,v,g),p=!0;else if(I=="o25"){for(;l.length>6;)v+=l.shift(),g+=l.shift(),t.U.P.lineTo(o,v,g);F=v+l.shift(),b=g+l.shift(),S=F+l.shift(),E=b+l.shift(),v=S+l.shift(),g=E+l.shift(),t.U.P.curveTo(o,F,b,S,E,v,g)}else if(I=="o26")for(l.length%2&&(v+=l.shift());l.length>0;)F=v,b=g+l.shift(),v=S=F+l.shift(),g=(E=b+l.shift())+l.shift(),t.U.P.curveTo(o,F,b,S,E,v,g);else if(I=="o27")for(l.length%2&&(g+=l.shift());l.length>0;)b=g,S=(F=v+l.shift())+l.shift(),E=b+l.shift(),v=S+l.shift(),g=E,t.U.P.curveTo(o,F,b,S,E,v,g);else if(I=="o10"||I=="o29"){var H=I=="o10"?i:n;if(l.length==0)console.debug("error: empty stack");else{var P=l.pop(),X=H.Subrs[P+H.Bias];e.x=v,e.y=g,e.nStems=c,e.haveWidth=f,e.width=h,e.open=p,t.U._drawCFF(X,e,n,i,o),v=e.x,g=e.y,c=e.nStems,f=e.haveWidth,h=e.width,p=e.open}}else if(I=="o30"||I=="o31"){var W=l.length,Z=(ue=0,I=="o31");for(ue+=W-(L=-3&W);ue<L;)Z?(b=g,S=(F=v+l.shift())+l.shift(),g=(E=b+l.shift())+l.shift(),L-ue==5?(v=S+l.shift(),ue++):v=S,Z=!1):(F=v,b=g+l.shift(),S=F+l.shift(),E=b+l.shift(),v=S+l.shift(),L-ue==5?(g=E+l.shift(),ue++):g=E,Z=!0),t.U.P.curveTo(o,F,b,S,E,v,g),ue+=4}else{if((I+"").charAt(0)=="o")throw console.debug("Unknown operation: "+I,r),I;l.push(I)}}}e.x=v,e.y=g,e.nStems=c,e.haveWidth=f,e.width=h,e.open=p};var s=t,a={Typr:s};return u.Typr=s,u.default=a,Object.defineProperty(u,"__esModule",{value:!0}),u}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Yc(){return function(u){var t=Uint8Array,s=Uint16Array,a=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),n=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(I,L){for(var x=new s(31),V=0;V<31;++V)x[V]=L+=1<<I[V-1];var j=new a(x[30]);for(V=1;V<30;++V)for(var ue=x[V];ue<x[V+1];++ue)j[ue]=ue-x[V]<<5|V;return[x,j]},o=i(r,2),l=o[0],c=o[1];l[28]=258,c[258]=28;for(var f=i(e,0)[0],h=new s(32768),p=0;p<32768;++p){var A=(43690&p)>>>1|(21845&p)<<1;A=(61680&(A=(52428&A)>>>2|(13107&A)<<2))>>>4|(3855&A)<<4,h[p]=((65280&A)>>>8|(255&A)<<8)>>>1}var v=function(I,L,x){for(var V=I.length,j=0,ue=new s(L);j<V;++j)++ue[I[j]-1];var fe,Y=new s(L);for(j=0;j<L;++j)Y[j]=Y[j-1]+ue[j-1]<<1;{fe=new s(1<<L);var k=15-L;for(j=0;j<V;++j)if(I[j])for(var M=j<<4|I[j],G=L-I[j],U=Y[I[j]-1]++<<G,H=U|(1<<G)-1;U<=H;++U)fe[h[U]>>>k]=M}return fe},g=new t(288);for(p=0;p<144;++p)g[p]=8;for(p=144;p<256;++p)g[p]=9;for(p=256;p<280;++p)g[p]=7;for(p=280;p<288;++p)g[p]=8;var F=new t(32);for(p=0;p<32;++p)F[p]=5;var b=v(g,9),S=v(F,5),E=function(I){for(var L=I[0],x=1;x<I.length;++x)I[x]>L&&(L=I[x]);return L},T=function(I,L,x){var V=L/8|0;return(I[V]|I[V+1]<<8)>>(7&L)&x},w=function(I,L){var x=L/8|0;return(I[x]|I[x+1]<<8|I[x+2]<<16)>>(7&L)},R=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],B=function(I,L,x){var V=new Error(L||R[I]);if(V.code=I,Error.captureStackTrace&&Error.captureStackTrace(V,B),!x)throw V;return V},_=function(I,L,x){var V=I.length;if(!V||x&&!x.l&&V<5)return L||new t(0);var j=!L||x,ue=!x||x.i;x||(x={}),L||(L=new t(3*V));var fe,Y=function(C){var q=L.length;if(C>q){var le=new t(Math.max(2*q,C));le.set(L),L=le}},k=x.f||0,M=x.p||0,G=x.b||0,U=x.l,H=x.d,P=x.m,X=x.n,W=8*V;do{if(!U){x.f=k=T(I,M,1);var Z=T(I,M+1,3);if(M+=3,!Z){var Ae=I[(ge=((fe=M)/8|0)+(7&fe&&1)+4)-4]|I[ge-3]<<8,Be=ge+Ae;if(Be>V){ue&&B(0);break}j&&Y(G+Ae),L.set(I.subarray(ge,Be),G),x.b=G+=Ae,x.p=M=8*Be;continue}if(Z==1)U=b,H=S,P=9,X=5;else if(Z==2){var ae=T(I,M,31)+257,ee=T(I,M+10,15)+4,Oe=ae+T(I,M+5,31)+1;M+=14;for(var _e=new t(Oe),me=new t(19),Ce=0;Ce<ee;++Ce)me[n[Ce]]=T(I,M+3*Ce,7);M+=3*ee;var we=E(me),ne=(1<<we)-1,Ee=v(me,we);for(Ce=0;Ce<Oe;){var ge,$=Ee[T(I,M,ne)];if(M+=15&$,(ge=$>>>4)<16)_e[Ce++]=ge;else{var Re=0,de=0;for(ge==16?(de=3+T(I,M,3),M+=2,Re=_e[Ce-1]):ge==17?(de=3+T(I,M,7),M+=3):ge==18&&(de=11+T(I,M,127),M+=7);de--;)_e[Ce++]=Re}}var Te=_e.subarray(0,ae),he=_e.subarray(ae);P=E(Te),X=E(he),U=v(Te,P),H=v(he,X)}else B(1);if(M>W){ue&&B(0);break}}j&&Y(G+131072);for(var Xe=(1<<P)-1,be=(1<<X)-1,ye=M;;ye=M){var Ie=(Re=U[w(I,M)&Xe])>>>4;if((M+=15&Re)>W){ue&&B(0);break}if(Re||B(2),Ie<256)L[G++]=Ie;else{if(Ie==256){ye=M,U=null;break}var ke=Ie-254;if(Ie>264){var et=r[Ce=Ie-257];ke=T(I,M,(1<<et)-1)+l[Ce],M+=et}var ot=H[w(I,M)&be],Pe=ot>>>4;if(ot||B(3),M+=15&ot,he=f[Pe],Pe>3&&(et=e[Pe],he+=w(I,M)&(1<<et)-1,M+=et),M>W){ue&&B(0);break}j&&Y(G+131072);for(var Se=G+ke;G<Se;G+=4)L[G]=L[G-he],L[G+1]=L[G+1-he],L[G+2]=L[G+2-he],L[G+3]=L[G+3-he];G=Se}}x.l=U,x.p=ye,x.b=G,U&&(k=1,x.m=P,x.d=H,x.n=X)}while(!k);return G==L.length?L:function(C,q,le){(le==null||le>C.length)&&(le=C.length);var ve=new(C instanceof s?s:C instanceof a?a:t)(le-q);return ve.set(C.subarray(q,le)),ve}(L,0,G)},D=new t(0),z=typeof TextDecoder<"u"&&new TextDecoder;try{z.decode(D,{stream:!0})}catch{}return u.convert_streams=function(I){var L=new DataView(I),x=0;function V(){var ae=L.getUint16(x);return x+=2,ae}function j(){var ae=L.getUint32(x);return x+=4,ae}function ue(ae){Ae.setUint16(Be,ae),Be+=2}function fe(ae){Ae.setUint32(Be,ae),Be+=4}for(var Y={signature:j(),flavor:j(),length:j(),numTables:V(),reserved:V(),totalSfntSize:j(),majorVersion:V(),minorVersion:V(),metaOffset:j(),metaLength:j(),metaOrigLength:j(),privOffset:j(),privLength:j()},k=0;Math.pow(2,k)<=Y.numTables;)k++;k--;for(var M=16*Math.pow(2,k),G=16*Y.numTables-M,U=12,H=[],P=0;P<Y.numTables;P++)H.push({tag:j(),offset:j(),compLength:j(),origLength:j(),origChecksum:j()}),U+=16;var X,W=new Uint8Array(12+16*H.length+H.reduce(function(ae,ee){return ae+ee.origLength+4},0)),Z=W.buffer,Ae=new DataView(Z),Be=0;return fe(Y.flavor),ue(Y.numTables),ue(M),ue(k),ue(G),H.forEach(function(ae){fe(ae.tag),fe(ae.origChecksum),fe(U),fe(ae.origLength),ae.outOffset=U,(U+=ae.origLength)%4!=0&&(U+=4-U%4)}),H.forEach(function(ae){var ee,Oe=I.slice(ae.offset,ae.offset+ae.compLength);if(ae.compLength!=ae.origLength){var _e=new Uint8Array(ae.origLength);ee=new Uint8Array(Oe,2),_(ee,_e)}else _e=new Uint8Array(Oe);W.set(_e,ae.outOffset);var me=0;(U=ae.outOffset+ae.origLength)%4!=0&&(me=4-U%4),W.set(new Uint8Array(me).buffer,ae.outOffset+ae.origLength),X=U+me}),Z.slice(0,X)},Object.defineProperty(u,"__esModule",{value:!0}),u}({}).convert_streams}function zc(u,t){const s={M:2,L:2,Q:4,C:6,Z:0},a={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,e=2,n=4,i=8,o=16,l=32;let c;function f(R){if(!c){const B={R:e,L:r,D:n,C:o,U:l,T:i};c=new Map;for(let _ in a){let D=0;a[_].split(",").forEach(z=>{let[I,L]=z.split("+");I=parseInt(I,36),L=L?parseInt(L,36):0,c.set(D+=I,B[_]);for(let x=L;x--;)c.set(++D,B[_])})}}return c.get(R)||l}const h=1,p=2,A=3,v=4,g=[null,"isol","init","fina","medi"];function F(R){const B=new Uint8Array(R.length);let _=l,D=h,z=-1;for(let I=0;I<R.length;I++){const L=R.codePointAt(I);let x=f(L)|0,V=h;x&i||(_&(r|n|o)?x&(e|n|o)?(V=A,(D===h||D===A)&&B[z]++):x&(r|l)&&(D===p||D===v)&&B[z]--:_&(e|l)&&(D===p||D===v)&&B[z]--,D=B[I]=V,_=x,z=I,L>65535&&I++)}return B}function b(R,B){const _=[];for(let z=0;z<B.length;z++){const I=B.codePointAt(z);I>65535&&z++,_.push(u.U.codeToGlyph(R,I))}const D=R.GSUB;if(D){const{lookupList:z,featureList:I}=D;let L;const x=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,V=[];I.forEach(j=>{if(x.test(j.tag))for(let ue=0;ue<j.tab.length;ue++){if(V[j.tab[ue]])continue;V[j.tab[ue]]=!0;const fe=z[j.tab[ue]],Y=/^(isol|init|fina|medi)$/.test(j.tag);Y&&!L&&(L=F(B));for(let k=0;k<_.length;k++)(!L||!Y||g[L[k]]===j.tag)&&u.U._applySubs(_,k,fe,z)}})}return _}function S(R,B){const _=new Int16Array(B.length*3);let D=0;for(;D<B.length;D++){const x=B[D];if(x===-1)continue;_[D*3+2]=R.hmtx.aWidth[x];const V=R.GPOS;if(V){const j=V.lookupList;for(let ue=0;ue<j.length;ue++){const fe=j[ue];for(let Y=0;Y<fe.tabs.length;Y++){const k=fe.tabs[Y];if(fe.ltype===1){if(u._lctf.coverageIndex(k.coverage,x)!==-1&&k.pos){L(k.pos,D);break}}else if(fe.ltype===2){let M=null,G=z();if(G!==-1){const U=u._lctf.coverageIndex(k.coverage,B[G]);if(U!==-1){if(k.fmt===1){const H=k.pairsets[U];for(let P=0;P<H.length;P++)H[P].gid2===x&&(M=H[P])}else if(k.fmt===2){const H=u.U._getGlyphClass(B[G],k.classDef1),P=u.U._getGlyphClass(x,k.classDef2);M=k.matrix[H][P]}if(M){M.val1&&L(M.val1,G),M.val2&&L(M.val2,D);break}}}}else if(fe.ltype===4){const M=u._lctf.coverageIndex(k.markCoverage,x);if(M!==-1){const G=z(I),U=G===-1?-1:u._lctf.coverageIndex(k.baseCoverage,B[G]);if(U!==-1){const H=k.markArray[M],P=k.baseArray[U][H.markClass];_[D*3]=P.x-H.x+_[G*3]-_[G*3+2],_[D*3+1]=P.y-H.y+_[G*3+1];break}}}else if(fe.ltype===6){const M=u._lctf.coverageIndex(k.mark1Coverage,x);if(M!==-1){const G=z();if(G!==-1){const U=B[G];if(E(R,U)===3){const H=u._lctf.coverageIndex(k.mark2Coverage,U);if(H!==-1){const P=k.mark1Array[M],X=k.mark2Array[H][P.markClass];_[D*3]=X.x-P.x+_[G*3]-_[G*3+2],_[D*3+1]=X.y-P.y+_[G*3+1];break}}}}}}}}else if(R.kern&&!R.cff){const j=z();if(j!==-1){const ue=R.kern.glyph1.indexOf(B[j]);if(ue!==-1){const fe=R.kern.rval[ue].glyph2.indexOf(x);fe!==-1&&(_[j*3+2]+=R.kern.rval[ue].vals[fe])}}}}return _;function z(x){for(let V=D-1;V>=0;V--)if(B[V]!==-1&&(!x||x(B[V])))return V;return-1}function I(x){return E(R,x)===1}function L(x,V){for(let j=0;j<3;j++)_[V*3+j]+=x[j]||0}}function E(R,B){const _=R.GDEF&&R.GDEF.glyphClassDef;return _?u.U._getGlyphClass(B,_):0}function T(...R){for(let B=0;B<R.length;B++)if(typeof R[B]=="number")return R[B]}function w(R){const B=Object.create(null),_=R["OS/2"],D=R.hhea,z=R.head.unitsPerEm,I=T(_&&_.sTypoAscender,D&&D.ascender,z),L={unitsPerEm:z,ascender:I,descender:T(_&&_.sTypoDescender,D&&D.descender,0),capHeight:T(_&&_.sCapHeight,I),xHeight:T(_&&_.sxHeight,I),lineGap:T(_&&_.sTypoLineGap,D&&D.lineGap),supportsCodePoint(x){return u.U.codeToGlyph(R,x)>0},forEachGlyph(x,V,j,ue){let fe=0;const Y=1/L.unitsPerEm*V,k=b(R,x);let M=0;const G=S(R,k);return k.forEach((U,H)=>{if(U!==-1){let P=B[U];if(!P){const{cmds:X,crds:W}=u.U.glyphToPath(R,U);let Z="",Ae=0;for(let _e=0,me=X.length;_e<me;_e++){const Ce=s[X[_e]];Z+=X[_e];for(let we=1;we<=Ce;we++)Z+=(we>1?",":"")+W[Ae++]}let Be,ae,ee,Oe;if(W.length){Be=ae=1/0,ee=Oe=-1/0;for(let _e=0,me=W.length;_e<me;_e+=2){let Ce=W[_e],we=W[_e+1];Ce<Be&&(Be=Ce),we<ae&&(ae=we),Ce>ee&&(ee=Ce),we>Oe&&(Oe=we)}}else Be=ee=ae=Oe=0;P=B[U]={index:U,advanceWidth:R.hmtx.aWidth[U],xMin:Be,yMin:ae,xMax:ee,yMax:Oe,path:Z}}ue.call(null,P,fe+G[H*3]*Y,G[H*3+1]*Y,M),fe+=G[H*3+2]*Y,j&&(fe+=j*V)}M+=x.codePointAt(M)>65535?2:1}),fe}};return L}return function(B){const _=new Uint8Array(B,0,4),D=u._bin.readASCII(_,0,4);if(D==="wOFF")B=t(B);else if(D==="wOF2")throw new Error("woff2 fonts not supported");return w(u.parse(B)[0])}}const Zc=Mr({name:"Typr Font Parser",dependencies:[Qc,Yc,zc],init(u,t,s){const a=u(),r=t();return s(a,r)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function Vc(){return function(u){var t=function(){this.buckets=new Map};t.prototype.add=function(S){var E=S>>5;this.buckets.set(E,(this.buckets.get(E)||0)|1<<(31&S))},t.prototype.has=function(S){var E=this.buckets.get(S>>5);return E!==void 0&&(E&1<<(31&S))!=0},t.prototype.serialize=function(){var S=[];return this.buckets.forEach(function(E,T){S.push((+T).toString(36)+":"+E.toString(36))}),S.join(",")},t.prototype.deserialize=function(S){var E=this;this.buckets.clear(),S.split(",").forEach(function(T){var w=T.split(":");E.buckets.set(parseInt(w[0],36),parseInt(w[1],36))})};var s=Math.pow(2,8),a=s-1,r=~a;function e(S){var E=function(w){return w&r}(S).toString(16),T=function(w){return(w&r)+s-1}(S).toString(16);return"codepoint-index/plane"+(S>>16)+"/"+E+"-"+T+".json"}function n(S,E){var T=S&a,w=E.codePointAt(T/6|0);return((w=(w||48)-48)&1<<T%6)!=0}function i(S,E){var T;(T=S,T.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(w){return w.split("-").map(function(R){return parseInt(R.trim(),16)})})).forEach(function(w){var R=w[0],B=w[1];B===void 0&&(B=R),E(R,B)})}function o(S,E){i(S,function(T,w){for(var R=T;R<=w;R++)E(R)})}var l={},c={},f=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function p(S){var E=f.get(S);return E||(E=new t,o(S.ranges,function(T){return E.add(T)}),f.set(S,E)),E}var A,v=new Map;function g(S,E,T){return S[E]?E:S[T]?T:function(w){for(var R in w)return R}(S)}function F(S,E){var T=E;if(!S.includes(T)){T=1/0;for(var w=0;w<S.length;w++)Math.abs(S[w]-E)<Math.abs(T-E)&&(T=S[w])}return T}function b(S){return A||(A=new Set,o("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(E){A.add(E)})),A.has(S)}return u.CodePointSet=t,u.clearCache=function(){l={},c={}},u.getFontsForString=function(S,E){E===void 0&&(E={});var T,w=E.lang;w===void 0&&(w=new RegExp("\\p{Script=Hangul}","u").test(T=S)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(T)?"ja":"en");var R=E.category;R===void 0&&(R="sans-serif");var B=E.style;B===void 0&&(B="normal");var _=E.weight;_===void 0&&(_=400);var D=(E.dataUrl||h).replace(/\/$/g,""),z=new Map,I=new Uint8Array(S.length),L={},x={},V=new Array(S.length),j=new Map,ue=!1;function fe(M){var G=v.get(M);return G||(G=fetch(D+"/"+M).then(function(U){if(!U.ok)throw new Error(U.statusText);return U.json().then(function(H){if(!Array.isArray(H)||H[0]!==1)throw new Error("Incorrect schema version; need 1, got "+H[0]);return H[1]})}).catch(function(U){if(D!==h)return ue||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+D+'", trying default CDN. '+U.message),ue=!0),D=h,v.delete(M),fe(M);throw U}),v.set(M,G)),G}for(var Y=function(M){var G=S.codePointAt(M),U=e(G);V[M]=U,l[U]||j.has(U)||j.set(U,fe(U).then(function(H){l[U]=H})),G>65535&&(M++,k=M)},k=0;k<S.length;k++)Y(k);return Promise.all(j.values()).then(function(){j.clear();for(var M=function(U){var H=S.codePointAt(U),P=null,X=l[V[U]],W=void 0;for(var Z in X){var Ae=x[Z];if(Ae===void 0&&(Ae=x[Z]=new RegExp(Z).test(w||"en")),Ae){for(var Be in W=Z,X[Z])if(n(H,X[Z][Be])){P=Be;break}break}}if(!P){e:for(var ae in X)if(ae!==W){for(var ee in X[ae])if(n(H,X[ae][ee])){P=ee;break e}}}P||(console.debug("No font coverage for U+"+H.toString(16)),P="latin"),V[U]=P,c[P]||j.has(P)||j.set(P,fe("font-meta/"+P+".json").then(function(Oe){c[P]=Oe})),H>65535&&(U++,G=U)},G=0;G<S.length;G++)M(G);return Promise.all(j.values())}).then(function(){for(var M,G=null,U=0;U<S.length;U++){var H=S.codePointAt(U);if(G&&(b(H)||p(G).has(H)))I[U]=I[U-1];else{G=c[V[U]];var P=L[G.id];if(!P){var X=G.typeforms,W=g(X,R,"sans-serif"),Z=g(X[W],B,"normal"),Ae=F((M=X[W])===null||M===void 0?void 0:M[Z],_);P=L[G.id]=D+"/font-files/"+G.id+"/"+W+"."+Z+"."+Ae+".woff"}var Be=z.get(P);Be==null&&(Be=z.size,z.set(P,Be)),I[U]=Be}H>65535&&(U++,I[U]=I[U-1])}return{fontUrls:Array.from(z.keys()),chars:I}})},Object.defineProperty(u,"__esModule",{value:!0}),u}({})}function qc(u,t){const s=Object.create(null),a=Object.create(null);function r(n,i){const o=l=>{console.error(`Failure loading font ${n}`,l)};try{const l=new XMLHttpRequest;l.open("get",n,!0),l.responseType="arraybuffer",l.onload=function(){if(l.status>=400)o(new Error(l.statusText));else if(l.status>0)try{const c=u(l.response);c.src=n,i(c)}catch(c){o(c)}},l.onerror=o,l.send()}catch(l){o(l)}}function e(n,i){let o=s[n];o?i(o):a[n]?a[n].push(i):(a[n]=[i],r(n,l=>{l.src=n,s[n]=l,a[n].forEach(c=>c(l)),delete a[n]}))}return function(n,i,{lang:o,fonts:l=[],style:c="normal",weight:f="normal",unicodeFontsURL:h}={}){const p=new Uint8Array(n.length),A=[];n.length||b();const v=new Map,g=[];if(c!=="italic"&&(c="normal"),typeof f!="number"&&(f=f==="bold"?700:400),l&&!Array.isArray(l)&&(l=[l]),l=l.slice().filter(E=>!E.lang||E.lang.test(o)).reverse(),l.length){let R=0;(function B(_=0){for(let D=_,z=n.length;D<z;D++){const I=n.codePointAt(D);if(R===1&&A[p[D-1]].supportsCodePoint(I)||/\s/.test(n[D]))p[D]=p[D-1],R===2&&(g[g.length-1][1]=D);else for(let L=p[D],x=l.length;L<=x;L++)if(L===x){const V=R===2?g[g.length-1]:g[g.length]=[D,D];V[1]=D,R=2}else{p[D]=L;const{src:V,unicodeRange:j}=l[L];if(!j||S(I,j)){const ue=s[V];if(!ue){e(V,()=>{B(D)});return}if(ue.supportsCodePoint(I)){let fe=v.get(ue);typeof fe!="number"&&(fe=A.length,A.push(ue),v.set(ue,fe)),p[D]=fe,R=1;break}}}I>65535&&D+1<z&&(p[D+1]=p[D],D++,R===2&&(g[g.length-1][1]=D))}F()})()}else g.push([0,n.length-1]),F();function F(){if(g.length){const E=g.map(T=>n.substring(T[0],T[1]+1)).join(`
`);t.getFontsForString(E,{lang:o||void 0,style:c,weight:f,dataUrl:h}).then(({fontUrls:T,chars:w})=>{const R=A.length;let B=0;g.forEach(D=>{for(let z=0,I=D[1]-D[0];z<=I;z++)p[D[0]+z]=w[B++]+R;B++});let _=0;T.forEach((D,z)=>{e(D,I=>{A[z+R]=I,++_===T.length&&b()})})})}else b()}function b(){i({chars:p,fonts:A})}function S(E,T){for(let w=0;w<T.length;w++){const[R,B=R]=T[w];if(R<=E&&E<=B)return!0}return!1}}}const $c=Mr({name:"FontResolver",dependencies:[qc,Zc,Vc],init(u,t,s){return u(t,s())}});function eu(u,t){const a=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",e=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function n({text:A,lang:v,fonts:g,style:F,weight:b,preResolvedFonts:S,unicodeFontsURL:E},T){const w=({chars:R,fonts:B})=>{let _,D;const z=[];for(let I=0;I<R.length;I++)R[I]!==D?(D=R[I],z.push(_={start:I,end:I,fontObj:B[R[I]]})):_.end=I;T(z)};S?w(S):u(A,w,{lang:v,fonts:g,style:F,weight:b,unicodeFontsURL:E})}function i({text:A="",font:v,lang:g,sdfGlyphSize:F=64,fontSize:b=400,fontWeight:S=1,fontStyle:E="normal",letterSpacing:T=0,lineHeight:w="normal",maxWidth:R=1/0,direction:B,textAlign:_="left",textIndent:D=0,whiteSpace:z="normal",overflowWrap:I="normal",anchorX:L=0,anchorY:x=0,metricsOnly:V=!1,unicodeFontsURL:j,preResolvedFonts:ue=null,includeCaretPositions:fe=!1,chunkedBoundsSize:Y=8192,colorRanges:k=null},M){const G=f(),U={fontLoad:0,typesetting:0};A.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),A=A.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),b=+b,T=+T,R=+R,w=w||"normal",D=+D,n({text:A,lang:g,style:E,weight:S,fonts:typeof v=="string"?[{src:v}]:v,unicodeFontsURL:j,preResolvedFonts:ue},H=>{U.fontLoad=f()-G;const P=isFinite(R);let X=null,W=null,Z=null,Ae=null,Be=null,ae=null,ee=null,Oe=null,_e=0,me=0,Ce=z!=="nowrap";const we=new Map,ne=f();let Ee=D,ge=0,$=new h;const Re=[$];H.forEach(be=>{const{fontObj:ye}=be,{ascender:Ie,descender:ke,unitsPerEm:et,lineGap:ot,capHeight:Pe,xHeight:Se}=ye;let C=we.get(ye);if(!C){const Q=b/et,Ne=w==="normal"?(Ie-ke+ot)*Q:w*b,Lt=(Ne-(Ie-ke)*Q)/2,We=Math.min(Ne,(Ie-ke)*Q),xe=(Ie+ke)/2*Q+We/2;C={index:we.size,src:ye.src,fontObj:ye,fontSizeMult:Q,unitsPerEm:et,ascender:Ie*Q,descender:ke*Q,capHeight:Pe*Q,xHeight:Se*Q,lineHeight:Ne,baseline:-Lt-Ie*Q,caretTop:xe,caretBottom:xe-We},we.set(ye,C)}const{fontSizeMult:q}=C,le=A.slice(be.start,be.end+1);let ve,Ge;ye.forEachGlyph(le,b,T,(Q,Ne,Lt,We)=>{Ne+=ge,We+=be.start,ve=Ne,Ge=Q;const xe=A.charAt(We),Qe=Q.advanceWidth*q,Ye=$.count;let De;if("isEmpty"in Q||(Q.isWhitespace=!!xe&&new RegExp(r).test(xe),Q.canBreakAfter=!!xe&&e.test(xe),Q.isEmpty=Q.xMin===Q.xMax||Q.yMin===Q.yMax||a.test(xe)),!Q.isWhitespace&&!Q.isEmpty&&me++,Ce&&P&&!Q.isWhitespace&&Ne+Qe+Ee>R&&Ye){if($.glyphAt(Ye-1).glyphObj.canBreakAfter)De=new h,Ee=-Ne;else for(let lt=Ye;lt--;)if(lt===0&&I==="break-word"){De=new h,Ee=-Ne;break}else if($.glyphAt(lt).glyphObj.canBreakAfter){De=$.splitAt(lt+1);const pt=De.glyphAt(0).x;Ee-=pt;for(let ct=De.count;ct--;)De.glyphAt(ct).x-=pt;break}De&&($.isSoftWrapped=!0,$=De,Re.push($),_e=R)}let ze=$.glyphAt($.count);ze.glyphObj=Q,ze.x=Ne+Ee,ze.y=Lt,ze.width=Qe,ze.charIndex=We,ze.fontData=C,xe===`
`&&($=new h,Re.push($),Ee=-(Ne+Qe+T*b)+D)}),ge=ve+Ge.advanceWidth*q+T*b});let de=0;Re.forEach(be=>{let ye=!0;for(let Ie=be.count;Ie--;){const ke=be.glyphAt(Ie);ye&&!ke.glyphObj.isWhitespace&&(be.width=ke.x+ke.width,be.width>_e&&(_e=be.width),ye=!1);let{lineHeight:et,capHeight:ot,xHeight:Pe,baseline:Se}=ke.fontData;et>be.lineHeight&&(be.lineHeight=et);const C=Se-be.baseline;C<0&&(be.baseline+=C,be.cap+=C,be.ex+=C),be.cap=Math.max(be.cap,be.baseline+ot),be.ex=Math.max(be.ex,be.baseline+Pe)}be.baseline-=de,be.cap-=de,be.ex-=de,de+=be.lineHeight});let Te=0,he=0;if(L&&(typeof L=="number"?Te=-L:typeof L=="string"&&(Te=-_e*(L==="left"?0:L==="center"?.5:L==="right"?1:l(L)))),x&&(typeof x=="number"?he=-x:typeof x=="string"&&(he=x==="top"?0:x==="top-baseline"?-Re[0].baseline:x==="top-cap"?-Re[0].cap:x==="top-ex"?-Re[0].ex:x==="middle"?de/2:x==="bottom"?de:x==="bottom-baseline"?-Re[Re.length-1].baseline:l(x)*de)),!V){const be=t.getEmbeddingLevels(A,B);X=new Uint16Array(me),W=new Uint8Array(me),Z=new Float32Array(me*2),Ae={},ee=[1/0,1/0,-1/0,-1/0],Oe=[],fe&&(ae=new Float32Array(A.length*4)),k&&(Be=new Uint8Array(me*3));let ye=0,Ie=-1,ke=-1,et,ot;if(Re.forEach((Pe,Se)=>{let{count:C,width:q}=Pe;if(C>0){let le=0;for(let We=C;We--&&Pe.glyphAt(We).glyphObj.isWhitespace;)le++;let ve=0,Ge=0;if(_==="center")ve=(_e-q)/2;else if(_==="right")ve=_e-q;else if(_==="justify"&&Pe.isSoftWrapped){let We=0;for(let xe=C-le;xe--;)Pe.glyphAt(xe).glyphObj.isWhitespace&&We++;Ge=(_e-q)/We}if(Ge||ve){let We=0;for(let xe=0;xe<C;xe++){let Qe=Pe.glyphAt(xe);const Ye=Qe.glyphObj;Qe.x+=ve+We,Ge!==0&&Ye.isWhitespace&&xe<C-le&&(We+=Ge,Qe.width+=Ge)}}const Q=t.getReorderSegments(A,be,Pe.glyphAt(0).charIndex,Pe.glyphAt(Pe.count-1).charIndex);for(let We=0;We<Q.length;We++){const[xe,Qe]=Q[We];let Ye=1/0,De=-1/0;for(let ze=0;ze<C;ze++)if(Pe.glyphAt(ze).charIndex>=xe){let lt=ze,pt=ze;for(;pt<C;pt++){let ct=Pe.glyphAt(pt);if(ct.charIndex>Qe)break;pt<C-le&&(Ye=Math.min(Ye,ct.x),De=Math.max(De,ct.x+ct.width))}for(let ct=lt;ct<pt;ct++){const Ft=Pe.glyphAt(ct);Ft.x=De-(Ft.x+Ft.width-Ye)}break}}let Ne;const Lt=We=>Ne=We;for(let We=0;We<C;We++){const xe=Pe.glyphAt(We);Ne=xe.glyphObj;const Qe=Ne.index,Ye=be.levels[xe.charIndex]&1;if(Ye){const De=t.getMirroredCharacter(A[xe.charIndex]);De&&xe.fontData.fontObj.forEachGlyph(De,0,0,Lt)}if(fe){const{charIndex:De,fontData:ze}=xe,lt=xe.x+Te,pt=xe.x+xe.width+Te;ae[De*4]=Ye?pt:lt,ae[De*4+1]=Ye?lt:pt,ae[De*4+2]=Pe.baseline+ze.caretBottom+he,ae[De*4+3]=Pe.baseline+ze.caretTop+he;const ct=De-Ie;ct>1&&c(ae,Ie,ct),Ie=De}if(k){const{charIndex:De}=xe;for(;De>ke;)ke++,k.hasOwnProperty(ke)&&(ot=k[ke])}if(!Ne.isWhitespace&&!Ne.isEmpty){const De=ye++,{fontSizeMult:ze,src:lt,index:pt}=xe.fontData,ct=Ae[lt]||(Ae[lt]={});ct[Qe]||(ct[Qe]={path:Ne.path,pathBounds:[Ne.xMin,Ne.yMin,Ne.xMax,Ne.yMax]});const Ft=xe.x+Te,wt=xe.y+Pe.baseline+he;Z[De*2]=Ft,Z[De*2+1]=wt;const Ot=Ft+Ne.xMin*ze,bt=wt+Ne.yMin*ze,It=Ft+Ne.xMax*ze,He=wt+Ne.yMax*ze;Ot<ee[0]&&(ee[0]=Ot),bt<ee[1]&&(ee[1]=bt),It>ee[2]&&(ee[2]=It),He>ee[3]&&(ee[3]=He),De%Y===0&&(et={start:De,end:De,rect:[1/0,1/0,-1/0,-1/0]},Oe.push(et)),et.end++;const At=et.rect;if(Ot<At[0]&&(At[0]=Ot),bt<At[1]&&(At[1]=bt),It>At[2]&&(At[2]=It),He>At[3]&&(At[3]=He),X[De]=Qe,W[De]=pt,k){const Xt=De*3;Be[Xt]=ot>>16&255,Be[Xt+1]=ot>>8&255,Be[Xt+2]=ot&255}}}}}),ae){const Pe=A.length-Ie;Pe>1&&c(ae,Ie,Pe)}}const Xe=[];we.forEach(({index:be,src:ye,unitsPerEm:Ie,ascender:ke,descender:et,lineHeight:ot,capHeight:Pe,xHeight:Se})=>{Xe[be]={src:ye,unitsPerEm:Ie,ascender:ke,descender:et,lineHeight:ot,capHeight:Pe,xHeight:Se}}),U.typesetting=f()-ne,M({glyphIds:X,glyphFontIndices:W,glyphPositions:Z,glyphData:Ae,fontData:Xe,caretPositions:ae,glyphColors:Be,chunkedBounds:Oe,fontSize:b,topBaseline:he+Re[0].baseline,blockBounds:[Te,he-de,Te+_e,he],visibleBounds:ee,timings:U})})}function o(A,v){i({...A,metricsOnly:!0},g=>{const[F,b,S,E]=g.blockBounds;v({width:S-F,height:E-b})})}function l(A){let v=A.match(/^([\d.]+)%$/),g=v?parseFloat(v[1]):NaN;return isNaN(g)?0:g/100}function c(A,v,g){const F=A[v*4],b=A[v*4+1],S=A[v*4+2],E=A[v*4+3],T=(b-F)/g;for(let w=0;w<g;w++){const R=(v+w)*4;A[R]=F+T*w,A[R+1]=F+T*(w+1),A[R+2]=S,A[R+3]=E}}function f(){return(self.performance||Date).now()}function h(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(A){let v=h.flyweight;return v.data=this.data,v.index=A,v},splitAt(A){let v=new h;return v.data=this.data.splice(A*p.length),v}},h.flyweight=p.reduce((A,v,g,F)=>(Object.defineProperty(A,v,{get(){return this.data[this.index*p.length+g]},set(b){this.data[this.index*p.length+g]=b}}),A),{data:null,index:0}),{typeset:i,measure:o}}const fr=()=>(self.performance||Date).now(),En=ii();let fa;function tu(u,t,s,a,r,e,n,i,o,l,c=!0){return c?nu(u,t,s,a,r,e,n,i,o,l).then(null,f=>(fa||(console.warn("WebGL SDF generation failed, falling back to JS",f),fa=!0),da(u,t,s,a,r,e,n,i,o,l))):da(u,t,s,a,r,e,n,i,o,l)}const pn=[],ru=5;let co=0;function li(){const u=fr();for(;pn.length&&fr()-u<ru;)pn.shift()();co=pn.length?setTimeout(li,0):0}const nu=(...u)=>new Promise((t,s)=>{pn.push(()=>{const a=fr();try{En.webgl.generateIntoCanvas(...u),t({timing:fr()-a})}catch(r){s(r)}}),co||(co=setTimeout(li,0))}),ou=4,au=2e3,ha={};let iu=0;function da(u,t,s,a,r,e,n,i,o,l){const c="TroikaTextSDFGenerator_JS_"+iu++%ou;let f=ha[c];return f||(f=ha[c]={workerModule:Mr({name:c,workerId:c,dependencies:[ii,fr],init(h,p){const A=h().javascript.generate;return function(...v){const g=p();return{textureData:A(...v),timing:p()-g}}},getTransferables(h){return[h.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(u,t,s,a,r,e).then(({textureData:h,timing:p})=>{const A=fr(),v=new Uint8Array(h.length*4);for(let g=0;g<h.length;g++)v[g*4+l]=h[g];return En.webglUtils.renderImageData(n,v,i,o,u,t,1<<3-l),p+=fr()-A,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Oc(c)},au)),{timing:p}})}function su(u){u._warm||(En.webgl.isSupported(u),u._warm=!0)}const lu=En.webglUtils.resizeWebGLCanvasWithoutClearing,Br={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},cu=new jt;function gr(){return(self.performance||Date).now()}const pa=Object.create(null);function ci(u,t){u=hu({},u);const s=gr(),{defaultFontURL:a}=Br,r=[];if(a&&r.push({label:"default",src:Aa(a)}),u.font&&r.push({label:"user",src:Aa(u.font)}),u.font=r,u.text=""+u.text,u.sdfGlyphSize=u.sdfGlyphSize||Br.sdfGlyphSize,u.unicodeFontsURL=u.unicodeFontsURL||Br.unicodeFontsURL,u.colorRanges!=null){let h={};for(let p in u.colorRanges)if(u.colorRanges.hasOwnProperty(p)){let A=u.colorRanges[p];typeof A!="number"&&(A=cu.set(A).getHex()),h[p]=A}u.colorRanges=h}Object.freeze(u);const{textureWidth:e,sdfExponent:n}=Br,{sdfGlyphSize:i}=u,o=e/i*4;let l=pa[i];if(!l){const h=document.createElement("canvas");h.width=e,h.height=i*256/o,l=pa[i]={glyphCount:0,sdfGlyphSize:i,sdfCanvas:h,sdfTexture:new Dt(h,void 0,void 0,void 0,Tt,Tt),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,uu(l)}const{sdfTexture:c,sdfCanvas:f}=l;pu(u).then(h=>{const{glyphIds:p,glyphFontIndices:A,fontData:v,glyphPositions:g,fontSize:F,timings:b}=h,S=[],E=new Float32Array(p.length*4);let T=0,w=0;const R=gr(),B=v.map(L=>{let x=l.glyphsByFont.get(L.src);return x||l.glyphsByFont.set(L.src,x=new Map),x});p.forEach((L,x)=>{const V=A[x],{src:j,unitsPerEm:ue}=v[V];let fe=B[V].get(L);if(!fe){const{path:U,pathBounds:H}=h.glyphData[j][L],P=Math.max(H[2]-H[0],H[3]-H[1])/i*(Br.sdfMargin*i+.5),X=l.glyphCount++,W=[H[0]-P,H[1]-P,H[2]+P,H[3]+P];B[V].set(L,fe={path:U,atlasIndex:X,sdfViewBox:W}),S.push(fe)}const{sdfViewBox:Y}=fe,k=g[w++],M=g[w++],G=F/ue;E[T++]=k+Y[0]*G,E[T++]=M+Y[1]*G,E[T++]=k+Y[2]*G,E[T++]=M+Y[3]*G,p[x]=fe.atlasIndex}),b.quads=(b.quads||0)+(gr()-R);const _=gr();b.sdf={};const D=f.height,z=Math.ceil(l.glyphCount/o),I=Math.pow(2,Math.ceil(Math.log2(z*i)));I>D&&(console.info(`Increasing SDF texture size ${D}->${I}`),lu(f,e,I),c.dispose()),Promise.all(S.map(L=>ui(L,l,u.gpuAccelerateSDF).then(({timing:x})=>{b.sdf[L.atlasIndex]=x}))).then(()=>{S.length&&!l.contextLost&&(fi(l),c.needsUpdate=!0),b.sdfTotal=gr()-_,b.total=gr()-s,t(Object.freeze({parameters:u,sdfTexture:c,sdfGlyphSize:i,sdfExponent:n,glyphBounds:E,glyphAtlasIndices:p,glyphColors:h.glyphColors,caretPositions:h.caretPositions,chunkedBounds:h.chunkedBounds,ascender:h.ascender,descender:h.descender,lineHeight:h.lineHeight,capHeight:h.capHeight,xHeight:h.xHeight,topBaseline:h.topBaseline,blockBounds:h.blockBounds,visibleBounds:h.visibleBounds,timings:h.timings}))})}),Promise.resolve().then(()=>{l.contextLost||su(f)})}function ui({path:u,atlasIndex:t,sdfViewBox:s},{sdfGlyphSize:a,sdfCanvas:r,contextLost:e},n){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:o}=Br,l=Math.max(s[2]-s[0],s[3]-s[1]),c=Math.floor(t/4),f=c%(i/a)*a,h=Math.floor(c/(i/a))*a,p=t%4;return tu(a,a,u,s,l,o,r,f,h,p,n)}function uu(u){const t=u.sdfCanvas;t.addEventListener("webglcontextlost",s=>{console.log("Context Lost",s),s.preventDefault(),u.contextLost=!0}),t.addEventListener("webglcontextrestored",s=>{console.log("Context Restored",s),u.contextLost=!1;const a=[];u.glyphsByFont.forEach(r=>{r.forEach(e=>{a.push(ui(e,u,!0))})}),Promise.all(a).then(()=>{fi(u),u.sdfTexture.needsUpdate=!0})})}function fu({font:u,characters:t,sdfGlyphSize:s},a){let r=Array.isArray(t)?t.join(`
`):""+t;ci({font:u,sdfGlyphSize:s,text:r},a)}function hu(u,t){for(let s in t)t.hasOwnProperty(s)&&(u[s]=t[s]);return u}let sn;function Aa(u){return sn||(sn=typeof document>"u"?{}:document.createElement("a")),sn.href=u,sn.href}function fi(u){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:s}=u,{width:a,height:r}=t,e=u.sdfCanvas.getContext("webgl");let n=s.image.data;(!n||n.length!==a*r*4)&&(n=new Uint8Array(a*r*4),s.image={width:a,height:r,data:n},s.flipY=!1,s.isDataTexture=!0),e.readPixels(0,0,a,r,e.RGBA,e.UNSIGNED_BYTE,n)}}const du=Mr({name:"Typesetter",dependencies:[eu,$c,Pc],init(u,t,s){return u(t,s())}}),pu=Mr({name:"Typesetter",dependencies:[du],init(u){return function(t){return new Promise(s=>{u.typeset(t,s)})}},getTransferables(u){const t=[];for(let s in u)u[s]&&u[s].buffer&&t.push(u[s].buffer);return t}}),ma={};function Au(u){let t=ma[u];if(!t){const s=new Yr(1,1,u,u),a=s.clone(),r=s.attributes,e=a.attributes,n=new ho,i=r.uv.count;for(let o=0;o<i;o++)e.position.array[o*3]*=-1,e.normal.array[o*3+2]*=-1;["position","normal","uv"].forEach(o=>{n.setAttribute(o,new Ds([...r[o].array,...e[o].array],r[o].itemSize))}),n.setIndex([...s.index.array,...a.index.array.map(o=>o+i)]),n.translate(.5,.5,0),t=ma[u]=n}return t}const mu="aTroikaGlyphBounds",ga="aTroikaGlyphIndex",gu="aTroikaGlyphColor";class vu extends Is{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ha,this.boundingBox=new Pa}computeBoundingSphere(){}computeBoundingBox(){}setSide(t){const s=this.getIndex().count;this.setDrawRange(t===Ss?s/2:0,t===Cn?s:s/2)}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let s=Au(t);["position","normal","uv"].forEach(a=>{this.attributes[a]=s.attributes[a].clone()}),this.setIndex(s.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,s,a,r,e){Xn(this,mu,t,4),Xn(this,ga,s,1),Xn(this,gu,e,3),this._blockBounds=a,this._chunkedBounds=r,this.instanceCount=s.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:s,boundingBox:a}=this;if(s){const{PI:r,floor:e,min:n,max:i,sin:o,cos:l}=Math,c=r/2,f=r*2,h=Math.abs(s),p=t[0]/h,A=t[2]/h,v=e((p+c)/f)!==e((A+c)/f)?-h:n(o(p)*h,o(A)*h),g=e((p-c)/f)!==e((A-c)/f)?h:i(o(p)*h,o(A)*h),F=e((p+r)/f)!==e((A+r)/f)?h*2:i(h-l(p)*h,h-l(A)*h);a.min.set(v,t[1],s<0?-F:0),a.max.set(g,t[3],s<0?0:F)}else a.min.set(t[0],t[1],0),a.max.set(t[2],t[3],0);a.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let s=this.getAttribute(ga).count,a=this._chunkedBounds;if(a)for(let r=a.length;r--;){s=a[r].end;let e=a[r].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=s}}function Xn(u,t,s,a){const r=u.getAttribute(t);s?r&&r.array.length===s.length?(r.array.set(s),r.needsUpdate=!0):(u.setAttribute(t,new xa(s,a)),delete u._maxInstanceCount,u.dispose()):r&&u.deleteAttribute(t)}const Bu=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Cu=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,bu=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Eu=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function yu(u){const t=lo(u,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new vt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Jo(0,0,0,0)},uTroikaClipRect:{value:new Jo(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new vt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new jt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new _s},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Bu,vertexTransform:Cu,fragmentDefs:bu,fragmentColorTransform:Eu,customRewriter({vertexShader:s,fragmentShader:a}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(a)&&(a=a.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(s)||(s=s.replace(si,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:s,fragmentShader:a}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const vo=new cr({color:16777215,side:Cn,transparent:!0}),va=8421504,Ba=new Wr,ln=new at,Wn=new at,Gr=[],Mu=new at,Qn="+x+y";function Ca(u){return Array.isArray(u)?u[0]:u}let hi=()=>{const u=new hr(new Yr(1,1),vo);return hi=()=>u,u},di=()=>{const u=new hr(new Yr(1,1,32,1),vo);return di=()=>u,u};const Tu={type:"syncstart"},Fu={type:"synccomplete"},pi=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],wu=pi.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Ai=class extends hr{constructor(){const t=new vu;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=va,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Qn,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(Tu),ci({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},s=>{this._isSyncing=!1,this._textRenderInfo=s,this.geometry.updateGlyphs(s.glyphBounds,s.glyphAtlasIndices,s.blockBounds,s.chunkedBounds,s.glyphColors);const a=this._queuedSyncs;a&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{a.forEach(r=>r&&r())})),this.dispatchEvent(Fu),t&&t()})))}onBeforeRender(t,s,a,r,e,n){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e),e._hadOwnSide=e.hasOwnProperty("side"),this.geometry.setSide(e._actualSide=e.side),e.side=ka}onAfterRender(t,s,a,r,e,n){e._hadOwnSide?e.side=e._actualSide:delete e.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let t=this._derivedMaterial;const s=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=vo.clone());if((!t||t.baseMaterial!==s)&&(t=this._derivedMaterial=yu(s),s.addEventListener("dispose",function a(){s.removeEventListener("dispose",a),t.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let a=t._outlineMtl;return a||(a=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),a.isTextOutlineMaterial=!0,a.depthWrite=!1,a.map=null,t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),a.dispose()})),[a,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return Ca(this.material).getDepthMaterial()}get customDistanceMaterial(){return Ca(this.material).getDistanceMaterial()}_prepareForRender(t){const s=t.isTextOutlineMaterial,a=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:i,blockBounds:o}=r;a.uTroikaSDFTexture.value=i,a.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),a.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,a.uTroikaSDFExponent.value=r.sdfExponent,a.uTroikaTotalBounds.value.fromArray(o),a.uTroikaUseGlyphColors.value=!s&&!!r.glyphColors;let l=0,c=0,f=0,h,p,A,v=0,g=0;if(s){let{outlineWidth:b,outlineOffsetX:S,outlineOffsetY:E,outlineBlur:T,outlineOpacity:w}=this;l=this._parsePercent(b)||0,c=Math.max(0,this._parsePercent(T)||0),h=w,v=this._parsePercent(S)||0,g=this._parsePercent(E)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(A=this.strokeColor,a.uTroikaStrokeColor.value.set(A??va),p=this.strokeOpacity,p==null&&(p=1)),h=this.fillOpacity;a.uTroikaDistanceOffset.value=l,a.uTroikaPositionOffset.value.set(v,g),a.uTroikaBlurRadius.value=c,a.uTroikaStrokeWidth.value=f,a.uTroikaStrokeOpacity.value=p,a.uTroikaFillOpacity.value=h??1,a.uTroikaCurveRadius.value=this.curveRadius||0;let F=this.clipRect;if(F&&Array.isArray(F)&&F.length===4)a.uTroikaClipRect.value.fromArray(F);else{const b=(this.fontSize||.1)*100;a.uTroikaClipRect.value.set(o[0]-b,o[1]-b,o[2]+b,o[3]+b)}this.geometry.applyClipRect(a.uTroikaClipRect.value)}a.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=s?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const i=t.hasOwnProperty("color")?t.color:t.color=new jt;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let n=this.orientation||Qn;if(n!==t._orientation){let i=a.uTroikaOrient.value;n=n.replace(/[^-+xyz]/g,"");let o=n!==Qn&&n.match(/^([-+])([xyz])([-+])([xyz])$/);if(o){let[,l,c,f,h]=o;ln.set(0,0,0)[c]=l==="-"?1:-1,Wn.set(0,0,0)[h]=f==="-"?-1:1,Ba.lookAt(Mu,ln.cross(Wn),Wn),i.setFromMatrix4(Ba)}else i.identity();t._orientation=n}}_parsePercent(t){if(typeof t=="string"){let s=t.match(/^(-?[\d.]+)%$/),a=s?parseFloat(s[1]):NaN;t=(isNaN(a)?0:a/100)*this.fontSize}return t}localPositionToTextCoords(t,s=new vt){s.copy(t);const a=this.curveRadius;return a&&(s.x=Math.atan2(t.x,Math.abs(a)-Math.abs(t.z))*Math.abs(a)),s}worldPositionToTextCoords(t,s=new vt){return ln.copy(t),this.localPositionToTextCoords(this.worldToLocal(ln),s)}raycast(t,s){const{textRenderInfo:a,curveRadius:r}=this;if(a){const e=a.blockBounds,n=r?di():hi(),i=n.geometry,{position:o,uv:l}=i.attributes;for(let c=0;c<l.count;c++){let f=e[0]+l.getX(c)*(e[2]-e[0]);const h=e[1]+l.getY(c)*(e[3]-e[1]);let p=0;r&&(p=r-Math.cos(f/r)*r,f=Math.sin(f/r)*r),o.setXYZ(c,f,h,p)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,n.matrixWorld=this.matrixWorld,n.material.side=this.material.side,Gr.length=0,n.raycast(t,Gr);for(let c=0;c<Gr.length;c++)Gr[c].object=this,s.push(Gr[c])}}copy(t){const s=this.geometry;return super.copy(t),this.geometry=s,wu.forEach(a=>{this[a]=t[a]}),this}clone(){return new this.constructor().copy(this)}};pi.forEach(u=>{const t="_private_"+u;Object.defineProperty(Ai.prototype,u,{get(){return this[t]},set(s){s!==this[t]&&(this[t]=s,this._needsSync=!0)}})});const Jt=oe.forwardRef(({sdfGlyphSize:u=64,anchorX:t="center",anchorY:s="middle",font:a,fontSize:r=1,children:e,characters:n,onSync:i,...o},l)=>{const c=Ct(({invalidate:A})=>A),[f]=oe.useState(()=>new Ai),[h,p]=oe.useMemo(()=>{const A=[];let v="";return oe.Children.forEach(e,g=>{typeof g=="string"||typeof g=="number"?v+=g:A.push(g)}),[A,v]},[e]);return Rs(()=>new Promise(A=>fu({font:a,characters:n},A)),["troika-text",a,n]),oe.useLayoutEffect(()=>void f.sync(()=>{c(),i&&i(f)})),oe.useEffect(()=>()=>f.dispose(),[f]),oe.createElement("primitive",Ao({object:f,ref:l,font:a,text:p,anchorX:t,anchorY:s,fontSize:r,sdfGlyphSize:u},o),h)}),Yn=u=>u===Object(u)&&!Array.isArray(u)&&typeof u!="function";function Er(u,t){const s=Ct(e=>e.gl),a=ir(bn,Yn(u)?Object.values(u):u);return oe.useLayoutEffect(()=>{t==null||t(a)},[t]),oe.useEffect(()=>{if("initTexture"in s){let e=[];Array.isArray(a)?e=a:a instanceof Dt?e=[a]:Yn(a)&&(e=Object.values(a)),e.forEach(n=>{n instanceof Dt&&s.initTexture(n)})}},[s,a]),oe.useMemo(()=>{if(Yn(u)){const e={};let n=0;for(const i in u)e[i]=a[n++];return e}else return a},[u,a])}Er.preload=u=>ir.preload(bn,u);Er.clear=u=>ir.clear(bn,u);let cn=null,mi="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function gi(u,t,s){return a=>{s&&s(a),u&&(cn||(cn=new Dc),cn.setDecoderPath(typeof u=="string"?u:mi),a.setDRACOLoader(cn)),t&&a.setMeshoptDecoder(typeof jn=="function"?jn():jn)}}function yn(u,t=!0,s=!0,a){return ir(go,u,gi(t,s,a))}yn.preload=(u,t=!0,s=!0,a)=>ir.preload(go,u,gi(t,s,a));yn.clear=u=>ir.clear(go,u);yn.setDecoderPath=u=>{mi=u};const Iu=oe.forwardRef(({makeDefault:u,camera:t,regress:s,domElement:a,enableDamping:r=!0,keyEvents:e=!1,onChange:n,onStart:i,onEnd:o,...l},c)=>{const f=Ct(w=>w.invalidate),h=Ct(w=>w.camera),p=Ct(w=>w.gl),A=Ct(w=>w.events),v=Ct(w=>w.setEvents),g=Ct(w=>w.set),F=Ct(w=>w.get),b=Ct(w=>w.performance),S=t||h,E=a||A.connected||p.domElement,T=oe.useMemo(()=>new Ql(S),[S]);return po(()=>{T.enabled&&T.update()},-1),oe.useEffect(()=>(e&&T.connect(e===!0?E:e),T.connect(E),()=>void T.dispose()),[e,E,s,T,f]),oe.useEffect(()=>{const w=_=>{f(),s&&b.regress(),n&&n(_)},R=_=>{i&&i(_)},B=_=>{o&&o(_)};return T.addEventListener("change",w),T.addEventListener("start",R),T.addEventListener("end",B),()=>{T.removeEventListener("start",R),T.removeEventListener("end",B),T.removeEventListener("change",w)}},[n,i,o,T,f,v]),oe.useEffect(()=>{if(u){const w=F().controls;return g({controls:T}),()=>g({controls:w})}},[u,T]),oe.createElement("primitive",Ao({ref:c,object:T,enableDamping:r},l))}),Su=3e3,_u=3001,vi=(u,t,s)=>{let a;switch(u){case eo:a=new Uint8ClampedArray(t*s*4);break;case Ut:a=new Uint16Array(t*s*4);break;case ks:a=new Uint32Array(t*s*4);break;case Os:a=new Int8Array(t*s*4);break;case Ls:a=new Int16Array(t*s*4);break;case Us:a=new Int32Array(t*s*4);break;case Zt:a=new Float32Array(t*s*4);break;default:throw new Error("Unsupported data type")}return a};let un;const Du=(u,t,s,a)=>{if(un!==void 0)return un;const r=new ja(1,1,a);t.setRenderTarget(r);const e=new hr(new Yr,new cr({color:16777215}));t.render(e,s),t.setRenderTarget(null);const n=vi(u,r.width,r.height);return t.readRenderTargetPixels(r,0,0,r.width,r.height,n),r.dispose(),e.geometry.dispose(),e.material.dispose(),un=n[0]!==0,un};class Bo{constructor(t){var s,a,r,e,n,i,o,l,c,f,h,p,A,v,g,F;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(S){throw this._renderer.setRenderTarget(null),S}this._renderer.setRenderTarget(null)},this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const b={format:Qr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((s=t.renderTargetOptions)===null||s===void 0?void 0:s.anisotropy)!==void 0?(a=t.renderTargetOptions)===null||a===void 0?void 0:a.anisotropy:1,generateMipmaps:((r=t.renderTargetOptions)===null||r===void 0?void 0:r.generateMipmaps)!==void 0?(e=t.renderTargetOptions)===null||e===void 0?void 0:e.generateMipmaps:!1,magFilter:((n=t.renderTargetOptions)===null||n===void 0?void 0:n.magFilter)!==void 0?(i=t.renderTargetOptions)===null||i===void 0?void 0:i.magFilter:Tt,minFilter:((o=t.renderTargetOptions)===null||o===void 0?void 0:o.minFilter)!==void 0?(l=t.renderTargetOptions)===null||l===void 0?void 0:l.minFilter:Tt,samples:((c=t.renderTargetOptions)===null||c===void 0?void 0:c.samples)!==void 0?(f=t.renderTargetOptions)===null||f===void 0?void 0:f.samples:void 0,wrapS:((h=t.renderTargetOptions)===null||h===void 0?void 0:h.wrapS)!==void 0?(p=t.renderTargetOptions)===null||p===void 0?void 0:p.wrapS:Yt,wrapT:((A=t.renderTargetOptions)===null||A===void 0?void 0:A.wrapT)!==void 0?(v=t.renderTargetOptions)===null||v===void 0?void 0:v.wrapT:Yt};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=Bo.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Ja,this._camera=new Cr,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Du(this._type,this._renderer,this._camera,b)){let S;switch(this._type){case Ut:S=this._renderer.extensions.has("EXT_color_buffer_float")?Zt:void 0;break}S!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Zt}`),this._type=S):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new hr(new Yr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new ja(this.width,this.height,b),this._renderTarget.texture.mapping=((g=t.renderTargetOptions)===null||g===void 0?void 0:g.mapping)!==void 0?(F=t.renderTargetOptions)===null||F===void 0?void 0:F.mapping:gn}static instantiateRenderer(){const t=new xs;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=vi(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const s=new Gs(this.toArray(),this.width,this.height,Qr,this._type,(t==null?void 0:t.mapping)||gn,(t==null?void 0:t.wrapS)||Yt,(t==null?void 0:t.wrapT)||Yt,(t==null?void 0:t.magFilter)||Tt,(t==null?void 0:t.minFilter)||Tt,(t==null?void 0:t.anisotropy)||1,$n);return s.generateMipmaps=(t==null?void 0:t.generateMipmaps)!==void 0?t==null?void 0:t.generateMipmaps:!1,s}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof uo&&Object.values(this.material.uniforms).forEach(s=>{s.value instanceof Dt&&s.value.dispose()}),Object.values(this.material).forEach(s=>{s instanceof Dt&&s.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Ru=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,xu=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Gu extends uo{constructor({gamma:t,offsetHdr:s,offsetSdr:a,gainMapMin:r,gainMapMax:e,maxDisplayBoost:n,hdrCapacityMin:i,hdrCapacityMax:o,sdr:l,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:Ru,fragmentShader:xu,uniforms:{sdr:{value:l},gainMap:{value:c},gamma:{value:new at(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new at().fromArray(s)},offsetSdr:{value:new at().fromArray(a)},gainMapMin:{value:new at().fromArray(r)},gainMapMax:{value:new at().fromArray(e)},weightFactor:{value:(Math.log2(n)-i)/(o-i)}},blending:Hs,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=n,this._hdrCapacityMin=i,this._hdrCapacityMax=o,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const s=this.uniforms.gamma.value;s.x=1/t[0],s.y=1/t[1],s.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class Bi extends Error{}class Ci extends Error{}const Ur=(u,t,s)=>{var a;let r;const e=(a=u.attributes.getNamedItem(t))===null||a===void 0?void 0:a.nodeValue;if(e)r=e;else{const n=u.getElementsByTagName(t)[0];if(n){const i=n.getElementsByTagName("rdf:li");if(i.length===3)r=Array.from(i).map(o=>o.innerHTML);else throw new Error(`Gainmap metadata contains an array of items for ${t} but its length is not 3`)}else{if(s)return s;throw new Error(`Can't find ${t} in gainmap metadata`)}}return r},Uu=u=>{var t,s;let a;typeof TextDecoder<"u"?a=new TextDecoder().decode(u):a=u.toString();let r=a.indexOf("<x:xmpmeta");const e=new DOMParser;for(;r!==-1;){const n=a.indexOf("x:xmpmeta>",r);a.slice(r,n+10);const i=a.slice(r,n+10);try{const l=e.parseFromString(i,"text/xml").getElementsByTagName("rdf:Description")[0],c=Ur(l,"hdrgm:GainMapMin","0"),f=Ur(l,"hdrgm:GainMapMax"),h=Ur(l,"hdrgm:Gamma","1"),p=Ur(l,"hdrgm:OffsetSDR","0.015625"),A=Ur(l,"hdrgm:OffsetHDR","0.015625");let v=(t=l.attributes.getNamedItem("hdrgm:HDRCapacityMin"))===null||t===void 0?void 0:t.nodeValue;v||(v="0");const g=(s=l.attributes.getNamedItem("hdrgm:HDRCapacityMax"))===null||s===void 0?void 0:s.nodeValue;if(!g)throw new Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(c)?c.map(F=>parseFloat(F)):[parseFloat(c),parseFloat(c),parseFloat(c)],gainMapMax:Array.isArray(f)?f.map(F=>parseFloat(F)):[parseFloat(f),parseFloat(f),parseFloat(f)],gamma:Array.isArray(h)?h.map(F=>parseFloat(F)):[parseFloat(h),parseFloat(h),parseFloat(h)],offsetSdr:Array.isArray(p)?p.map(F=>parseFloat(F)):[parseFloat(p),parseFloat(p),parseFloat(p)],offsetHdr:Array.isArray(A)?A.map(F=>parseFloat(F)):[parseFloat(A),parseFloat(A),parseFloat(A)],hdrCapacityMin:parseFloat(v),hdrCapacityMax:parseFloat(g)}}catch{}r=a.indexOf("<x:xmpmeta",n)}};class Lu{constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((s,a)=>{const r=this.options.debug,e=new DataView(t.buffer);if(e.getUint16(0)!==65496){a(new Error("Not a valid jpeg"));return}const n=e.byteLength;let i=2,o=0,l;for(;i<n;){if(++o>250){a(new Error(`Found no marker after ${o} loops 😵`));return}if(e.getUint8(i)!==255){a(new Error(`Not a valid marker at offset 0x${i.toString(16)}, found: 0x${e.getUint8(i).toString(16)}`));return}if(l=e.getUint8(i+1),r&&console.log(`Marker: ${l.toString(16)}`),l===226){r&&console.log("Found APP2 marker (0xffe2)");const c=i+4;if(e.getUint32(c)===1297106432){const f=c+4;let h;if(e.getUint16(f)===18761)h=!1;else if(e.getUint16(f)===19789)h=!0;else{a(new Error("No valid endianness marker found in TIFF header"));return}if(e.getUint16(f+2,!h)!==42){a(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const p=e.getUint32(f+4,!h);if(p<8){a(new Error("Not valid TIFF data! (First offset less than 8)"));return}const A=f+p,v=e.getUint16(A,!h),g=A+2;let F=0;for(let T=g;T<g+12*v;T+=12)e.getUint16(T,!h)===45057&&(F=e.getUint32(T+8,!h));const S=A+2+v*12+4,E=[];for(let T=S;T<S+F*16;T+=16){const w={MPType:e.getUint32(T,!h),size:e.getUint32(T+4,!h),dataOffset:e.getUint32(T+8,!h),dependantImages:e.getUint32(T+12,!h),start:-1,end:-1,isFII:!1};w.dataOffset?(w.start=f+w.dataOffset,w.isFII=!1):(w.start=0,w.isFII=!0),w.end=w.start+w.size,E.push(w)}if(this.options.extractNonFII&&E.length){const T=new Blob([e]),w=[];for(const R of E){if(R.isFII&&!this.options.extractFII)continue;const B=T.slice(R.start,R.end+1,"image/jpeg");w.push(B)}s(w)}}}i+=2+e.getUint16(i+2)}})}}const Ou=async u=>{const t=Uu(u);if(!t)throw new Ci("Gain map XMP metadata not found");const a=await new Lu({extractFII:!0,extractNonFII:!0}).extract(u);if(a.length!==2)throw new Bi("Gain map recovery image not found");return{sdr:new Uint8Array(await a[0].arrayBuffer()),gainMap:new Uint8Array(await a[1].arrayBuffer()),metadata:t}},ba=u=>new Promise((t,s)=>{const a=document.createElement("img");a.onload=()=>{t(a)},a.onerror=r=>{s(r)},a.src=URL.createObjectURL(u)});class bi extends fo{constructor(t,s){super(s),t&&(this._renderer=t),this._internalLoadingManager=new Ps}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=new Gu({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Dt,sdr:new Dt});return new Bo({width:16,height:16,type:Ut,colorSpace:$n,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(t,s,a,r){const e=r?new Blob([r],{type:"image/jpeg"}):void 0,n=new Blob([a],{type:"image/jpeg"});let i,o,l=!1;if(typeof createImageBitmap>"u"){const h=await Promise.all([e?ba(e):Promise.resolve(void 0),ba(n)]);o=h[0],i=h[1],l=!0}else{const h=await Promise.all([e?createImageBitmap(e,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(n,{imageOrientation:"flipY"})]);o=h[0],i=h[1]}const c=new Dt(o||new ImageData(2,2),gn,Yt,Yt,Tt,jo,Qr,eo,1,$n);c.flipY=l,c.needsUpdate=!0;const f=new Dt(i,gn,Yt,Yt,Tt,jo,Qr,eo,1,Ka);f.flipY=l,f.needsUpdate=!0,t.width=i.width,t.height=i.height,t.material.gainMap=c,t.material.sdr=f,t.material.gainMapMin=s.gainMapMin,t.material.gainMapMax=s.gainMapMax,t.material.offsetHdr=s.offsetHdr,t.material.offsetSdr=s.offsetSdr,t.material.gamma=s.gamma,t.material.hdrCapacityMin=s.hdrCapacityMin,t.material.hdrCapacityMax=s.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,s.hdrCapacityMax),t.material.needsUpdate=!0,t.render()}}class ku extends bi{load([t,s,a],r,e,n){const i=this.prepareQuadRenderer();let o,l,c;const f=async()=>{if(o&&l&&c){try{await this.render(i,c,o,l)}catch(_){this.manager.itemError(t),this.manager.itemError(s),this.manager.itemError(a),typeof n=="function"&&n(_),i.disposeOnDemandRenderer();return}typeof r=="function"&&r(i),this.manager.itemEnd(t),this.manager.itemEnd(s),this.manager.itemEnd(a),i.disposeOnDemandRenderer()}};let h=!0,p=0,A=0,v=!0,g=0,F=0,b=!0,S=0,E=0;const T=()=>{if(typeof e=="function"){const _=p+g+S,D=A+F+E,z=h&&v&&b;e(new ProgressEvent("progress",{lengthComputable:z,loaded:D,total:_}))}};this.manager.itemStart(t),this.manager.itemStart(s),this.manager.itemStart(a);const w=new ar(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(t,async _=>{if(typeof _=="string")throw new Error("Invalid sdr buffer");o=_,await f()},_=>{h=_.lengthComputable,A=_.loaded,p=_.total,T()},_=>{this.manager.itemError(t),typeof n=="function"&&n(_)});const R=new ar(this._internalLoadingManager);R.setResponseType("arraybuffer"),R.setRequestHeader(this.requestHeader),R.setPath(this.path),R.setWithCredentials(this.withCredentials),R.load(s,async _=>{if(typeof _=="string")throw new Error("Invalid gainmap buffer");l=_,await f()},_=>{v=_.lengthComputable,F=_.loaded,g=_.total,T()},_=>{this.manager.itemError(s),typeof n=="function"&&n(_)});const B=new ar(this._internalLoadingManager);return B.setRequestHeader(this.requestHeader),B.setPath(this.path),B.setWithCredentials(this.withCredentials),B.load(a,async _=>{if(typeof _!="string")throw new Error("Invalid metadata string");c=JSON.parse(_),await f()},_=>{b=_.lengthComputable,E=_.loaded,S=_.total,T()},_=>{this.manager.itemError(a),typeof n=="function"&&n(_)}),i}}class Pu extends bi{load(t,s,a,r){const e=this.prepareQuadRenderer(),n=new ar(this._internalLoadingManager);return n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setPath(this.path),n.setWithCredentials(this.withCredentials),this.manager.itemStart(t),n.load(t,async i=>{if(typeof i=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const o=new Uint8Array(i);let l,c,f;try{const h=await Ou(o);l=h.sdr,c=h.gainMap,f=h.metadata}catch(h){if(h instanceof Ci||h instanceof Bi)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),f={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},l=o;else throw h}try{await this.render(e,f,l,c)}catch(h){this.manager.itemError(t),typeof r=="function"&&r(h),e.disposeOnDemandRenderer();return}typeof s=="function"&&s(e),this.manager.itemEnd(t),e.disposeOnDemandRenderer()},a,i=>{this.manager.itemError(t),typeof r=="function"&&r(i)}),e}}const zn={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Hu="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",fn=u=>Array.isArray(u);function Ei({files:u=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:t="",preset:s=void 0,encoding:a=void 0,extensions:r}={}){var e;let n=null,i=!1;if(s){if(!(s in zn))throw new Error("Preset must be one of: "+Object.keys(zn).join(", "));u=zn[s],t=Hu}const o=fn(u)&&u.length===6,l=fn(u)&&u.length===3&&u.some(g=>g.endsWith("json")),c=fn(u)?u[0]:u;i=fn(u);const f=o?"cube":l?"webp":c.startsWith("data:application/exr")?"exr":c.startsWith("data:application/hdr")?"hdr":c.startsWith("data:image/jpeg")?"jpg":(e=c.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase();if(n=f==="cube"?js:f==="hdr"?Sc:f==="exr"?_c:f==="jpg"||f==="jpeg"?Pu:f==="webp"?ku:null,!n)throw new Error("useEnvironment: Unrecognized file extension: "+u);const h=Ct(g=>g.gl);oe.useLayoutEffect(()=>{if(f!=="webp"&&f!=="jpg"&&f!=="jpeg")return;function g(){ir.clear(n,i?[u]:u)}h.domElement.addEventListener("webglcontextlost",g,{once:!0})},[u,h.domElement]);const p=ir(n,i?[u]:u,g=>{(f==="webp"||f==="jpg"||f==="jpeg")&&g.setRenderer(h),g.setPath==null||g.setPath(t),r&&r(g)});let A=i?p[0]:p;if(f==="jpg"||f==="jpeg"||f==="webp"){var v;A=(v=A.renderTarget)==null?void 0:v.texture}return A.mapping=o?Ns:Js,"colorSpace"in A?A.colorSpace=a??o?"srgb":"srgb-linear":A.encoding=a??o?_u:Su,A}const Nu=u=>u.current&&u.current.isScene,Ju=u=>Nu(u)?u.current:u;function Co(u,t,s,a,r={}){var e,n,i,o,l;r={backgroundBlurriness:(e=r.blur)!==null&&e!==void 0?e:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const c=Ju(t||s),f=c.background,h=c.environment,p={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:(n=(i=c.backgroundRotation)==null||i.clone==null?void 0:i.clone())!==null&&n!==void 0?n:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:(o=(l=c.environmentRotation)==null||l.clone==null?void 0:l.clone())!==null&&o!==void 0?o:[0,0,0]};return u!=="only"&&(c.environment=a),u&&(c.background=a),Ko(c,r),()=>{u!=="only"&&(c.environment=h),u&&(c.background=f),Ko(c,p)}}function bo({scene:u,background:t=!1,map:s,...a}){const r=Ct(e=>e.scene);return oe.useLayoutEffect(()=>{if(s)return Co(t,u,r,s,a)}),null}function yi({background:u=!1,scene:t,blur:s,backgroundBlurriness:a,backgroundIntensity:r,backgroundRotation:e,environmentIntensity:n,environmentRotation:i,...o}){const l=Ei(o),c=Ct(f=>f.scene);return oe.useLayoutEffect(()=>Co(u,t,c,l,{blur:s,backgroundBlurriness:a,backgroundIntensity:r,backgroundRotation:e,environmentIntensity:n,environmentRotation:i})),null}function ju({children:u,near:t=1,far:s=1e3,resolution:a=256,frames:r=1,map:e,background:n=!1,blur:i,backgroundBlurriness:o,backgroundIntensity:l,backgroundRotation:c,environmentIntensity:f,environmentRotation:h,scene:p,files:A,path:v,preset:g=void 0,extensions:F}){const b=Ct(B=>B.gl),S=Ct(B=>B.scene),E=oe.useRef(null),[T]=oe.useState(()=>new Ja),w=oe.useMemo(()=>{const B=new Ks(a);return B.texture.type=Ut,B},[a]);oe.useLayoutEffect(()=>(r===1&&E.current.update(b,T),Co(n,p,S,w.texture,{blur:i,backgroundBlurriness:o,backgroundIntensity:l,backgroundRotation:c,environmentIntensity:f,environmentRotation:h})),[u,T,w.texture,p,S,n,r,b]);let R=1;return po(()=>{(r===1/0||R<r)&&(E.current.update(b,T),R++)}),oe.createElement(oe.Fragment,null,Xs(oe.createElement(oe.Fragment,null,u,oe.createElement("cubeCamera",{ref:E,args:[t,s,w]}),A||g?oe.createElement(yi,{background:!0,files:A,preset:g,path:v,extensions:F}):e?oe.createElement(bo,{background:!0,map:e,extensions:F}):null),T))}function Ku(u){var t,s,a,r;const e=Ei(u),n=u.map||e;oe.useMemo(()=>_a({GroundProjectedEnvImpl:jl}),[]);const i=oe.useMemo(()=>[n],[n]),o=(t=u.ground)==null?void 0:t.height,l=(s=u.ground)==null?void 0:s.radius,c=(a=(r=u.ground)==null?void 0:r.scale)!==null&&a!==void 0?a:1e3;return oe.createElement(oe.Fragment,null,oe.createElement(bo,Ao({},u,{map:n})),oe.createElement("groundProjectedEnvImpl",{args:i,scale:c,height:o,radius:l}))}function Xu(u){return u.ground?oe.createElement(Ku,u):u.map?oe.createElement(bo,u):u.children?oe.createElement(ju,u):oe.createElement(yi,u)}TextDecoder.prototype.decode.bind(new TextDecoder);const Wu=TextEncoder.prototype.encode.bind(new TextEncoder);Uint8Array.from.bind(Uint8Array);const Qu=String.fromCharCode.bind(String),Yu=u=>{const t=Wu(u),s=4096,a=[];for(let r=0;r<t.length;r+=s)a.push(Qu(...t.subarray(r,r+s)));return btoa(a.join(""))},zu="data:image/svg+xml;base64,",Zu=u=>zu+Yu(u.outerHTML),Vu=u=>{const t=u.getAttribute("width"),s=u.getAttribute("height"),a=Or(t)?parseInt(t):NaN,r=Or(s)?parseInt(s):NaN;if(!isNaN(a)||!isNaN(r))return zt.Ok({width:a,height:r});const e=u.getAttribute("viewBox"),[,,n,i]=(e==null?void 0:e.split(" "))??[],o=Or(n)?parseInt(n):NaN,l=Or(i)?parseInt(i):NaN;return isNaN(o)||isNaN(l)?zt.Error("VIEWBOX_MISSING"):zt.Ok({width:o,height:l})},qu=u=>{const t=u.width/u.height;return t>=1?{width:1024,height:1024/t}:{width:256*t,height:256}},Mi=u=>{const t=u.getAttribute("fill"),s=u.getAttribute("stroke"),a=u.getAttribute("style");return u.tagName==="style"?u.innerHTML.includes("fill")||u.innerHTML.includes("stroke"):nr(t)||nr(s)||nr(a)?!0:[...u.children].some(r=>Mi(r))},$u=u=>[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0].join(" "),ef=(u,t)=>{const s=Lr(t).with("black",()=>"#000").with("white",()=>"#FFF").exhaustive(),a=u.cloneNode(!0);if(!Mi(u))return a.setAttribute("fill",s),a.setAttribute("stroke",s),a;const r=["mask"],e=n=>{if(n.tagName==="style"){const h=n.innerHTML,p=/#[A-F0-9]{6,6}|#[A-F0-9]{3,3}|rgb\(\d{1,3},\d{1,3},\d{1,3}\)|rgba\(\d{1,3},\d{1,3},\d{1,3},\d\.?\d{0,}\)/gim,A=h.replace(p,s);n.innerHTML=A}if(n.tagName==="feColorMatrix"){const h=$u();n.setAttribute("type","matrix"),n.setAttribute("values",h)}const i=!r.includes(n.tagName),o=i?n.getAttribute("fill"):null,l=i?n.getAttribute("stroke"):null,c=i?n.getAttribute("stop-color"):null,f=i?n.getAttribute("style"):null;if(nr(o)&&o!=="none"&&n.setAttribute("fill",s),nr(l)&&l!=="none"&&n.setAttribute("stroke",s),nr(c)&&c!=="none"&&n.setAttribute("stop-color",s),nr(f)){const h=f.split(";").map(p=>{const[A,v]=p.split(":");return nr(A)&&["fill","stroke","stop-color"].includes(A)&&v!=="none"?`${A}:${s}`:p}).join(";");n.setAttribute("style",h)}[...n.children].forEach(h=>e(h))};return e(a),a},tf=u=>Vu(u).map(t=>{const s=Zu(u),{width:a,height:r}=qu(t),e=new Image(a,r);return e.src=s,e}),rf=`
diffuseColor.a *= texture2D(alphaMap, vAlphaMapUv).a;
`,nf=`
float red = cameraPosition.x * cameraPosition.z;
float green = cameraPosition.y * cameraPosition.z;
float blue = 0.1;

red = sin(red / 5.0) + 1.0 / 2.0;
green = sin(green / 5.0) + 1.0 / 2.0;

vec3 shinyColor = vec3(red, green, blue);
float shinyFactor = 0.35;

diffuseColor.rgb = mix(diffuseColor.rgb, shinyColor, shinyFactor);
`,hn=3,of=8.56,af=5.4,rr=.04,vr=-rr,sf=.3,lf=.3,Ea=5,ya=1,cf=u=>{const t=u.width/u.height,s=Ea/ya;if(t>=s){const a=Ea,r=a/t;return{width:a,height:r}}else{const a=ya;return{width:a*t,height:a}}},Eo=u=>pe.jsxs(wl,{camera:{position:[0,0,12],fov:50},children:[pe.jsx(Iu,{enablePan:!1,enableZoom:!1}),pe.jsx(uf,{...u})]}),uf=({autoRotationDuration:u,...t})=>{const{assetsUrls:s}=t,a=oe.useRef(null);return po(({clock:r})=>{u!=null&&a.current!=null&&(a.current.rotation.y=r.getElapsedTime()/u*Math.PI*2)}),pe.jsxs(pe.Fragment,{children:[pe.jsx("ambientLight",{color:16777215,intensity:1}),pe.jsx("pointLight",{intensity:.2,decay:2,position:[-10,-10,-21]}),pe.jsx("pointLight",{intensity:.2,decay:2,position:[10,10,21]}),pe.jsx(Xu,{files:[s.envPx,s.envNx,s.envPy,s.envNy,s.envPz,s.envNz]}),pe.jsx(Ti,{ref:a,...t})]})},Zn=u=>{Array.isArray(u)||(u.colorSpace=Ka)},Ti=oe.forwardRef(({ownerName:u,cardNumber:t,expirationDate:s,cvv:a,color:r,logo:e,logoScale:n,assetsUrls:i,onSvgError:o,...l},c)=>{const{nodes:f,materials:h}=yn(i.cardGltf),[p,A]=oe.useState(null),v=Er(i.colorSilver,Zn),g=Er(i.colorBlack,Zn),F=Er(i.chipTexture,Zn),b=Er(i.bandRoughness);oe.useEffect(()=>{Object.values(h).forEach(w=>{w.envMapIntensity=hn})},[h]),oe.useEffect(()=>{h.rainbow_mastercard.onBeforeCompile=w=>{w.fragmentShader=w.fragmentShader.replace("#include <color_fragment>",nf)}},[h.rainbow_mastercard]),oe.useEffect(()=>{h.black_band.roughness=.8,h.black_band.roughnessMap=b,h.chip.map=F},[h.black_band,h.chip,b,F]),oe.useEffect(()=>{Lr(r).with("Silver",()=>{h.card.map=v}).with("Black",()=>{h.card.map=g}).otherwise(w=>{h.card.map=w}),h.card.needsUpdate=!0},[r,h.card,v,g]);const S=oe.useRef(o);oe.useEffect(()=>{S.current=o},[o]),oe.useEffect(()=>{var D;if(_i(e)){A(null);return}const w=Lr(e).with(Di.instanceOf(HTMLImageElement),z=>zt.Ok(z)).otherwise(z=>{const I=ef(z,"white");return tf(I)});if(w.isError()){(D=S.current)==null||D.call(S,w.getError());return}const{width:R,height:B}=cf(w.get()),_=new Dt(w.get());_.needsUpdate=!0,A({size:[R,B],alphaMap:_})},[e]);const E=pe.jsx("meshStandardMaterial",{color:Lr(r).with("Silver",()=>0).with("Black",()=>15658734).otherwise(()=>15658734),metalness:.1,roughness:.55,envMapIntensity:hn}),T=pe.jsx("meshStandardMaterial",{color:6710886,metalness:.1,roughness:.55,envMapIntensity:hn});return pe.jsx("group",{ref:c,...l,dispose:null,children:pe.jsxs("mesh",{geometry:f.card.geometry,material:h.card,children:[pe.jsxs("group",{position:[0,0,rr],children:[pe.jsxs(Jt,{font:i.fontMaisonNeueBook,fontSize:.2,anchorX:"left",anchorY:"bottom",position:[-3.4,-1.95,0],children:[u,E]}),pe.jsxs(Jt,{font:i.fontMarkProRegular,fontSize:.03,anchorX:"left",anchorY:"bottom",position:[3.85,-2.15,0],children:["TM",E]})]}),pe.jsxs("group",{position:[0,0,vr],children:[pe.jsxs(Jt,{font:i.fontMarkProRegular,anchorX:"left",anchorY:"bottom",fontSize:.12,rotation:[0,Math.PI,0],position:[4,2.38,0],children:["support@swan.io",T]}),pe.jsxs(Jt,{font:i.fontMarkProRegular,anchorX:"right",anchorY:"bottom",fontSize:.12,rotation:[0,Math.PI,0],position:[-4,2.38,0],children:["IDEMIA 9 1212121L 09/21",T]}),pe.jsxs(Jt,{font:i.fontMaisonNeueBook,fontSize:.24,anchorX:"left",anchorY:"bottom",rotation:[0,Math.PI,0],position:[4,.68,0],children:["Identifier: 0000000000",E]}),pe.jsxs(Jt,{font:i.fontMaisonNeueBook,fontSize:.2,anchorX:"left",anchorY:"bottom",rotation:[0,Math.PI,0],position:[4,.15,0],children:["This card is issued by Swan, pursuant to license",T]}),pe.jsxs(Jt,{font:i.fontMaisonNeueBook,fontSize:.2,anchorX:"left",anchorY:"bottom",rotation:[0,Math.PI,0],position:[4,-.15,0],children:["from Mastercard International.",T]}),pe.jsxs(Jt,{font:i.fontMaisonNeueBook,fontSize:.48,anchorX:"left",anchorY:"bottom",rotation:[0,Math.PI,0],position:[4,-1.85,0],children:[t,E]}),pe.jsxs(Jt,{font:i.fontMaisonNeueBook,fontSize:.29,anchorX:"left",anchorY:"bottom",rotation:[0,Math.PI,0],position:[4,-2.3,0],children:[s,E]}),pe.jsxs(Jt,{font:i.fontMaisonNeueBook,fontSize:.29,anchorX:"left",anchorY:"bottom",rotation:[0,Math.PI,0],position:[2.55,-2.3,0],children:["CVC ",a,E]}),pe.jsxs(Jt,{font:i.fontMarkProRegular,anchorX:"center",anchorY:"bottom",fontSize:.36,rotation:[0,Math.PI,0],position:[-2.35,-1.15,0],children:["debit",E]})]}),pe.jsx("group",{position:[of/2-lf,af/2-sf,rr],scale:n,children:Or(p)&&pe.jsxs("mesh",{position:[-p.size[0]/2,-p.size[1]/2,0],children:[pe.jsx("planeGeometry",{args:p.size}),pe.jsx("meshStandardMaterial",{ref:w=>{w&&(w.onBeforeCompile=R=>{R.fragmentShader=R.fragmentShader.replace("#include <alphamap_fragment>",rf)})},color:Lr(r).with("Silver",()=>0).with("Black",()=>16777215).otherwise(()=>16777215),metalness:.1,roughness:.35,envMapIntensity:hn,transparent:!0,alphaMap:p.alphaMap})]})}),pe.jsx("mesh",{geometry:f.black_band.geometry,material:h.black_band,position:[0,1.774,vr],rotation:[0,Math.PI/2,0]}),pe.jsx("mesh",{geometry:f.chip.geometry,material:h.chip,position:[-2.78,.439,rr],rotation:[0,Math.PI/2,0]}),pe.jsx("mesh",{geometry:f.chip_pattern.geometry,material:h.chip_pattern,position:[-2.778,.442,rr+.001],rotation:[0,Math.PI/2,0]}),pe.jsx("mesh",{geometry:f.mc_center.geometry,material:h.mastercard_orange,position:[3.052,-1.832,rr],rotation:[Math.PI/2,0,0]}),pe.jsx("mesh",{geometry:f.mc_left.geometry,material:h.mastercard_red,position:[2.676,-1.773,rr],rotation:[Math.PI/2,0,0]}),pe.jsx("mesh",{geometry:f.mc_right.geometry,material:h.mastercard_yellow,position:[3.47,-1.773,rr],rotation:[-Math.PI/2,0,0]}),pe.jsx("mesh",{geometry:f.metal_circle.geometry,material:h.rainbow,position:[-2.33,-1.849,vr],rotation:[-Math.PI/2,Math.PI/2,0]}),pe.jsx("mesh",{geometry:f.metal_circle001.geometry,material:h.rainbow_rough,position:[-2.629,-1.849,vr-.001],rotation:[-Math.PI/2,Math.PI/2,0],scale:[.35,1,.35]}),pe.jsx("mesh",{geometry:f.metal_circle002.geometry,material:h.rainbow_rough,position:[-2.33,-1.849,vr-.001],rotation:[-Math.PI/2,Math.PI/2,0]}),pe.jsx("mesh",{geometry:f.metal_mastercard.geometry,material:h.rainbow_mastercard,position:[.914,-1.298,vr-.001],rotation:[Math.PI/2,0,Math.PI],scale:.09})]})})});Ti.__docgenInfo={description:"",methods:[],displayName:"Card"};const Fi={envNx:Vs,envNy:qs,envNz:$s,envPx:el,envPy:tl,envPz:rl,fontMaisonNeueBook:nl,fontMarkProRegular:ol,bandRoughness:al,cardGltf:il,chipTexture:sl,colorBlack:ll,colorSilver:cl},Bn=Ri.create({canvasContainer:{height:500},fill:{flex:1}}),eh={title:"Informations/Card3dPreview",component:Eo},ff=u=>Gi.make(t=>{if(u.type!=="image/svg+xml"){t(zt.Error("BAD_FORMAT"));return}const s=new FileReader;s.onload=a=>{var r;if(typeof((r=a.target)==null?void 0:r.result)!="string"){t(zt.Error("NO_CONTENT"));return}t(zt.Ok(a.target.result))},s.readAsText(u)}),hf=u=>{const t=Zs(u),a=new DOMParser().parseFromString(t,"image/svg+xml");return a.children[0]instanceof SVGElement?zt.Ok(a.children[0]):zt.Error("INVALID_SVG")},wi=({value:u,onChange:t})=>{const[s,a]=oe.useState(),r=o=>{t({...u,ownerName:o})},e=o=>{t({...u,color:o})},n=o=>{t({...u,logoScale:o})},i=o=>{const l=o[0];l&&ff(l).mapOkToResult(hf).onResolve(c=>{c.match({Ok:f=>{a(l),t({...u,svgLogo:f})},Error:()=>{console.error("Error while parsing svg file")}})})};return pe.jsxs(xi,{direction:"row",children:[pe.jsxs(An,{style:Bn.fill,children:[pe.jsx(rn,{label:"Name",render:()=>pe.jsx(Ys,{value:u.ownerName,onChangeText:r})}),pe.jsx(rn,{label:"Color",render:()=>pe.jsx(zs,{value:u.color,onValueChange:e,items:[{name:"Silver",value:"Silver"},{name:"Black",value:"Black"}]})})]}),pe.jsx(Oo,{width:32}),pe.jsxs(An,{style:Bn.fill,children:[pe.jsx(rn,{label:"Logo",render:()=>pe.jsx(Ui,{accept:["image/svg+xml"],value:s,onFiles:i,layout:"horizontal",icon:"arrow-download-filled"})}),pe.jsx(Oo,{height:16}),pe.jsx(rn,{label:"Logo scale",render:()=>pe.jsx(Qs,{min:0,max:1,step:.01,value:u.logoScale,onChange:n})})]})]})},Pr=()=>{const[u,t]=oe.useState({color:"Silver",ownerName:"John Doe",svgLogo:null,logoScale:1});return pe.jsx(Xa,{title:"Card",children:pe.jsxs(Wa,{title:"Default",children:[pe.jsx(wi,{value:u,onChange:t}),pe.jsx(An,{style:Bn.canvasContainer,children:pe.jsx(Eo,{assetsUrls:Fi,color:u.color,ownerName:u.ownerName,logo:u.svgLogo,logoScale:u.logoScale,cardNumber:"1234 5678 9012 3456",expirationDate:"12/24",cvv:"123"})})]})})},Hr=()=>{const[u,t]=oe.useState({color:"Silver",ownerName:"John Doe",svgLogo:null,logoScale:1});return pe.jsx(Xa,{title:"Card",children:pe.jsxs(Wa,{title:"With auto rotation",children:[pe.jsx(wi,{value:u,onChange:t}),pe.jsx(An,{style:Bn.canvasContainer,children:pe.jsx(Eo,{assetsUrls:Fi,autoRotationDuration:10,color:u.color,ownerName:u.ownerName,logo:u.svgLogo,logoScale:u.logoScale,cardNumber:"1234 5678 9012 3456",expirationDate:"12/24",cvv:"123"})})]})})};Pr.__docgenInfo={description:"",methods:[],displayName:"Card"};Hr.__docgenInfo={description:"",methods:[],displayName:"AutoRotation"};var Ma,Ta,Fa;Pr.parameters={...Pr.parameters,docs:{...(Ma=Pr.parameters)==null?void 0:Ma.docs,source:{originalSource:`() => {
  const [config, setConfig] = useState<CardConfig>({
    color: "Silver",
    ownerName: "John Doe",
    svgLogo: null,
    logoScale: 1
  });
  return <StoryBlock title="Card">
      <StoryPart title="Default">
        <ConfigForm value={config} onChange={setConfig} />

        <View style={styles.canvasContainer}>
          <Card3dPreview assetsUrls={assetsUrls} color={config.color} ownerName={config.ownerName} logo={config.svgLogo} logoScale={config.logoScale} cardNumber="1234 5678 9012 3456" expirationDate="12/24" cvv="123" />
        </View>
      </StoryPart>
    </StoryBlock>;
}`,...(Fa=(Ta=Pr.parameters)==null?void 0:Ta.docs)==null?void 0:Fa.source}}};var wa,Ia,Sa;Hr.parameters={...Hr.parameters,docs:{...(wa=Hr.parameters)==null?void 0:wa.docs,source:{originalSource:`() => {
  const [config, setConfig] = useState<CardConfig>({
    color: "Silver",
    ownerName: "John Doe",
    svgLogo: null,
    logoScale: 1
  });
  return <StoryBlock title="Card">
      <StoryPart title="With auto rotation">
        <ConfigForm value={config} onChange={setConfig} />

        <View style={styles.canvasContainer}>
          <Card3dPreview assetsUrls={assetsUrls} autoRotationDuration={10} color={config.color} ownerName={config.ownerName} logo={config.svgLogo} logoScale={config.logoScale} cardNumber="1234 5678 9012 3456" expirationDate="12/24" cvv="123" />
        </View>
      </StoryPart>
    </StoryBlock>;
}`,...(Sa=(Ia=Hr.parameters)==null?void 0:Ia.docs)==null?void 0:Sa.source}}};const th=["Card","AutoRotation"];export{Hr as AutoRotation,Pr as Card,th as __namedExportsOrder,eh as default};
//# sourceMappingURL=Card3dPreview.stories-DHCQgycU.js.map
