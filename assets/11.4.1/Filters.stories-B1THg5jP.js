import{j as e}from"./jsx-runtime-8P-18mTY.js";import{V as S,s as U,k as re,L as Q,S as C,I as X,c as T,ad as I,d as Z,F as se,p as J,i as A,z as O,T as W,N as L,l as oe,B as ee,W as ne}from"./ScrollView-BKkPsNRr.js";import{r as f}from"./index-Cs7sjTYM.js";import{u as D}from"./useDisclosure-DLkMFUa4.js";import{P as E,F as B}from"./Popover-1A3WDbgW.js";import{L as ie}from"./LakeButton-CHVRx-Bn.js";import{M}from"./index-CXuZBaac.js";import{L as ae}from"./LakeCheckbox-CPhGoHXK.js";import{L as le}from"./LakeLabel-BLdWqsrL.js";import{L as ce}from"./LakeRadio-Csv9C3kP.js";import{L as de}from"./LakeTextInput-DnfVS9HL.js";import{S as ue}from"./Stack-BePZ68LW.js";import{T as me}from"./Tag-r1Rj7iV5.js";import{u as pe}from"./Pressable-BMgg_GIt.js";import{u as he}from"./TransitionView-CVbm9pvN.js";import{d as z}from"./utc-JZaFi-_r.js";import{t as F,l as fe}from"./i18n-BT0_VNLo.js";import{D as xe}from"./DatePicker-Q8B3h2mD.js";import{S as ve}from"./_StoriesComponents-CMI8D8ye.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-BKZjgRaT.js";import"./useResponsive-CzIqCC5v.js";import"./function-XPQbrxn-.js";import"./BottomPanel-DqNtLW9I.js";import"./commonStyles-BBEkV6IC.js";import"./useBodyClassName-DMoYUPTW.js";import"./FocusTrap-DbeXHdd-.js";import"./array-BfAlyugE.js";import"./Suspendable-dEtQ-lRc.js";import"./index-BOFhFDBp.js";import"./extends-CF3RwP-h.js";import"./v4-C6aID195.js";import"./Fill-DHjLyN54.js";import"./LakeSelect-D30uZH-d.js";import"./Separator-DVYelPYG.js";import"./index-D0lxU9-6.js";import"./rifm-DfuVNZKU.js";import"./rifm.esm-FZJd-_Wa.js";import"./LakeModal-C3blnP1N.js";import"./LakeHeading-DyTBtVNA.js";import"./ResponsiveContainer-DeHxhXsU.js";const R=U.create({selected:{color:T.gray[500]},list:{paddingVertical:20,marginVertical:4,minWidth:250,overflow:"hidden"},item:{display:"flex",paddingHorizontal:24,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:8},itemHovered:{backgroundColor:T.gray[50]},availableFiltersTitle:{paddingHorizontal:24}}),H=({filters:t,openFilters:s,label:l,title:a,availableFilters:c,large:n=!0,onAddFilter:x})=>{const r=f.useRef(null),[d,{close:u,toggle:p}]=D(!1);return e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:"small",mode:"secondary",color:"gray",onPress:p,ref:r,icon:n?"chevron-down-filled":"filter-filled",iconPosition:"end",ariaLabel:l,children:n?l:null}),e.jsx(E,{role:"listbox",matchReferenceMinWidth:!0,onDismiss:u,referenceRef:r,returnFocus:!1,visible:d,children:e.jsxs(S,{style:R.list,children:[re(a)?e.jsxs(e.Fragment,{children:[e.jsx(Q,{style:R.availableFiltersTitle,children:a}),e.jsx(C,{height:8})]}):null,e.jsx(B,{role:"list",data:c,keyExtractor:(i,o)=>`filter-item-${o}`,renderItem:({item:i})=>{const o=!!t[i.name]||s.includes(i.name);return e.jsxs(M,{style:({hovered:m})=>[R.item,m&&R.itemHovered],role:"button",disabled:o,onPress:()=>{x(i.name),u()},children:[e.jsx(Q,{variant:"smallRegular",style:o&&R.selected,children:i.label}),o&&e.jsx(X,{color:T.positive[500],name:"checkmark-filled",size:14})]})}})]})})]})};H.__docgenInfo={description:"",methods:[],displayName:"FilterChooser",props:{filters:{required:!0,tsType:{name:"Partial",elements:[{name:"Record",elements:[{name:"FilterName"},{name:"unknown"}],raw:"Record<FilterName, unknown>"}],raw:"Partial<Record<FilterName, unknown>>"},description:""},openFilters:{required:!0,tsType:{name:"Array",elements:[{name:"FilterName"}],raw:"FilterName[]"},description:""},label:{required:!0,tsType:{name:"string"},description:""},title:{required:!1,tsType:{name:"string"},description:""},availableFilters:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ label: string; name: FilterName }",signature:{properties:[{key:"label",value:{name:"string",required:!0}},{key:"name",value:{name:"FilterName",required:!0}}]}}],raw:"{ label: string; name: FilterName }[]"},description:""},large:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},onAddFilter:{required:!0,tsType:{name:"signature",type:"function",raw:"(filterName: FilterName) => void",signature:{arguments:[{type:{name:"FilterName"},name:"filterName"}],return:{name:"void"}}},description:""}}};const h=U.create({container:{paddingRight:12,paddingBottom:8},shadowed:{position:"absolute",opacity:0,width:"100%",height:"100%",borderRadius:4,boxShadow:oe.tile,transitionDuration:"150ms",transitionProperty:"opacity"},hovered:{opacity:1},dropdown:{maxHeight:400,minWidth:200},itemHovered:{backgroundColor:T.gray[50]},content:{paddingVertical:12},inputContent:{paddingHorizontal:24,paddingTop:24,paddingBottom:16},radio:{display:"flex",flexDirection:"row",alignItems:"center",height:32,paddingHorizontal:24},itemLabel:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},input:{width:250},value:{maxWidth:130,whiteSpace:"nowrap"}}),_=f.forwardRef(({onPress:t,onPressRemove:s,label:l,value:a="",isActive:c},n)=>{const x=f.useRef(null),r=pe(x,n);return e.jsx(M,{ref:r,onPress:t,children:({hovered:d})=>e.jsxs(e.Fragment,{children:[e.jsx(S,{style:[h.shadowed,d&&h.hovered]}),e.jsx(me,{label:l,color:"current",onPressRemove:s,children:e.jsxs(ee,{direction:"row",alignItems:"center",children:[e.jsx(W,{numberOfLines:1,style:h.value,children:a}),e.jsx(C,{width:4}),e.jsx(X,{color:T.current.primary,name:c?"chevron-up-filled":"chevron-down-filled",size:16})]})})]})})}),ye=({label:t,items:s,width:l,value:a,onValueChange:c,onPressRemove:n,autoOpen:x=!1})=>{const r=f.useRef(null),[d,{close:u,toggle:p}]=D(x),i=f.useMemo(()=>s.find(o=>o.value===a),[s,a]);return e.jsxs(S,{style:h.container,children:[e.jsx(_,{label:t,onPress:p,ref:r,onPressRemove:n,isActive:d,value:i==null?void 0:i.label}),e.jsx(E,{role:"listbox",matchReferenceWidth:!1,onDismiss:u,referenceRef:r,returnFocus:!1,visible:d,children:e.jsx(B,{role:"list",data:s,style:[h.dropdown,{width:l}],contentContainerStyle:h.content,keyExtractor:(o,m)=>`filter-item-${m}`,renderItem:({item:o})=>{const m=a===o.value;return e.jsxs(M,{role:"radio","aria-checked":m,style:({hovered:y})=>[h.radio,y&&h.itemHovered],onPress:()=>{c(o.value),u()},children:[e.jsx(ce,{value:m}),e.jsx(C,{width:12}),e.jsx(W,{style:h.itemLabel,children:o.label})]})}})})]})},ge=({label:t,items:s,width:l,checkAllLabel:a,value:c,onValueChange:n,onPressRemove:x,autoOpen:r=!1})=>{const d=f.useRef(null),[u,{close:p,toggle:i}]=D(r),o=f.useMemo(()=>new Set(c),[c]),m=f.useMemo(()=>s.filter(g=>o.has(g.value)),[s,o]),y=a!=null&&o.size===s.length,w=f.useMemo(()=>{if(a==null)return s;const g=o.size===0?!1:o.size===s.length?!0:"mixed";return[{label:a,checked:g},...s]},[s,a,o]);return e.jsxs(S,{style:h.container,children:[e.jsx(_,{label:t,onPress:i,ref:d,onPressRemove:x,isActive:u,value:y?a:m.map(g=>g.label).join(", ")}),e.jsx(E,{role:"listbox",matchReferenceWidth:!1,onDismiss:p,referenceRef:d,returnFocus:!1,visible:u,children:e.jsx(B,{role:"list",data:w,style:[h.dropdown,{width:l}],contentContainerStyle:h.content,keyExtractor:(g,v)=>`filter-item-${v}`,renderItem:({item:g})=>{const v=O(g).with({checked:L.any},({checked:b})=>b).with({value:L.any},({value:b})=>o.has(b)).exhaustive(),k=O(g).with({checked:L.any},({checked:b})=>()=>{n(b===!0?void 0:s.map(j=>j.value))}).with({value:L.any},({value:b})=>()=>{const j=new Set([...o]);v===!0?j.delete(b):j.add(b),j.size===0?n(void 0):n([...j])}).exhaustive();return e.jsxs(M,{role:"radio","aria-checked":v,style:({hovered:b})=>[h.radio,b&&h.itemHovered],onPress:k,children:[e.jsx(ae,{value:v}),e.jsx(C,{width:12}),e.jsx(W,{style:h.itemLabel,children:g.label})]})}})})]})},be=({label:t,initialValue:s,noValueText:l,cancelText:a,submitText:c,dateFormat:n,isSelectable:x,validate:r,onValueChange:d,onPressRemove:u,autoOpen:p=!1})=>{const i=f.useRef(null),[o,{close:m,toggle:y}]=D(p),w=f.useMemo(()=>A(s)?z(s).format(n):"",[s,n]);return e.jsxs(S,{style:h.container,children:[e.jsx(_,{label:t,onPress:y,ref:i,onPressRemove:u,isActive:o,value:A(s)?z(s).format(n):l}),e.jsx(xe,{visible:o,format:n,firstWeekDay:"monday",label:t,cancelLabel:a,confirmLabel:c,value:w,isSelectable:x,validate:r,onChange:g=>{const v=z(g,n,!0).toJSON();d(v)},onDismiss:m})]})},je=({label:t,initialValue:s="",noValueText:l,autoOpen:a=!1,placeholder:c,validate:n,onValueChange:x,onPressRemove:r})=>{const[d,{close:u,toggle:p}]=D(a),i=f.useRef(null),o=f.useCallback((k,b)=>{const j=k.trim(),$=(n==null?void 0:n(j))??void 0,N=Z($)?j:void 0;return b||x(N),{inputValue:k,validValue:N,error:b?void 0:$}},[n,x]),[{inputValue:m,validValue:y,error:w},g]=f.useState(()=>o(s,!0)),v=f.useCallback(k=>g(o(k,!1)),[o]);return e.jsxs(S,{style:h.container,children:[e.jsx(_,{label:t,onPress:p,ref:i,onPressRemove:r,isActive:d,value:y??l}),e.jsx(E,{role:"listbox",matchReferenceWidth:!1,onDismiss:u,referenceRef:i,returnFocus:!1,visible:d,children:e.jsx(S,{style:[h.dropdown,h.inputContent],children:e.jsx(le,{label:t,render:k=>e.jsx(de,{id:k,value:m,error:w,style:h.input,placeholder:c,onChangeText:v})})})})]})},V=(t,s,l)=>s[l],te=({filters:t,openedFilters:s,definition:l,onChangeOpened:a,onChangeFilters:c})=>{const n=he(s),x=s.length>n.length?s[s.length-1]:void 0;return s.length===0?null:e.jsx(ue,{direction:"row",wrap:"wrap",children:s.map(r=>{const d=l[r];return typeof r!="string"||d==null?null:e.jsx(S,{children:O(d).with({type:"radio"},({type:u,label:p,items:i,width:o})=>e.jsx(ye,{label:p,items:i,width:o,autoOpen:x===r,onPressRemove:()=>{c({...t,[r]:void 0}),a(s.filter(m=>m!==r))},value:V(u,t,r),onValueChange:m=>c({...t,[r]:m})})).with({type:"checkbox"},({type:u,label:p,items:i,width:o,checkAllLabel:m})=>e.jsx(ge,{label:p,items:i,width:o,checkAllLabel:m,autoOpen:x===r,value:V(u,t,r),onValueChange:y=>c({...t,[r]:y}),onPressRemove:()=>{c({...t,[r]:void 0}),a(s.filter(y=>y!==r))}})).with({type:"date"},({type:u,label:p,noValueText:i,cancelText:o,submitText:m,dateFormat:y,isSelectable:w,validate:g})=>e.jsx(be,{label:p,noValueText:i,cancelText:o,submitText:m,dateFormat:y,autoOpen:x===r,isSelectable:w?v=>w(v,t):void 0,validate:g?v=>g(v,t):void 0,initialValue:V(u,t,r),onValueChange:v=>c({...t,[r]:v}),onPressRemove:()=>{c({...t,[r]:void 0}),a(s.filter(v=>v!==r))}})).with({type:"input"},({type:u,label:p,placeholder:i,noValueText:o,validate:m})=>e.jsx(je,{label:p,placeholder:i,noValueText:o,autoOpen:x===r,validate:m,initialValue:V(u,t,r),onValueChange:y=>c({...t,[r]:y}),onPressRemove:()=>{c({...t,[r]:void 0}),a(s.filter(y=>y!==r))}})).exhaustive()},r)})})},q={checkbox:t=>({type:"checkbox",label:t.label,items:t.items,checkAllLabel:F("common.filters.all")}),date:t=>({type:"date",label:t.label,cancelText:F("common.filters.cancel"),submitText:F("common.filters.apply"),noValueText:F("common.filters.none"),dateFormat:fe.dateFormat,isSelectable:t.isSelectable,validate:t.validate}),input:t=>({type:"input",label:t.label,noValueText:F("common.filters.none"),placeholder:t.placeholder,validate:t.validate}),radio:t=>({type:"radio",label:t.label,items:t.items})},we=({available:t,filters:s,filtersDefinition:l})=>{const a=f.useMemo(()=>{const r=new Set(Z(t)?I.keys(l):t);return se.filterMap(I.entries(l),([d,{label:u}])=>r.has(d)?J.Some({name:d,label:u}):J.None())},[t,l]),[c,n]=f.useState(()=>I.entries(s).filter(([,r])=>A(r)).map(([r])=>r));f.useEffect(()=>{n(r=>{const d=new Set(r),u=I.entries(s).filter(([p,i])=>A(i)&&!d.has(p)).map(([p])=>p);return[...r,...u]})},[s]);const x=f.useCallback(r=>{n(d=>[...d,r])},[]);return{chooser:{availableFilters:a,filters:s,label:F("common.filters"),onAddFilter:x,openFilters:c},stack:{definition:l,filters:s,openedFilters:c,onChangeOpened:n}}};te.__docgenInfo={description:"",methods:[],displayName:"FiltersStack",props:{definition:{required:!0,tsType:{name:"Definition"},description:""},filters:{required:!0,tsType:{name:"State"},description:""},openedFilters:{required:!0,tsType:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},description:""},onChangeOpened:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: (keyof Definition)[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},name:"value"}],return:{name:"void"}}},description:""},onChangeFilters:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: State) => void",signature:{arguments:[{type:{name:"State"},name:"value"}],return:{name:"void"}}},description:""}}};const ke={mode:q.radio({label:"Mode",items:[{label:"QES",value:"QES"},{label:"Expert",value:"Expert"}]}),status:q.checkbox({label:"Status",items:[{label:"Accepted",value:"Accepted"},{label:"Canceled",value:"Canceled"},{label:"Failed",value:"Failed"},{label:"Expired",value:"Expired"},{label:"CustomerRefused",value:"CustomerRefused"}]}),startDate:q.date({label:"Start Date"}),resourceId:q.input({label:"Resource ID",placeholder:"Placeholder...",validate:t=>{if(t.length<3)return"Not long enough"}})},ut={title:"Forms/Filters",component:H},P=()=>{const[t,s]=f.useState({mode:void 0,status:void 0,resourceId:void 0,startDate:void 0}),l=we({filtersDefinition:ke,filters:t});return e.jsx(ve,{title:"Filters",children:e.jsx(ne,{variant:"live",children:e.jsxs(ee,{alignItems:"start",children:[e.jsx(H,{...l.chooser}),e.jsx(C,{height:8}),e.jsx(te,{...l.stack,onChangeFilters:s})]})})})};P.__docgenInfo={description:"",methods:[],displayName:"All"};var Y,G,K;P.parameters={...P.parameters,docs:{...(Y=P.parameters)==null?void 0:Y.docs,source:{originalSource:`() => {
  const [filters, setFilters] = useState<State>({
    mode: undefined,
    status: undefined,
    resourceId: undefined,
    startDate: undefined
  });
  const filtersProps = useFiltersProps({
    filtersDefinition,
    filters
  });
  return <StoryBlock title="Filters">
      <WithCurrentColor variant="live">
        <Box alignItems="start">
          <FilterChooser {...filtersProps.chooser} />
          <Space height={8} />
          <FiltersStack {...filtersProps.stack} onChangeFilters={setFilters} />
        </Box>
      </WithCurrentColor>
    </StoryBlock>;
}`,...(K=(G=P.parameters)==null?void 0:G.docs)==null?void 0:K.source}}};const mt=["All"];export{P as All,mt as __namedExportsOrder,ut as default};
//# sourceMappingURL=Filters.stories-B1THg5jP.js.map
