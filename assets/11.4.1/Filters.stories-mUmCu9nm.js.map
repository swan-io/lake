{"version":3,"file":"Filters.stories-mUmCu9nm.js","sources":["../../../packages/lake/src/components/FilterChooser.tsx","../../../packages/shared-business/src/components/Filters.tsx","../../../packages/shared-business/__stories__/Filters.stories.tsx"],"sourcesContent":["import { useRef } from \"react\";\nimport { Pressable, StyleSheet, View } from \"react-native\";\nimport { colors } from \"../constants/design\";\nimport { useDisclosure } from \"../hooks/useDisclosure\";\nimport { isNotNullishOrEmpty } from \"../utils/nullish\";\nimport { FlatList } from \"./FlatList\";\nimport { Icon } from \"./Icon\";\nimport { LakeButton } from \"./LakeButton\";\nimport { LakeText } from \"./LakeText\";\nimport { Popover } from \"./Popover\";\nimport { Space } from \"./Space\";\n\nconst styles = StyleSheet.create({\n  selected: {\n    color: colors.gray[500],\n  },\n  list: {\n    paddingVertical: 20,\n    marginVertical: 4,\n    minWidth: 250,\n    overflow: \"hidden\",\n  },\n  item: {\n    display: \"flex\",\n    paddingHorizontal: 24,\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingVertical: 8,\n  },\n  itemHovered: {\n    backgroundColor: colors.gray[50],\n  },\n  availableFiltersTitle: {\n    paddingHorizontal: 24,\n  },\n});\n\nexport const FilterChooser = <FilterName extends string>({\n  filters,\n  openFilters,\n  label,\n  title,\n  availableFilters,\n  large = true,\n  onAddFilter,\n}: {\n  filters: Partial<Record<FilterName, unknown>>;\n  openFilters: FilterName[];\n  label: string;\n  title?: string;\n  availableFilters: { label: string; name: FilterName }[];\n  large?: boolean;\n  onAddFilter: (filterName: FilterName) => void;\n}) => {\n  const inputRef = useRef<View>(null);\n  const [visible, { close, toggle }] = useDisclosure(false);\n\n  return (\n    <>\n      <LakeButton\n        size=\"small\"\n        mode=\"secondary\"\n        color=\"gray\"\n        onPress={toggle}\n        ref={inputRef}\n        icon={large ? \"chevron-down-filled\" : \"filter-filled\"}\n        iconPosition=\"end\"\n        ariaLabel={label}\n      >\n        {large ? label : null}\n      </LakeButton>\n\n      <Popover\n        role=\"listbox\"\n        matchReferenceMinWidth={true}\n        onDismiss={close}\n        referenceRef={inputRef}\n        returnFocus={false}\n        visible={visible}\n      >\n        <View style={styles.list}>\n          {isNotNullishOrEmpty(title) ? (\n            <>\n              <LakeText style={styles.availableFiltersTitle}>{title}</LakeText>\n              <Space height={8} />\n            </>\n          ) : null}\n\n          <FlatList\n            role=\"list\"\n            data={availableFilters}\n            keyExtractor={(_, index) => `filter-item-${index}`}\n            renderItem={({ item }) => {\n              const isSet = Boolean(filters[item.name]) || openFilters.includes(item.name);\n              return (\n                <Pressable\n                  style={({ hovered }) => [styles.item, hovered && styles.itemHovered]}\n                  role=\"button\"\n                  disabled={isSet}\n                  onPress={() => {\n                    onAddFilter(item.name);\n                    close();\n                  }}\n                >\n                  <LakeText variant=\"smallRegular\" style={isSet && styles.selected}>\n                    {item.label}\n                  </LakeText>\n\n                  {isSet && <Icon color={colors.positive[500]} name=\"checkmark-filled\" size={14} />}\n                </Pressable>\n              );\n            }}\n          />\n        </View>\n      </Popover>\n    </>\n  );\n};\n","import { Array, Dict, Option } from \"@swan-io/boxed\";\nimport { Box } from \"@swan-io/lake/src/components/Box\";\nimport { FlatList } from \"@swan-io/lake/src/components/FlatList\";\nimport { Icon } from \"@swan-io/lake/src/components/Icon\";\nimport { LakeCheckbox } from \"@swan-io/lake/src/components/LakeCheckbox\";\nimport { LakeLabel } from \"@swan-io/lake/src/components/LakeLabel\";\nimport { LakeRadio } from \"@swan-io/lake/src/components/LakeRadio\";\nimport { LakeTextInput } from \"@swan-io/lake/src/components/LakeTextInput\";\nimport { Popover } from \"@swan-io/lake/src/components/Popover\";\nimport { Space } from \"@swan-io/lake/src/components/Space\";\nimport { Stack } from \"@swan-io/lake/src/components/Stack\";\nimport { Tag } from \"@swan-io/lake/src/components/Tag\";\nimport { colors, shadows } from \"@swan-io/lake/src/constants/design\";\nimport { useDisclosure } from \"@swan-io/lake/src/hooks/useDisclosure\";\nimport { useMergeRefs } from \"@swan-io/lake/src/hooks/useMergeRefs\";\nimport { usePreviousValue } from \"@swan-io/lake/src/hooks/usePreviousValue\";\nimport { isNotNullish, isNullish } from \"@swan-io/lake/src/utils/nullish\";\nimport { ValidatorResult } from \"@swan-io/use-form\";\nimport dayjs from \"dayjs\";\nimport { forwardRef, useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { Pressable, StyleSheet, Text, View } from \"react-native\";\nimport { P, match } from \"ts-pattern\";\nimport { Simplify } from \"type-fest\";\nimport { DateFormat, locale, t } from \"../utils/i18n\";\nimport { DatePickerDate, DatePickerModal } from \"./DatePicker\";\n\nconst styles = StyleSheet.create({\n  container: {\n    paddingRight: 12,\n    paddingBottom: 8,\n  },\n  shadowed: {\n    position: \"absolute\",\n    opacity: 0,\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: 4,\n    boxShadow: shadows.tile,\n    transitionDuration: \"150ms\",\n    transitionProperty: \"opacity\",\n  },\n  hovered: {\n    opacity: 1,\n  },\n  dropdown: {\n    maxHeight: 400,\n    minWidth: 200,\n  },\n  itemHovered: {\n    backgroundColor: colors.gray[50],\n  },\n  content: {\n    paddingVertical: 12,\n  },\n  inputContent: {\n    paddingHorizontal: 24,\n    paddingTop: 24,\n    paddingBottom: 16,\n  },\n  radio: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    height: 32,\n    paddingHorizontal: 24,\n  },\n  itemLabel: {\n    textOverflow: \"ellipsis\",\n    overflow: \"hidden\",\n    whiteSpace: \"nowrap\",\n  },\n  input: {\n    width: 250,\n  },\n  value: {\n    maxWidth: 130,\n    whiteSpace: \"nowrap\",\n  },\n});\n\ntype Item<T> = {\n  label: string;\n  value: T;\n};\n\ntype TagProps = {\n  isActive: boolean;\n  label: string;\n  value?: string;\n  onPress: () => void;\n  onPressRemove: () => void;\n};\n\nconst FilterTag = forwardRef<View, TagProps>(\n  ({ onPress, onPressRemove, label, value = \"\", isActive }, forwardRef) => {\n    const ref = useRef<View>(null);\n    const mergedRef = useMergeRefs(ref, forwardRef);\n\n    return (\n      <Pressable ref={mergedRef} onPress={onPress}>\n        {({ hovered }) => (\n          <>\n            <View style={[styles.shadowed, hovered && styles.hovered]} />\n\n            <Tag label={label} color=\"current\" onPressRemove={onPressRemove}>\n              <Box direction=\"row\" alignItems=\"center\">\n                <Text numberOfLines={1} style={styles.value}>\n                  {value}\n                </Text>\n\n                <Space width={4} />\n\n                <Icon\n                  color={colors.current.primary}\n                  name={isActive ? \"chevron-up-filled\" : \"chevron-down-filled\"}\n                  size={16}\n                />\n              </Box>\n            </Tag>\n          </>\n        )}\n      </Pressable>\n    );\n  },\n);\n\ntype FilterRadioProps<T> = {\n  autoOpen?: boolean;\n  items: Item<T>[];\n  width?: number;\n  label: string;\n  value: T | undefined;\n  onPressRemove: () => void;\n  onValueChange: (value: T | undefined) => void;\n};\n\nconst FilterRadio = <T,>({\n  label,\n  items,\n  width,\n  value,\n  onValueChange,\n  onPressRemove,\n  autoOpen = false,\n}: FilterRadioProps<T>) => {\n  const inputRef = useRef<View>(null);\n  const [visible, { close, toggle }] = useDisclosure(autoOpen);\n  const currentValue = useMemo(() => items.find(i => i.value === value), [items, value]);\n\n  return (\n    <View style={styles.container}>\n      <FilterTag\n        label={label}\n        onPress={toggle}\n        ref={inputRef}\n        onPressRemove={onPressRemove}\n        isActive={visible}\n        value={currentValue?.label}\n      />\n\n      <Popover\n        role=\"listbox\"\n        matchReferenceWidth={false}\n        onDismiss={close}\n        referenceRef={inputRef}\n        returnFocus={false}\n        visible={visible}\n      >\n        <FlatList\n          role=\"list\"\n          data={items}\n          style={[styles.dropdown, { width }]}\n          contentContainerStyle={styles.content}\n          keyExtractor={(_, index) => `filter-item-${index}`}\n          renderItem={({ item }) => {\n            const isSelected = value === item.value;\n\n            return (\n              <Pressable\n                role=\"radio\"\n                aria-checked={isSelected}\n                style={({ hovered }) => [styles.radio, hovered && styles.itemHovered]}\n                onPress={() => {\n                  onValueChange(item.value);\n                  close();\n                }}\n              >\n                <LakeRadio value={isSelected} />\n                <Space width={12} />\n                <Text style={styles.itemLabel}>{item.label}</Text>\n              </Pressable>\n            );\n          }}\n        />\n      </Popover>\n    </View>\n  );\n};\n\ntype FilterCheckboxProps<T> = {\n  label: string;\n  items: Item<T>[];\n  width?: number;\n  onValueChange: (value: T[] | undefined) => void;\n  value: T[] | undefined;\n  onPressRemove: () => void;\n  autoOpen?: boolean;\n  checkAllLabel?: string;\n};\n\ntype CheckAllItem = {\n  label: string;\n  checked: boolean | \"mixed\";\n};\n\nconst FilterCheckbox = <T,>({\n  label,\n  items,\n  width,\n  checkAllLabel,\n  value,\n  onValueChange,\n  onPressRemove,\n  autoOpen = false,\n}: FilterCheckboxProps<T>) => {\n  const inputRef = useRef<View>(null);\n  const [visible, { close, toggle }] = useDisclosure(autoOpen);\n\n  const valueSet = useMemo(() => new Set(value), [value]);\n\n  const currentValue = useMemo(\n    () => items.filter(item => valueSet.has(item.value)),\n    [items, valueSet],\n  );\n\n  const allChecked = checkAllLabel != null && valueSet.size === items.length;\n\n  const listItems = useMemo(() => {\n    if (checkAllLabel == null) {\n      return items;\n    }\n\n    const checked: CheckAllItem[\"checked\"] =\n      valueSet.size === 0 ? false : valueSet.size === items.length ? true : \"mixed\";\n\n    const checkAllItem: CheckAllItem = {\n      label: checkAllLabel,\n      checked,\n    };\n\n    return [checkAllItem, ...items];\n  }, [items, checkAllLabel, valueSet]);\n\n  return (\n    <View style={styles.container}>\n      <FilterTag\n        label={label}\n        onPress={toggle}\n        ref={inputRef}\n        onPressRemove={onPressRemove}\n        isActive={visible}\n        value={allChecked ? checkAllLabel : currentValue.map(item => item.label).join(\", \")}\n      />\n\n      <Popover\n        role=\"listbox\"\n        matchReferenceWidth={false}\n        onDismiss={close}\n        referenceRef={inputRef}\n        returnFocus={false}\n        visible={visible}\n      >\n        <FlatList\n          role=\"list\"\n          data={listItems}\n          style={[styles.dropdown, { width }]}\n          contentContainerStyle={styles.content}\n          keyExtractor={(_, index) => `filter-item-${index}`}\n          renderItem={({ item }) => {\n            const isSelected = match<Item<unknown> | CheckAllItem>(item)\n              .with({ checked: P.any }, ({ checked }) => checked)\n              .with({ value: P.any }, ({ value }) => valueSet.has(value as T))\n              .exhaustive();\n\n            const onPress = match<Item<unknown> | CheckAllItem>(item)\n              // Check all item\n              .with({ checked: P.any }, ({ checked }) => () => {\n                if (checked === true) {\n                  onValueChange(undefined);\n                } else {\n                  onValueChange(items.map(item => item.value));\n                }\n              })\n              // Regular item\n              .with({ value: P.any }, ({ value }) => () => {\n                const nextValues = new Set([...valueSet]);\n                if (isSelected === true) {\n                  nextValues.delete(value as T);\n                } else {\n                  nextValues.add(value as T);\n                }\n                if (nextValues.size === 0) {\n                  onValueChange(undefined);\n                } else {\n                  onValueChange([...nextValues]);\n                }\n              })\n              .exhaustive();\n\n            return (\n              <Pressable\n                role=\"radio\"\n                aria-checked={isSelected}\n                style={({ hovered }) => [styles.radio, hovered && styles.itemHovered]}\n                onPress={onPress}\n              >\n                <LakeCheckbox value={isSelected} />\n                <Space width={12} />\n                <Text style={styles.itemLabel}>{item.label}</Text>\n              </Pressable>\n            );\n          }}\n        />\n      </Popover>\n    </View>\n  );\n};\n\ntype FilterDateProps = {\n  label: string;\n  noValueText: string;\n  cancelText: string;\n  submitText: string;\n  dateFormat: DateFormat;\n  isSelectable?: (date: DatePickerDate) => boolean;\n  validate?: (value: string) => ValidatorResult;\n  initialValue?: string;\n  onValueChange: (value: string) => void;\n  onPressRemove: () => void;\n  autoOpen?: boolean;\n};\n\nconst FilterDate = ({\n  label,\n  initialValue,\n  noValueText,\n  cancelText,\n  submitText,\n  dateFormat,\n  isSelectable,\n  validate,\n  onValueChange,\n  onPressRemove,\n  autoOpen = false,\n}: FilterDateProps) => {\n  const inputRef = useRef<View>(null);\n  const [visible, { close, toggle }] = useDisclosure(autoOpen);\n\n  const value = useMemo(\n    () => (isNotNullish(initialValue) ? dayjs(initialValue).format(dateFormat) : \"\"),\n    [initialValue, dateFormat],\n  );\n\n  return (\n    <View style={styles.container}>\n      <FilterTag\n        label={label}\n        onPress={toggle}\n        ref={inputRef}\n        onPressRemove={onPressRemove}\n        isActive={visible}\n        value={isNotNullish(initialValue) ? dayjs(initialValue).format(dateFormat) : noValueText}\n      />\n\n      <DatePickerModal\n        visible={visible}\n        format={dateFormat}\n        firstWeekDay=\"monday\"\n        label={label}\n        cancelLabel={cancelText}\n        confirmLabel={submitText}\n        value={value}\n        isSelectable={isSelectable}\n        validate={validate}\n        onChange={value => {\n          const formattedValue = dayjs(value, dateFormat, true).toJSON();\n          onValueChange(formattedValue);\n        }}\n        onDismiss={close}\n      />\n    </View>\n  );\n};\n\ntype FilterInputProps = {\n  label: string;\n  noValueText: string;\n  validate?: (value: string) => ValidatorResult;\n  placeholder?: string;\n  initialValue?: string;\n  onValueChange: (value: string | undefined) => void;\n  onPressRemove: () => void;\n  autoOpen?: boolean;\n};\n\nconst FilterInput = ({\n  label,\n  initialValue = \"\",\n  noValueText,\n  autoOpen = false,\n  placeholder,\n  validate,\n  onValueChange,\n  onPressRemove,\n}: FilterInputProps) => {\n  const [visible, { close, toggle }] = useDisclosure(autoOpen);\n  const tagRef = useRef<View>(null);\n\n  const getValueState = useCallback(\n    (inputValue: string, isInitialValue: boolean) => {\n      const trimmed = inputValue.trim();\n      const error = validate?.(trimmed) ?? undefined;\n      const validValue = isNullish(error) ? trimmed : undefined;\n\n      if (!isInitialValue) {\n        onValueChange(validValue);\n      }\n\n      return {\n        inputValue,\n        validValue,\n        error: isInitialValue ? undefined : error,\n      };\n    },\n    [validate, onValueChange],\n  );\n\n  const [{ inputValue, validValue, error }, setState] = useState(() =>\n    getValueState(initialValue, true),\n  );\n\n  const onChangeText = useCallback(\n    (value: string) => setState(getValueState(value, false)),\n    [getValueState],\n  );\n\n  return (\n    <View style={styles.container}>\n      <FilterTag\n        label={label}\n        onPress={toggle}\n        ref={tagRef}\n        onPressRemove={onPressRemove}\n        isActive={visible}\n        value={validValue ?? noValueText}\n      />\n\n      <Popover\n        role=\"listbox\"\n        matchReferenceWidth={false}\n        onDismiss={close}\n        referenceRef={tagRef}\n        returnFocus={false}\n        visible={visible}\n      >\n        <View style={[styles.dropdown, styles.inputContent]}>\n          <LakeLabel\n            label={label}\n            render={id => (\n              <LakeTextInput\n                id={id}\n                value={inputValue}\n                error={error}\n                style={styles.input}\n                placeholder={placeholder}\n                onChangeText={onChangeText}\n              />\n            )}\n          />\n        </View>\n      </Popover>\n    </View>\n  );\n};\n\nexport type FilterCheckboxDef<T> = {\n  type: \"checkbox\";\n  label: string;\n  items: Item<T>[];\n  width?: number;\n  checkAllLabel?: string;\n};\n\nexport type FilterRadioDef<T> = {\n  type: \"radio\";\n  label: string;\n  items: Item<T>[];\n  width?: number;\n};\n\nexport type FilterDateDef<Values = unknown> = {\n  type: \"date\";\n  label: string;\n  cancelText: string;\n  submitText: string;\n  noValueText: string;\n  dateFormat: DateFormat;\n  isSelectable?: (date: DatePickerDate, filters: Values) => boolean;\n  validate?: (value: string, filters: Values) => ValidatorResult;\n};\n\nexport type FilterInputDef = {\n  type: \"input\";\n  label: string;\n  noValueText: string;\n  placeholder?: string;\n  validate?: (value: string) => ValidatorResult;\n};\n\ntype Filter<T> = FilterCheckboxDef<T> | FilterRadioDef<T> | FilterDateDef | FilterInputDef;\n\ntype ExtractFilterValue<T extends Filter<unknown>> = T extends { type: \"checkbox\" }\n  ? T[\"items\"][number][\"value\"][] | undefined\n  : T extends { type: \"radio\" }\n    ? T[\"items\"][number][\"value\"] | undefined\n    : string | undefined;\n\nconst getFilterValue = <T extends Filter<unknown>[\"type\"]>(\n  _type: T,\n  filters: FiltersState<FiltersDefinition>,\n  name: string,\n) => filters[name] as ExtractFilterValue<Extract<Filter<unknown>, { type: T }>>;\n\ntype FiltersDefinition = Record<string, Filter<unknown>>;\n\nexport type FiltersState<T extends FiltersDefinition> = Simplify<{\n  [K in keyof T]: Simplify<ExtractFilterValue<T[K]>>;\n}>;\n\ntype FiltersStackProps<\n  Definition extends FiltersDefinition,\n  State extends FiltersState<Definition> = FiltersState<Definition>,\n> = {\n  definition: Definition;\n  filters: State;\n  openedFilters: (keyof Definition)[];\n  onChangeOpened: (value: (keyof Definition)[]) => void;\n  onChangeFilters: (value: State) => void;\n};\n\nexport const FiltersStack = <T extends FiltersDefinition>({\n  filters,\n  openedFilters,\n  definition,\n  onChangeOpened,\n  onChangeFilters,\n}: FiltersStackProps<T>) => {\n  const previousOpened = usePreviousValue(openedFilters);\n\n  const lastOpenedFilter =\n    openedFilters.length > previousOpened.length\n      ? openedFilters[openedFilters.length - 1]\n      : undefined;\n\n  if (openedFilters.length === 0) {\n    return null;\n  }\n\n  return (\n    <Stack direction=\"row\" wrap=\"wrap\">\n      {openedFilters.map(filterName => {\n        const filterDefinition = definition[filterName];\n\n        if (typeof filterName !== \"string\" || filterDefinition == null) {\n          return null;\n        }\n\n        return (\n          <View key={filterName}>\n            {match<Filter<unknown>>(filterDefinition)\n              .with({ type: \"radio\" }, ({ type, label, items, width }) => (\n                <FilterRadio\n                  label={label}\n                  items={items}\n                  width={width}\n                  autoOpen={lastOpenedFilter === filterName}\n                  onPressRemove={() => {\n                    onChangeFilters({ ...filters, [filterName]: undefined });\n                    onChangeOpened(openedFilters.filter(f => f !== filterName));\n                  }}\n                  value={getFilterValue(type, filters, filterName)}\n                  onValueChange={value => onChangeFilters({ ...filters, [filterName]: value })}\n                />\n              ))\n              .with({ type: \"checkbox\" }, ({ type, label, items, width, checkAllLabel }) => (\n                <FilterCheckbox\n                  label={label}\n                  items={items}\n                  width={width}\n                  checkAllLabel={checkAllLabel}\n                  autoOpen={lastOpenedFilter === filterName}\n                  value={getFilterValue(type, filters, filterName)}\n                  onValueChange={value => onChangeFilters({ ...filters, [filterName]: value })}\n                  onPressRemove={() => {\n                    onChangeFilters({ ...filters, [filterName]: undefined });\n                    onChangeOpened(openedFilters.filter(f => f !== filterName));\n                  }}\n                />\n              ))\n              .with(\n                { type: \"date\" },\n                ({\n                  type,\n                  label,\n                  noValueText,\n                  cancelText,\n                  submitText,\n                  dateFormat,\n                  isSelectable,\n                  validate,\n                }) => (\n                  <FilterDate\n                    label={label}\n                    noValueText={noValueText}\n                    cancelText={cancelText}\n                    submitText={submitText}\n                    dateFormat={dateFormat}\n                    autoOpen={lastOpenedFilter === filterName}\n                    isSelectable={isSelectable ? date => isSelectable(date, filters) : undefined}\n                    validate={validate ? value => validate(value, filters) : undefined}\n                    initialValue={getFilterValue(type, filters, filterName)}\n                    onValueChange={value => onChangeFilters({ ...filters, [filterName]: value })}\n                    onPressRemove={() => {\n                      onChangeFilters({ ...filters, [filterName]: undefined });\n                      onChangeOpened(openedFilters.filter(f => f !== filterName));\n                    }}\n                  />\n                ),\n              )\n              .with({ type: \"input\" }, ({ type, label, placeholder, noValueText, validate }) => (\n                <FilterInput\n                  label={label}\n                  placeholder={placeholder}\n                  noValueText={noValueText}\n                  autoOpen={lastOpenedFilter === filterName}\n                  validate={validate}\n                  initialValue={getFilterValue(type, filters, filterName)}\n                  onValueChange={value => onChangeFilters({ ...filters, [filterName]: value })}\n                  onPressRemove={() => {\n                    onChangeFilters({ ...filters, [filterName]: undefined });\n                    onChangeOpened(openedFilters.filter(f => f !== filterName));\n                  }}\n                />\n              ))\n              .exhaustive()}\n          </View>\n        );\n      })}\n    </Stack>\n  );\n};\n\nexport const filter = {\n  checkbox: <T,>(config: { label: string; items: Item<T>[] }): FilterCheckboxDef<T> => ({\n    type: \"checkbox\",\n    label: config.label,\n    items: config.items,\n    checkAllLabel: t(\"common.filters.all\"),\n  }),\n\n  date: (config: {\n    label: string;\n    isSelectable?: (date: DatePickerDate, filters: unknown) => boolean;\n    validate?: (value: string, filters: unknown) => ValidatorResult;\n  }): FilterDateDef => ({\n    type: \"date\",\n    label: config.label,\n    cancelText: t(\"common.filters.cancel\"),\n    submitText: t(\"common.filters.apply\"),\n    noValueText: t(\"common.filters.none\"),\n    dateFormat: locale.dateFormat,\n    isSelectable: config.isSelectable,\n    validate: config.validate,\n  }),\n\n  input: (config: {\n    label: string;\n    placeholder?: string;\n    validate?: (value: string) => ValidatorResult;\n  }): FilterInputDef => ({\n    type: \"input\",\n    label: config.label,\n    noValueText: t(\"common.filters.none\"),\n    placeholder: config.placeholder,\n    validate: config.validate,\n  }),\n\n  radio: <T,>(config: { label: string; items: Item<T>[] }): FilterRadioDef<T> => ({\n    type: \"radio\",\n    label: config.label,\n    items: config.items,\n  }),\n} as const;\n\nexport const useFiltersProps = <\n  Definition extends FiltersDefinition,\n  Filters extends Record<string, unknown>,\n>({\n  available,\n  filters,\n  filtersDefinition,\n}: {\n  available?: ReadonlyArray<keyof Filters>;\n  filters: Filters;\n  filtersDefinition: Definition;\n}) => {\n  const availableFilters: { name: keyof Definition; label: string }[] = useMemo(() => {\n    const availableSet = new Set<PropertyKey>(\n      isNullish(available) ? Dict.keys(filtersDefinition) : available,\n    );\n\n    return Array.filterMap(Dict.entries(filtersDefinition), ([name, { label }]) =>\n      availableSet.has(name) ? Option.Some({ name, label }) : Option.None(),\n    );\n  }, [available, filtersDefinition]);\n\n  const [openFilters, setOpenFilters] = useState(() =>\n    Dict.entries(filters)\n      .filter(([, value]) => isNotNullish(value))\n      .map(([name]) => name),\n  );\n\n  useEffect(() => {\n    setOpenFilters(openFilters => {\n      const currentlyOpenFilters = new Set(openFilters);\n      const openFiltersNotYetInState = Dict.entries(filters)\n        .filter(([name, value]) => isNotNullish(value) && !currentlyOpenFilters.has(name))\n        .map(([name]) => name);\n      return [...openFilters, ...openFiltersNotYetInState];\n    });\n  }, [filters]);\n\n  const onAddFilter = useCallback((filter: keyof Filters) => {\n    setOpenFilters(openFilters => [...openFilters, filter]);\n  }, []);\n\n  return {\n    chooser: {\n      availableFilters,\n      filters,\n      label: t(\"common.filters\"),\n      onAddFilter,\n      openFilters,\n    },\n    stack: {\n      definition: filtersDefinition,\n      filters,\n      openedFilters: openFilters,\n      onChangeOpened: setOpenFilters,\n    },\n  };\n};\n","import { Meta } from \"@storybook/react\";\nimport { Box } from \"@swan-io/lake/src/components/Box\";\nimport { FilterChooser } from \"@swan-io/lake/src/components/FilterChooser\";\nimport { Space } from \"@swan-io/lake/src/components/Space\";\nimport { WithCurrentColor } from \"@swan-io/lake/src/components/WithCurrentColor\";\nimport { useState } from \"react\";\nimport { filter, FiltersStack, FiltersState, useFiltersProps } from \"../src/components/Filters\";\nimport { StoryBlock } from \"./_StoriesComponents\";\n\nconst filtersDefinition = {\n  mode: filter.radio({\n    label: \"Mode\",\n    items: [\n      { label: \"QES\", value: \"QES\" },\n      { label: \"Expert\", value: \"Expert\" },\n    ],\n  }),\n\n  status: filter.checkbox({\n    label: \"Status\",\n    items: [\n      { label: \"Accepted\", value: \"Accepted\" },\n      { label: \"Canceled\", value: \"Canceled\" },\n      { label: \"Failed\", value: \"Failed\" },\n      { label: \"Expired\", value: \"Expired\" },\n      { label: \"CustomerRefused\", value: \"CustomerRefused\" },\n    ],\n  }),\n\n  startDate: filter.date({\n    label: \"Start Date\",\n  }),\n\n  resourceId: filter.input({\n    label: \"Resource ID\",\n    placeholder: \"Placeholder...\",\n    validate: value => {\n      if (value.length < 3) {\n        return \"Not long enough\";\n      }\n    },\n  }),\n};\n\ntype State = FiltersState<typeof filtersDefinition>;\n\nexport default {\n  title: \"Forms/Filters\",\n  component: FilterChooser,\n} as Meta<typeof FilterChooser>;\n\nexport const All = () => {\n  const [filters, setFilters] = useState<State>({\n    mode: undefined,\n    status: undefined,\n    resourceId: undefined,\n    startDate: undefined,\n  });\n\n  const filtersProps = useFiltersProps({ filtersDefinition, filters });\n\n  return (\n    <StoryBlock title=\"Filters\">\n      <WithCurrentColor variant=\"live\">\n        <Box alignItems=\"start\">\n          <FilterChooser {...filtersProps.chooser} />\n          <Space height={8} />\n          <FiltersStack {...filtersProps.stack} onChangeFilters={setFilters} />\n        </Box>\n      </WithCurrentColor>\n    </StoryBlock>\n  );\n};\n"],"names":["styles","StyleSheet","colors","FilterChooser","filters","openFilters","label","title","availableFilters","large","onAddFilter","inputRef","useRef","visible","close","toggle","useDisclosure","jsxs","Fragment","jsx","LakeButton","Popover","View","isNotNullishOrEmpty","LakeText","Space","FlatList","_","index","item","isSet","Pressable","hovered","Icon","shadows","FilterTag","forwardRef","onPress","onPressRemove","value","isActive","ref","mergedRef","useMergeRefs","Tag","Box","Text","FilterRadio","items","width","onValueChange","autoOpen","currentValue","useMemo","i","isSelected","LakeRadio","FilterCheckbox","checkAllLabel","valueSet","allChecked","listItems","checked","match","P","nextValues","LakeCheckbox","FilterDate","initialValue","noValueText","cancelText","submitText","dateFormat","isSelectable","validate","isNotNullish","dayjs","DatePickerModal","formattedValue","FilterInput","placeholder","tagRef","getValueState","useCallback","inputValue","isInitialValue","trimmed","error","validValue","isNullish","setState","useState","onChangeText","LakeLabel","id","LakeTextInput","getFilterValue","_type","name","FiltersStack","openedFilters","definition","onChangeOpened","onChangeFilters","previousOpened","usePreviousValue","lastOpenedFilter","Stack","filterName","filterDefinition","type","f","date","filter","config","t","locale","useFiltersProps","available","filtersDefinition","availableSet","Dict","Array","Option","setOpenFilters","useEffect","currentlyOpenFilters","openFiltersNotYetInState","mode","radio","status","checkbox","startDate","resourceId","input","length","Filters_stories","component","All","setFilters","undefined","filtersProps","StoryBlock","WithCurrentColor","chooser","stack"],"mappings":"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"}