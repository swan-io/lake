{"version":3,"file":"SearchField.stories-F25ikhIn.js","sources":["../../../packages/lake/src/hooks/useDebounce.ts","../../../packages/lake/src/components/LakeSearchField.tsx","../../../packages/lake/__stories__/SearchField.stories.tsx"],"sourcesContent":["import { useCallback, useRef } from \"react\";\nimport { isNotNullish } from \"../utils/nullish\";\n\nexport const useDebounce = <T>(func: (arg: T) => void, duration: number) => {\n  const timeoutRef = useRef<number | undefined>(undefined);\n\n  return useCallback(\n    (arg: T) => {\n      if (isNotNullish(timeoutRef.current)) {\n        clearTimeout(timeoutRef.current);\n      }\n      timeoutRef.current = window.setTimeout(func, duration, arg);\n      return () => clearTimeout(timeoutRef.current);\n    },\n    [func, duration],\n  );\n};\n","import { ReactNode, Ref, useCallback, useRef, useState } from \"react\";\nimport { Pressable, StyleSheet, TextInput, View } from \"react-native\";\nimport { animations, backgroundColor, colors, radii, spacings } from \"../constants/design\";\nimport { useBoolean } from \"../hooks/useBoolean\";\nimport { useDebounce } from \"../hooks/useDebounce\";\nimport { isNotNullishOrEmpty } from \"../utils/nullish\";\nimport { LakeButton } from \"./LakeButton\";\nimport { LakeTextInput } from \"./LakeTextInput\";\nimport { ResponsiveContainer } from \"./ResponsiveContainer\";\nimport { Line, Svg } from \"./Svg\";\nimport { TransitionView } from \"./TransitionView\";\n\nconst styles = StyleSheet.create({\n  container: {\n    flexGrow: 1,\n    flexShrink: 1,\n  },\n  input: {\n    transition: \"300ms ease-in-out border-color\",\n    // ResponsiveContainer uses a 200 breaking,\n    // we give the opportunity to the component to grow 2px more\n    // to trigger the change\n    maxWidth: 202,\n    minWidth: 38,\n    justifyContent: \"flex-end\",\n  },\n  focus: {\n    outlineStyle: \"none\",\n    borderColor: colors.current.primary,\n  },\n  clearButton: {\n    marginRight: spacings[8],\n  },\n  clear: {\n    width: 8,\n    height: 8,\n  },\n  smallButtonContainer: {\n    flexDirection: \"row\",\n    justifyContent: \"flex-end\",\n    flexGrow: 1,\n  },\n  largeInputContainer: {\n    flexDirection: \"row\",\n    justifyContent: \"flex-end\",\n    flexGrow: 1,\n  },\n  openSearchFieldContainer: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n    bottom: 0,\n  },\n  openSearchField: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n    bottom: 0,\n    boxShadow: `0 0 20px 20px ${backgroundColor.default}`,\n    borderRadius: radii[6],\n  },\n});\n\ntype Props = {\n  initialValue: string;\n  placeholder: string;\n  onChangeText: (text: string) => void;\n  debounceDuration?: number;\n  maxWidth?: number;\n  renderEnd?: () => ReactNode;\n};\n\ntype InternalProps = {\n  inputRef: Ref<TextInput>;\n  placeholder: string;\n  initialValue: string;\n  onChange: (value: string) => void;\n  setFocused: { on: () => void; off: () => void };\n  hasFocus: boolean;\n  clear: () => void;\n  currentValue: string;\n  renderEnd?: () => ReactNode;\n};\n\nconst CollapsibleSeachField = ({\n  inputRef,\n  placeholder,\n  initialValue,\n  onChange,\n  setFocused,\n  hasFocus,\n  clear,\n  currentValue,\n  renderEnd,\n}: InternalProps) => {\n  return (\n    <View style={styles.smallButtonContainer}>\n      <LakeButton\n        mode=\"secondary\"\n        size=\"small\"\n        ariaLabel={placeholder}\n        icon=\"search-filled\"\n        onPress={() => {\n          setFocused.on();\n        }}\n        pill={currentValue !== \"\"}\n      />\n\n      <TransitionView\n        style={styles.openSearchFieldContainer}\n        {...animations.fadeAndSlideInFromRight}\n      >\n        {hasFocus ? (\n          <View style={styles.openSearchField}>\n            <ExpandedSearchField\n              inputRef={inputRef}\n              placeholder={placeholder}\n              initialValue={initialValue}\n              onChange={onChange}\n              setFocused={setFocused}\n              hasFocus={hasFocus}\n              clear={clear}\n              currentValue={currentValue}\n              renderEnd={renderEnd}\n            />\n          </View>\n        ) : null}\n      </TransitionView>\n    </View>\n  );\n};\n\nconst ExpandedSearchField = ({\n  inputRef,\n  placeholder,\n  initialValue,\n  onChange,\n  setFocused,\n  hasFocus,\n  clear,\n  renderEnd,\n  currentValue,\n}: InternalProps) => {\n  const timeoutRef = useRef<number | null>(null);\n\n  return (\n    <LakeTextInput\n      ref={inputRef}\n      autoFocus={hasFocus}\n      icon=\"search-filled\"\n      placeholder={placeholder}\n      defaultValue={initialValue}\n      inputMode=\"search\"\n      onChangeText={onChange}\n      hideErrors={true}\n      renderEnd={() => (\n        <>\n          {isNotNullishOrEmpty(currentValue) && (\n            <Pressable\n              onPress={() => {\n                if (timeoutRef.current != null) {\n                  clearTimeout(timeoutRef.current);\n                }\n                clear();\n              }}\n              style={styles.clearButton}\n            >\n              <Svg viewBox=\"0 0 16 16\" style={styles.clear}>\n                <>\n                  <Line\n                    x1=\"0\"\n                    x2=\"16\"\n                    y1=\"0\"\n                    y2=\"16\"\n                    strokeLinecap=\"round\"\n                    stroke={colors.gray[500]}\n                    strokeWidth={2}\n                  />\n\n                  <Line\n                    x1=\"0\"\n                    x2=\"16\"\n                    y1=\"16\"\n                    y2=\"0\"\n                    strokeLinecap=\"round\"\n                    stroke={colors.gray[500]}\n                    strokeWidth={2}\n                  />\n                </>\n              </Svg>\n            </Pressable>\n          )}\n\n          {renderEnd?.()}\n        </>\n      )}\n      onFocus={() => {\n        if (timeoutRef.current != null) {\n          clearTimeout(timeoutRef.current);\n        }\n        setFocused.on();\n      }}\n      onBlur={() => {\n        timeoutRef.current = window.setTimeout(() => {\n          setFocused.off();\n        }, 300);\n      }}\n      containerStyle={styles.largeInputContainer}\n      style={[styles.input, hasFocus ? styles.focus : null]}\n    />\n  );\n};\n\nexport const LakeSearchField = ({\n  initialValue,\n  placeholder,\n  onChangeText,\n  debounceDuration = 500,\n  maxWidth,\n  renderEnd,\n}: Props) => {\n  const [hasFocus, setFocused] = useBoolean(false);\n  const inputRef = useRef<TextInput>(null);\n\n  const [currentValue, setCurrentValue] = useState(initialValue);\n\n  const onChange = useDebounce((value: string) => {\n    onChangeText(value);\n    setCurrentValue(value.trim());\n  }, debounceDuration);\n\n  const clear = useCallback(() => {\n    if (inputRef.current instanceof HTMLInputElement) {\n      inputRef.current.clear();\n      inputRef.current.focus();\n      onChangeText(\"\");\n      setCurrentValue(\"\");\n    }\n  }, [onChangeText]);\n\n  const props = {\n    inputRef,\n    placeholder,\n    initialValue,\n    onChange,\n    setFocused,\n    hasFocus,\n    clear,\n    currentValue,\n    renderEnd,\n  };\n\n  return (\n    <ResponsiveContainer\n      breakpoint={200}\n      style={[styles.container, maxWidth != null && { maxWidth }]}\n    >\n      {({ large }) => {\n        const Component = large ? ExpandedSearchField : CollapsibleSeachField;\n        return <Component {...props} />;\n      }}\n    </ResponsiveContainer>\n  );\n};\n","import { Meta } from \"@storybook/react\";\nimport { useState } from \"react\";\nimport { StyleSheet } from \"react-native\";\nimport { Box } from \"../src/components/Box\";\nimport { Fill } from \"../src/components/Fill\";\nimport { Icon } from \"../src/components/Icon\";\nimport { LakeSearchField } from \"../src/components/LakeSearchField\";\nimport { LakeText } from \"../src/components/LakeText\";\nimport { Space } from \"../src/components/Space\";\nimport { Tag } from \"../src/components/Tag\";\nimport { StoryBlock, StoryPart } from \"./_StoriesComponents\";\n\nconst styles = StyleSheet.create({\n  container: {\n    maxWidth: 600,\n  },\n});\n\nexport default {\n  title: \"Forms/SearchField\",\n  component: LakeSearchField,\n} as Meta<typeof LakeSearchField>;\n\nexport const Variations = () => {\n  const [text1, setText1] = useState<string>();\n  const [text2, setText2] = useState<string>();\n  return (\n    <StoryBlock title=\"SearchField\">\n      <StoryPart title=\"Default\" style={styles.container}>\n        <LakeSearchField initialValue=\"\" placeholder=\"Placeholder\" onChangeText={setText1} />\n        <Space height={12} />\n        <LakeText>Debounced value: {text1}</LakeText>\n      </StoryPart>\n\n      <StoryPart title=\"With initialValue\">\n        <Box direction=\"row\">\n          <Icon name=\"add-circle-filled\" size={32} />\n          <Fill minWidth={96} />\n\n          <LakeSearchField\n            initialValue=\"Initial value\"\n            placeholder=\"Placeholder\"\n            onChangeText={setText2}\n          />\n        </Box>\n\n        <Space height={12} />\n        <LakeText>Debounced value: {text2}</LakeText>\n      </StoryPart>\n\n      <StoryPart title=\"With counter\">\n        <LakeSearchField\n          initialValue=\"Initial value\"\n          placeholder=\"Placeholder\"\n          onChangeText={setText2}\n          renderEnd={() => <Tag>44</Tag>}\n        />\n      </StoryPart>\n    </StoryBlock>\n  );\n};\n"],"names":["useDebounce","func","duration","timeoutRef","useRef","useCallback","arg","isNotNullish","styles","StyleSheet","colors","spacings","backgroundColor","radii","CollapsibleSeachField","inputRef","placeholder","initialValue","onChange","setFocused","hasFocus","clear","currentValue","renderEnd","jsxs","View","jsx","LakeButton","TransitionView","animations","ExpandedSearchField","LakeTextInput","Fragment","isNotNullishOrEmpty","Pressable","Svg","Line","LakeSearchField","onChangeText","debounceDuration","maxWidth","useBoolean","setCurrentValue","useState","value","props","ResponsiveContainer","large","Component","create","container","SearchField_stories","title","component","Variations","text1","setText1","text2","setText2","StoryBlock","StoryPart","Space","LakeText","Box","Icon","Fill","Tag"],"mappings":"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"}