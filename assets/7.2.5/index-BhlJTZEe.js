import{Q as g,O as T,a0 as S}from"./Space-B3r5-oVe.js";class w{constructor(t){var e=t.onMoreTasks;this._onMoreTasks=e,this._queueStack=[{tasks:[],popable:!0}]}enqueue(t){this._getCurrentQueue().push(t)}enqueueTasks(t){t.forEach(e=>this.enqueue(e))}cancelTasks(t){this._queueStack=this._queueStack.map(e=>g(g({},e),{},{tasks:e.tasks.filter(r=>t.indexOf(r)===-1)})).filter((e,r)=>e.tasks.length>0||r===0)}hasTasksToProcess(){return this._getCurrentQueue().length>0}processNext(){var t=this._getCurrentQueue();if(t.length){var e=t.shift();try{typeof e=="object"&&e.gen?this._genPromise(e):typeof e=="object"&&e.run?e.run():(T(typeof e=="function",`Expected Function, SimpleTask, or PromiseTask, but got:
`+JSON.stringify(e,null,2)),e())}catch(r){throw r.message="TaskQueue: Error with task "+(e.name||"")+": "+r.message,r}}}_getCurrentQueue(){var t=this._queueStack.length-1,e=this._queueStack[t];return e.popable&&e.tasks.length===0&&t>0?(this._queueStack.pop(),this._getCurrentQueue()):e.tasks}_genPromise(t){var e=this._queueStack.push({tasks:[],popable:!1}),r=e-1,n=this._queueStack[r];t.gen().then(()=>{n.popable=!0,this.hasTasksToProcess()&&this._onMoreTasks()}).catch(s=>{setTimeout(()=>{throw s.message="TaskQueue: Error resolving Promise in task "+t.name+": "+s.message,s},0)})}}const q=w;class b{constructor(){this._registry={}}addListener(t,e,r){var n=C(this._registry,t),s={context:r,listener:e,remove(){n.delete(s)}};return n.add(s),s}emit(t){var e=this._registry[t];if(e!=null){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];for(var v=0,m=[...e];v<m.length;v++){var p=m[v];p.listener.apply(p.context,n)}}}removeAllListeners(t){t==null?this._registry={}:delete this._registry[t]}listenerCount(t){var e=this._registry[t];return e==null?0:e.size}}function C(a,t){var e=a[t];return e==null&&(e=new Set,a[t]=e),e}var I=function(t,e){return setTimeout(()=>{var r=Date.now();t({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-r))}})},1)},E=S&&typeof window.requestIdleCallback<"u",Q=E?window.requestIdleCallback:I,l=new b,k={Events:{interactionStart:"interactionStart",interactionComplete:"interactionComplete"},runAfterInteractions(a){var t=[],e=new Promise(r=>{i(),a&&t.push(a),t.push({run:r,name:"resolve "+(a&&a.name||"?")}),h.enqueueTasks(t)});return{then:e.then.bind(e),done:e.then.bind(e),cancel:()=>{h.cancelTasks(t)}}},createInteractionHandle(){i();var a=++x;return c.add(a),a},clearInteractionHandle(a){T(!!a,"Must provide a handle to clear."),i(),c.delete(a),f.add(a)},addListener:l.addListener.bind(l),setDeadline(a){d=a}},o=new Set,c=new Set,f=new Set,h=new q({onMoreTasks:i}),u=0,x=0,d=-1;function i(){u||(d>0?u=setTimeout(_):u=Q(_))}function _(){u=0;var a=o.size;c.forEach(r=>o.add(r)),f.forEach(r=>o.delete(r));var t=o.size;if(a!==0&&t===0?l.emit(k.Events.interactionComplete):a===0&&t!==0&&l.emit(k.Events.interactionStart),t===0){for(var e=Date.now();h.hasTasksToProcess();)if(h.processNext(),d>0&&Date.now()-e>=d){i();break}}c.clear(),f.clear()}export{b as E,k as I};
//# sourceMappingURL=index-BhlJTZEe.js.map
