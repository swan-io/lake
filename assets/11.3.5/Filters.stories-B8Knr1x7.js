import{j as e}from"./jsx-runtime-DT09rT5F.js";import{r as g}from"./index-DXKZGL6g.js";import{B as Q,V as w,s as J,k as U,L as H,S as D,I as G,c as C,z as q,T as M,N as I,i as B,l as X,d as Z,W as ee}from"./ScrollView-DmQfgLfc.js";import{u as T}from"./useDisclosure-CwHJfrsH.js";import{P as L,F as E}from"./Popover-D6DUAftz.js";import{L as te}from"./LakeButton-CVVSHUYx.js";import{M as V}from"./index-BwY4x6i0.js";import{L as re}from"./LakeCheckbox-DofD42Gj.js";import{L as ne}from"./LakeLabel-l7dK7hcQ.js";import{L as se}from"./LakeRadio-DfEvTXhY.js";import{L as ie}from"./LakeTextInput-QJ4qFEyK.js";import{S as oe}from"./Stack-BrYJlv04.js";import{T as ae}from"./Tag-hIyzxUTJ.js";import{u as le}from"./Pressable-qr-VC_qH.js";import{u as de}from"./TransitionView-B8hXHfhO.js";import{d as O}from"./utc-D_eSGhSe.js";import{D as ce}from"./DatePicker-BjnwYItK.js";import{S as ue}from"./_StoriesComponents-B9HmSSEq.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-BlQSi2IU.js";import"./useResponsive-6iDeDSbQ.js";import"./function-CEqjUwAs.js";import"./BottomPanel-BUH_mbnv.js";import"./commonStyles-BBEkV6IC.js";import"./useBodyClassName-CYzM7DM-.js";import"./FocusTrap-DNHrld98.js";import"./array-BfAlyugE.js";import"./Suspendable-BjksFpPY.js";import"./index-BJTS7HPn.js";import"./extends-CF3RwP-h.js";import"./v4-C6aID195.js";import"./Fill-CUnIUPIA.js";import"./LakeSelect-QJXODN46.js";import"./Separator-DsQMCOlS.js";import"./index-Yq17wMy8.js";import"./rifm-O4oTxRTM.js";import"./rifm.esm-B_sHgh9o.js";import"./i18n-CSSfE9Sx.js";import"./LakeModal-DAlslLff.js";import"./LakeHeading-D5hgUnge.js";import"./ResponsiveContainer-CJ6uRWwm.js";const S=J.create({selected:{color:C.gray[500]},list:{paddingVertical:20,marginVertical:4,minWidth:250,overflow:"hidden"},item:{display:"flex",paddingHorizontal:24,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:8},itemHovered:{backgroundColor:C.gray[50]},availableFiltersTitle:{paddingHorizontal:24}});function _({filters:s,openFilters:t,label:m,title:o,availableFilters:l,large:i=!0,onAddFilter:f}){const r=g.useRef(null),[h,{close:c,toggle:x}]=T(!1);return e.jsxs(e.Fragment,{children:[e.jsx(Q,{direction:"row",justifyContent:"start",alignItems:"center",children:e.jsx(te,{size:"small",mode:"secondary",color:"gray",onPress:x,ref:r,icon:i?"chevron-down-filled":"filter-filled",iconPosition:"end",ariaLabel:m,children:i?m:null})}),e.jsx(L,{role:"listbox",matchReferenceMinWidth:!0,onDismiss:c,referenceRef:r,returnFocus:!1,visible:h,children:e.jsxs(w,{style:S.list,children:[U(o)?e.jsxs(e.Fragment,{children:[e.jsx(H,{style:S.availableFiltersTitle,children:o}),e.jsx(D,{height:8})]}):null,e.jsx(E,{role:"list",data:l,keyExtractor:(a,n)=>`filter-item-${n}`,renderItem:({item:a})=>{const n=!!s[a.name]||t.includes(a.name);return e.jsxs(V,{style:({hovered:d})=>[S.item,d&&S.itemHovered],role:"button",disabled:n,onPress:()=>{f(a.name),c()},children:[e.jsx(H,{variant:"smallRegular",style:n&&S.selected,children:a.label}),n&&e.jsx(G,{color:C.positive[500],name:"checkmark-filled",size:14})]})}})]})})]})}_.__docgenInfo={description:"",methods:[],displayName:"FilterChooser",props:{filters:{required:!0,tsType:{name:"Partial",elements:[{name:"Record",elements:[{name:"FilterName"},{name:"unknown"}],raw:"Record<FilterName, unknown>"}],raw:"Partial<Record<FilterName, unknown>>"},description:""},openFilters:{required:!0,tsType:{name:"Array",elements:[{name:"FilterName"}],raw:"FilterName[]"},description:""},label:{required:!0,tsType:{name:"string"},description:""},title:{required:!1,tsType:{name:"string"},description:""},availableFilters:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ label: string; name: FilterName }",signature:{properties:[{key:"label",value:{name:"string",required:!0}},{key:"name",value:{name:"FilterName",required:!0}}]}}],raw:"{ label: string; name: FilterName }[]"},description:""},large:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},onAddFilter:{required:!0,tsType:{name:"signature",type:"function",raw:"(filterName: FilterName) => void",signature:{arguments:[{type:{name:"FilterName"},name:"filterName"}],return:{name:"void"}}},description:""}}};const u=J.create({container:{paddingRight:12,paddingBottom:8},shadowed:{position:"absolute",opacity:0,width:"100%",height:"100%",borderRadius:4,boxShadow:X.tile,transitionDuration:"150ms",transitionProperty:"opacity"},hovered:{opacity:1},dropdown:{maxHeight:400,minWidth:200},itemHovered:{backgroundColor:C.gray[50]},content:{paddingVertical:12},inputContent:{paddingHorizontal:24,paddingTop:24,paddingBottom:16},radio:{display:"flex",flexDirection:"row",alignItems:"center",height:32,paddingHorizontal:24},itemLabel:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},input:{width:250},value:{maxWidth:130,whiteSpace:"nowrap"}}),A=g.forwardRef(({onPress:s,onPressRemove:t,label:m,value:o="",isActive:l},i)=>{const f=g.useRef(null),r=le(f,i);return e.jsx(V,{ref:r,onPress:s,children:({hovered:h})=>e.jsxs(e.Fragment,{children:[e.jsx(w,{style:[u.shadowed,h&&u.hovered]}),e.jsx(ae,{label:m,color:"current",onPressRemove:t,children:e.jsxs(Q,{direction:"row",alignItems:"center",children:[e.jsx(M,{numberOfLines:1,style:u.value,children:o}),e.jsx(D,{width:4}),e.jsx(G,{color:C.current.primary,name:l?"chevron-up-filled":"chevron-down-filled",size:16})]})})]})})});function me({label:s,items:t,width:m,value:o,onValueChange:l,onPressRemove:i,autoOpen:f=!1}){const r=g.useRef(null),[h,{close:c,toggle:x}]=T(f),a=g.useMemo(()=>t.find(n=>n.value===o),[t,o]);return e.jsxs(w,{style:u.container,children:[e.jsx(A,{label:s,onPress:x,ref:r,onPressRemove:i,isActive:h,value:a==null?void 0:a.label}),e.jsx(L,{role:"listbox",matchReferenceWidth:!1,onDismiss:c,referenceRef:r,returnFocus:!1,visible:h,children:e.jsx(E,{role:"list",data:t,style:[u.dropdown,{width:m}],contentContainerStyle:u.content,keyExtractor:(n,d)=>`filter-item-${d}`,renderItem:({item:n})=>{const d=o===n.value;return e.jsxs(V,{role:"radio","aria-checked":d,style:({hovered:y})=>[u.radio,y&&u.itemHovered],onPress:()=>{l(n.value),c()},children:[e.jsx(se,{value:d}),e.jsx(D,{width:12}),e.jsx(M,{style:u.itemLabel,children:n.label})]})}})})]})}function pe({label:s,items:t,width:m,checkAllLabel:o,value:l,onValueChange:i,onPressRemove:f,autoOpen:r=!1}){const h=g.useRef(null),[c,{close:x,toggle:a}]=T(r),n=g.useMemo(()=>new Set(l),[l]),d=g.useMemo(()=>t.filter(v=>n.has(v.value)),[t,n]),y=o!=null&&n.size===t.length,F=g.useMemo(()=>{if(o==null)return t;const v=n.size===0?!1:n.size===t.length?!0:"mixed";return[{label:o,checked:v},...t]},[t,o,n]);return e.jsxs(w,{style:u.container,children:[e.jsx(A,{label:s,onPress:a,ref:h,onPressRemove:f,isActive:c,value:y?o:d.map(v=>v.label).join(", ")}),e.jsx(L,{role:"listbox",matchReferenceWidth:!1,onDismiss:x,referenceRef:h,returnFocus:!1,visible:c,children:e.jsx(E,{role:"list",data:F,style:[u.dropdown,{width:m}],contentContainerStyle:u.content,keyExtractor:(v,p)=>`filter-item-${p}`,renderItem:({item:v})=>{const p=q(v).with({checked:I.any},({checked:j})=>j).with({value:I.any},({value:j})=>n.has(j)).exhaustive(),k=q(v).with({checked:I.any},({checked:j})=>()=>{i(j===!0?void 0:t.map(b=>b.value))}).with({value:I.any},({value:j})=>()=>{const b=new Set([...n]);p===!0?b.delete(j):b.add(j),b.size===0?i(void 0):i([...b])}).exhaustive();return e.jsxs(V,{role:"radio","aria-checked":p,style:({hovered:j})=>[u.radio,j&&u.itemHovered],onPress:k,children:[e.jsx(re,{value:p}),e.jsx(D,{width:12}),e.jsx(M,{style:u.itemLabel,children:v.label})]})}})})]})}function fe({label:s,initialValue:t,noValueText:m,cancelText:o,submitText:l,dateFormat:i,isSelectable:f,validate:r,onValueChange:h,onPressRemove:c,autoOpen:x=!1}){const a=g.useRef(null),[n,{close:d,toggle:y}]=T(x),F=g.useMemo(()=>B(t)?O(t).format(i):"",[t,i]);return e.jsxs(w,{style:u.container,children:[e.jsx(A,{label:s,onPress:y,ref:a,onPressRemove:c,isActive:n,value:B(t)?O(t).format(i):m}),e.jsx(ce,{visible:n,format:i,firstWeekDay:"monday",label:s,cancelLabel:o,confirmLabel:l,value:F,isSelectable:f,validate:r,onChange:v=>{const p=O(v,i,!0).toJSON();h(p)},onDismiss:d})]})}function he({label:s,initialValue:t="",noValueText:m,autoOpen:o=!1,placeholder:l,validate:i,onValueChange:f,onPressRemove:r}){const[h,{close:c,toggle:x}]=T(o),a=g.useRef(null),n=g.useCallback((k,j)=>{const b=k.trim(),z=(i==null?void 0:i(b))??void 0,W=Z(z)?b:void 0;return j||f(W),{inputValue:k,validValue:W,error:j?void 0:z}},[i,f]),[{inputValue:d,validValue:y,error:F},v]=g.useState(()=>n(t,!0)),p=g.useCallback(k=>v(n(k,!1)),[n]);return e.jsxs(w,{style:u.container,children:[e.jsx(A,{label:s,onPress:x,ref:a,onPressRemove:r,isActive:h,value:y??m}),e.jsx(L,{role:"listbox",matchReferenceWidth:!1,onDismiss:c,referenceRef:a,returnFocus:!1,visible:h,children:e.jsx(w,{style:[u.dropdown,u.inputContent],children:e.jsx(ne,{label:s,render:k=>e.jsx(ie,{id:k,value:d,error:F,style:u.input,placeholder:l,onChangeText:p})})})})]})}const P=(s,t,m)=>t[m],K=({filters:s,openedFilters:t,definition:m,onChangeOpened:o,onChangeFilters:l})=>{const i=de(t),f=t.length>i.length?t[t.length-1]:void 0;return t.length===0?null:e.jsx(oe,{direction:"row",wrap:"wrap",children:t.map(r=>{const h=m[r];return typeof r!="string"||h==null?null:e.jsx(w,{children:q(h).with({type:"radio"},({type:c,label:x,items:a,width:n})=>e.jsx(me,{label:x,items:a,width:n,autoOpen:f===r,onPressRemove:()=>{l({...s,[r]:void 0}),o(t.filter(d=>d!==r))},value:P(c,s,r),onValueChange:d=>l({...s,[r]:d})})).with({type:"checkbox"},({type:c,label:x,items:a,width:n,checkAllLabel:d})=>e.jsx(pe,{label:x,items:a,width:n,checkAllLabel:d,autoOpen:f===r,value:P(c,s,r),onValueChange:y=>l({...s,[r]:y}),onPressRemove:()=>{l({...s,[r]:void 0}),o(t.filter(y=>y!==r))}})).with({type:"date"},({type:c,label:x,noValueText:a,cancelText:n,submitText:d,dateFormat:y,isSelectable:F,validate:v})=>e.jsx(fe,{label:x,noValueText:a,cancelText:n,submitText:d,dateFormat:y,autoOpen:f===r,isSelectable:F?p=>F(p,s):void 0,validate:v?p=>v(p,s):void 0,initialValue:P(c,s,r),onValueChange:p=>l({...s,[r]:p}),onPressRemove:()=>{l({...s,[r]:void 0}),o(t.filter(p=>p!==r))}})).with({type:"input"},({type:c,label:x,placeholder:a,noValueText:n,validate:d})=>e.jsx(he,{label:x,placeholder:a,noValueText:n,autoOpen:f===r,validate:d,initialValue:P(c,s,r),onValueChange:y=>l({...s,[r]:y}),onPressRemove:()=>{l({...s,[r]:void 0}),o(t.filter(y=>y!==r))}})).exhaustive()},r)})})};K.__docgenInfo={description:"",methods:[],displayName:"FiltersStack",props:{definition:{required:!0,tsType:{name:"Definition"},description:""},filters:{required:!0,tsType:{name:"State"},description:""},openedFilters:{required:!0,tsType:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},description:""},onChangeOpened:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: (keyof Definition)[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},name:"value"}],return:{name:"void"}}},description:""},onChangeFilters:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: State) => void",signature:{arguments:[{type:{name:"State"},name:"value"}],return:{name:"void"}}},description:""}}};const xe={type:"radio",label:"Mode",items:[{label:"QES",value:"QES"},{label:"Expert",value:"Expert"}]},ye={type:"checkbox",label:"Status",checkAllLabel:"All",items:[{label:"Accepted",value:"Accepted"},{label:"Canceled",value:"Canceled"},{label:"Failed",value:"Failed"},{label:"Expired",value:"Expired"},{label:"CustomerRefused",value:"CustomerRefused"}]},ve={type:"date",label:"Start Date",cancelText:"Cancel",submitText:"Save",noValueText:"None",dateFormat:"DD/MM/YYYY"},ge={type:"input",label:"Resource ID",noValueText:"None",placeholder:"Placeholder...",validate:s=>{if(s.length<3)return"Not long enough"}},je={mode:xe,status:ye,startDate:ve,resourceId:ge},be=[{name:"mode",label:"Mode"},{name:"status",label:"Status"},{name:"startDate",label:"Start date"},{name:"resourceId",label:"Ressource ID"}],dt={title:"Forms/Filters",component:_},R=()=>{const[s,t]=g.useState([]),[m,o]=g.useState({mode:void 0,status:void 0,resourceId:void 0,startDate:void 0});return e.jsx(ue,{title:"Filters",children:e.jsx(ee,{variant:"live",children:e.jsxs(w,{children:[e.jsx(_,{filters:m,label:"Choose filters",title:"Filters",onAddFilter:l=>t(i=>[...i,l]),availableFilters:be,openFilters:s}),e.jsx(D,{height:8}),e.jsx(K,{definition:je,filters:m,openedFilters:s,onChangeFilters:o,onChangeOpened:t})]})})})};R.__docgenInfo={description:"",methods:[],displayName:"All"};var Y,$,N;R.parameters={...R.parameters,docs:{...(Y=R.parameters)==null?void 0:Y.docs,source:{originalSource:`() => {
  const [openFilters, setOpenFilters] = useState<(keyof State)[]>([]);
  const [filters, setFilters] = useState<State>({
    mode: undefined,
    status: undefined,
    resourceId: undefined,
    startDate: undefined
  });
  return <StoryBlock title="Filters">
      <WithCurrentColor variant="live">
        <View>
          <FilterChooser filters={filters} label="Choose filters" title="Filters" onAddFilter={filter => setOpenFilters(filters => [...filters, filter])} availableFilters={availableFilters} openFilters={openFilters} />

          <Space height={8} />

          <FiltersStack definition={definition} filters={filters} openedFilters={openFilters} onChangeFilters={setFilters} onChangeOpened={setOpenFilters} />
        </View>
      </WithCurrentColor>
    </StoryBlock>;
}`,...(N=($=R.parameters)==null?void 0:$.docs)==null?void 0:N.source}}};const ct=["All"];export{R as All,ct as __namedExportsOrder,dt as default};
//# sourceMappingURL=Filters.stories-B8Knr1x7.js.map
