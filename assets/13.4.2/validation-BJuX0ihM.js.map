{"version":3,"file":"validation-BJuX0ihM.js","sources":["../../../packages/shared-business/src/utils/date.ts","../../../packages/shared-business/src/utils/validation.ts"],"sourcesContent":["import dayjs from \"dayjs\";\n\nexport const decodeBirthDate = (value: string) => {\n  const date = dayjs.utc(value, \"YYYY-MM-DD\", true);\n  return date.isValid() ? date.format(\"DD/MM/YYYY\") : \"\";\n};\n\nexport const encodeBirthDate = (value: string) => {\n  const date = dayjs.utc(value, \"DD/MM/YYYY\", true);\n  return date.isValid() ? date.format(\"YYYY-MM-DD\") : \"\";\n};\n\nexport type ExtractedDate = {\n  day: string;\n  month: string;\n  year: string;\n};\n\nexport const extractDate = (value: string): ExtractedDate | undefined => {\n  const date = dayjs.utc(value, \"YYYY-MM-DD\", true);\n\n  if (date.isValid()) {\n    return {\n      day: date.format(\"DD\"),\n      month: date.format(\"MM\"),\n      year: date.format(\"YYYY\"),\n    };\n  }\n};\n\nexport const formatExtractedDate = (date: ExtractedDate): string => {\n  const day = date.day.trim().padStart(2, \"0\");\n  const month = date.month.trim().padStart(2, \"0\");\n  const year = date.year.trim().padStart(4, \"0\");\n\n  return `${year}-${month}-${day}`;\n};\n","import { isNullish } from \"@swan-io/lake/src/utils/nullish\";\nimport { Validator } from \"@swan-io/use-form\";\nimport dayjs from \"dayjs\";\nimport { isValid as isValidIban } from \"iban\";\nimport { match } from \"ts-pattern\";\nimport {\n  CompanyCountryCCA3,\n  IndividualCountryCCA3,\n  TaxNumberValidation,\n} from \"../constants/countries\";\nimport { ExtractedDate, formatExtractedDate } from \"./date\";\nimport { t } from \"./i18n\";\n\nconst EMAIL_REGEX = /^[A-Z0-9_+.-]*[A-Z0-9_+-]@([A-Z0-9][A-Z0-9-]*\\.)+[A-Z]{2,}$/i;\nconst VAT_NUMBER_REGEX =\n  /^((AT)?U[0-9]{8}|(BE)?[01][0-9]{9}|(BG)?[0-9]{9,10}|(CY)?[0-9]{8}L|(CZ)?[0-9]{8,10}|(DE)?[0-9]{9}|(DK)?[0-9]{8}|(EE)?[0-9]{9}|(EL|GR)?[0-9]{9}|(ES)?[0-9A-Z][0-9]{7}[0-9A-Z]|(FI)?[0-9]{8}|(FR)?[0-9A-Z]{2}[0-9]{9}|(GB)?([0-9]{9}([0-9]{3})?|[A-Z]{2}[0-9]{3})|(HU)?[0-9]{8}|(IE)?[0-9]S[0-9]{5}L|(IT)?[0-9]{11}|(LT)?([0-9]{9}|[0-9]{12})|(LU)?[0-9]{8}|(LV)?[0-9]{11}|(MT)?[0-9]{8}|(NL)?[0-9]{9}B[0-9]{2}|(PL)?[0-9]{10}|(PT)?[0-9]{9}|(RO)?[0-9]{2,10}|(SE)?[0-9]{12}|(SI)?[0-9]{8}|(SK)?[0-9]{10})$/;\n\n// (AT)?U[0-9]{8} |                              # Austria\n// (BE)?[01][0-9]{9} |                              # Belgium\n// (BG)?[0-9]{9,10} |                            # Bulgaria\n// (CY)?[0-9]{8}L |                              # Cyprus\n// (CZ)?[0-9]{8,10} |                            # Czech Republic\n// (DE)?[0-9]{9} |                               # Germany\n// (DK)?[0-9]{8} |                               # Denmark\n// (EE)?[0-9]{9} |                               # Estonia\n// (EL|GR)?[0-9]{9} |                            # Greece\n// (ES)?[0-9A-Z][0-9]{7}[0-9A-Z] |               # Spain\n// (FI)?[0-9]{8} |                               # Finland\n// (FR)?[0-9A-Z]{2}[0-9]{9} |                    # France\n// (GB)?([0-9]{9}([0-9]{3})?|[A-Z]{2}[0-9]{3}) | # United Kingdom\n// (HU)?[0-9]{8} |                               # Hungary\n// (IE)?[0-9]S[0-9]{5}L |                        # Ireland\n// (IT)?[0-9]{11} |                              # Italy\n// (LT)?([0-9]{9}|[0-9]{12}) |                   # Lithuania\n// (LU)?[0-9]{8} |                               # Luxembourg\n// (LV)?[0-9]{11} |                              # Latvia\n// (MT)?[0-9]{8} |                               # Malta\n// (NL)?[0-9]{9}B[0-9]{2} |                      # Netherlands\n// (PL)?[0-9]{10} |                              # Poland\n// (PT)?[0-9]{9} |                               # Portugal\n// (RO)?[0-9]{2,10} |                            # Romania\n// (SE)?[0-9]{12} |                              # Sweden\n// (SI)?[0-9]{8} |                               # Slovenia\n// (SK)?[0-9]{10}                                # Slovakia\n\nconst TAX_NUMBER_REGEX: TaxNumberValidation = {\n  individual: {\n    BEL: {\n      pattern: /^\\d{11}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"11\" }),\n    },\n    DEU: {\n      pattern: /^\\d{11}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"11\" }),\n    },\n    ESP: {\n      pattern: /^[a-zA-Z0-9]{9}$/,\n      message: t(\"common.form.help.nbCharacters\", { nbCharacters: \"9\" }),\n    },\n    FIN: {\n      pattern: /^[a-zA-Z0-9]{11}$/,\n      message: t(\"common.form.help.nbCharacters\", { nbCharacters: \"11\" }),\n    },\n    FRA: {\n      pattern: /^\\d{13}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"13\" }),\n    },\n    ITA: {\n      pattern: /^[a-zA-Z0-9]{16}$/,\n      message: t(\"common.form.help.nbCharacters\", { nbCharacters: \"16\" }),\n    },\n    NLD: {\n      pattern: /^\\d{9}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"9\" }),\n    },\n    PRT: {\n      pattern: /^\\d{9}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"9\" }),\n    },\n  },\n  company: {\n    BEL: {\n      pattern: /^\\d{10,12}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"10-12\" }),\n    },\n    DEU: {\n      pattern: /^\\d{10,13}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"10-13\" }),\n    },\n    ESP: {\n      pattern: /^[a-zA-Z0-9]{9}$/,\n      message: t(\"common.form.help.nbCharacters\", { nbCharacters: \"9\" }),\n    },\n    FIN: {\n      pattern: /^[a-zA-Z0-9]{8,9}$/,\n      message: t(\"common.form.help.nbCharacters\", { nbCharacters: \"8-9\" }),\n    },\n    FRA: {\n      pattern: /^\\d{9}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"9\" }),\n    },\n    ITA: {\n      pattern: /^\\d{11}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"11\" }),\n    },\n    NLD: {\n      pattern: /^\\d{9}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"9\" }),\n    },\n    PRT: {\n      pattern: /^\\d{9}$/,\n      message: t(\"common.form.help.nbDigits\", { nbDigits: \"9\" }),\n    },\n  },\n};\n\nexport const isValidVatNumber = (maybeVat: string) => {\n  return VAT_NUMBER_REGEX.test(maybeVat);\n};\n\nexport const isValidEmail = (maybeEmail: string) => {\n  return EMAIL_REGEX.test(maybeEmail);\n};\n\nexport const sanitizeDecimal = (value: string): string => {\n  return value.replace(/ /g, \"\").replace(/,/g, \".\");\n};\n\nexport const validateNullableRequired: Validator<string | undefined> = value => {\n  if (value == null || !value) {\n    return t(\"error.requiredField\");\n  }\n};\n\nexport const validateRequired: Validator<string> = value => {\n  if (!value) {\n    return t(\"error.requiredField\");\n  }\n};\n\nexport const validateBooleanRequired: Validator<boolean | undefined> = value => {\n  if (value == null || !value) {\n    return t(\"error.requiredField\");\n  }\n};\n\nexport const validateIndividualTaxNumber =\n  (country: IndividualCountryCCA3): Validator<string | undefined> =>\n  value => {\n    if (value == null || !value) {\n      return;\n    }\n\n    const rule = TAX_NUMBER_REGEX.individual[country];\n    if (rule && !rule.pattern.test(value)) {\n      return t(\"common.form.invalidTaxIdentificationNumber\");\n    }\n  };\n\nexport const validateCompanyTaxNumber =\n  (country: CompanyCountryCCA3): Validator<string | undefined> =>\n  value => {\n    if (value == null || !value) {\n      return;\n    }\n\n    const rule = TAX_NUMBER_REGEX.company[country];\n    if (rule && !rule.pattern.test(value)) {\n      return t(\"common.form.invalidTaxIdentificationNumber\");\n    }\n  };\n\nexport { printFormat as printIbanFormat } from \"iban\";\n\nexport const validateIban = (iban: string) => {\n  if (!isValidIban(iban)) {\n    return t(\"error.iban.invalid\");\n  }\n};\n\nexport const validateDate = (value: ExtractedDate | undefined) => {\n  if (isNullish(value)) {\n    return t(\"validation.invalidDate\");\n  }\n  const date = dayjs.utc(formatExtractedDate(value), \"YYYY-MM-DD\", true);\n  if (!date.isValid()) {\n    return t(\"validation.invalidDate\");\n  }\n};\n\nexport const validateBirthdate = (value: ExtractedDate | undefined) => {\n  if (isNullish(value)) {\n    return t(\"validation.invalidBirthDate\");\n  }\n  const date = dayjs.utc(formatExtractedDate(value), \"YYYY-MM-DD\", true);\n\n  const isBirthdateOver150years = date.isBefore(dayjs.utc().subtract(100, \"years\"));\n  const isBirthdateWithin4years = date.isAfter(dayjs.utc().subtract(4, \"years\"));\n\n  if (!date.isValid() || isBirthdateOver150years || isBirthdateWithin4years) {\n    return t(\"validation.invalidBirthDate\");\n  }\n\n  if (date.isAfter(dayjs.utc().add(1, \"day\"))) {\n    return t(\"validation.birthdateCannotBeFuture\");\n  }\n};\n\n/*\n * Translation helpers for tax validation\n */\n\nexport const getIndividualTaxNumberPlaceholder = (\n  country: IndividualCountryCCA3 | CompanyCountryCCA3,\n) =>\n  match(country)\n    .with(\n      \"DEU\",\n      () => `${t(\"common.form.taxIdentificationNumber.placeholder\")} (Steueridentifikationsnummer)`,\n    )\n    .with(\n      \"ESP\",\n      () =>\n        `${t(\"common.form.taxIdentificationNumber.placeholder\")} (Número de Identificación Fiscal)`,\n    )\n    .with(\"ITA\", () => `${t(\"common.form.taxIdentificationNumber.placeholder\")} (Codice fiscale)`)\n    .otherwise(() => t(\"common.form.taxIdentificationNumber.placeholder\"));\n\nexport const getCompanyTaxNumberPlaceholder = (\n  country: IndividualCountryCCA3 | CompanyCountryCCA3,\n) =>\n  match(country)\n    .with(\"DEU\", () => `${t(\"common.form.taxIdentificationNumber.placeholder\")} (Steuer-Nummer)`)\n    .with(\n      \"ESP\",\n      () =>\n        `${t(\"common.form.taxIdentificationNumber.placeholder\")} (Número de Identificación Fiscal)`,\n    )\n    .with(\"ITA\", () => `${t(\"common.form.taxIdentificationNumber.placeholder\")} (Codice fiscale)`)\n    .otherwise(() => t(\"common.form.taxIdentificationNumber.placeholder\"));\n\nexport const getTaxNumberTooltip = (country: IndividualCountryCCA3 | CompanyCountryCCA3) =>\n  match(country)\n    .with(\"DEU\", () => \"Steuernummer des Unternehmens\")\n    .with(\"ESP\", () => \"Número de Identificación Fiscal\") // no need to translate\n    .with(\"ITA\", () => t(\"common.form.taxIdentificationNumber.tooltip.ita\"))\n    .otherwise(() => undefined);\n\nexport const getCompanyTaxNumberHelp = (country: CompanyCountryCCA3) =>\n  TAX_NUMBER_REGEX.company[country]?.message ?? \"\";\n\nexport const getIndividualTaxNumberHelp = (country: IndividualCountryCCA3) =>\n  TAX_NUMBER_REGEX.individual[country]?.message ?? \"\";\n"],"names":["extractDate","value","date","dayjs","formatExtractedDate","day","month","EMAIL_REGEX","TAX_NUMBER_REGEX","isValidEmail","maybeEmail","validateDate","isNullish","validateBirthdate","isBirthdateOver150years","isBirthdateWithin4years","getIndividualTaxNumberPlaceholder","country","match","getCompanyTaxNumberPlaceholder","getTaxNumberTooltip","getCompanyTaxNumberHelp","getIndividualTaxNumberHelp"],"mappings":"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"}