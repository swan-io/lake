import{s as U,c as P,j as e,B as W,V as b,L as $,S as F,I as X,f as re,g as ne,b as se,T as M,N as O,q as L,i as Q,W as oe}from"./Space-BJ8o3sFw.js";import{r as h}from"./index-CBqU2yxZ.js";import{u as I}from"./useDisclosure-CS9t68_Y.js";import{L as B}from"./LakeButton-Bd_h_8ZA.js";import{P as V}from"./Popover-CIwE_vQX.js";import{F as H}from"./index-BpMotjcQ.js";import{P as _}from"./index-B1925W4Z.js";import{b as ie,f as ae}from"./DatePicker-Cmd1uK6A.js";import{d as z}from"./utc-DJvBpWoA.js";import{u as le}from"./Pressable-DzF9rM7z.js";import{u as ce}from"./TransitionView-DoG_oH2X.js";import{L as de}from"./LakeCheckbox-BMy659iE.js";import{L as ue}from"./LakeLabel-glSOeyP4.js";import{L as me}from"./LakeRadio-guWJ9cLa.js";import{L as pe}from"./LakeTextInput-DW1pZKlK.js";import{T as Z}from"./Tag-C7yq_QGa.js";import{S as he}from"./_StoriesComponents-SDLtyL2-.js";import"./extends-CCbyfPlC.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-BtM5VmRH.js";import"./commonStyles-t4XfA7cz.js";import"./index-QI0gf_ds.js";import"./useResponsive-BX72-yEI.js";import"./function-BSvIwqUo.js";import"./BottomPanel-C9G1c8W7.js";import"./useBodyClassName-FAgY5CgW.js";import"./math-DwykiY4o.js";import"./FocusTrap-n96NuHfD.js";import"./a11y-DXvpDVrG.js";import"./array-rjEBP2Ry.js";import"./LoadingView-CV6Guj08.js";import"./index-DrKPpo-4.js";import"./Fill-BOphEy9A.js";import"./LakeSelect-BpRrlMtx.js";import"./rifm-3PPqt3sd.js";import"./rifm.esm-B5sXhCfa.js";import"./i18n-DCTCFOKm.js";import"./LakeModal-DqY60t4K.js";import"./LakeHeading-DH3GmWc4.js";import"./ResponsiveContainer-531x39y8.js";import"./v4-D8aEg3BZ.js";const C=U.create({selected:{color:P.gray[500]},list:{paddingVertical:20,marginVertical:4,minWidth:250,overflow:"hidden"},item:{display:"flex",paddingHorizontal:24,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:8},itemHovered:{backgroundColor:P.gray[50]},availableFiltersTitle:{paddingHorizontal:24}});function Y({filters:n,openFilters:t,label:c,title:o,availableFilters:s,large:d=!0,onAddFilter:x}){const r=h.useRef(null),[y,{close:u,toggle:m}]=I(!1);return e.jsxs(e.Fragment,{children:[e.jsx(W,{direction:"row",justifyContent:"start",alignItems:"center",children:e.jsx(B,{size:"small",mode:"secondary",color:"gray",onPress:m,ref:r,icon:d?"chevron-down-filled":"filter-filled",iconPosition:"end",ariaLabel:c,children:d?c:null})}),e.jsx(V,{role:"listbox",matchReferenceMinWidth:!0,onDismiss:u,referenceRef:r,returnFocus:!1,visible:y,children:e.jsxs(b,{style:C.list,children:[e.jsx($,{style:C.availableFiltersTitle,children:o}),e.jsx(F,{height:8}),e.jsx(H,{role:"list",data:s,keyExtractor:(a,i)=>`filter-item-${i}`,renderItem:({item:a})=>{const i=!!n[a.name]||t.includes(a.name);return e.jsxs(_,{style:({hovered:l})=>[C.item,l&&C.itemHovered],role:"button",disabled:i,onPress:()=>{x(a.name),u()},children:[e.jsx($,{variant:"smallRegular",style:i&&C.selected,children:a.label}),i&&e.jsx(X,{color:P.positive[500],name:"checkmark-filled",size:14})]})}})]})})]})}Y.__docgenInfo={description:"",methods:[],displayName:"FilterChooser",props:{filters:{required:!0,tsType:{name:"Partial",elements:[{name:"Record",elements:[{name:"FilterName"},{name:"unknown"}],raw:"Record<FilterName, unknown>"}],raw:"Partial<Record<FilterName, unknown>>"},description:""},openFilters:{required:!0,tsType:{name:"Array",elements:[{name:"FilterName"}],raw:"FilterName[]"},description:""},label:{required:!0,tsType:{name:"string"},description:""},title:{required:!0,tsType:{name:"string"},description:""},availableFilters:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ label: string; name: FilterName }",signature:{properties:[{key:"label",value:{name:"string",required:!0}},{key:"name",value:{name:"FilterName",required:!0}}]}}],raw:"{ label: string; name: FilterName }[]"},description:""},large:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},onAddFilter:{required:!0,tsType:{name:"signature",type:"function",raw:"(filterName: FilterName) => void",signature:{arguments:[{type:{name:"FilterName"},name:"filterName"}],return:{name:"void"}}},description:""}}};const N=h.forwardRef(({children:n,space:t,...c},o)=>{const{direction:s="column"}=c,d=s==="row"||s==="rowReverse";return e.jsx(W,{ref:o,...c,children:h.Children.map(n,(x,r)=>re(x)?x:e.jsxs(h.Fragment,{children:[r!==0&&(d?e.jsx(F,{width:t}):e.jsx(F,{height:t})),x]}))})});N.__docgenInfo={description:"",methods:[],displayName:"Stack"};const f=U.create({container:{paddingRight:12,paddingBottom:8},shadowed:{position:"absolute",opacity:0,width:"100%",height:"100%",borderRadius:4,boxShadow:ne.tile,transitionDuration:"150ms",transitionProperty:"opacity"},hovered:{opacity:1},dropdown:{maxHeight:400,minWidth:200},itemHovered:{backgroundColor:P.gray[50]},content:{paddingVertical:12},inputContent:{padding:24},radio:{display:"flex",flexDirection:"row",alignItems:"center",height:32,paddingHorizontal:24},itemLabel:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},input:{minWidth:200},value:{maxWidth:130,whiteSpace:"nowrap"},buttonContainer:{paddingHorizontal:se[24]}}),q=h.forwardRef(({onPress:n,onPressRemove:t,label:c,value:o="",isActive:s},d)=>{const x=h.useRef(null),r=le(x,d);return e.jsx(_,{ref:r,onPress:n,children:({hovered:y})=>e.jsxs(e.Fragment,{children:[e.jsx(b,{style:[f.shadowed,y&&f.hovered]}),e.jsx(Z,{label:c,color:"current",onPressRemove:t,children:e.jsxs(W,{direction:"row",alignItems:"center",children:[e.jsx(M,{numberOfLines:1,style:f.value,children:o}),e.jsx(F,{width:4}),e.jsx(X,{color:P.current.primary,name:s?"chevron-up-filled":"chevron-down-filled",size:16})]})})]})})});function fe({label:n,items:t,width:c,value:o,onValueChange:s,onPressRemove:d,autoOpen:x=!1}){const r=h.useRef(null),[y,{close:u,toggle:m}]=I(x),a=h.useMemo(()=>t.find(i=>i.value===o),[t,o]);return e.jsxs(b,{style:f.container,children:[e.jsx(q,{label:n,onPress:m,ref:r,onPressRemove:d,isActive:y,value:a==null?void 0:a.label}),e.jsx(V,{role:"listbox",matchReferenceWidth:!1,onDismiss:u,referenceRef:r,returnFocus:!1,visible:y,children:e.jsx(b,{style:[f.dropdown,{width:c}],children:e.jsx(H,{role:"list",data:t,contentContainerStyle:f.content,keyExtractor:(i,l)=>`filter-item-${l}`,renderItem:({item:i})=>{const l=o===i.value;return e.jsxs(_,{role:"radio","aria-checked":l,style:({hovered:v})=>[f.radio,v&&f.itemHovered],onPress:()=>{s(i.value),u()},children:[e.jsx(me,{value:l}),e.jsx(F,{width:12}),e.jsx(M,{style:f.itemLabel,children:i.label})]})}})})})]})}function xe({label:n,items:t,width:c,checkAllLabel:o,value:s,onValueChange:d,applyButtonLabel:x,onPressRemove:r,autoOpen:y=!1}){const u=h.useRef(null),[m,{close:a,toggle:i}]=I(y),[l,v]=h.useState(s),p=h.useMemo(()=>new Set(l),[l]),S=h.useMemo(()=>t.filter(j=>p.has(j.value)),[t,p]),g=o!=null&&p.size===t.length,R=h.useMemo(()=>{if(o==null)return t;const j=p.size===0?!1:p.size===t.length?!0:"mixed";return[{label:o,checked:j},...t]},[t,o,p]),E=h.useCallback(()=>{d(l),a()},[d,l,a]);return h.useEffect(()=>{m||v(s)},[m,s]),e.jsxs(b,{style:f.container,children:[e.jsx(q,{label:n,onPress:i,ref:u,onPressRemove:r,isActive:m,value:g?o:S.map(j=>j.label).join(", ")}),e.jsx(V,{role:"listbox",matchReferenceWidth:!1,onDismiss:a,referenceRef:u,returnFocus:!1,visible:m,children:e.jsxs(b,{style:[f.dropdown,{width:c}],children:[e.jsx(H,{role:"list",data:R,contentContainerStyle:f.content,keyExtractor:(j,k)=>`filter-item-${k}`,renderItem:({item:j})=>{const k=O(j).with({checked:L.any},({checked:w})=>w).with({value:L.any},({value:w})=>p.has(w)).exhaustive(),te=O(j).with({checked:L.any},({checked:w})=>()=>{v(w===!0?void 0:t.map(T=>T.value))}).with({value:L.any},({value:w})=>()=>{const T=new Set([...p]);k===!0?T.delete(w):T.add(w),T.size===0?v(void 0):v([...T])}).exhaustive();return e.jsxs(_,{role:"radio","aria-checked":k,style:({hovered:w})=>[f.radio,w&&f.itemHovered],onPress:te,children:[e.jsx(de,{value:k}),e.jsx(F,{width:12}),e.jsx(M,{style:f.itemLabel,children:j.label})]})}}),e.jsx(F,{height:8}),e.jsx(b,{style:f.buttonContainer,children:e.jsx(B,{color:"current",onPress:E,children:x})}),e.jsx(F,{height:24})]})})]})}function ve({label:n,initialValue:t,noValueText:c,cancelText:o,submitText:s,dateFormat:d,isSelectable:x,validate:r,onSave:y,onPressRemove:u,autoOpen:m=!1}){const a=h.useRef(null),[i,{close:l,toggle:v}]=I(m),p=h.useMemo(()=>Q(t)?z(t).format(d):"",[t,d]);return e.jsxs(b,{style:f.container,children:[e.jsx(q,{label:n,onPress:v,ref:a,onPressRemove:u,isActive:i,value:Q(t)?z(t).format(d):c}),e.jsx(ie,{visible:i,format:d,firstWeekDay:"monday",label:n,cancelLabel:o,confirmLabel:s,value:p,isSelectable:x,validate:r,onChange:S=>{const g=z(S,d,!0).toJSON();y(g)},onDismiss:l})]})}function ye({label:n,initialValue:t="",noValueText:c,submitText:o,autoOpen:s=!1,placeholder:d,validate:x,onSave:r,onPressRemove:y}){const u=h.useRef(null),[m,{close:a,toggle:i}]=I(s),[l,v]=h.useState(t),{Field:p,submitForm:S}=ae({input:{initialValue:t,validate:x}}),g=()=>{S({onSuccess:({input:R})=>{R.isSome()&&(v(R.get()),r(R.get()),a())}})};return e.jsxs(b,{style:f.container,children:[e.jsx(q,{label:n,onPress:i,ref:u,onPressRemove:y,isActive:m,value:l===""?c:l}),e.jsx(V,{role:"listbox",matchReferenceWidth:!1,onDismiss:a,referenceRef:u,returnFocus:!1,visible:m,children:e.jsxs(b,{style:[f.dropdown,f.inputContent],children:[e.jsx(p,{name:"input",children:({error:R,value:E,onChange:j})=>e.jsx(ue,{label:n,render:k=>e.jsx(pe,{id:k,error:R,style:f.input,placeholder:d,value:E,onChangeText:j,onSubmitEditing:g})})}),e.jsx(B,{size:"small",color:"current",onPress:g,children:o})]})})]})}function ge({children:n,onAdd:t,onPressRemove:c}){return h.useEffect(t,[]),e.jsx(Z,{color:"current",onPressRemove:c,children:n})}const A=(n,t,c)=>t[c],ee=({filters:n,openedFilters:t,definition:c,onChangeOpened:o,onChangeFilters:s})=>{const d=ce(t),x=t.length>d.length?t[t.length-1]:void 0;return t.length===0?null:e.jsx(N,{direction:"row",wrap:"wrap",children:t.map(r=>{const y=c[r];return typeof r!="string"||y==null?null:e.jsx(b,{children:O(y).with({type:"radio"},({type:u,label:m,items:a,width:i})=>e.jsx(fe,{label:m,items:a,width:i,autoOpen:x===r,onPressRemove:()=>{s({...n,[r]:void 0}),o(t.filter(l=>l!==r))},value:A(u,n,r),onValueChange:l=>s({...n,[r]:l})})).with({type:"checkbox"},({type:u,label:m,items:a,width:i,checkAllLabel:l,submitText:v})=>e.jsx(xe,{label:m,items:a,width:i,checkAllLabel:l,autoOpen:x===r,applyButtonLabel:v,value:A(u,n,r),onValueChange:p=>s({...n,[r]:p}),onPressRemove:()=>{s({...n,[r]:void 0}),o(t.filter(p=>p!==r))}})).with({type:"date"},({type:u,label:m,noValueText:a,cancelText:i,submitText:l,dateFormat:v,isSelectable:p,validate:S})=>e.jsx(ve,{label:m,noValueText:a,cancelText:i,submitText:l,dateFormat:v,autoOpen:x===r,isSelectable:p?g=>p(g,n):void 0,validate:S?g=>S(g,n):void 0,initialValue:A(u,n,r),onSave:g=>s({...n,[r]:g}),onPressRemove:()=>{s({...n,[r]:void 0}),o(t.filter(g=>g!==r))}})).with({type:"input"},({type:u,label:m,placeholder:a,noValueText:i,submitText:l,validate:v})=>e.jsx(ye,{label:m,placeholder:a,noValueText:i,submitText:l,autoOpen:x===r,validate:v,initialValue:A(u,n,r),onSave:p=>s({...n,[r]:p}),onPressRemove:()=>{s({...n,[r]:void 0}),o(t.filter(p=>p!==r))}})).with({type:"boolean"},({label:u})=>e.jsx(ge,{onAdd:()=>{s({...n,[r]:!0})},onPressRemove:()=>{s({...n,[r]:void 0}),o(t.filter(m=>m!==r))},children:u})).exhaustive()},r)})})};ee.__docgenInfo={description:"",methods:[],displayName:"FiltersStack",props:{definition:{required:!0,tsType:{name:"Definition"},description:""},filters:{required:!0,tsType:{name:"State"},description:""},openedFilters:{required:!0,tsType:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},description:""},onChangeOpened:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: (keyof Definition)[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},name:"value"}],return:{name:"void"}}},description:""},onChangeFilters:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: State) => void",signature:{arguments:[{type:{name:"State"},name:"value"}],return:{name:"void"}}},description:""}}};const je={type:"radio",label:"Mode",items:[{label:"QES",value:"QES"},{label:"Expert",value:"Expert"}]},be={type:"checkbox",label:"Status",submitText:"Apply",items:[{label:"Accepted",value:"Accepted"},{label:"Canceled",value:"Canceled"},{label:"Failed",value:"Failed"},{label:"Expired",value:"Expired"},{label:"CustomerRefused",value:"CustomerRefused"}]},we={type:"date",label:"Start Date",cancelText:"Cancel",submitText:"Save",noValueText:"None",dateFormat:"DD/MM/YYYY"},Fe={type:"input",label:"Resource ID",noValueText:"None",submitText:"Save",placeholder:"Placeholder..."},Se={mode:je,status:be,startDate:we,resourceId:Fe},ke=[{name:"mode",label:"Mode"},{name:"status",label:"Status"},{name:"startDate",label:"Start date"},{name:"resourceId",label:"Ressource ID"}],pt={title:"Forms/Filter",component:Y},D=()=>{const[n,t]=h.useState([]),[c,o]=h.useState({mode:void 0,status:void 0,resourceId:void 0,startDate:void 0});return e.jsx(he,{title:"Filter",children:e.jsx(oe,{variant:"live",children:e.jsxs(b,{children:[e.jsx(Y,{filters:c,label:"Choose filters",title:"Filters",onAddFilter:s=>t(d=>[...d,s]),availableFilters:ke,openFilters:n}),e.jsx(F,{height:8}),e.jsx(ee,{definition:Se,filters:c,openedFilters:n,onChangeFilters:o,onChangeOpened:t})]})})})};D.__docgenInfo={description:"",methods:[],displayName:"All"};var J,G,K;D.parameters={...D.parameters,docs:{...(J=D.parameters)==null?void 0:J.docs,source:{originalSource:`() => {
  const [openFilters, setOpenFilters] = useState<(keyof State)[]>([]);
  const [filters, setFilters] = useState<State>({
    mode: undefined,
    status: undefined,
    resourceId: undefined,
    startDate: undefined
  });
  return <StoryBlock title="Filter">
      <WithCurrentColor variant="live">
        <View>
          <FilterChooser filters={filters} label="Choose filters" title="Filters" onAddFilter={filter => setOpenFilters(filters => [...filters, filter])} availableFilters={availableFilters} openFilters={openFilters} />

          <Space height={8} />

          <FiltersStack definition={definition} filters={filters} openedFilters={openFilters} onChangeFilters={setFilters} onChangeOpened={setOpenFilters} />
        </View>
      </WithCurrentColor>
    </StoryBlock>;
}`,...(K=(G=D.parameters)==null?void 0:G.docs)==null?void 0:K.source}}};const ht=["All"];export{D as All,ht as __namedExportsOrder,pt as default};
//# sourceMappingURL=Filter.stories-BwEjirvV.js.map
