{"version":3,"file":"SidebarNavigationTracker.stories-aZAZFsB7.js","sources":["../../../packages/lake/src/components/SidebarNavigationTracker.tsx"],"sourcesContent":["import { createContext, useCallback, useContext, useEffect, useRef, useState } from \"react\";\nimport { ScrollView, ScrollViewProps, StyleSheet, View } from \"react-native\";\n\nconst styles = StyleSheet.create({\n  track: {\n    position: \"absolute\",\n    top: 0,\n    right: 0,\n    bottom: 0,\n    width: 3,\n  },\n  marker: {\n    pointerEvents: \"none\",\n    position: \"absolute\",\n    top: 0,\n    right: 0,\n    bottom: 0,\n    width: 3,\n  },\n  trackIndicator: {\n    width: 3,\n    height: 1,\n    position: \"absolute\",\n    right: 0,\n    transformOrigin: \"right top\",\n    transition: \"150ms ease-in-out\",\n    transitionProperty: \"transform, background-color\",\n  },\n});\n\ntype Track = { color: string; element: View };\n\nconst Context = createContext((_: Track) => {});\n\ntype Props = {\n  style?: ScrollViewProps[\"style\"];\n  contentContainerStyle?: ScrollViewProps[\"style\"];\n  children: ScrollViewProps[\"children\"];\n};\n\ntype Layout = { color: string; top: number; height: number };\n\n// using `offsetTop` and `offsetHeight` here to avoid calculations\n// being wrong when ancestor has as CSS transform applied\nconst getCoordinates = (element: HTMLElement, guide: HTMLElement) => {\n  const offsetHeight = element.offsetHeight;\n  const guideParent = guide.parentElement;\n\n  if (guideParent == null || !guideParent.contains(element)) {\n    return { top: 0, height: offsetHeight };\n  }\n  let offsetTop = 0;\n  let currentElement: HTMLElement | null = element;\n  while (currentElement != null && currentElement != guideParent) {\n    offsetTop += currentElement.offsetTop;\n    currentElement = currentElement.offsetParent as HTMLElement | null;\n  }\n\n  return { top: offsetTop, height: offsetHeight };\n};\n\nexport const SidebarNavigationTracker = ({ style, contentContainerStyle, children }: Props) => {\n  const [track, setTrackRaw] = useState<Layout | null>(null);\n  const trackRef = useRef<View | null>(null);\n  const lastElementRef = useRef<View | null>(null);\n\n  const setTrack = useCallback(({ color, element }: Track) => {\n    if (trackRef.current != null) {\n      lastElementRef.current = element;\n      const { top, height } = getCoordinates(\n        element as unknown as HTMLElement,\n        trackRef.current as unknown as HTMLElement,\n      );\n      setTrackRaw({\n        color,\n        top,\n        height,\n      });\n    }\n  }, []);\n\n  const onLayout = useCallback(() => {\n    if (lastElementRef.current != null && track?.color != null) {\n      const { top, height } = getCoordinates(\n        lastElementRef.current as unknown as HTMLElement,\n        trackRef.current as unknown as HTMLElement,\n      );\n      setTrackRaw({\n        color: track?.color,\n        top,\n        height,\n      });\n    }\n  }, [track]);\n\n  return (\n    <Context.Provider value={setTrack}>\n      <ScrollView\n        scrollEventThrottle={30}\n        onLayout={onLayout}\n        style={style}\n        contentContainerStyle={contentContainerStyle}\n        role=\"banner\"\n      >\n        {children}\n\n        <View style={styles.track} ref={trackRef}>\n          {track != null ? (\n            <View\n              style={[\n                styles.trackIndicator,\n                {\n                  transform: `translateY(${track.top}px) scaleY(${track.height})`,\n                  backgroundColor: track.color,\n                },\n              ]}\n            />\n          ) : null}\n        </View>\n      </ScrollView>\n    </Context.Provider>\n  );\n};\n\ntype MarkerProps = {\n  color: string;\n};\n\nexport const SidebarNavigationTrackerActiveMarker = ({ color }: MarkerProps) => {\n  const setLayoutReference = useContext(Context);\n  const elementRef = useRef<View | null>(null);\n\n  const onLayout = useCallback(() => {\n    if (elementRef.current != null) {\n      setLayoutReference({ color, element: elementRef.current });\n    }\n  }, [setLayoutReference, color]);\n\n  useEffect(() => {\n    if (elementRef.current != null) {\n      setLayoutReference({ color, element: elementRef.current });\n    }\n  }, [setLayoutReference, color]);\n\n  return <View ref={elementRef} onLayout={onLayout} style={styles.marker} />;\n};\n"],"names":["styles","StyleSheet","Context","createContext","_","getCoordinates","element","guide","offsetHeight","guideParent","offsetTop","currentElement","SidebarNavigationTracker","style","contentContainerStyle","children","track","setTrackRaw","useState","trackRef","useRef","lastElementRef","setTrack","useCallback","color","top","height","onLayout","jsx","jsxs","ScrollView","View","SidebarNavigationTrackerActiveMarker","setLayoutReference","useContext","elementRef","useEffect"],"mappings":"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"}