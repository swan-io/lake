{"version":3,"file":"Toast.stories-R620L8ac.js","sources":["../../../node_modules/react-atomic-state/dist/index.module.js","../../../packages/lake/src/utils/timer.ts","../../../packages/lake/src/state/toasts.ts","../../../packages/lake/src/components/ToastStack.tsx"],"sourcesContent":["import{useSyncExternalStoreWithSelector as e}from\"use-sync-external-store/shim/with-selector\";function t(e){const t=new Set;let r=e;return{get:()=>r,set(e){r=\"function\"==typeof e?e(r):e,t.forEach(e=>e(r))},subscribe:e=>(t.add(e),()=>{t.delete(e)}),reset(){r=e,t.forEach(e=>e(r))}}}function r(e){return e}function n(t,n){return void 0===n&&(n=Object.is),e(t.subscribe,t.get,t.get,r,n)}function o(t,r,n){return void 0===n&&(n=Object.is),e(t.subscribe,t.get,t.get,r,n)}export{t as atom,n as useAtom,o as useAtomWithSelector};\n//# sourceMappingURL=index.module.js.map\n","// based on https://gist.github.com/ncou/3a0a1f89c8e22416d0d607f621a948a9\n\nexport type ControllableTimeout = {\n  readonly duration: number;\n  readonly clear: () => void;\n  readonly reset: () => void;\n};\n\nexport const createControllableTimeout = (config: {\n  duration: number;\n  onStart: (duration: number) => void;\n  onEnd: () => void;\n  onReset: (duration: number) => void;\n}): ControllableTimeout => {\n  const { duration, onStart, onReset, onEnd } = config;\n  let timerId = 0;\n  let remaining = duration;\n\n  const clear = () => {\n    document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n    window.clearTimeout(timerId);\n  };\n\n  const start = () => {\n    if (remaining <= 0) {\n      return;\n    }\n\n    timerId = window.setTimeout(() => {\n      remaining = 0;\n      clear();\n      onEnd();\n    }, remaining);\n\n    onStart(duration);\n  };\n\n  const reset = () => {\n    window.clearTimeout(timerId);\n\n    remaining = duration;\n\n    timerId = window.setTimeout(() => {\n      remaining = 0;\n      clear();\n      onEnd();\n    }, duration);\n\n    onReset(duration);\n  };\n\n  const onVisibilityChange = () => {\n    document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n    start();\n  };\n\n  if (document.hidden) {\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n  } else {\n    start();\n  }\n\n  return {\n    duration,\n    clear,\n    reset,\n  };\n};\n","import { atom, useAtom } from \"react-atomic-state\";\nimport { Animated, Easing } from \"react-native\";\nimport { ControllableTimeout, createControllableTimeout } from \"../utils/timer\";\n\nexport type ToastVariant = \"success\" | \"info\" | \"warning\" | \"error\";\n\ntype ToastContent = {\n  variant: ToastVariant;\n  title: string;\n  description?: string;\n  autoClose?: boolean;\n};\n\ntype Toast = {\n  uid: string;\n  variant: ToastVariant;\n  title: string;\n  description?: string;\n  progress?: Animated.Value;\n  timeout?: ControllableTimeout;\n};\n\nconst toasts = atom<Toast[]>([]);\n\nexport const useToasts = () => useAtom(toasts);\n\nexport const hideToast = (uid: string) => {\n  const toast = toasts.get().find(toast => toast.uid === uid);\n\n  if (!toast) {\n    return;\n  }\n\n  toast.timeout?.clear();\n  toast.progress?.stopAnimation();\n\n  toasts.set(toasts => toasts.filter(toast => toast.uid !== uid));\n};\n\nexport const showToast = ({ variant, title, description, autoClose }: ToastContent) => {\n  const uid = `${variant} - ${title} - ${description ?? \"\"}`;\n\n  const toast = toasts.get().find(toast => toast.uid === uid);\n\n  if (toast != null) {\n    if (toast.timeout && toast.progress) {\n      toast.timeout.clear();\n\n      Animated.timing(toast.progress, {\n        duration: 100,\n        easing: Easing.linear,\n        toValue: 1,\n        useNativeDriver: false,\n      }).start(() => {\n        toast.timeout?.reset();\n      });\n    }\n\n    return uid;\n  }\n\n  // by default, only info and success toasts are auto-closing\n  const isAutoClosingToast = autoClose ?? (variant === \"info\" || variant === \"success\");\n\n  const progress = isAutoClosingToast ? new Animated.Value(1) : undefined;\n\n  const timeout = progress\n    ? createControllableTimeout({\n        duration: 10000,\n        onStart: duration => {\n          Animated.timing(progress, {\n            duration,\n            easing: Easing.linear,\n            toValue: 0,\n            useNativeDriver: false,\n          }).start();\n        },\n        onReset: duration => {\n          Animated.timing(progress, {\n            duration,\n            easing: Easing.linear,\n            toValue: 0,\n            useNativeDriver: false,\n          }).start();\n        },\n        onEnd: () => {\n          hideToast(uid);\n        },\n      })\n    : undefined;\n\n  toasts.set(toasts => [{ uid, variant, title, description, progress, timeout }, ...toasts]);\n  return uid;\n};\n","import { memo, useEffect, useRef, useState } from \"react\";\nimport { Animated, StyleSheet, View } from \"react-native\";\nimport { match } from \"ts-pattern\";\nimport { ColorVariants, animations, colors, shadows } from \"../constants/design\";\nimport { ToastVariant, hideToast, useToasts } from \"../state/toasts\";\nimport { isNullish } from \"../utils/nullish\";\nimport { Box } from \"./Box\";\nimport { Icon } from \"./Icon\";\nimport { LakeText } from \"./LakeText\";\nimport { Portal } from \"./Portal\";\nimport { Pressable } from \"./Pressable\";\nimport { Space } from \"./Space\";\nimport { TransitionGroupView } from \"./TransitionGroupView\";\n\nconst styles = StyleSheet.create({\n  list: {\n    position: \"absolute\",\n    right: 0,\n    bottom: 0,\n    maxHeight: \"100%\",\n    maxWidth: 400,\n    paddingVertical: 8,\n    width: \"100%\",\n    zIndex: 10,\n  },\n  toastWrapper: {\n    paddingHorizontal: 16,\n    paddingVertical: 8,\n  },\n  toast: {\n    padding: 24,\n    borderRadius: 4,\n    borderWidth: 1,\n    borderLeftWidth: 4,\n    overflow: \"hidden\",\n    boxShadow: shadows.modal,\n  },\n  contentContainer: {\n    paddingRight: 36, // 24 for close button + 12 for spacing\n  },\n  closeButton: {\n    zIndex: 1,\n    position: \"absolute\",\n    width: 24,\n    height: 24,\n    right: 24,\n    top: 0,\n    bottom: 0,\n    margin: \"auto\",\n  },\n  progressBar: {\n    height: 2,\n    transformOrigin: \"left\",\n  },\n});\n\ntype ToastProps = {\n  variant: ToastVariant;\n  uid: string;\n  title: string;\n  description?: string;\n  progress?: Animated.Value;\n  onClose: (uid: string) => void;\n};\n\nconst Toast = memo<ToastProps>(({ variant, uid, title, description, progress, onClose }) => {\n  const progressBarRef = useRef<View>(null);\n\n  const colorVariation = match(variant)\n    .returnType<ColorVariants>()\n    .with(\"success\", () => \"positive\")\n    .with(\"error\", () => \"negative\")\n    .with(\"info\", () => \"shakespear\")\n    .with(\"warning\", () => \"warning\")\n    .exhaustive();\n\n  useEffect(() => {\n    if (isNullish(progress)) {\n      return;\n    }\n\n    const id = progress.addListener(({ value }) => {\n      if (progressBarRef.current instanceof HTMLElement) {\n        progressBarRef.current.style.transform = `scaleX(${value})`;\n      }\n    });\n\n    return () => progress.removeListener(id);\n  }, [progress]);\n\n  return (\n    <View style={styles.toastWrapper}>\n      <View\n        style={[\n          styles.toast,\n          {\n            borderColor: colors[colorVariation][200],\n            borderLeftColor: colors[colorVariation][500],\n            backgroundColor: colors[colorVariation][0],\n          },\n        ]}\n      >\n        <Box style={styles.contentContainer}>\n          <Box direction=\"row\" alignItems=\"center\">\n            {match(variant)\n              .with(\"success\", () => (\n                <Icon\n                  name=\"checkmark-circle-regular\"\n                  size={20}\n                  color={colors[colorVariation][700]}\n                />\n              ))\n              .with(\"error\", () => (\n                <Icon name=\"dismiss-circle-regular\" size={20} color={colors[colorVariation][700]} />\n              ))\n              .with(\"info\", () => (\n                <Icon name=\"info-regular\" size={20} color={colors[colorVariation][700]} />\n              ))\n              .with(\"warning\", () => (\n                <Icon name=\"warning-regular\" size={20} color={colors[colorVariation][700]} />\n              ))\n              .exhaustive()}\n\n            <Space width={12} />\n\n            <LakeText variant=\"regular\" color={colors[colorVariation][700]}>\n              {title}\n            </LakeText>\n          </Box>\n\n          {description != null && (\n            <>\n              <Space height={8} />\n\n              <LakeText variant=\"smallRegular\" color={colors.gray[700]}>\n                {description}\n              </LakeText>\n            </>\n          )}\n        </Box>\n\n        <Pressable onPress={() => onClose(uid)} style={styles.closeButton}>\n          <Icon name=\"lake-close\" size={24} color={colors.gray[500]} />\n        </Pressable>\n\n        {progress != null && (\n          <>\n            <Space height={24} />\n\n            <View\n              ref={progressBarRef}\n              role=\"progressbar\"\n              style={[styles.progressBar, { backgroundColor: colors[colorVariation][500] }]}\n            />\n          </>\n        )}\n      </View>\n    </View>\n  );\n});\n\nexport const ToastStack = () => {\n  const toasts = useToasts();\n\n  const [rootElement, setRootElement] = useState<Element | undefined>(() => undefined);\n\n  useEffect(() => {\n    const rootElement = document.createElement(\"div\");\n    document.body.append(rootElement);\n    setRootElement(rootElement);\n    return () => {\n      rootElement.remove();\n      setRootElement(undefined);\n    };\n  }, []);\n\n  if (rootElement == null) {\n    return null;\n  }\n\n  return (\n    <Portal container={rootElement}>\n      <TransitionGroupView\n        style={styles.list}\n        enter={animations.fadeAndSlideInFromRight.enter}\n        leave={animations.fadeAndSlideInFromRight.leave}\n      >\n        {toasts.map(toast => (\n          <Toast\n            key={toast.uid}\n            uid={toast.uid}\n            variant={toast.variant}\n            progress={toast.progress}\n            title={toast.title}\n            description={toast.description}\n            onClose={hideToast}\n          />\n        ))}\n      </TransitionGroupView>\n    </Portal>\n  );\n};\n"],"names":["t","e","r","n","createControllableTimeout","config","duration","onStart","onReset","onEnd","timerId","remaining","clear","onVisibilityChange","start","reset","toasts","atom","useToasts","useAtom","hideToast","uid","toast","_a","_b","showToast","variant","title","description","autoClose","Animated","Easing","progress","timeout","styles","StyleSheet","shadows","Toast","memo","onClose","progressBarRef","useRef","colorVariation","match","useEffect","isNullish","id","value","jsx","View","jsxs","colors","Box","Icon","Space","LakeText","Fragment","Pressable","ToastStack","rootElement","setRootElement","useState","Portal","TransitionGroupView","animations"],"mappings":"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","x_google_ignoreList":[0]}