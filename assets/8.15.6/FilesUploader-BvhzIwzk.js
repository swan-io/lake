import{s as S,d as V,b as T,J as O,c as y,j as e,B as b,$ as U,L as j,S as k,V as P,g as C,o as M,I as B,l as H,i as G}from"./ScrollView-CnkSV7w6.js";import{r as n}from"./index-Cs7sjTYM.js";import{g as N,F as X}from"./FileInput-D-LxiSBh.js";import{L as F}from"./LakeAlert-_t93cyBn.js";import{L as R,a as z}from"./LakeButton-CC8Q2vJZ.js";import{P as D}from"./Pressable-BGOPdkuK.js";import{T as W}from"./Tag-CoH4PIyY.js";import{c as _}from"./commonStyles-t4XfA7cz.js";import{s as A}from"./clipboard-BXAk6GqW.js";import{t as p}from"./i18n-Xw7AAIJ-.js";import{L as $}from"./LakeModal-CMxfS8ug.js";const J=s=>{const[m,d]=n.useState(s.initialFiles),v=n.useCallback(i=>{d(u=>u.some(t=>t.id===i.id)?u.map(t=>t.id===i.id?i:t):[...u,i])},[]),f=n.useCallback((i,u)=>s.generateUpload(i).tapError(t=>{s.onError!=null&&s.onError(t)}).flatMapOk(({upload:t,id:o})=>{d(r=>[...r.filter(a=>a.id!==o),{id:o,statusInfo:{status:"Uploading",progress:0},name:u.name}]);const w=r=>{d(a=>a.map(l=>l.id!==o?l:{...l,statusInfo:{status:"Uploading",progress:r.loaded/r.total}}))};return s.uploadFile({id:o,upload:t,file:u,onLoadStart:w,onProgress:w}).tapOk(()=>{d(r=>r.map(a=>a.id!==o?a:{...a,statusInfo:{status:"Uploaded"}}))}).tapError(r=>{s.onError!=null&&s.onError(r),d(a=>a.filter(l=>l.id!==o))})}),[s]),c=n.useCallback(i=>{d(u=>u.filter(t=>t.id!==i))},[]);return{files:m,upload:f,remove:c,add:v}},h=S.create({base:{backgroundColor:V.accented,borderRadius:8,borderWidth:1,overflow:"hidden"},content:{height:56,paddingLeft:T[20],paddingRight:T[8]},progressBar:{flex:1,height:4,borderRadius:2,backgroundColor:O},progress:{height:4,transitionProperty:"width",transitionDuration:"300ms",transitionTimingFunction:"ease-in-out",borderRadius:2,backgroundColor:y.current[500]}}),I=({file:{id:s,statusInfo:m,name:d,url:v},showId:f=!1,onRemove:c})=>{const[i,u]=n.useState(!1),[t,o]=n.useState(!1),w=n.useCallback(()=>{c!=null&&(u(!0),c().tap(()=>{u(!1),o(!1)}))},[c]),[r,a]=n.useState("copy");return e.jsxs(b,{style:[h.base,{borderColor:U(m.status).with("Uploaded","Uploading",()=>y.gray[100]).with("Pending",()=>y.shakespear[100]).with("Validated",()=>y.positive[100]).with("Refused",()=>y.negative[100]).exhaustive()}],children:[e.jsx(b,{alignItems:"center",direction:"row",style:h.content,children:m.status==="Uploading"?e.jsxs(e.Fragment,{children:[e.jsx(j,{numberOfLines:1,color:y.gray[700],children:p("fileTile.uploading")}),e.jsx(k,{width:20}),e.jsx(P,{role:"progressbar",style:h.progressBar,children:e.jsx(P,{style:[h.progress,{width:`${m.progress*100}%`}]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{icon:N(d),iconSize:20,color:U(m).with({status:C.union("Uploaded","Pending")},()=>"shakespear").with({status:"Validated"},()=>"positive").with({status:"Refused"},()=>"negative").exhaustive()}),e.jsx(k,{width:16}),e.jsxs(b,{grow:1,children:[e.jsx(j,{numberOfLines:1,color:y.gray[700],style:_.fill,children:d}),f?e.jsx(M,{describedBy:"copy",onHide:()=>a("copy"),togglableOnFocus:!0,content:r==="copy"?p("copyButton.copyTooltip"):p("copyButton.copiedTooltip"),children:e.jsx(D,{onPress:l=>{l.stopPropagation(),l.preventDefault(),A(s),a("copied")},children:e.jsxs(b,{direction:"row",alignItems:"center",children:[e.jsx(j,{numberOfLines:1,variant:"smallRegular",children:p("fileTile.id",{id:s})}),e.jsx(k,{width:4}),e.jsx(B,{size:14,name:"copy-regular"})]})})}):null]}),e.jsx(k,{width:12}),H(v)&&e.jsx(R,{mode:"tertiary",size:"small",icon:"open-filled",onPress:()=>{window.open(v,"_blank")},ariaLabel:p("common.open")}),G(c)&&e.jsx(R,{mode:"tertiary",size:"small",icon:"delete-regular",color:"negative",onPress:()=>o(!0),ariaLabel:p("common.remove")}),e.jsx($,{title:p("fileTile.deleteModal.title"),icon:"subtract-circle-regular",visible:t,onPressClose:()=>o(!1),color:"negative",children:e.jsx(z,{paddingBottom:0,children:e.jsx(R,{loading:i,grow:!0,color:"negative",onPress:w,children:p("fileTile.deleteModal.delete")})})})]})}),U(m).with({status:"Pending"},()=>e.jsx(F,{anchored:!0,title:p("fileTile.status.Pending"),variant:"info"})).with({status:"Validated"},()=>e.jsx(F,{anchored:!0,title:p("fileTile.status.Validated"),variant:"success"})).with({status:"Refused"},({reason:l})=>e.jsx(F,{anchored:!0,title:p("fileTile.status.Refused"),variant:"error",children:l})).otherwise(()=>null)]})};I.__docgenInfo={description:"",methods:[],displayName:"FileTile",props:{file:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  id: string;
  statusInfo: SwanFileStatusInfo;
  name: string;
  url?: string;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"statusInfo",value:{name:"union",raw:`| { status: "Uploading"; progress: number }
| { status: "Uploaded" }
| { status: "Pending" }
| { status: "Validated" }
| { status: "Refused"; reason: string }`,elements:[{name:"signature",type:"object",raw:'{ status: "Uploading"; progress: number }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Uploading"',required:!0}},{key:"progress",value:{name:"number",required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Uploaded" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Uploaded"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Pending" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Pending"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Validated" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Validated"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Refused"; reason: string }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Refused"',required:!0}},{key:"reason",value:{name:"string",required:!0}}]}}],required:!0}},{key:"name",value:{name:"string",required:!0}},{key:"url",value:{name:"string",required:!1}}]}},description:""},showId:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onRemove:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Future<unknown>",signature:{arguments:[],return:{name:"Future",elements:[{name:"unknown"}],raw:"Future<unknown>"}}},description:""}}};const K=({maxSize:s,accept:m,icon:d,getUploadConfig:v,onRemoveFile:f,onChange:c,formatAndSizeDescription:i,canUpload:u=!0,showIds:t=!1,...o},w)=>{const{files:r,upload:a,remove:l,add:L}=J(o),x=n.useRef(c);x.current=c;const E=n.useRef(!0);return n.useImperativeHandle(w,()=>({add:L})),n.useEffect(()=>{if(E.current){E.current=!1;return}const g=x.current;g!=null&&g(r)},[r]),e.jsxs(b,{children:[u?e.jsxs(e.Fragment,{children:[e.jsx(X,{layout:"horizontal",onFiles:g=>{g.forEach(q=>{a(v(q),q)})},accept:m,icon:d,description:i,maxSize:s}),e.jsx(k,{height:12})]}):null,r.map((g,q)=>e.jsxs(n.Fragment,{children:[q>0?e.jsx(k,{height:12}):null,e.jsx(I,{file:g,showId:t,onRemove:f!=null&&g.statusInfo.status==="Uploaded"?()=>f(g).tapOk(()=>{l(g.id)}):void 0})]},g.id))]})},Q=n.forwardRef(K);Q.__docgenInfo={description:"",methods:[],displayName:"FilesUploader",props:{initialFiles:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  statusInfo: SwanFileStatusInfo;
  name: string;
  url?: string;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"statusInfo",value:{name:"union",raw:`| { status: "Uploading"; progress: number }
| { status: "Uploaded" }
| { status: "Pending" }
| { status: "Validated" }
| { status: "Refused"; reason: string }`,elements:[{name:"signature",type:"object",raw:'{ status: "Uploading"; progress: number }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Uploading"',required:!0}},{key:"progress",value:{name:"number",required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Uploaded" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Uploaded"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Pending" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Pending"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Validated" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Validated"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Refused"; reason: string }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Refused"',required:!0}},{key:"reason",value:{name:"string",required:!0}}]}}],required:!0}},{key:"name",value:{name:"string",required:!0}},{key:"url",value:{name:"string",required:!1}}]}}],raw:"SwanFile[]"},description:""},generateUpload:{required:!0,tsType:{name:"signature",type:"function",raw:`(
  config: UploadInput,
) => Future<Result<UploadOutputWithId<UploadOutput>, GenerateUploadError>>`,signature:{arguments:[{type:{name:"UploadInput"},name:"config"}],return:{name:"Future",elements:[{name:"Result",elements:[{name:"signature",type:"object",raw:"{ id: string; upload: UploadOutput }",signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"upload",value:{name:"UploadOutput",required:!0}}]}},{name:"GenerateUploadError"}],raw:"Result<UploadOutputWithId<UploadOutput>, GenerateUploadError>"}],raw:"Future<Result<UploadOutputWithId<UploadOutput>, GenerateUploadError>>"}}},description:""},uploadFile:{required:!0,tsType:{name:"signature",type:"function",raw:"(config: UploadFileInput<UploadOutput>) => Future<Result<unknown, UploadFileError>>",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  id: string;
  upload: UploadOutput;
  file: File;
  onLoadStart: (event: ProgressEvent<XMLHttpRequestEventTarget>) => void;
  onProgress: (event: ProgressEvent<XMLHttpRequestEventTarget>) => void;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"upload",value:{name:"UploadOutput",required:!0}},{key:"file",value:{name:"File",required:!0}},{key:"onLoadStart",value:{name:"signature",type:"function",raw:"(event: ProgressEvent<XMLHttpRequestEventTarget>) => void",signature:{arguments:[{type:{name:"ProgressEvent",elements:[{name:"XMLHttpRequestEventTarget"}],raw:"ProgressEvent<XMLHttpRequestEventTarget>"},name:"event"}],return:{name:"void"}},required:!0}},{key:"onProgress",value:{name:"signature",type:"function",raw:"(event: ProgressEvent<XMLHttpRequestEventTarget>) => void",signature:{arguments:[{type:{name:"ProgressEvent",elements:[{name:"XMLHttpRequestEventTarget"}],raw:"ProgressEvent<XMLHttpRequestEventTarget>"},name:"event"}],return:{name:"void"}},required:!0}}]}},name:"config"}],return:{name:"Future",elements:[{name:"Result",elements:[{name:"unknown"},{name:"UploadFileError"}],raw:"Result<unknown, UploadFileError>"}],raw:"Future<Result<unknown, UploadFileError>>"}}},description:""},onError:{required:!1,tsType:{name:"signature",type:"function",raw:"(error: GenerateUploadError | UploadFileError) => void",signature:{arguments:[{type:{name:"union",raw:"GenerateUploadError | UploadFileError",elements:[{name:"GenerateUploadError"},{name:"UploadFileError"}]},name:"error"}],return:{name:"void"}}},description:""},getUploadConfig:{required:!0,tsType:{name:"signature",type:"function",raw:"(file: File) => UploadInput",signature:{arguments:[{type:{name:"File"},name:"file"}],return:{name:"UploadInput"}}},description:""},accept:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},maxSize:{required:!0,tsType:{name:"number"},description:""},icon:{required:!0,tsType:{name:"unknown"},description:""},formatAndSizeDescription:{required:!1,tsType:{name:"string"},description:""},onRemoveFile:{required:!1,tsType:{name:"signature",type:"function",raw:"(file: SwanFile) => Future<Result<unknown, unknown>>",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  id: string;
  statusInfo: SwanFileStatusInfo;
  name: string;
  url?: string;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"statusInfo",value:{name:"union",raw:`| { status: "Uploading"; progress: number }
| { status: "Uploaded" }
| { status: "Pending" }
| { status: "Validated" }
| { status: "Refused"; reason: string }`,elements:[{name:"signature",type:"object",raw:'{ status: "Uploading"; progress: number }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Uploading"',required:!0}},{key:"progress",value:{name:"number",required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Uploaded" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Uploaded"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Pending" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Pending"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Validated" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Validated"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Refused"; reason: string }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Refused"',required:!0}},{key:"reason",value:{name:"string",required:!0}}]}}],required:!0}},{key:"name",value:{name:"string",required:!0}},{key:"url",value:{name:"string",required:!1}}]}},name:"file"}],return:{name:"Future",elements:[{name:"Result",elements:[{name:"unknown"},{name:"unknown"}],raw:"Result<unknown, unknown>"}],raw:"Future<Result<unknown, unknown>>"}}},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(files: SwanFile[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  statusInfo: SwanFileStatusInfo;
  name: string;
  url?: string;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"statusInfo",value:{name:"union",raw:`| { status: "Uploading"; progress: number }
| { status: "Uploaded" }
| { status: "Pending" }
| { status: "Validated" }
| { status: "Refused"; reason: string }`,elements:[{name:"signature",type:"object",raw:'{ status: "Uploading"; progress: number }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Uploading"',required:!0}},{key:"progress",value:{name:"number",required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Uploaded" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Uploaded"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Pending" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Pending"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Validated" }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Validated"',required:!0}}]}},{name:"signature",type:"object",raw:'{ status: "Refused"; reason: string }',signature:{properties:[{key:"status",value:{name:"literal",value:'"Refused"',required:!0}},{key:"reason",value:{name:"string",required:!0}}]}}],required:!0}},{key:"name",value:{name:"string",required:!0}},{key:"url",value:{name:"string",required:!1}}]}}],raw:"SwanFile[]"},name:"files"}],return:{name:"void"}}},description:""},canUpload:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},showIds:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{Q as F};
//# sourceMappingURL=FilesUploader-BvhzIwzk.js.map
