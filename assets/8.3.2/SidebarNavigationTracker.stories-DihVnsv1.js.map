{"version":3,"file":"SidebarNavigationTracker.stories-DihVnsv1.js","sources":["../../../packages/lake/src/components/SidebarNavigationTracker.tsx"],"sourcesContent":["import { createContext, useCallback, useContext, useEffect, useRef, useState } from \"react\";\nimport { ScrollView, ScrollViewProps, StyleSheet, View } from \"react-native\";\n\nconst styles = StyleSheet.create({\n  track: {\n    position: \"absolute\",\n    top: 0,\n    right: 0,\n    bottom: 0,\n    width: 3,\n  },\n  marker: {\n    pointerEvents: \"none\",\n    position: \"absolute\",\n    top: 0,\n    right: 0,\n    bottom: 0,\n    width: 3,\n  },\n  trackIndicator: {\n    width: 3,\n    height: 1,\n    position: \"absolute\",\n    right: 0,\n    transformOrigin: \"right top\",\n    transition: \"150ms ease-in-out\",\n    transitionProperty: \"transform, background-color\",\n  },\n});\n\ntype Track = { color: string; element: View };\n\nconst Context = createContext((_: Track) => {});\n\ntype Props = {\n  style?: ScrollViewProps[\"style\"];\n  contentContainerStyle?: ScrollViewProps[\"style\"];\n  children: ScrollViewProps[\"children\"];\n};\n\ntype Layout = { color: string; top: number; height: number };\n\n// using `offsetTop` and `offsetHeight` here to avoid calculations\n// being wrong when ancestor has as CSS transform applied\nconst getCoordinates = (element: HTMLElement, guide: HTMLElement) => {\n  const parentTop = guide.parentElement?.getBoundingClientRect().top ?? 0;\n  const elementRect = element.getBoundingClientRect();\n\n  return { top: elementRect.top - parentTop, height: elementRect.height };\n};\n\nexport const SidebarNavigationTracker = ({ style, contentContainerStyle, children }: Props) => {\n  const [track, setTrackRaw] = useState<Layout | null>(null);\n  const trackRef = useRef<View | null>(null);\n  const lastElementRef = useRef<View | null>(null);\n\n  const setTrack = useCallback(({ color, element }: Track) => {\n    if (trackRef.current != null) {\n      lastElementRef.current = element;\n      const { top, height } = getCoordinates(\n        element as unknown as HTMLElement,\n        trackRef.current as unknown as HTMLElement,\n      );\n      setTrackRaw({\n        color,\n        top,\n        height,\n      });\n    }\n  }, []);\n\n  const onLayout = useCallback(() => {\n    if (lastElementRef.current != null && track?.color != null) {\n      const { top, height } = getCoordinates(\n        lastElementRef.current as unknown as HTMLElement,\n        trackRef.current as unknown as HTMLElement,\n      );\n      setTrackRaw({\n        color: track?.color,\n        top,\n        height,\n      });\n    }\n  }, [track]);\n\n  return (\n    <Context.Provider value={setTrack}>\n      <ScrollView\n        scrollEventThrottle={30}\n        onLayout={onLayout}\n        style={style}\n        contentContainerStyle={contentContainerStyle}\n        role=\"banner\"\n      >\n        {children}\n\n        <View style={styles.track} ref={trackRef}>\n          {track != null ? (\n            <View\n              style={[\n                styles.trackIndicator,\n                {\n                  transform: `translateY(${track.top}px)`,\n                  height: track.height,\n                  backgroundColor: track.color,\n                },\n              ]}\n            />\n          ) : null}\n        </View>\n      </ScrollView>\n    </Context.Provider>\n  );\n};\n\ntype MarkerProps = {\n  color: string;\n};\n\nexport const SidebarNavigationTrackerActiveMarker = ({ color }: MarkerProps) => {\n  const setLayoutReference = useContext(Context);\n  const elementRef = useRef<View | null>(null);\n\n  const onLayout = useCallback(() => {\n    if (elementRef.current != null) {\n      setLayoutReference({ color, element: elementRef.current });\n    }\n  }, [setLayoutReference, color]);\n\n  useEffect(() => {\n    if (elementRef.current != null) {\n      setLayoutReference({ color, element: elementRef.current });\n    }\n  }, [setLayoutReference, color]);\n\n  return <View ref={elementRef} onLayout={onLayout} style={styles.marker} />;\n};\n"],"names":["styles","StyleSheet","Context","createContext","_","getCoordinates","element","guide","parentTop","_a","elementRect","SidebarNavigationTracker","style","contentContainerStyle","children","track","setTrackRaw","useState","trackRef","useRef","lastElementRef","setTrack","useCallback","color","top","height","onLayout","jsx","jsxs","ScrollView","View","SidebarNavigationTrackerActiveMarker","setLayoutReference","useContext","elementRef","useEffect"],"mappings":"2VAGA,MAAAA,EAAAC,EAAA,OAAA,CACA,MAAA,CACA,SAAA,WACA,IAAA,EACA,MAAA,EACA,OAAA,EACA,MAAA,CACA,EACA,OAAA,CACA,cAAA,OACA,SAAA,WACA,IAAA,EACA,MAAA,EACA,OAAA,EACA,MAAA,CACA,EACA,eAAA,CACA,MAAA,EACA,OAAA,EACA,SAAA,WACA,MAAA,EACA,gBAAA,YACA,WAAA,oBACA,mBAAA,6BACA,CACA,CAAA,EAIAC,EAAAC,EAAAA,cAAAC,GAAA,CAAA,CAAA,EAYAC,EAAA,CAAAC,EAAAC,IAAA,OACA,MAAAC,IAAAC,EAAAF,EAAA,gBAAA,YAAAE,EAAA,wBAAA,MAAA,EACAC,EAAAJ,EAAA,wBAEA,MAAA,CAAA,IAAAI,EAAA,IAAAF,EAAA,OAAAE,EAAA,OACA,EAEAC,EAAA,CAAA,CAAA,MAAAC,EAAA,sBAAAC,EAAA,SAAAC,KAAA,CACA,KAAA,CAAAC,EAAAC,CAAA,EAAAC,WAAA,IAAA,EACAC,EAAAC,SAAA,IAAA,EACAC,EAAAD,SAAA,IAAA,EAEAE,EAAAC,EAAA,YAAA,CAAA,CAAA,MAAAC,EAAA,QAAAjB,KAAA,CACA,GAAAY,EAAA,SAAA,KAAA,CACAE,EAAA,QAAAd,EACA,KAAA,CAAA,IAAAkB,EAAA,OAAAC,CAAA,EAAApB,EACAC,EACAY,EAAA,OAAA,EAEAF,EAAA,CACA,MAAAO,EACA,IAAAC,EACA,OAAAC,CAAA,CACA,CACA,CACA,EAAA,CAAA,CAAA,EAEAC,EAAAJ,EAAAA,YAAA,IAAA,CACA,GAAAF,EAAA,SAAA,OAAAL,GAAA,YAAAA,EAAA,QAAA,KAAA,CACA,KAAA,CAAA,IAAAS,EAAA,OAAAC,CAAA,EAAApB,EACAe,EAAA,QACAF,EAAA,OAAA,EAEAF,EAAA,CACA,MAAAD,GAAA,YAAAA,EAAA,MACA,IAAAS,EACA,OAAAC,CAAA,CACA,CACA,CAAA,EACA,CAAAV,CAAA,CAAA,EAEA,OACAY,EAAAA,IAAAzB,EAAA,SAAA,CAAA,MAAAmB,EACA,SAAAO,EAAA,KAAAC,EAAA,CACA,oBAAA,GACA,SAAAH,EACA,MAAAd,EACA,sBAAAC,EACA,KAAA,SAEA,SAAA,CAAAC,EAEAa,EAAAA,IAAAG,GAAA,MAAA9B,EAAA,MAAA,IAAAkB,EACA,YAAA,KACAS,EAAA,IAAAG,EAAA,CACA,MAAA,CACA9B,EAAA,eACA,CACA,UAAA,cAAAe,EAAA,GAAA,MACA,OAAAA,EAAA,OACA,gBAAAA,EAAA,KACA,CACA,CAAA,GAEA,IACA,CAAA,CAAA,CAAA,CAEA,CAAA,CAAA,CAEA,EAMAgB,EAAA,CAAA,CAAA,MAAAR,KAAA,CACA,MAAAS,EAAAC,aAAA/B,CAAA,EACAgC,EAAAf,SAAA,IAAA,EAEAO,EAAAJ,EAAAA,YAAA,IAAA,CACAY,EAAA,SAAA,MACAF,EAAA,CAAA,MAAAT,EAAA,QAAAW,EAAA,OAAA,CAAA,CACA,EACA,CAAAF,EAAAT,CAAA,CAAA,EAEAY,OAAAA,EAAAA,UAAA,IAAA,CACAD,EAAA,SAAA,MACAF,EAAA,CAAA,MAAAT,EAAA,QAAAW,EAAA,OAAA,CAAA,CACA,EACA,CAAAF,EAAAT,CAAA,CAAA,QAEAO,EAAA,CAAA,IAAAI,EAAA,SAAAR,EAAA,MAAA1B,EAAA,MAAA,CAAA,CACA;;;;;;;;;;;;;;;;;;"}