{"version":3,"file":"ListRightPanel.stories-r7rhP4fU.js","sources":["../../../packages/lake/src/components/ListRightPanel.tsx","../../../packages/lake/__stories__/ListRightPanel.stories.tsx"],"sourcesContent":["import { Array, Option } from \"@swan-io/boxed\";\nimport { Ref } from \"react\";\nimport { StyleProp, StyleSheet, View, ViewStyle } from \"react-native\";\nimport { match } from \"ts-pattern\";\nimport { animations, colors, spacings } from \"../constants/design\";\nimport { usePreviousValue } from \"../hooks/usePreviousValue\";\nimport { noop } from \"../utils/function\";\nimport { Box } from \"./Box\";\nimport { FocusTrapRef } from \"./FocusTrap\";\nimport { LakeButton } from \"./LakeButton\";\nimport { LoadingView } from \"./LoadingView\";\nimport { RightPanel } from \"./RightPanel\";\nimport { Space } from \"./Space\";\nimport { Suspendable } from \"./Suspendable\";\nimport { TransitionView } from \"./TransitionView\";\n\nconst styles = StyleSheet.create({\n  details: {\n    paddingBottom: spacings[24],\n    paddingTop: spacings[12],\n    flexGrow: 1,\n  },\n  detailsContents: {\n    ...StyleSheet.absoluteFillObject,\n  },\n  detailsContainer: {\n    flexGrow: 1,\n  },\n  content: {\n    paddingHorizontal: spacings[24],\n  },\n  contentLarge: {\n    paddingHorizontal: spacings[40],\n  },\n});\n\nexport const ListRightPanelContent = ({\n  children,\n  large,\n  style,\n}: {\n  children: React.ReactNode;\n  large: boolean;\n  style?: StyleProp<ViewStyle>;\n}) => {\n  return <View style={[large ? styles.contentLarge : styles.content, style]}>{children}</View>;\n};\n\ntype Props<T> = {\n  ref?: Ref<FocusTrapRef>;\n  items: T[];\n  keyExtractor: (item: T) => string;\n  activeId: string | null;\n  onActiveIdChange: (id: string) => void;\n  onClose: () => void;\n  render: (item: T, large: boolean) => React.ReactNode;\n  closeLabel: string;\n  previousLabel: string;\n  nextLabel: string;\n};\n\nexport const ListRightPanel = <T,>({\n  ref,\n  items,\n  keyExtractor,\n  activeId,\n  onActiveIdChange,\n  onClose,\n  render,\n  closeLabel,\n  previousLabel,\n  nextLabel,\n}: Props<T>) => {\n  const activeItem = items.find(item => keyExtractor(item) === activeId);\n  // use `Array.getIndexBy` instead of `Array.findIndex` to avoid -1 value\n  const activeItemIndex = Array.findIndex(\n    items,\n    item => keyExtractor(item) === activeId,\n  ).toUndefined();\n\n  const previousId = usePreviousValue(activeId);\n  const previousItem = usePreviousValue(activeItem);\n  const previousIndex = usePreviousValue(activeItemIndex);\n\n  const newDetailDirection =\n    typeof activeItemIndex === \"number\" && typeof previousIndex === \"number\"\n      ? match({ activeItemIndex, previousIndex })\n          .when(\n            ({ activeItemIndex, previousIndex }) => activeItemIndex < previousIndex,\n            () => animations.fadeAndSlideInFromTop,\n          )\n          .when(\n            ({ activeItemIndex, previousIndex }) => activeItemIndex > previousIndex,\n            () => animations.fadeAndSlideInFromBottom,\n          )\n          .otherwise(() => null)\n      : null;\n\n  const previousDetailDirection =\n    typeof activeItemIndex === \"number\" && typeof previousIndex === \"number\"\n      ? match({ activeItemIndex, previousIndex })\n          .when(\n            ({ activeItemIndex, previousIndex }) => activeItemIndex < previousIndex,\n            () => animations.fadeAndSlideInFromBottom,\n          )\n          .when(\n            ({ activeItemIndex, previousIndex }) => activeItemIndex > previousIndex,\n            () => animations.fadeAndSlideInFromTop,\n          )\n          .otherwise(() => null)\n      : null;\n\n  return (\n    <RightPanel ref={ref} visible={activeItem != null} onPressClose={onClose}>\n      {({ large }) => (\n        <View style={styles.details}>\n          <Box\n            direction=\"row\"\n            justifyContent=\"spaceBetween\"\n            style={large ? styles.contentLarge : styles.content}\n          >\n            <LakeButton\n              mode=\"tertiary\"\n              icon=\"lake-close\"\n              ariaLabel={closeLabel}\n              onPress={onClose}\n            />\n\n            <Box direction=\"row\" justifyContent=\"spaceBetween\">\n              <LakeButton\n                mode=\"tertiary\"\n                ariaLabel={previousLabel}\n                icon=\"arrow-left-regular\"\n                disabled={activeItemIndex === 0}\n                onPress={() => {\n                  if (typeof activeItemIndex === \"number\") {\n                    Option.fromNullable(items[activeItemIndex - 1]).match({\n                      Some: item => onActiveIdChange(keyExtractor(item)),\n                      None: noop,\n                    });\n                  }\n                }}\n              />\n\n              <LakeButton\n                mode=\"tertiary\"\n                ariaLabel={nextLabel}\n                icon=\"arrow-right-regular\"\n                disabled={activeItemIndex === items.length - 1}\n                onPress={() => {\n                  if (typeof activeItemIndex === \"number\") {\n                    Option.fromNullable(items[activeItemIndex + 1]).match({\n                      Some: item => onActiveIdChange(keyExtractor(item)),\n                      None: noop,\n                    });\n                  }\n                }}\n              />\n            </Box>\n          </Box>\n\n          <Space height={12} />\n\n          <View style={styles.detailsContainer}>\n            {activeItem != null\n              ? [\n                  <TransitionView\n                    {...newDetailDirection}\n                    key={activeId}\n                    style={styles.detailsContents}\n                  >\n                    {previousItem != null ? (\n                      <Suspendable fallback={<LoadingView color={colors.current[500]} delay={0} />}>\n                        {render(activeItem, large)}\n                      </Suspendable>\n                    ) : (\n                      render(activeItem, large)\n                    )}\n                  </TransitionView>,\n\n                  ...(previousItem != null && previousId !== activeId\n                    ? [\n                        <TransitionView\n                          {...previousDetailDirection}\n                          key={previousId}\n                          style={styles.detailsContents}\n                        >\n                          {null}\n                        </TransitionView>,\n                      ]\n                    : []),\n                ]\n              : null}\n          </View>\n        </View>\n      )}\n    </RightPanel>\n  );\n};\n","import { Meta } from \"@storybook/react\";\nimport { useState } from \"react\";\nimport { StyleSheet } from \"react-native\";\nimport { LakeButton } from \"../src/components/LakeButton\";\nimport { LakeHeading } from \"../src/components/LakeHeading\";\nimport { ListRightPanel } from \"../src/components/ListRightPanel\";\nimport { StoryBlock } from \"./_StoriesComponents\";\n\nconst styles = StyleSheet.create({\n  button: {\n    alignSelf: \"flex-start\",\n  },\n});\n\nexport default {\n  title: \"Layout/ListRightPanel\",\n  component: ListRightPanel,\n} as Meta<typeof ListRightPanel>;\n\nconst resolved: Record<string, boolean> = {};\n\nconst Item = ({ item }: { item: string }) => {\n  if (resolved[item] !== true) {\n    throw new Promise(resolve => {\n      setTimeout(() => {\n        resolved[item] = true;\n        resolve(undefined);\n      }, 500);\n    });\n  }\n\n  return (\n    <LakeHeading level={1} variant=\"h1\">\n      Item {item}\n    </LakeHeading>\n  );\n};\n\nexport const Default = () => {\n  const [activeId, setActiveId] = useState<string | null>(null);\n\n  return (\n    <StoryBlock\n      title=\"RightPanel\"\n      description={[\n        \"RightPanel is a component that allows you to render a panel on the right side of the screen.\",\n        \"To make this component work, you need a root element with the id `full-page-layer-root` below your #root-app element\",\n        \"You can open it by clicking on the button below.\",\n      ]}\n    >\n      <LakeButton onPress={() => setActiveId(\"1\")} size=\"small\" style={styles.button}>\n        Open right panel\n      </LakeButton>\n\n      <ListRightPanel\n        closeLabel=\"Close\"\n        previousLabel=\"Previous\"\n        nextLabel=\"Next\"\n        keyExtractor={item => item}\n        activeId={activeId}\n        onActiveIdChange={activeId => setActiveId(activeId)}\n        onClose={() => setActiveId(null)}\n        items={[\"1\", \"2\", \"3\"]}\n        render={item => <Item item={item} />}\n      />\n    </StoryBlock>\n  );\n};\n"],"names":["styles","StyleSheet","spacings","ListRightPanel","ref","items","keyExtractor","activeId","onActiveIdChange","onClose","render","closeLabel","previousLabel","nextLabel","activeItem","item","activeItemIndex","Array","previousId","usePreviousValue","previousItem","previousIndex","newDetailDirection","match","animations","previousDetailDirection","RightPanel","large","jsxs","View","Box","jsx","LakeButton","Option","noop","Space","createElement","TransitionView","Suspendable","LoadingView","colors","create","button","alignSelf","ListRightPanel_stories","title","component","resolved","Item","Promise","resolve","setTimeout","undefined","LakeHeading","Default","setActiveId","useState","StoryBlock"],"mappings":"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"}