{"version":3,"file":"SearchField.stories-BUm1vLsO.js","sources":["../../../packages/lake/src/hooks/useDebounce.ts","../../../packages/lake/src/components/LakeSearchField.tsx"],"sourcesContent":["import { useCallback, useRef } from \"react\";\nimport { isNotNullish } from \"../utils/nullish\";\n\nexport const useDebounce = <T>(func: (arg: T) => void, duration: number) => {\n  const timeoutRef = useRef<number | undefined>(undefined);\n\n  return useCallback(\n    (arg: T) => {\n      if (isNotNullish(timeoutRef.current)) {\n        clearTimeout(timeoutRef.current);\n      }\n      timeoutRef.current = window.setTimeout(func, duration, arg);\n      return () => clearTimeout(timeoutRef.current);\n    },\n    [func, duration],\n  );\n};\n","import { ReactNode, Ref, useCallback, useRef, useState } from \"react\";\nimport { Pressable, StyleSheet, TextInput, View } from \"react-native\";\nimport { animations, backgroundColor, colors, radii, spacings } from \"../constants/design\";\nimport { useBoolean } from \"../hooks/useBoolean\";\nimport { useDebounce } from \"../hooks/useDebounce\";\nimport { LakeButton } from \"./LakeButton\";\nimport { LakeTextInput } from \"./LakeTextInput\";\nimport { ResponsiveContainer } from \"./ResponsiveContainer\";\nimport { Line, Svg } from \"./Svg\";\nimport { TransitionView } from \"./TransitionView\";\n\nconst styles = StyleSheet.create({\n  container: {\n    flexGrow: 1,\n    flexShrink: 1,\n  },\n  input: {\n    transition: \"300ms ease-in-out border-color\",\n    // ResponsiveContainer uses a 200 breaking,\n    // we give the opportunity to the component to grow 2px more\n    // to trigger the change\n    maxWidth: 202,\n    minWidth: 38,\n    justifyContent: \"flex-end\",\n  },\n  focus: {\n    outlineStyle: \"none\",\n    borderColor: colors.current.primary,\n  },\n  clearButton: {\n    marginRight: spacings[8],\n  },\n  clear: {\n    width: 8,\n    height: 8,\n  },\n  smallButtonContainer: {\n    flexDirection: \"row\",\n    justifyContent: \"flex-end\",\n    flexGrow: 1,\n  },\n  largeInputContainer: {\n    flexDirection: \"row\",\n    justifyContent: \"flex-end\",\n    flexGrow: 1,\n  },\n  openSearchFieldContainer: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n    bottom: 0,\n  },\n  openSearchField: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n    bottom: 0,\n    boxShadow: `0 0 20px 20px ${backgroundColor.default}`,\n    borderRadius: radii[6],\n  },\n});\n\ntype Props = {\n  initialValue: string;\n  placeholder: string;\n  onChangeText: (text: string) => void;\n  debounceDuration?: number;\n  maxWidth?: number;\n  renderEnd?: () => ReactNode;\n};\n\ntype InternalProps = {\n  inputRef: Ref<TextInput>;\n  placeholder: string;\n  initialValue: string;\n  onChange: (value: string) => void;\n  setFocused: { on: () => void; off: () => void };\n  hasFocus: boolean;\n  clear: () => void;\n  currentValue: string;\n  renderEnd?: () => ReactNode;\n};\n\nconst CollapsibleSeachField = ({\n  inputRef,\n  placeholder,\n  initialValue,\n  onChange,\n  setFocused,\n  hasFocus,\n  clear,\n  currentValue,\n  renderEnd,\n}: InternalProps) => {\n  return (\n    <View style={styles.smallButtonContainer}>\n      <LakeButton\n        mode=\"secondary\"\n        size=\"small\"\n        ariaLabel={placeholder}\n        icon=\"search-filled\"\n        onPress={() => {\n          setFocused.on();\n        }}\n        pill={currentValue !== \"\"}\n      />\n\n      <TransitionView\n        style={styles.openSearchFieldContainer}\n        {...animations.fadeAndSlideInFromRight}\n      >\n        {hasFocus ? (\n          <View style={styles.openSearchField}>\n            <ExpandedSearchField\n              inputRef={inputRef}\n              placeholder={placeholder}\n              initialValue={initialValue}\n              onChange={onChange}\n              setFocused={setFocused}\n              hasFocus={hasFocus}\n              clear={clear}\n              currentValue={currentValue}\n              renderEnd={renderEnd}\n            />\n          </View>\n        ) : null}\n      </TransitionView>\n    </View>\n  );\n};\n\nconst ExpandedSearchField = ({\n  inputRef,\n  placeholder,\n  initialValue,\n  onChange,\n  setFocused,\n  hasFocus,\n  clear,\n  renderEnd,\n}: InternalProps) => {\n  const timeoutRef = useRef<number | null>(null);\n  return (\n    <LakeTextInput\n      ref={inputRef}\n      autoFocus={hasFocus}\n      icon=\"search-filled\"\n      placeholder={placeholder}\n      defaultValue={initialValue}\n      inputMode=\"search\"\n      onChangeText={onChange}\n      hideErrors={true}\n      renderEnd={() => (\n        <>\n          <Pressable\n            onPress={() => {\n              if (timeoutRef.current != null) {\n                clearTimeout(timeoutRef.current);\n              }\n              clear();\n            }}\n            style={styles.clearButton}\n          >\n            <Svg viewBox=\"0 0 16 16\" style={styles.clear}>\n              <>\n                <Line\n                  x1=\"0\"\n                  x2=\"16\"\n                  y1=\"0\"\n                  y2=\"16\"\n                  strokeLinecap=\"round\"\n                  stroke={colors.gray[500]}\n                  strokeWidth={2}\n                />\n\n                <Line\n                  x1=\"0\"\n                  x2=\"16\"\n                  y1=\"16\"\n                  y2=\"0\"\n                  strokeLinecap=\"round\"\n                  stroke={colors.gray[500]}\n                  strokeWidth={2}\n                />\n              </>\n            </Svg>\n          </Pressable>\n\n          {renderEnd?.()}\n        </>\n      )}\n      onFocus={() => {\n        if (timeoutRef.current != null) {\n          clearTimeout(timeoutRef.current);\n        }\n        setFocused.on();\n      }}\n      onBlur={() => {\n        timeoutRef.current = window.setTimeout(() => {\n          setFocused.off();\n        }, 300);\n      }}\n      containerStyle={styles.largeInputContainer}\n      style={[styles.input, hasFocus ? styles.focus : null]}\n    />\n  );\n};\n\nexport const LakeSearchField = ({\n  initialValue,\n  placeholder,\n  onChangeText,\n  debounceDuration = 500,\n  maxWidth,\n  renderEnd,\n}: Props) => {\n  const [hasFocus, setFocused] = useBoolean(false);\n  const inputRef = useRef<TextInput>(null);\n\n  const [currentValue, setCurrentValue] = useState(initialValue);\n\n  const onChange = useDebounce((value: string) => {\n    onChangeText(value);\n    setCurrentValue(value.trim());\n  }, debounceDuration);\n\n  const clear = useCallback(() => {\n    if (inputRef.current instanceof HTMLInputElement) {\n      inputRef.current.clear();\n      inputRef.current.focus();\n      onChangeText(\"\");\n      setCurrentValue(\"\");\n    }\n  }, [onChangeText]);\n\n  const props = {\n    inputRef,\n    placeholder,\n    initialValue,\n    onChange,\n    setFocused,\n    hasFocus,\n    clear,\n    currentValue,\n    renderEnd,\n  };\n\n  return (\n    <ResponsiveContainer\n      breakpoint={200}\n      style={[styles.container, maxWidth != null && { maxWidth }]}\n    >\n      {({ large }) => {\n        const Component = large ? ExpandedSearchField : CollapsibleSeachField;\n        return <Component {...props} />;\n      }}\n    </ResponsiveContainer>\n  );\n};\n"],"names":["useDebounce","func","duration","timeoutRef","useRef","useCallback","arg","isNotNullish","styles","StyleSheet","colors","spacings","backgroundColor","radii","CollapsibleSeachField","inputRef","placeholder","initialValue","onChange","setFocused","hasFocus","clear","currentValue","renderEnd","jsxs","View","jsx","LakeButton","TransitionView","animations","ExpandedSearchField","LakeTextInput","Fragment","Pressable","Svg","Line","LakeSearchField","onChangeText","debounceDuration","maxWidth","useBoolean","setCurrentValue","useState","value","props","ResponsiveContainer","large"],"mappings":"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"}