{"version":3,"file":"TransitionView-qPXrZuWh.js","sources":["../../../packages/lake/src/hooks/usePreviousValue.ts","../../../packages/lake/src/components/TransitionView.tsx"],"sourcesContent":["import { useEffect, useRef } from \"react\";\n\nexport const usePreviousValue = <T>(value: T): T => {\n  const previousRef = useRef(value);\n\n  useEffect(() => {\n    previousRef.current = value;\n  }, [value]);\n\n  return previousRef.current;\n};\n","import { ReactNode, useLayoutEffect, useReducer, useRef } from \"react\";\nimport { AnimationStyles, StyleProp, StyleSheet, View, ViewStyle } from \"react-native\";\nimport { usePreviousValue } from \"../hooks/usePreviousValue\";\nimport { isNotNullish, isNullish } from \"../utils/nullish\";\n\ntype Props = {\n  enter?: AnimationStyles;\n  leave?: AnimationStyles;\n  style?: StyleProp<ViewStyle>;\n  children: ReactNode | null;\n  onLeave?: () => void;\n};\n\nconst styles = StyleSheet.create({\n  base: {\n    animationFillMode: \"forwards\",\n  },\n});\n\nexport const TransitionView = ({ enter, leave, style, children, onLeave }: Props) => {\n  const viewRef = useRef<View>(null);\n  const childrenForLeaveAnimationRef = useRef<ReactNode>(null);\n  const [, forceUpdate] = useReducer(() => [], []);\n\n  const previousChildren = usePreviousValue(children);\n\n  if (isNullish(children) && isNotNullish(previousChildren) && isNotNullish(leave)) {\n    childrenForLeaveAnimationRef.current = previousChildren;\n  }\n\n  // Cleanup in case children reappear before the animation has performed\n  if (isNotNullish(children) && isNullish(previousChildren)) {\n    childrenForLeaveAnimationRef.current = null;\n  }\n\n  useLayoutEffect(() => {\n    if (isNullish(children) && isNotNullish(leave) && isNotNullish(viewRef.current)) {\n      const element = viewRef.current as unknown as Element;\n\n      const onAnimationEnd = () => {\n        childrenForLeaveAnimationRef.current = null;\n        forceUpdate();\n        onLeave?.();\n        element.removeEventListener(\"animationend\", onAnimationEnd);\n      };\n      element.addEventListener(\"animationend\", onAnimationEnd);\n\n      return () => element.removeEventListener(\"animationend\", onAnimationEnd);\n    }\n  }, [children, leave, onLeave]);\n\n  const hasChildrenToDisplay =\n    isNotNullish(children) || isNotNullish(childrenForLeaveAnimationRef.current);\n\n  return hasChildrenToDisplay ? (\n    <View\n      ref={viewRef}\n      style={[\n        styles.base,\n        style,\n        enter,\n        isNotNullish(childrenForLeaveAnimationRef.current) && leave,\n      ]}\n    >\n      {children ?? childrenForLeaveAnimationRef.current}\n    </View>\n  ) : null;\n};\n"],"names":["usePreviousValue","value","previousRef","useRef","useEffect","styles","StyleSheet","TransitionView","enter","leave","style","children","onLeave","viewRef","childrenForLeaveAnimationRef","forceUpdate","useReducer","previousChildren","isNullish","isNotNullish","useLayoutEffect","element","onAnimationEnd","jsx","View"],"mappings":"kHAEO,MAAMA,EAAuBC,GAAgB,CAClD,MAAMC,EAAcC,EAAAA,OAAOF,CAAK,EAEhCG,OAAAA,EAAAA,UAAU,IAAM,CACdF,EAAY,QAAUD,CACxB,EAAG,CAACA,CAAK,CAAC,EAEHC,EAAY,OACrB,ECGMG,EAASC,EAAW,OAAO,CAC/B,KAAM,CACJ,kBAAmB,UAAA,CAEvB,CAAC,EAEYC,EAAiB,CAAC,CAAE,MAAAC,EAAO,MAAAC,EAAO,MAAAC,EAAO,SAAAC,EAAU,QAAAC,KAAqB,CACnF,MAAMC,EAAUV,EAAAA,OAAa,IAAI,EAC3BW,EAA+BX,EAAAA,OAAkB,IAAI,EACrD,CAAA,CAAGY,CAAW,EAAIC,EAAAA,WAAW,IAAM,CAAA,EAAI,CAAA,CAAE,EAEzCC,EAAmBjB,EAAiBW,CAAQ,EAElD,OAAIO,EAAUP,CAAQ,GAAKQ,EAAaF,CAAgB,GAAKE,EAAaV,CAAK,IAC7EK,EAA6B,QAAUG,GAIrCE,EAAaR,CAAQ,GAAKO,EAAUD,CAAgB,IACtDH,EAA6B,QAAU,MAGzCM,EAAAA,gBAAgB,IAAM,CACpB,GAAIF,EAAUP,CAAQ,GAAKQ,EAAaV,CAAK,GAAKU,EAAaN,EAAQ,OAAO,EAAG,CAC/E,MAAMQ,EAAUR,EAAQ,QAElBS,EAAiB,IAAM,CAC3BR,EAA6B,QAAU,KACvCC,EAAA,EACAH,IAAA,EACAS,EAAQ,oBAAoB,eAAgBC,CAAc,CAC5D,EACA,OAAAD,EAAQ,iBAAiB,eAAgBC,CAAc,EAEhD,IAAMD,EAAQ,oBAAoB,eAAgBC,CAAc,CACzE,CACF,EAAG,CAACX,EAAUF,EAAOG,CAAO,CAAC,EAG3BO,EAAaR,CAAQ,GAAKQ,EAAaL,EAA6B,OAAO,EAG3ES,EAAAA,IAACC,EAAA,CACC,IAAKX,EACL,MAAO,CACLR,EAAO,KACPK,EACAF,EACAW,EAAaL,EAA6B,OAAO,GAAKL,CAAA,EAGvD,YAAYK,EAA6B,OAAA,CAAA,EAE1C,IACN"}