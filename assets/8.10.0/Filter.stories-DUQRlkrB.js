import{s as K,c as P,j as e,B as U,V as b,h as te,L as $,S as R,I as X,g as re,d as se,T as _,$ as W,C as L,b as Y,W as ne}from"./ScrollView-CvzccpVd.js";import{r as f}from"./index-uCp2LrAq.js";import{u as I}from"./useDisclosure-X_l1NENI.js";import{P as E,F as z}from"./Popover-jCP4Qu3F.js";import{L as B}from"./LakeButton-7RgGNqe_.js";import{M as V}from"./index-CjW0_BS4.js";import{b as oe,u as ie}from"./DatePicker-DF2Lb_tT.js";import{d as O}from"./utc-DJvBpWoA.js";import{u as ae}from"./Pressable-ByE7PA60.js";import{u as le}from"./TransitionView-BLiB80wh.js";import{L as ce}from"./LakeCheckbox-Bk-Wb3io.js";import{L as de}from"./LakeLabel-Bpsgb4Rm.js";import{L as ue}from"./LakeRadio-BBWC1TrY.js";import{L as me}from"./LakeTextInput-RPCpoQO5.js";import{S as pe}from"./Stack-Blo44JLv.js";import{T as Z}from"./Tag-SxGSub5c.js";import{S as he}from"./_StoriesComponents-DM2Dijct.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-BOkhicXD.js";import"./useResponsive-CWYKQO6x.js";import"./function-DWOrZq29.js";import"./BottomPanel-DIXI_POH.js";import"./commonStyles-t4XfA7cz.js";import"./useBodyClassName-CiTylq2A.js";import"./FocusTrap-B6hges9U.js";import"./a11y-DXvpDVrG.js";import"./array-rjEBP2Ry.js";import"./Suspendable-B2bod9Dq.js";import"./index-Csy7uKnt.js";import"./extends-CF3RwP-h.js";import"./Fill-BIMAjm8J.js";import"./LakeSelect-B8_Zp-eR.js";import"./rifm-o4VJJUnR.js";import"./rifm.esm-BZGGdhF-.js";import"./i18n-DAFUJE2O.js";import"./tslib.es6-UMXCHJY6.js";import"./LakeModal-DPxM3mBz.js";import"./LakeHeading-Dh1wRjnR.js";import"./ResponsiveContainer-BVO6hRY6.js";import"./v4-CQkTLCs1.js";const C=K.create({selected:{color:P.gray[500]},list:{paddingVertical:20,marginVertical:4,minWidth:250,overflow:"hidden"},item:{display:"flex",paddingHorizontal:24,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:8},itemHovered:{backgroundColor:P.gray[50]},availableFiltersTitle:{paddingHorizontal:24}});function H({filters:s,openFilters:t,label:m,title:o,availableFilters:i,large:p=!0,onAddFilter:v}){const r=f.useRef(null),[y,{close:c,toggle:d}]=I(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{direction:"row",justifyContent:"start",alignItems:"center",children:e.jsx(B,{size:"small",mode:"secondary",color:"gray",onPress:d,ref:r,icon:p?"chevron-down-filled":"filter-filled",iconPosition:"end",ariaLabel:m,children:p?m:null})}),e.jsx(E,{role:"listbox",matchReferenceMinWidth:!0,onDismiss:c,referenceRef:r,returnFocus:!1,visible:y,children:e.jsxs(b,{style:C.list,children:[te(o)?e.jsxs(e.Fragment,{children:[e.jsx($,{style:C.availableFiltersTitle,children:o}),e.jsx(R,{height:8})]}):null,e.jsx(z,{role:"list",data:i,keyExtractor:(a,n)=>`filter-item-${n}`,renderItem:({item:a})=>{const n=!!s[a.name]||t.includes(a.name);return e.jsxs(V,{style:({hovered:l})=>[C.item,l&&C.itemHovered],role:"button",disabled:n,onPress:()=>{v(a.name),c()},children:[e.jsx($,{variant:"smallRegular",style:n&&C.selected,children:a.label}),n&&e.jsx(X,{color:P.positive[500],name:"checkmark-filled",size:14})]})}})]})})]})}H.__docgenInfo={description:"",methods:[],displayName:"FilterChooser",props:{filters:{required:!0,tsType:{name:"Partial",elements:[{name:"Record",elements:[{name:"FilterName"},{name:"unknown"}],raw:"Record<FilterName, unknown>"}],raw:"Partial<Record<FilterName, unknown>>"},description:""},openFilters:{required:!0,tsType:{name:"Array",elements:[{name:"FilterName"}],raw:"FilterName[]"},description:""},label:{required:!0,tsType:{name:"string"},description:""},title:{required:!1,tsType:{name:"string"},description:""},availableFilters:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ label: string; name: FilterName }",signature:{properties:[{key:"label",value:{name:"string",required:!0}},{key:"name",value:{name:"FilterName",required:!0}}]}}],raw:"{ label: string; name: FilterName }[]"},description:""},large:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},onAddFilter:{required:!0,tsType:{name:"signature",type:"function",raw:"(filterName: FilterName) => void",signature:{arguments:[{type:{name:"FilterName"},name:"filterName"}],return:{name:"void"}}},description:""}}};const h=K.create({container:{paddingRight:12,paddingBottom:8},shadowed:{position:"absolute",opacity:0,width:"100%",height:"100%",borderRadius:4,boxShadow:re.tile,transitionDuration:"150ms",transitionProperty:"opacity"},hovered:{opacity:1},dropdown:{maxHeight:400,minWidth:200},itemHovered:{backgroundColor:P.gray[50]},content:{paddingVertical:12},inputContent:{padding:24},radio:{display:"flex",flexDirection:"row",alignItems:"center",height:32,paddingHorizontal:24},itemLabel:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},input:{minWidth:200},value:{maxWidth:130,whiteSpace:"nowrap"},buttonContainer:{paddingHorizontal:se[24]}}),q=f.forwardRef(({onPress:s,onPressRemove:t,label:m,value:o="",isActive:i},p)=>{const v=f.useRef(null),r=ae(v,p);return e.jsx(V,{ref:r,onPress:s,children:({hovered:y})=>e.jsxs(e.Fragment,{children:[e.jsx(b,{style:[h.shadowed,y&&h.hovered]}),e.jsx(Z,{label:m,color:"current",onPressRemove:t,children:e.jsxs(U,{direction:"row",alignItems:"center",children:[e.jsx(_,{numberOfLines:1,style:h.value,children:o}),e.jsx(R,{width:4}),e.jsx(X,{color:P.current.primary,name:i?"chevron-up-filled":"chevron-down-filled",size:16})]})})]})})});function fe({label:s,items:t,width:m,value:o,onValueChange:i,onPressRemove:p,autoOpen:v=!1}){const r=f.useRef(null),[y,{close:c,toggle:d}]=I(v),a=f.useMemo(()=>t.find(n=>n.value===o),[t,o]);return e.jsxs(b,{style:h.container,children:[e.jsx(q,{label:s,onPress:d,ref:r,onPressRemove:p,isActive:y,value:a==null?void 0:a.label}),e.jsx(E,{role:"listbox",matchReferenceWidth:!1,onDismiss:c,referenceRef:r,returnFocus:!1,visible:y,children:e.jsx(b,{style:[h.dropdown,{width:m}],children:e.jsx(z,{role:"list",data:t,contentContainerStyle:h.content,keyExtractor:(n,l)=>`filter-item-${l}`,renderItem:({item:n})=>{const l=o===n.value;return e.jsxs(V,{role:"radio","aria-checked":l,style:({hovered:x})=>[h.radio,x&&h.itemHovered],onPress:()=>{i(n.value),c()},children:[e.jsx(ue,{value:l}),e.jsx(R,{width:12}),e.jsx(_,{style:h.itemLabel,children:n.label})]})}})})})]})}function xe({label:s,items:t,width:m,checkAllLabel:o,value:i,onValueChange:p,applyButtonLabel:v,onPressRemove:r,autoOpen:y=!1}){const c=f.useRef(null),[d,{close:a,toggle:n}]=I(y),[l,x]=f.useState(i),u=f.useMemo(()=>new Set(l),[l]),F=f.useMemo(()=>t.filter(j=>u.has(j.value)),[t,u]),g=o!=null&&u.size===t.length,k=f.useMemo(()=>{if(o==null)return t;const j=u.size===0?!1:u.size===t.length?!0:"mixed";return[{label:o,checked:j},...t]},[t,o,u]),M=f.useCallback(()=>{p(l),a()},[p,l,a]);return f.useEffect(()=>{d||x(i)},[d,i]),e.jsxs(b,{style:h.container,children:[e.jsx(q,{label:s,onPress:n,ref:c,onPressRemove:r,isActive:d,value:g?o:F.map(j=>j.label).join(", ")}),e.jsx(E,{role:"listbox",matchReferenceWidth:!1,onDismiss:a,referenceRef:c,returnFocus:!1,visible:d,children:e.jsxs(b,{style:[h.dropdown,{width:m}],children:[e.jsx(z,{role:"list",data:k,contentContainerStyle:h.content,keyExtractor:(j,S)=>`filter-item-${S}`,renderItem:({item:j})=>{const S=W(j).with({checked:L.any},({checked:w})=>w).with({value:L.any},({value:w})=>u.has(w)).exhaustive(),ee=W(j).with({checked:L.any},({checked:w})=>()=>{x(w===!0?void 0:t.map(T=>T.value))}).with({value:L.any},({value:w})=>()=>{const T=new Set([...u]);S===!0?T.delete(w):T.add(w),T.size===0?x(void 0):x([...T])}).exhaustive();return e.jsxs(V,{role:"radio","aria-checked":S,style:({hovered:w})=>[h.radio,w&&h.itemHovered],onPress:ee,children:[e.jsx(ce,{value:S}),e.jsx(R,{width:12}),e.jsx(_,{style:h.itemLabel,children:j.label})]})}}),e.jsx(R,{height:8}),e.jsx(b,{style:h.buttonContainer,children:e.jsx(B,{color:"current",onPress:M,children:v})}),e.jsx(R,{height:24})]})})]})}function ve({label:s,initialValue:t,noValueText:m,cancelText:o,submitText:i,dateFormat:p,isSelectable:v,validate:r,onSave:y,onPressRemove:c,autoOpen:d=!1}){const a=f.useRef(null),[n,{close:l,toggle:x}]=I(d),u=f.useMemo(()=>Y(t)?O(t).format(p):"",[t,p]);return e.jsxs(b,{style:h.container,children:[e.jsx(q,{label:s,onPress:x,ref:a,onPressRemove:c,isActive:n,value:Y(t)?O(t).format(p):m}),e.jsx(oe,{visible:n,format:p,firstWeekDay:"monday",label:s,cancelLabel:o,confirmLabel:i,value:u,isSelectable:v,validate:r,onChange:F=>{const g=O(F,p,!0).toJSON();y(g)},onDismiss:l})]})}function ye({label:s,initialValue:t="",noValueText:m,submitText:o,autoOpen:i=!1,placeholder:p,validate:v,onSave:r,onPressRemove:y}){const c=f.useRef(null),[d,{close:a,toggle:n}]=I(i),[l,x]=f.useState(t),{Field:u,submitForm:F}=ie({input:{initialValue:t,validate:v}}),g=()=>{F({onSuccess:({input:k})=>{k.isSome()&&(x(k.get()),r(k.get()),a())}})};return e.jsxs(b,{style:h.container,children:[e.jsx(q,{label:s,onPress:n,ref:c,onPressRemove:y,isActive:d,value:l===""?m:l}),e.jsx(E,{role:"listbox",matchReferenceWidth:!1,onDismiss:a,referenceRef:c,returnFocus:!1,visible:d,children:e.jsxs(b,{style:[h.dropdown,h.inputContent],children:[e.jsx(u,{name:"input",children:({error:k,value:M,onChange:j})=>e.jsx(de,{label:s,render:S=>e.jsx(me,{id:S,error:k,style:h.input,placeholder:p,value:M,onChangeText:j,onSubmitEditing:g})})}),e.jsx(B,{size:"small",color:"current",onPress:g,children:o})]})})]})}function ge({children:s,onAdd:t,onPressRemove:m}){return f.useEffect(t,[]),e.jsx(Z,{color:"current",onPressRemove:m,children:s})}const A=(s,t,m)=>t[m],N=({filters:s,openedFilters:t,definition:m,onChangeOpened:o,onChangeFilters:i})=>{const p=le(t),v=t.length>p.length?t[t.length-1]:void 0;return t.length===0?null:e.jsx(pe,{direction:"row",wrap:"wrap",children:t.map(r=>{const y=m[r];return typeof r!="string"||y==null?null:e.jsx(b,{children:W(y).with({type:"radio"},({type:c,label:d,items:a,width:n})=>e.jsx(fe,{label:d,items:a,width:n,autoOpen:v===r,onPressRemove:()=>{i({...s,[r]:void 0}),o(t.filter(l=>l!==r))},value:A(c,s,r),onValueChange:l=>i({...s,[r]:l})})).with({type:"checkbox"},({type:c,label:d,items:a,width:n,checkAllLabel:l,submitText:x})=>e.jsx(xe,{label:d,items:a,width:n,checkAllLabel:l,autoOpen:v===r,applyButtonLabel:x,value:A(c,s,r),onValueChange:u=>i({...s,[r]:u}),onPressRemove:()=>{i({...s,[r]:void 0}),o(t.filter(u=>u!==r))}})).with({type:"date"},({type:c,label:d,noValueText:a,cancelText:n,submitText:l,dateFormat:x,isSelectable:u,validate:F})=>e.jsx(ve,{label:d,noValueText:a,cancelText:n,submitText:l,dateFormat:x,autoOpen:v===r,isSelectable:u?g=>u(g,s):void 0,validate:F?g=>F(g,s):void 0,initialValue:A(c,s,r),onSave:g=>i({...s,[r]:g}),onPressRemove:()=>{i({...s,[r]:void 0}),o(t.filter(g=>g!==r))}})).with({type:"input"},({type:c,label:d,placeholder:a,noValueText:n,submitText:l,validate:x})=>e.jsx(ye,{label:d,placeholder:a,noValueText:n,submitText:l,autoOpen:v===r,validate:x,initialValue:A(c,s,r),onSave:u=>i({...s,[r]:u}),onPressRemove:()=>{i({...s,[r]:void 0}),o(t.filter(u=>u!==r))}})).with({type:"boolean"},({label:c})=>e.jsx(ge,{onAdd:()=>{i({...s,[r]:!0})},onPressRemove:()=>{i({...s,[r]:void 0}),o(t.filter(d=>d!==r))},children:c})).exhaustive()},r)})})};N.__docgenInfo={description:"",methods:[],displayName:"FiltersStack",props:{definition:{required:!0,tsType:{name:"Definition"},description:""},filters:{required:!0,tsType:{name:"State"},description:""},openedFilters:{required:!0,tsType:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},description:""},onChangeOpened:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: (keyof Definition)[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Definition)[]"},name:"value"}],return:{name:"void"}}},description:""},onChangeFilters:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: State) => void",signature:{arguments:[{type:{name:"State"},name:"value"}],return:{name:"void"}}},description:""}}};const je={type:"radio",label:"Mode",items:[{label:"QES",value:"QES"},{label:"Expert",value:"Expert"}]},be={type:"checkbox",label:"Status",submitText:"Apply",items:[{label:"Accepted",value:"Accepted"},{label:"Canceled",value:"Canceled"},{label:"Failed",value:"Failed"},{label:"Expired",value:"Expired"},{label:"CustomerRefused",value:"CustomerRefused"}]},we={type:"date",label:"Start Date",cancelText:"Cancel",submitText:"Save",noValueText:"None",dateFormat:"DD/MM/YYYY"},Fe={type:"input",label:"Resource ID",noValueText:"None",submitText:"Save",placeholder:"Placeholder..."},Se={mode:je,status:be,startDate:we,resourceId:Fe},ke=[{name:"mode",label:"Mode"},{name:"status",label:"Status"},{name:"startDate",label:"Start date"},{name:"resourceId",label:"Ressource ID"}],mt={title:"Forms/Filter",component:H},D=()=>{const[s,t]=f.useState([]),[m,o]=f.useState({mode:void 0,status:void 0,resourceId:void 0,startDate:void 0});return e.jsx(he,{title:"Filter",children:e.jsx(ne,{variant:"live",children:e.jsxs(b,{children:[e.jsx(H,{filters:m,label:"Choose filters",title:"Filters",onAddFilter:i=>t(p=>[...p,i]),availableFilters:ke,openFilters:s}),e.jsx(R,{height:8}),e.jsx(N,{definition:Se,filters:m,openedFilters:s,onChangeFilters:o,onChangeOpened:t})]})})})};D.__docgenInfo={description:"",methods:[],displayName:"All"};var Q,J,G;D.parameters={...D.parameters,docs:{...(Q=D.parameters)==null?void 0:Q.docs,source:{originalSource:`() => {
  const [openFilters, setOpenFilters] = useState<(keyof State)[]>([]);
  const [filters, setFilters] = useState<State>({
    mode: undefined,
    status: undefined,
    resourceId: undefined,
    startDate: undefined
  });
  return <StoryBlock title="Filter">
      <WithCurrentColor variant="live">
        <View>
          <FilterChooser filters={filters} label="Choose filters" title="Filters" onAddFilter={filter => setOpenFilters(filters => [...filters, filter])} availableFilters={availableFilters} openFilters={openFilters} />

          <Space height={8} />

          <FiltersStack definition={definition} filters={filters} openedFilters={openFilters} onChangeFilters={setFilters} onChangeOpened={setOpenFilters} />
        </View>
      </WithCurrentColor>
    </StoryBlock>;
}`,...(G=(J=D.parameters)==null?void 0:J.docs)==null?void 0:G.source}}};const pt=["All"];export{D as All,pt as __namedExportsOrder,mt as default};
//# sourceMappingURL=Filter.stories-DUQRlkrB.js.map
